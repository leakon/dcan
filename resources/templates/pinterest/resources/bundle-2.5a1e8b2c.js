!function(){goog.provide("P.CONST"),goog.require("P.scout.CONST");var a={SHOW:0,BUBBLE:1,REMOVE:2},b={VIEWPORT_MIDDLE:1,ANCHORED:2,MANUAL:3};P.CONST.PIN_WIDTH=P.scout.CONST.PIN_WIDTH,P.CONST.PIN_MARGIN=P.scout.CONST.PIN_MARGIN,P.CONST.MIN_COLUMNS=P.scout.CONST.MIN_COLUMNS,P.CONST.MAX_COLUMNS=P.scout.CONST.MAX_COLUMNS,P.CONST.OPEN_CONVERSATION_MIN_POLL=1e3,P.CONST.UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL=5e3,P.CONST.UPDATES_MIN_POLL=45e3,P.CONST.UPDATES_MAX_POLL=9e5,P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION=59,P.CONST.SCROLL_TO_ELEMENT_OFFSET=130,P.CONST.SCROLL_TO_TOP_ANIMATION_TIME=300,P.CONST.BOARD_PRIVACY_SECRET="secret",P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER="addHoverListenerForMapMarker",P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER="removeHoverListenerForMapMarker",P.CONST.CLASS_BUTTON_HIGHLIGHTED="buttonHighlighted",P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED="highlighted",P.CONST.COOKIE_CSRF="csrftoken",P.CONST.COOKIE_DEVICE_PIXEL_RATIO="c_dpr",P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED="ues",P.CONST.COOKIE_FB_AUTO_LOGIN_DISABLED="fba",P.CONST.COOKIE_LOCAL_STORAGE="ls",P.CONST.COOKIE_SESSION_STORAGE="ss",P.CONST.COOKIE_SKIP_NUX="d_skip_nux",P.CONST.COOKIE_NAG_LANGUAGE="nl",P.CONST.COOKIE_USER_JUST_REGISTERED="ujr",P.CONST.COOKIE_FORCE_DESKTOP="r_m",P.CONST.COOKIE_SUPPRESS_NAG_DOWNLOAD="nd",P.CONST.COOKIE_OPEN_IN_APP="open_in_app",P.CONST.COOKIE_STAY_IN_BROWSER="stay_in_browser",P.CONST.COOKIE_VERSION_REFRESH="version_refresh",P.CONST.COOKIE_REGISTER_RESTRICT="r_r",P.CONST.COOKIE_PERSONALIZE_FROM_OFFSITE_BROWSING_COOKIE_NAME="_pinterest_pfob",P.CONST.COOKIE_DUMMY_SECURE="_pinterest_d_sess",P.CONST.USER_AGENT_PLATFORM_IOS="ios",P.CONST.USER_AGENT_PLATFORM_ANDROID="android",P.CONST.SESSION_FACEBOOK_ID="_fbid",P.CONST.SESSION_FACEBOOK_TOKEN="_fbt",P.CONST.SESSION_KEY_INVITE_FOLLOW="d_pif_invite",P.CONST.SESSION_TWITTER_ID="_twid",P.CONST.SESSION_TWITTER_TOKEN="_twit",P.CONST.SESSION_TWITTER_TOKEN_SECRET="_twisc",P.CONST.SESSION_TWITTER_FIRST_NAME="_twifn",P.CONST.SESSION_TWITTER_LAST_NAME="_twiln",P.CONST.SESSION_TWITTER_USERNAME="_twiun",P.CONST.SESSION_TWITTER_IMAGE_URL="_twiiu",P.CONST.SESSION_RAKUTEN_ID="_rakuid",P.CONST.SESSION_RAKUTEN_TOKEN="_rakut",P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN="_rakurt",P.CONST.SESSION_RAKUTEN_FIRST_NAME="_rakufn",P.CONST.SESSION_RAKUTEN_EMAIL="_rakue",P.CONST.SESSION_RAKUTEN_GENDER="_rakug",P.CONST.SESSION_GPLUS_CODE="_gpc",P.CONST.SESSION_GPLUS_REDIRECT_URI="_gpuri",P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD="addPermanentMarkerToMapFromTypeahead",P.CONST.EVENT_BLUR="blur",P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP="boardCachePinIdToAddToMap",P.CONST.EVENT_BOARD_CREATE_USER_REMOVED="boardCreateUserRemoved",P.CONST.EVENT_BOARD_FOLLOW="boardFollowed",P.CONST.EVENT_BOARD_SELECTED="boardSelected",P.CONST.EVENT_BOARD_CREATED="boardCreated",P.CONST.EVENT_BOARD_UNFOLLOW="boardUnfollowed",P.CONST.EVENT_BODY_COLUMN_CHANGE="bodyColumnChange",P.CONST.EVENT_BUTTON_CLICK="buttonClick",P.CONST.EVENT_CATEGORIES_BAR_SHOWN="categoriesBarShown",P.CONST.EVENT_CATEGORIES_BAR_HIDDEN="categoriesBarHidden",P.CONST.EVENT_CENTER_MAP_GEO_FEATURE="centerMapFromGeoFeature",P.CONST.EVENT_CHANGE="change",P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT="clearPlaceholderMarkerHighlight",P.CONST.EVENT_CLOSE="close",P.CONST.EVENT_CONFIRM="confirm",P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE="conversationDecrementBadge",P.CONST.EVENT_CONVERSATION_HEAD_CLICKED="conversationHeadClicked",P.CONST.EVENT_CONVERSATION_HEAD_READY="conversationHeadReady",P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE="conversationsPreventConversationsRenderingOnChange",P.CONST.EVENT_CONVERSATIONS_IS_EMPTY="conversationsIsEmpty",P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS="conversationsIsEmptyWithoutFriends",P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED="conversationListItemClicked",P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL="conversationMessagesScroll",P.CONST.EVENT_CONTENT_CHANGED="contentChanged",P.CONST.EVENT_DATA="data",P.CONST.EVENT_DATEPICKER_DATE_SELECTED="datePickerDateSelected",P.CONST.EVENT_DATEPICKER_RANGE_SELECTED="datePickerRangeSelected",P.CONST.EVENT_DESTROYED="destroyed",P.CONST.EVENT_DIMS_CHANGED="dimsChanged",P.CONST.EVENT_DISMISS="dismiss",P.CONST.EVENT_DIALOG_BUTTON_CLICKED="dialogButtonClicked",P.CONST.EVENT_DROPDOWN_CONTAINER_HIDDEN="dropdownContainerHidden",P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN="dropdownContainerShown",P.CONST.EVENT_DROPDOWN_HIDE="dropdownHide",P.CONST.EVENT_DROPDOWN_HIDE_NOT_PROPAGATE="dropdownHideNotPropagate",P.CONST.EVENT_DROPDOWN_SHOW="dropdownShow",P.CONST.EVENT_ENTER_PRESSED="enterPressed",P.CONST.EVENT_ERROR="error",P.CONST.EVENT_ERROR_RESOLVED="errorResolved",P.CONST.EVENT_EXTERNAL_CLICK="externalLinkClicked",P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED="followpageCategorySelected",P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED="followpageSearchQueryUpdated",P.CONST.EVENT_FOCUS="focus",P.CONST.EVENT_GRID_ITEM_SELECTED="gridItemSelected",P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER="highlightPlaceholderMarker",P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE="mouseEnterComplete",P.CONST.EVENT_HOVERINTENT_ENTER_START="mouseEnterStart",P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE="mouseOutComplete",P.CONST.EVENT_HOVERINTENT_OUT_START="mouseOutStart",P.CONST.EVENT_INCREMENT_BUTTON_CREATE="incrementButtonCreate",P.CONST.EVENT_INCREMENT_BUTTON_DESTROY="incrementButtonDestroy",P.CONST.EVENT_INTEREST_FOLLOW="interestFollow",P.CONST.EVENT_INVITE_EMAIL="inviteEmail",P.CONST.EVENT_INVITE_USER="inviteUser",P.CONST.EVENT_ITEM_CLICK="itemClick",P.CONST.EVENT_ITEMS_END="itemsEnd",P.CONST.EVENT_ITEMS_REQUEST_ERROR="itemsRequestError",P.CONST.EVENT_ITEMS_REQUEST_START="itemsRequestStart",P.CONST.EVENT_ITEMS_REQUEST_SUCCESS="itemsRequestSuccess",P.CONST.EVENT_ITEM_HIGHLIGHTED="itemHighlighted",P.CONST.EVENT_ITEM_SELECTED="itemSelected",P.CONST.EVENT_LAZY_IMAGE_COMPLETE="lazyImageComplete",P.CONST.EVENT_LIST_ITEM_CLICK="listItemClick",P.CONST.EVENT_MAP_CLUSTER_CLICK="mapClusterClick",P.CONST.EVENT_MAP_DRAG_END="mapDragEnd",P.CONST.EVENT_MAP_POPUP_OPENED="mapPopupOpened",P.CONST.EVENT_MAP_READY="mapReady",P.CONST.EVENT_MAP_ZOOM_END="mapZoomEnd",P.CONST.EVENT_MODAL="modal",P.CONST.EVENT_NAVIGATE="navigate",P.CONST.EVENT_NEXT="next",P.CONST.EVENT_OPEN="open",P.CONST.EVENT_OPEN_IN_APP="openInApp",P.CONST.EVENT_MODAL_ANIMATE_HIDE_END="modalAnimateHideEnd",P.CONST.EVENT_MODAL_ANIMATE_HIDE_START="modalAnimateHideStart",P.CONST.EVENT_MODAL_ANIMATE_SHOW_END="modalAnimateShowEnd",P.CONST.EVENT_MODAL_ANIMATE_SHOW_START="modalAnimateShowStart",P.CONST.EVENT_PASTE="paste",P.CONST.EVENT_PAGE_NUMBER_CLICK="pageNumberClick",P.CONST.EVENT_PLACE_IMAGE_SELECTED="placeImageSelected",P.CONST.EVENT_PIN_CREATE="pinCreate",P.CONST.EVENT_PIN_CREATE_OPENED="pinCreateOpened",P.CONST.EVENT_PIN_DELETED="pinDeleted",P.CONST.EVENT_PIN_LIKED="pinLiked",P.CONST.EVENT_PIN_MASK_CLICKED="pinMaskClicked",P.CONST.EVENT_PIN_MOUSE_IN="pinMouseIn",P.CONST.EVENT_PIN_MOUSE_OUT="pinMouseOut",P.CONST.EVENT_PIN_PLACE_CLICK="pinPlaceClick",P.CONST.EVENT_PIN_UNLIKED="pinUnliked",P.CONST.EVENT_PIN_UPDATED="pinUpdated",P.CONST.EVENT_PINIT_BUTTON_CLICKED="pinItButtonClicked",P.CONST.EVENT_PLACE_SELECTED="placeSelected",P.CONST.EVENT_PREVIOUS="previous",P.CONST.EVENT_PROGRESS_COMPLETED="progressCompleted",P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD="removePlaceholderMarkerToMapFromTypeahead",P.CONST.EVENT_REPORT_REASON_SELECTED="reportReasonSelected",P.CONST.EVENT_REQUIRES_AUTHENTICATION="authenticationRequired",P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON="resetShowPinOnMapButtonStates",P.CONST.EVENT_RESIZE="resize",P.CONST.EVENT_ROUTE_MATCHED="routeMatched",P.CONST.EVENT_ROUTE_NO_MATCH="routeNoMatch",P.CONST.EVENT_ROW_CLICKED="rowClicked",P.CONST.EVENT_SCROLL="scroll",P.CONST.EVENT_SCROLL_TO_ELEMENT="scrollToElement",P.CONST.EVENT_SCROLL_TO_TOP="scrollToTop",P.CONST.EVENT_SEE_QUESTION="seeQuestion",P.CONST.EVENT_SEND_OBJECT_TO_USERS="sendObjectViaUsers",P.CONST.EVENT_SET_PLACEHOLDER_MARKERS="setPlaceholderMarkers",P.CONST.EVENT_STICKY_FIXED="stickyUpdate",P.CONST.EVENT_STICKY_NORMAL="stickyNormal",P.CONST.EVENT_SUBMIT_VALIDATED="submitValidated",P.CONST.EVENT_TEXT_INPUT_RESIZED="textInputResized",P.CONST.EVENT_TOAST_RENDER="toastRender",P.CONST.EVENT_TOGGLE_MARKERS_TRANSLUCENT="toggleMarkersTransparent",P.CONST.EVENT_TOKEN_ADDED="tokenAdded",P.CONST.EVENT_TOKEN_REMOVED="tokenRemoved",P.CONST.EVENT_TOKEN_REMOVED_BY_USER="tokenRemovedByUser",P.CONST.EVENT_REMOVE_TOKEN="removeToken",P.CONST.EVENT_TUTORIAL_SHOW="showTutorial",P.CONST.EVENT_TYPEAHEAD_HIDDEN="typeaheadHidden",P.CONST.EVENT_TYPEAHEAD_HINT="typeaheadHint",P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN="typeaheadMousedown",P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED="typeaheadNoResultsReturned",P.CONST.EVENT_TYPEAHEAD_RENDER_DONE="typeaheadRenderDone",P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED="typeaheadResultsReturned",P.CONST.EVENT_TYPEAHEAD_SEARCH_START="typeaheadSearchStart",P.CONST.EVENT_TYPEAHEAD_SEARCH_WORLD="typeaheadSearchWorld",P.CONST.EVENT_TYPEAHEAD_SHOWN="typeaheadShown",P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK="conversationUnreadListItemClick",P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST="updateGeoFeatureList",P.CONST.EVENT_UPLOAD_ERROR="uploadError",P.CONST.EVENT_UPLOAD_PROGRESS="uploadProgress",P.CONST.EVENT_UPLOAD_START="uploadStart",P.CONST.EVENT_UPLOAD_SUCCESS="uploadSuccess",P.CONST.EVENT_USER_CLICK="userClick",P.CONST.EVENT_USER_FOLLOW="userFollow",P.CONST.EVENT_USER_REGISTER="userRegister",P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED="visualSearchObjectTagSelected",P.CONST.EVENT_PIN_COMMENTS_TOGGLED="pinCommentsToggled",P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION="socialConnect",P.CONST.FACEBOOK_LOGIN_SUCCESS="fbLoginSuccess",P.CONST.FACEBOOK_LOGIN_FAILURE="fbLoginFailure",P.CONST.GA_ACTION_CLICK="click",P.CONST.GA_ACTION_CLICK_ACCEPT="click_accept",P.CONST.GA_ACTION_CLICK_BACK="click_back",P.CONST.GA_ACTION_CLICK_CANCEL="click_cancel",P.CONST.GA_ACTION_CLICK_CLOSE="click_close",P.CONST.GA_ACTION_CLICK_CONFIRM="click_confirm",P.CONST.GA_ACTION_CLICK_SUBMIT="click_submit",P.CONST.GA_ACTION_ENTER_SUBMIT="enter_submit",P.CONST.GA_ACTION_ERROR="error",P.CONST.GA_ACTION_OPEN_MODAL="open_modal",P.CONST.GA_ACTION_SELECT_SUBMIT="select_submit",P.CONST.GA_ACTION_SUCCESS="success",P.CONST.GA_CATEGORY_PIN_DELETE="pin_delete",P.CONST.GA_CATEGORY_PIN_EDIT="pin_edit",P.CONST.IMAGE_SIZE_ORIG="orig",P.CONST.PUBSUB_CHANNEL_BREADCRUMBS="breadcrumbs",P.CONST.PUBSUB_CHANNEL_CURRENT_USER="currentUser",P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING="contextLogging",P.CONST.PUBSUB_CHANNEL_MAIN_MODULE="mainModule",P.CONST.PUBSUB_CHANNEL_MESSAGES="messages",P.CONST.PUBSUB_CHANNEL_REQUEST="request",P.CONST.PUBSUB_CHANNEL_SITE="site",P.CONST.PUBSUB_CHANNEL_TUTORIAL="tutorial",P.CONST.PUBSUB_CHANNEL_UNAUTH_NAG="unauthNag",P.CONST.PUBSUB_MESSAGE_BOARD_SET_PUBLIC="boardSetPublic",P.CONST.PUBSUB_MESSAGE_USER_EMAIL_UPDATED="userEmailUpdated",P.CONST.PUBSUB_TOPIC_ANSWER_DELETED="answerDeleted",P.CONST.PUBSUB_TOPIC_ANSWER_LIKED="answerLiked",P.CONST.PUBSUB_TOPIC_ANSWER_REPLY_CREATED="answerReplyCreated",P.CONST.PUBSUB_TOPIC_ANSWER_REPORTED="answerReported",P.CONST.PUBSUB_TOPIC_ANSWER_UNLIKED="answerUnliked",P.CONST.PUBSUB_TOPIC_ANSWER_UPDATED="answerUpdated",P.CONST.PUBSUB_TOPIC_APP_VERSION="appVersion",P.CONST.PUBSUB_TOPIC_APP_VERSION_AVAILABLE="appVersionAvailable",P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE="boardApprovedCollaboratorInvite",P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR="boardBannedCollaborator",P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED="boardCoverUpdated",P.CONST.PUBSUB_TOPIC_BOARD_CREATED="boardCreated",P.CONST.PUBSUB_TOPIC_BOARD_DELETED="boardDeleted",P.CONST.PUBSUB_TOPIC_BOARD_FOLLOW="boardFollow",P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF="boardRemovedCollaboratorSelf",P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW="boardUnfollow",P.CONST.PUBSUB_TOPIC_BOARD_UPDATED="boardUpdated",P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED="boardWriteAccessUpdated",P.CONST.PUBSUB_TOPIC_BREADCRUMB_UPDATE="updateBreadcrumb",P.CONST.PUBSUB_TOPIC_CONSUMER_UPDATED="consumerUpdated",P.CONST.PUBSUB_TOPIC_CONSUMER_LIST_UPDATED="consumerListUpdated",P.CONST.PUBSUB_TOPIC_CONTEXT_LOG_PLAIN_OBJECT="contextLogPlainObject",P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT="conversationUnreadCount",P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE="conversationUnreadCountDecrease",P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN="conversationOpen",P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED="conversationClosed",P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER="placedExperiencesFromServer",P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY="currentCategory",P.CONST.PUBSUB_TOPIC_DEEP_LINK="deepLink",P.CONST.PUBSUB_TOPIC_HEADER_ALT_STATE="headerAltState",P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW="mainModuleNew",P.CONST.PUBSUB_TOPIC_NAG_DOWNLOAD_APP_HIDDEN="nagDownloadAppHidden",P.CONST.PUBSUB_TOPIC_NAG_STATE="nagState",P.CONST.PUBSUB_TOPIC_NAG_UPDATED="nagUpdated",P.CONST.PUBSUB_TOPIC_OBJECT_SENT="objectSent",P.CONST.PUBSUB_TOPIC_PAGE_INFO="pageInfo",P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED="pinCommentCreated",P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED="pinCommentDeleted",P.CONST.PUBSUB_TOPIC_PIN_CREATED="pinCreated",P.CONST.PUBSUB_TOPIC_PIN_DELETED="pinDeleted",P.CONST.PUBSUB_TOPIC_PIN_LIKED="pinLiked",P.CONST.PUBSUB_TOPIC_PIN_QUESTION_CREATED="pinQuestionCreated",P.CONST.PUBSUB_TOPIC_PIN_UNLIKED="pinUnliked",P.CONST.PUBSUB_TOPIC_PIN_UPDATED="pinUpdated",P.CONST.PUBSUB_TOPIC_PIN_FLAGGED="pinFlagged",P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_CLOSED="placeholderMarkerClosed",P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED="placeholderMarkerOpened",P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD="prependNewPinMapBoard",P.CONST.PUBSUB_TOPIC_QUESTION_ANSWER_CREATED="questionAnswerCreated",P.CONST.PUBSUB_TOPIC_QUESTION_DELETED="questionDeleted",P.CONST.PUBSUB_TOPIC_QUESTION_LIKED="questionLiked",P.CONST.PUBSUB_TOPIC_QUESTION_REPLY_CREATED="questionReplyCreated",P.CONST.PUBSUB_TOPIC_QUESTION_REPORTED="questionReported",P.CONST.PUBSUB_TOPIC_QUESTION_UNLIKED="questionUnliked",P.CONST.PUBSUB_TOPIC_QUESTION_UPDATED="questionUpdated",P.CONST.PUBSUB_TOPIC_REPLY_DELETED="replyDeleted",P.CONST.PUBSUB_TOPIC_REPLY_REPORTED="replyReported",P.CONST.PUBSUB_TOPIC_REPLY_UPDATED="replyUpdated",P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER="requestIdentifier",P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_HIDDEN="scrollToTopHidden",P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_VISIBLE="scrollToTopVisible",P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED="searchQueryUpdated",P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_WITH_EMPTY_QUERY="searchQueryUpdatedWithEmptyQuery",P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED="searchScopeUpdated",P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED="searchBoostUpdated",P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED="searchGuideSelected",P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED="socialNetworkUpdated",P.CONST.PUBSUB_TOPIC_TOPIC_MAP_DRAGGED="mapDragged",P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT="tutorialNext",P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT="tutorialMiniNext",P.CONST.PUBSUB_TOPIC_USER_BLOCKED="userBlocked",P.CONST.PUBSUB_TOPIC_USER_FOLLOW="userFollow",P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED="userUnblocked",P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW="userUnfollow",P.CONST.PUBSUB_TOPIC_USER_UPDATED="userUpdated",P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD="userChangedPassword",P.CONST.PUBSUB_TOPIC_UNAUTH_NAG_TYPE="unauthNagType",P.CONST.PUBSUB_TOPIC_WINDOW_LOCATION_CHANGE="windowLocationChange",P.CONST.PUBSUB_TOPIC_PIN_REPINNED="pinRepinned",P.CONST.PUBSUB_TOPIC_PIN_COMMENT_POPULATED="pinCommentPopulated",P.CONST.MAX_CHARS_FOR_BOARD_TITLE=100,P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION=160,P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION=500,P.CONST.OVERFLOWING_TEXT_OVERFLOWING_CLASS="overflowing",P.CONST.CLASS_DROPPABLE_HOVER="droppableHover",P.CONST.MIN_PINNABLE_IMAGE_HEIGHT=50,P.CONST.MIN_PINNABLE_IMAGE_WIDTH=100,P.CONST.ErrorStrategy=a,P.CONST.PositionMode=b,P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE="results_empty",P.CONST.TYPEAHEAD_CATEGORY_CITY="City",P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER="gplus_non_pinner",P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER="facebook_non_pinner",P.CONST.BOARD_LAYOUT_PLACES="places",P.CONST.API_ERROR_PIN_NOT_FOUND=50,P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE=85,P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT=93,P.CONST.QA_TUTORIAL_SCROLL_OFFSET=200;var c,d,e=parseInt("0000000000001",2),f=0;P.CONST.PositionPointFlag={},_.each(["VERTICAL","HORIZONTAL"],function(a){d=0,_.each(["BOTTOM","LEFT","CENTER","RIGHT","TOP"],function(b){c=e<<f++,d|=c,P.CONST.PositionPointFlag["FLAG_"+a+"_"+b]=c}),P.CONST.PositionPointFlag["FLAG_"+a]=d});var g=P.CONST.PositionPointFlag;P.CONST.PositionPoint={BOTTOM_CENTER:g.FLAG_VERTICAL_BOTTOM|g.FLAG_VERTICAL_CENTER,BOTTOM_LEFT:g.FLAG_VERTICAL_BOTTOM|g.FLAG_VERTICAL_LEFT,BOTTOM_RIGHT:g.FLAG_VERTICAL_BOTTOM|g.FLAG_VERTICAL_RIGHT,TOP_CENTER:g.FLAG_VERTICAL_TOP|g.FLAG_VERTICAL_CENTER,TOP_LEFT:g.FLAG_VERTICAL_TOP|g.FLAG_VERTICAL_LEFT,TOP_RIGHT:g.FLAG_VERTICAL_TOP|g.FLAG_VERTICAL_RIGHT,LEFT_BOTTOM:g.FLAG_HORIZONTAL_LEFT|g.FLAG_HORIZONTAL_BOTTOM,LEFT_CENTER:g.FLAG_HORIZONTAL_LEFT|g.FLAG_HORIZONTAL_CENTER,LEFT_TOP:g.FLAG_HORIZONTAL_LEFT|g.FLAG_HORIZONTAL_TOP,RIGHT_BOTTOM:g.FLAG_HORIZONTAL_RIGHT|g.FLAG_HORIZONTAL_BOTTOM,RIGHT_CENTER:g.FLAG_HORIZONTAL_RIGHT|g.FLAG_HORIZONTAL_CENTER,RIGHT_TOP:g.FLAG_HORIZONTAL_RIGHT|g.FLAG_HORIZONTAL_TOP},P.CONST.SEARCH_FILTER_CONJUNCTIONS=["and","that","but","or","as","if","when","than","because","while","where","after","so","though","since","until","whether","before","although","nor","like","once","unless","now","except","the","a","an","san","for","in","with"],P.CONST.INTEREST_LIST_FAVORITED="favorited",P.CONST.INTEREST_LIST_USER_ADDED="user_added"}(),function(){goog.provide("P.csrf"),goog.require("P.CONST"),goog.require("P.url"),P.Csrf={},P.csrf.addCsrfToken=function(){$(document).ajaxSend(function(a,b,c){P.csrf._needsCsrfToken(c.type,c.url)&&b.setRequestHeader("X-CSRFToken",P.csrf.getCSRFToken())})},P.csrf.cleanUpCookie=function(){var a=P.CONST.COOKIE_CSRF,b=document.cookie.match(new RegExp(a+"=.+?($|;)","g")),c=b&&b.length>1;c&&(document.cookie=P.CONST.COOKIE_CSRF+"=bad; expires=Thu, 01-Jan-1970 00:00:00 GMT; Max-Age=0; Path=/")},P.csrf.getCSRFToken=function(){return Cookie.get(P.CONST.COOKIE_CSRF)},P.csrf._isSafeMethod=function(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)},P.csrf._needsCsrfToken=function(a,b){return!P.csrf._isSafeMethod(a)&&P.url.isTrustedOrigin(b)}}(),function(){goog.provide("P.NOOP"),goog.provide("P.state"),goog.provide("P.Mixins"),goog.provide("P.app"),goog.require("P.csrf"),_.bindFn=_.bind,P.NOOP=function(){},P.state={activeTarget:null},P.Mixins={},P.app=null,P.csrf.cleanUpCookie(),P.csrf.addCsrfToken(),$(document).ajaxSend(function(a,b){b.setRequestHeader("X-NEW-APP","1")})}(),function(){goog.provide("P.interfaces.ILogger");var a={FINEST:0,FINER:1,FINE:2,INFO:3,WARN:4,ERROR:5,NONE:6},b={LOG:"log",ERROR:"error",PAGE_LOAD_METRIC:"page_load_metric",APP_METRIC:"app_metric"},c={GET:"get",POST:"post"};P.Logger={LOG_LEVEL:a,LOGGABLE_HTTP_METHOD:c,SERVER_LOG_TYPE:b},P.interfaces.ILogger=function(){},_.extend(P.interfaces.ILogger.prototype,{finest:function(){},finer:function(){},fine:function(){},debug:function(){},warn:function(){},error:function(){},setLogLevel:function(){},logToServer:function(){}})}(),function(){goog.provide("P.interfaces.IHistoryNavigator"),goog.require("P.navigateData.NavigateData"),P.interfaces.IHistoryNavigator=function(){},P.interfaces.IHistoryNavigator.prototype.navigate=function(){};var a=function(){};a.prototype.navigate=function(){},P._historyNavigator=null,P.setHistoryNavigator=function(a){P._historyNavigator=a},P.getHistoryNavigator=function(){return P._historyNavigator},P.setHistoryNavigator(new a)}(),function(){goog.provide("P.interfaces.IModalManager"),P.interfaces.IModalManager=function(){},_.extend(P.interfaces.IModalManager.prototype,{showModal:function(){},removeModal:function(){},removeAllModals:function(){},showInModal:function(){}});var a=function(){};_.extend(a.prototype,{showModal:function(){},removeModal:function(){},removeAllModals:function(){},showInModal:function(){}}),P.setModalManager=function(a){P._modalManager=a},P.setModalManager(new a),P.getModalManager=function(){return P._modalManager}}(),function(){goog.provide("P.interfaces.IResource"),goog.require("P.resourceResponse");P.interfaces.IResource=function(){},_.extend(P.interfaces.IResource.prototype,Backbone.Events),_.extend(P.interfaces.IResource.prototype,{getName:function(){},setOptions:function(){},set:function(){},get:function(){},copyOptions:function(){},callGet:function(){},callCreate:function(){},callUpdate:function(){},callDelete:function(){},abort:function(){},resetBookmark:function(){},setBookmarks:function(){},getLatestBookmark:function(){},atEnd:function(){},isEqual:function(){},toString:function(){},isCalling:function(){}})}(),function(){goog.provide("P.interfaces.IStorage"),P.interfaces.IStorage=function(){},P.interfaces.IStorage.prototype.length=function(){},P.interfaces.IStorage.prototype.key=function(){},P.interfaces.IStorage.prototype.getItem=function(){},P.interfaces.IStorage.prototype.setItem=function(){},P.interfaces.IStorage.prototype.removeItem=function(){},P.interfaces.IStorage.prototype.clear=function(){}}(),function(){goog.provide("P.interfaces.IWindowManager"),P.interfaces.IWindowManager=function(){},_.extend(P.interfaces.IWindowManager.prototype,{open:function(){},_makeWindowOptions:function(){},shrinkWrap:function(){},contain:function(){}}),P.setWindowManager=function(a){P._window=a},P.getWindowManager=function(){return P._window}}(),goog.provide("P.contextEvent"),goog.require("P.ContextLogging.ComponentType"),goog.require("P.ContextLogging.ElementType");var ContextEvent=function(a,b,c,d,e,f,g,h){this._eventType=a,this._viewType=b,this._viewParameter=c,this._helperData=d,this._requestIdentifier=e,this._element=f,this._component=g,this._time=null,this._eventData={},this._auxData={},this._objectIdStr=h};ContextEvent.prototype.appendPinImpressions=function(a){this._eventData.pinImpressions=this.getPinImpressions().concat(a)},ContextEvent.prototype.copyViewContext=function(a){this._viewType=a.getViewType(),this._viewParameter=a.getViewParameter(),this._helperData=$.extend(!0,{},a.getHelperData())},ContextEvent.prototype.getEventType=function(){return this._eventType},ContextEvent.prototype.getHelperData=function(){return this._helperData},ContextEvent.prototype.getPinImpressions=function(){return this._eventData.pinImpressions||[]},ContextEvent.prototype.getViewParameter=function(){return this._viewParameter},ContextEvent.prototype.getViewType=function(){return this._viewType},ContextEvent.prototype.hasSameViewContext=function(a){return this.getViewType()===a.getViewType()&&this.getViewParameter()===a.getViewParameter()&&_.isEqual(this.getHelperData(),a.getHelperData())},ContextEvent.prototype.setEventType=function(a){this._eventType=a},ContextEvent.prototype.setObjectIdStr=function(a){this._objectIdStr=a},ContextEvent.prototype.setPinImpressions=function(a){this._eventData.pinImpressions=a},ContextEvent.prototype.setComponent=function(a){this._component=a},ContextEvent.prototype.setElement=function(a){this._element=a},ContextEvent.prototype.updateAuxData=function(a){this._auxData=_.extend(this._auxData,a)},ContextEvent.prototype.setRequestIdentifier=function(a){this._requestIdentifier=a},ContextEvent.prototype.setTime=function(a){this._time=a},ContextEvent.prototype.toSerializable=function(){var a={event_type:this._eventType,view_type:this._viewType,view_parameter:this._viewParameter,helper_data:this._helperData,request_identifier:this._requestIdentifier,element:this._element,component:this._component,time:this._time,event_data:this._eventData,aux_data:this._auxData};return this._objectIdStr&&(a[P.ContextEvent.KEY_OBJECT_ID_STR]=this._objectIdStr),a},P.ContextEvent={},Pc.TEST_MODE&&(P.ContextEvent=ContextEvent),P.ContextEvent.KEY_EVENT_TYPE="event_type",P.ContextEvent.KEY_OBJECT_ID_STR="object_id_str",P.ContextEvent.fromEventType=function(a){var b=P.ContextEvent.fromPlainObject({});return b.setEventType(a),b},P.ContextEvent.fromPlainObject=function(a){return new ContextEvent(a.event_type,a.view_type,a.view_parameter,a.helper_data,a.request_identifier,a.element,a.component,a.object_id_str)},function(){goog.provide("P.storage"),goog.require("P.interfaces.IStorage");var a=function(a){this._cookieKey=a};_.extend(a.prototype,{length:function(){var a=Cookie.get(this._cookieKey),b=a?JSON.parse(a):{};return _.keys(b).length},key:function(){throw new Error("intentionally unimplemented function")},getItem:function(a){var b=Cookie.get(this._cookieKey);if(b){var c=b.toLowerCase();("true"===c||"false"===c)&&(b=c)}var d=b?JSON.parse(b):{};return d[a]},setItem:function(a,b){var c=Cookie.get(this._cookieKey),d=c?JSON.parse(c):{};d[a]=b,Cookie.set(this._cookieKey,JSON.stringify(d))},removeItem:function(a){var b=Cookie.get(this._cookieKey),c=b?JSON.parse(b):{};delete c[a],Cookie.set(this._cookieKey,JSON.stringify(c))},clear:function(){Cookie.unset(this._cookieKey)}});var b=function(){};_.extend(b.prototype,{length:function(){return window.sessionStorage.length},key:function(){throw new Error("intentionally unimplemented function")},getItem:function(a){var b=window.sessionStorage.getItem(a);return null!=b?JSON.parse(b):null},setItem:function(a,b){window.sessionStorage.setItem(a,JSON.stringify(b))},removeItem:function(a){window.sessionStorage.removeItem(a)},clear:function(){window.sessionStorage.clear()}});var c=function(){};_.extend(c.prototype,{length:function(){return window.localStorage.length},key:function(){throw new Error("intentionally unimplemented function")},getItem:function(a){var b=window.localStorage.getItem(a);return null!=b?JSON.parse(b):b},setItem:function(a,b){window.localStorage.setItem(a,JSON.stringify(b))},removeItem:function(a){window.localStorage.removeItem(a)},clear:function(){window.localStorage.clear()}});var d=function(d){var e;try{e=d?window.sessionStorage:window.localStorage}catch(f){e=null}var g=d?P.CONST.COOKIE_SESSION_STORAGE:P.CONST.COOKIE_LOCAL_STORAGE,h=!1,i=e;if(i)try{i.setItem("testing","test"),i.removeItem("testing")}catch(f){if(f.code!==window.DOMException.QUOTA_EXCEEDED_ERR||0!==i.length)throw f;h=!0}else h=!0;return h?new a(g):d?new b:new c};P.SessionStorage=d(!0),P.LocalStorage=d(!1),Pc.TEST_MODE&&(P.CookieBackedStorage=a,P.WindowSessionStorage=b,P.WindowLocalStorage=c,P.FakeStorage=function(){this.len=0,this.storage={}},_.extend(P.FakeStorage.prototype,{length:function(){return this.length},key:function(){throw new Error("intentionally unimplemented function")},getItem:function(a){return this.storage[a]},setItem:function(a,b){this.storage[a]=b},removeItem:function(a){delete this.storage[a]},clear:function(){this.storage.key={}}}))}(),function(){goog.provide("P.logger"),goog.require("P.interfaces.ILogger");var a=function(a){this.name=a;var b;if(P.DEBUG){var c=P.LocalStorage.getItem(this._getStorageKey());null!==c&&void 0!==c&&(b=parseInt(c,10))}void 0===b&&(b=P.DEBUG?P.Logger.LOG_LEVEL.FINE:P.Logger.LOG_LEVEL.NONE),this.setLogLevel(b)},b=window.navigator.userAgent,c=window.navigator.platform;_.extend(a.prototype,{finest:function(){var a=_.toArray(arguments);this._addLogName(a),this._printToConsole(P.Logger.LOG_LEVEL.FINEST,a)},finer:function(){var a=_.toArray(arguments);this._addLogName(a),this._printToConsole(P.Logger.LOG_LEVEL.FINER,a)},fine:function(){var a=_.toArray(arguments);this._addLogName(a),this._printToConsole(P.Logger.LOG_LEVEL.FINE,a)},debug:function(){return this.fine.apply(this,arguments)},warn:function(){var a=_.toArray(arguments);this._addLogName(a),this._printToConsole(P.Logger.LOG_LEVEL.WARN,a)},error:function(){var a=_.toArray(arguments);this._addLogName(a),this._printToConsole(P.Logger.LOG_LEVEL.ERROR,a);var b=a.shift(),c={message:b,messages:a};this.logToServer(P.Logger.SERVER_LOG_TYPE.ERROR,"post",c)},setLogLevel:function(a){this.logLevel=a,P.DEBUG&&P.LocalStorage.setItem(this._getStorageKey(),a)},_getStorageKey:function(){return"logLevels."+this.name},_addLogName:function(a){a[0]=this.name+": "+a[0]},_printToConsole:function(a,b){var c=window.console||null;if(c&&!(this.logLevel>a)){var d;a===P.Logger.LOG_LEVEL.ERROR&&c.error?d=c.error:a===P.Logger.LOG_LEVEL.WARN&&c.warn?d=c.warn:c.log&&(d=c.log),d&&Function.prototype.apply.apply(d,[c,b])}},logToServer:function(a,b,c){var d=this;this._logToServer(a,b,c).fail(function(c,e,f){var g={message:"Failed to log error!",logType:a,method:b,textStatus:e,serverErrorText:f,jqXhrStatus:c.status};d._logToServer(P.Logger.SERVER_LOG_TYPE.ERROR,"post",g)})},_logToServer:function(a,d,e){var f="/_/_/report/"+a+"/",g={app_version:P.AppVersion.currentVersion,current_url:window.location.href,user_agent:b,platform:c,app_invalid:P.AppVersion.isNewVersionRequired(),page_load_request_identifier:P.PAGE_LOAD_REQUEST_IDENTIFIER};P.state.activeTarget&&(g.active_target=P.state.activeTarget.getFullName());var h,i={report_context:JSON.stringify(g),report_data:JSON.stringify(e)};return h="get"===d?$.get(f,i):$.post(f,i)}});var d=[],e={};_.extend(P.Logger,{getLogger:function(b){var c=e[b];return c||(c=new a(b),e[b]=c,d.push(c)),c},getAll:function(){return d},getByName:function(a){return e[a]}}),Pc.TEST_MODE&&(P.Logger.clear=function(){d=[],e={}})}(),function(){goog.provide("P.contextLogger"),goog.require("P.logger");var a=P.Logger.getLogger("P.contextLogger"),b=function(){this._events=[],this._currentViewContext=null,this._logTimeout=null,$(window).on("beforeunload",_.bindFn(function(){this.flushEvents(!0)},this))};b.FLUSH_INTERVAL_MS=1e4,b.prototype.addEvent=function(c,d){var e=c.getEventType();if(null!==e&&void 0!==e){if(d&&(this._lastLoggedEvent=d.originalEvent),c.getEventType()===P.ContextLogging.EventType.VIEW)this._currentViewContext=P.ContextEvent.fromPlainObject({}),this._currentViewContext.copyViewContext(c);else{if(!this._currentViewContext)return;c.copyViewContext(this._currentViewContext);var f=P.ContextLogging.EventType.PIN_IMPRESSION_ONE_PIXEL;if(c.getEventType()===f){var g=_.last(this._events);if(g&&g.hasSameViewContext(c)&&g.getEventType()===f)return void g.appendPinImpressions(c.getPinImpressions())}}c.setTime(this._currentNs()),this._events.push(c),a.fine("addEvent",c),this._logTimeout||(this._logTimeout=P.setTimeout(_.bindFn(this.flushEvents,this),b.FLUSH_INTERVAL_MS))}},b.prototype.clearContext=function(){this._currentViewContext=null},b.prototype.eventLogged=function(a){return this._lastLoggedEvent===a.originalEvent},b.prototype.flushEvents=function(a){if(this._events.length){for(var b=[],c=0;c<this._events.length;c++)b.push(this._events[c].toSerializable());this._reset();var d=P.resourceFactory.create("ContextLogResource",{events:b,report_time:this._currentNs()}),e={async:!a,error:P.NOOP};d.callCreate(e)}},b.prototype._currentNs=function(){return 1e6*Date.now()},b.prototype._reset=function(){this._events=[],clearTimeout(this._logTimeout),this._logTimeout=null},P.ContextLogger={},Pc.TEST_MODE&&(P.ContextLogger=b);var c=null;P.ContextLogger.getInstance=function(){return c||(c=new b,P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,P.CONST.PUBSUB_TOPIC_CONTEXT_LOG_PLAIN_OBJECT,function(a,b,c){if(P.ContextEvent.KEY_EVENT_TYPE in c){var d=P.ContextEvent.fromPlainObject(c);P.ContextLogger.getInstance().addEvent(d)}})),c}}(),goog.provide("P.ContextLogging"),P.ContextLogging={},goog.provide("P.ContextLogging.ViewType"),P.ContextLogging.ViewType={ABOUT:6,ANALYTICS_DOMAIN:40,ANALYTICS_PROFILE:39,ANDROID_WIDGET:13,ANDROID_WIDGET_FEED:26,BOARD:5,BOARD_PICKER:21,BOOKMARKLET:12,BROWSER:11,CAMERA:15,CATEGORY_GRID:19,CONVERSATION:42,DEEP_LINKING:20,DISCOVER:22,EDUCATION:23,EMAIL:31,ERROR:17,EXPLORE_FEED:28,EXPLORE_PAGE:27,FEED:1,FEED_EDITOR:25,FIND_FRIENDS:30,FRIEND_INVITER:8,FRIEND_MULTI_INVITER:29,LOGIN:9,NEWS:18,ORIENTATION:24,OTHER_EXTERNAL:32,PIN:3,REGISTRATION:10,REPORT:16,SEARCH:2,SERVICE_ENTRY_SEO:34,SERVICE_ENTRY_SOCIAL:33,SETTINGS:7,SPLASH:14,STERLING_ADVERTISER:36,STERLING_CAMPAIGN:37,STERLING_CREATION_FLOW:35,STERLING_PIN_PROMOTION:38,STORIES:41,USER:4},goog.provide("P.ContextLogging.ViewParameterType"),P.ContextLogging.ViewParameterType={ABOUT_ABOUT:77,ABOUT_BOOKMARKLET:62,ABOUT_CAREERS:79,ABOUT_COPYRIGHT:84,ABOUT_ETIQUETTE:76,ABOUT_GOODIES:78,ABOUT_PRESS:81,ABOUT_PRIVACY:82,ABOUT_SUPPORT:61,ABOUT_TEAM:80,ABOUT_TERMS:60,ABOUT_USE:83,ANALYTICS_DOMAIN_ALL_TIME:2315,ANALYTICS_DOMAIN_CLICKS:2313,ANALYTICS_DOMAIN_IMPRESSIONS:2311,ANALYTICS_DOMAIN_ORIGINAL_PINS:2314,ANALYTICS_DOMAIN_REPINS:2312,ANALYTICS_PROFILE_ALL_TIME:2304,ANALYTICS_PROFILE_CLICKS:2303,ANALYTICS_PROFILE_IMPRESSIONS:2301,ANALYTICS_PROFILE_REPINS:2302,BOARD_COLLABORATORS:90,BOARD_CREATE:87,BOARD_EDIT:88,BOARD_EDIT_COLLABORATORS:104,BOARD_FOLLOWERS:54,BOARD_MAP:122,BOARD_PLACE:121,BOARD_SETTINGS:55,CATEGORY_DISCOVER:91,CONVERSATION_CREATE:201,CONVERSATION_INBOX:203,CONVERSATION_THREAD:202,DEEP_LINKING_APP:115,DEEP_LINKING_FACEBOOK:114,DEPRECATED_DEEP_LINKING_EMAIL:112,DEPRECATED_DEEP_LINKING_WEB:113,DISCOVER_CATEGORY:137,DISCOVER_INTEREST:138,DISCOVER_SEARCH_INTERESTS:185,EDUCATION_CONTEXTUAL_MENU:108,EDUCATION_GUIDED_SEARCH:184,EDUCATION_LONGPRESS:94,EDUCATION_RELATED_PINS:101,EDUCATION_SECRET_BOARD:95,EMAIL_ACTIVITY_AGGREGATION:2003,EMAIL_ANSWER_CREATE:2019,EMAIL_ANSWER_LIKE:2021,EMAIL_BOARD_RECOMMENDATIONS:2011,EMAIL_COMMENT_AND_MENTION:2013,EMAIL_EDITORIAL:2002,EMAIL_FIREHOSE_ANSWER_CREATE:2016,EMAIL_FIREHOSE_QUESTION_CREATE:2015,EMAIL_FIREHOSE_REPLY_CREATE:2017,EMAIL_FRIEND_JOINED:2009,EMAIL_PARTNER:2023,EMAIL_PIN_RECOMMENDATIONS:2012,EMAIL_QUESTION_CREATE:2018,EMAIL_QUESTION_LIKE:2020,EMAIL_RECOMMENDATIONS_DIGEST:2004,EMAIL_REPLY_CREATE:2022,EMAIL_SEND_BOARD:2007,EMAIL_SEND_PIN:2006,EMAIL_SEND_PINNER:2008,EMAIL_SOCIAL_DIGEST:2005,EMAIL_TRANSACTIONAL:2001,EMAIL_UNKNOWN:2e3,EMAIL_USECASES:2014,EMAIL_WELCOME:2010,ERROR_NO_ACTIVITY:70,ERROR_NO_BOARD:68,ERROR_NO_INTERNET:66,ERROR_NO_PIN:67,ERROR_NO_USER:69,EXTERNAL_SOURCE_OTHER:1900,FEED_CATEGORY_ANIMALS:5,FEED_CATEGORY_ARCHITECTURE:6,FEED_CATEGORY_ART:7,FEED_CATEGORY_CARS_MOTORCYCLES:8,FEED_CATEGORY_CELEBRITIES:9,FEED_CATEGORY_CHRISTMAS_SWEATER:130,FEED_CATEGORY_DESIGN:10,FEED_CATEGORY_DIY_CRAFTS:11,FEED_CATEGORY_EDUCATION:12,FEED_CATEGORY_FILM_MUSIC_BOOKS:13,FEED_CATEGORY_FOOD_DRINK:14,FEED_CATEGORY_GARDENING:15,FEED_CATEGORY_GEEK:16,FEED_CATEGORY_HAIR_BEAUTY:17,FEED_CATEGORY_HEALTH_FITNESS:18,FEED_CATEGORY_HISTORY:19,FEED_CATEGORY_HOLIDAYS_EVENTS:20,FEED_CATEGORY_HOLIDAY_FOR_ALL:127,FEED_CATEGORY_HOLIDAY_FOR_HER:125,FEED_CATEGORY_HOLIDAY_FOR_HIM:124,FEED_CATEGORY_HOLIDAY_FOR_KIDS:126,FEED_CATEGORY_HOME_DECOR:21,FEED_CATEGORY_HUMOR:22,FEED_CATEGORY_ILLUSTRATIONS_POSTERS:23,FEED_CATEGORY_KIDS:24,FEED_CATEGORY_MENS_FASHION:25,FEED_CATEGORY_OUTDOORS:26,FEED_CATEGORY_PHOTOGRAPHY:27,FEED_CATEGORY_PRODUCTS:28,FEED_CATEGORY_QUOTES:29,FEED_CATEGORY_SCIENCE_NATURE:30,FEED_CATEGORY_SPORTS:31,FEED_CATEGORY_TATTOOS:32,FEED_CATEGORY_TECHNOLOGY:33,FEED_CATEGORY_TRAVEL:34,FEED_CATEGORY_WEDDINGS:35,FEED_CATEGORY_WOMENS_FASHION:36,FEED_DOMAIN:129,FEED_EDITOR_FOLLOW_BOARDS:109,FEED_EDITOR_UNFOLLOW_BOARDS:110,FEED_EVERYTHING:2,FEED_FOLLOWING:0,FEED_FRIENDS:1,FEED_GIFTS:85,FEED_GIFTS_100_200:40,FEED_GIFTS_20:37,FEED_GIFTS_200_500:41,FEED_GIFTS_20_50:38,FEED_GIFTS_500:42,FEED_GIFTS_50_100:39,FEED_HOME:92,FEED_INTEREST:136,FEED_PLACES:200,FEED_POPULAR:3,FEED_RELATED_BOARD:116,FEED_RELATED_INTEREST:117,FEED_SOURCE:4,FEED_SUBCATEGORY:120,FEED_TOP_PICKS:111,FEED_VIDEOS:128,FEED_WELCOME:118,FIND_FRIENDS:135,FRIEND_INVITER_EMAIL:56,FRIEND_INVITER_FACEBOOK:57,FRIEND_INVITER_FIND_FRIENDS:131,FRIEND_INVITER_GMAIL:58,FRIEND_INVITER_INVITE:132,FRIEND_INVITER_TWITTER:133,FRIEND_INVITER_YAHOO:59,LOGIN_EMAIL:63,LOGIN_FACEBOOK:64,LOGIN_TWITTER:65,MOBILE_ORIENTATION_COLLECT:97,MOBILE_ORIENTATION_DISCOVER:96,MOBILE_ORIENTATION_FUNCTIONAL:98,MOBILE_ORIENTATION_STORY:99,ORIENTATION_END:171,ORIENTATION_FAST_FOLLOW:102,ORIENTATION_INTEREST_PICKER:172,ORIENTATION_START:170,ORIENTATION_USER_PICKER:173,PICKED_FOR_YOU_FEED:106,PIN_ANSWERS:187,PIN_ARTICLE:141,PIN_COMMENTS:152,PIN_CREATE:73,PIN_CREATE_PINMARKLET:119,PIN_CREATE_PLACES:150,PIN_CREATE_REPIN:72,PIN_CREATE_SDK:100,PIN_EDIT:89,PIN_LIKES:151,PIN_MOVIE:142,PIN_OTHER:139,PIN_PLACE:143,PIN_PRODUCT:144,PIN_QUESTIONS:186,PIN_RECIPE:145,PIN_REGULAR:140,PIN_REPIN_BOARDS:153,PIN_REPLIES:188,PIN_SEND_TO:105,REGISTRATION_BOARDS:48,REGISTRATION_LANDING:46,REGISTRATION_SIGNUP:47,REPORT_PIN:71,REPORT_USER:86,SEARCH_AUTOCOMPLETE:103,SEARCH_BOARDS:44,SEARCH_INTERESTS:182,SEARCH_MY_PINS:107,SEARCH_PINS:43,SEARCH_PLACES:123,SEARCH_PLACE_BOARDS:181,SEARCH_USERS:45,SERVICE_ENTRY_SEO_BING:2112,SERVICE_ENTRY_SEO_GOOGLE:2110,SERVICE_ENTRY_SEO_YAHOO:2111,SERVICE_ENTRY_SOCIAL_FACEBOOK:2101,SERVICE_ENTRY_SOCIAL_TWITTER:2102,SPLASH_INSPIRED_WALL:161,SPLASH_LOADING:160,STERLING_ADVERTISER_DASHBOARD:2208,STERLING_ADVERTISER_EDIT:2209,STERLING_ADVERTISER_EDIT_BILLING:2211,STERLING_ADVERTISER_SEARCH:2210,STERLING_CAMPAIGN_DASHBOARD:2206,STERLING_CAMPAIGN_EDIT:2207,STERLING_CREATION_FLOW_BILLING:2203,STERLING_CREATION_FLOW_PICK_A_PIN:2201,STERLING_CREATION_FLOW_SETUP_DETAILS:2202,STERLING_PIN_PROMOTION_DASHBOARD:2204,STERLING_PIN_PROMOTION_EDIT:2205,STORIES_RELATED_BOARDS:192,STORIES_RELATED_PINS:190,STORIES_RELATED_USERS:191,USER_ABOUT:75,USER_ACTIVITY:53,USER_BOARDS:49,USER_EDIT:93,USER_FOLLOWERS:50,USER_FOLLOWING:51,USER_FYP:189,USER_INTERESTS:183,USER_LIKES:52,USER_PINS:74},goog.provide("P.ContextLogging.ComponentType"),P.ContextLogging.ComponentType={BOARD_PINS_GRID:29,BROWSER:17,BULK_INVITE:37,CATEGORIES_CAROUSEL:42,CONTEXTUAL_MENU:18,CONTEXTUAL_USER_EDUCATION:52,DISCOVER_FEATURED_CAROUSEL:49,DOMAIN:30,EDUCATION:14,FLOWED_BOARD:1,FLOWED_CATEGORY:11,FLOWED_PIN:0,HOMEFEED_INVITE_MODULE:24,INTEREST_CAROUSEL:40,INTEREST_GRID:36,INTEREST_RELATED_CAROUSEL:41,LIST_HEADER:27,MAP:26,MODAL_ADD_PIN:7,MODAL_CREATE_BOARD:12,MODAL_DIALOG:9,MODAL_PIN:4,MODAL_POST_REPIN:6,MODAL_REPIN:5,NAG:19,NAVIGATION:8,NEWS_FEED:3,ORIENTATION:16,PINNER_CAROUSEL:50,REGISTRATION:15,RELATED_BOARDS:31,RELATED_INTERESTS:39,SEARCH_BOX:43,SEARCH_GUIDES_CONTAINER:47,SEARCH_INTEREST_RESULTS_GRID:44,SEARCH_RELATED_CATEGORIES:33,SEARCH_RELATED_QUERIES:32,SEGMENTED_CONTROL:51,SHEET:13,STORIES_FEED:48,SUGGESTED_USERS:2,TOAST:20,TRENDING_CATEGORIES:25,TYPEAHEAD_SUGGESTIONS:35,USER_FEED:10,USER_MENU_DROPDOWN:46,USER_NEWS:38,USER_REPINS_FROM:28,USER_SELECT_SEARCH_BOX:34,VISUAL_SEARCH_GRID:45,WIDGET_ACTION_BAR:21,WIDGET_FOOTER:23,WIDGET_HEADER:22},goog.provide("P.ContextLogging.ElementType"),P.ContextLogging.ElementType={ADD_INTEREST_BUTTON:229,ADD_MESSAGE_BUTTON:99,ADD_PIN_FROM_WEBSITE_BUTTON:250,ADD_PLACE_BUTTON:165,ANALYTICS_BUTTON:24,APP_ICON:137,APP_RATING_ATTEMPT_BUTTON:205,APP_RATING_DECLINE_BUTTON:206,APP_RATING_REMIND_BUTTON:207,AUTOCOMPLETE_SUGGESTION:104,BACK_BUTTON:34,BOARD_CATEGORY:51,BOARD_COVER:36,BOARD_CREATE:22,BOARD_CREATE_SECRET:90,BOARD_CREATE_SUGGESTED:23,BOARD_DELETE_BUTTON:50,BOARD_DESCRIPTION:93,BOARD_EDIT_BUTTON:81,BOARD_FOLLOW:37,BOARD_LEAVE_BUTTON:97,BOARD_NAME:52,BOARD_PICKER:67,BOARD_RELATED_BOARD:180,BOARD_SECRET:53,BROWSER_BUTTON:79,BROWSER_WEB_IMAGE:109,BULK_INVITER_BUTTON:215,BUY_BUTTON:201,CAMERA_BUTTON:54,CANCEL_BUTTON:73,CATEGORY_ICON:38,CATEGORY_RECENT:127,CHANGE_PASSWORD_BUTTON:128,CLEAR_CONTACTS_BUTTON:115,CLEAR_HISTORY_BUTTON:102,CLEAR_SEARCHES_BUTTON:114,CLIPBOARD_BUTTON:101,CLOSE_BUTTON:75,COLLABORATOR_TEXT:171,COMPOSE_SMS_INVITE_BUTTON:210,COPY_LINK_BUTTON:100,COUNTRY_BUTTON:124,CREATE_BOARD_BUTTON:249,CREATE_BUTTON:44,DECLINE_BUTTON:86,DISCOVER_FEATURED_ITEM:265,DISCOVER_TRENDING_CATEGORY:153,DOMAIN_URL:177,DONE_BUTTON:76,DUPLICATE_PIN_WARNING:120,EDIT_HOME_FEED_BUTTON:117,EDUCATION_GUIDED_SEARCH_COMPLETE_BUTTON:232,EDUCATION_GUIDED_SEARCH_SUGGESTION:231,EDUCATION_TARGET:95,EMAIL_BUTTON:123,EXPLORE_BUTTON:78,FACEBOOK_CONNECT:68,FACEBOOK_INVITE_BUTTON:202,FACEBOOK_TIMELINE_CONNECT:21,FEED_SUBCATEGORY:152,FINDFRIENDS_BUTTON:58,FIND_FRIENDS_BUTTON:248,FIND_IMAGES_BUTTON:56,FIND_MORE_BOARDS_BUTTON:105,FLOWED_INTEREST:211,FOLLOWERS_BUTTON:42,FOLLOWING_BOARDS_BUTTON:268,FOLLOWING_BUTTON:41,FOLLOWING_INTERESTS_BUTTON:266,FOLLOWING_PINNERS_BUTTON:267,FOLLOW_ALL_USERS_BUTTON:20,FOLLOW_BOARDS_BUTTON:118,GALLERY_BUTTON:55,GENDER_BUTTON:241,GET_STARTED_BUTTON:106,GPLUS_CONNECT:208,GPLUS_INVITE_BUTTON:203,HELP_BUTTON:271,HELP_PULSE:270,INTEREST_SUGGESTION:260,INVITE_ALL_TOGGLE:173,INVITE_BUTTON:59,INVITE_DELETE_BUTTON:150,LANGUAGE_BUTTON:240,LIKES_BUTTON:175,LINK_OUT_BUTTON:144,LOCATION_BUTTON:159,LOGIN_BUTTON:30,LOGO:178,LOGOUT_BUTTON:19,MAP_ADD_BUTTON:157,MAP_ANNOTATION:154,MAP_DIRECTIONS_BUTTON:156,MAP_PIN_ICON:164,MAP_SEE_ON_MAP_BUTTON:155,MAP_TOGGLE_BUTTON:170,MENU_BUTTON:74,MORE_INFO_BUTTON:245,MORE_PINS_BUTTON:141,NAME_BUTTON:136,NAVIGATION_DISCOVER_BUTTON:147,NAVIGATION_HOME_BUTTON:146,NAVIGATION_LOGO_BUTTON:244,NEWS_BUTTON:77,NEWS_FEED_ACTOR_IMAGE:273,NEWS_FEED_ACTOR_LABEL:274,NEWS_FEED_ANSWER:219,NEWS_FEED_BOARD:39,NEWS_FEED_PIN:15,NEWS_FEED_QUESTION:218,NEWS_FEED_REPLY:252,NEWS_FEED_USER:16,NEXT_BUTTON:96,NOTIFICATIONS_ICON:139,PERSONALIZED_RECOMMENDATIONS_BUTTON:242,PFY_REASON_BUTTON:145,PHONE_BUTTON:161,PHOTOS_BUTTON:149,PIN_ATTRIBUTION:27,PIN_BOARD:5,PIN_BOARD_FOLLOW:6,PIN_BOARD_PIN:7,PIN_CAPTION_COMMENT:4,PIN_COMMENT_BUTTON:2,PIN_DELETE_BUTTON:49,PIN_DESCRIPTION:116,PIN_DOMAIN:25,PIN_EDIT_BUTTON:3,PIN_FLAG_BUTTON:176,PIN_INTEREST:255,PIN_LIKER:28,PIN_LIKE_BUTTON:1,PIN_ORIGINAL_BOARD:8,PIN_ORIGINAL_BOARD_FOLLOW:9,PIN_ORIGINAL_BOARD_PIN:10,PIN_PINNED_TO:29,PIN_PROMOTED_INFO:142,PIN_READING_LIST_BUTTON:259,PIN_RELATED_PIN:148,PIN_REPIN_BUTTON:0,PIN_REPORT_BUTTON:47,PIN_RICH_PIN_ACTION_BUTTON:110,PIN_SAVE_BUTTON:48,PIN_SEND_BUTTON:98,PIN_SHARE:46,PIN_SHARE_BUTTON:72,PIN_SHARE_EMAIL_BUTTON:258,PIN_SHARE_FACEBOOK_BUTTON:257,PIN_SHARE_TWITTER_BUTTON:256,PIN_SOURCE_IMAGE:35,PIN_SUBMIT:70,PIN_UPLOAD_BUTTON:18,PIN_USER:26,PIN_VIA:12,PIN_VIA_PIN:11,PLACES_BUTTON:158,PLACES_LIST_PLACE:160,PLACE_IMAGE:163,PLACE_PICKER_CREATE:166,PLACE_PICKER_IMAGE:167,PROFILE_BUTTON:40,PROFILE_FACEBOOK:65,PROFILE_IMAGE:63,PROFILE_TWITTER:66,PROFILE_URL:64,PROMOTED_OK_BUTTON:143,PUSH_NOTIFICATIONS_BUTTON:125,RAKUTEN_CONNECT:151,RECENT_SEARCH_SUGGESTION:253,REFRESH_BUTTON:45,RELATED_INTEREST:216,RELATED_RICH_PIN_BUTTON:214,REMOVE_BUTTON:107,REMOVE_SUGGESTED_USER_BUTTON:14,REPINS_BUTTON:174,REPIN_ADD_PLACE_BUTTON:212,REPIN_EDIT_PLACE_BUTTON:213,REPIN_SUGGESTED_BOARD:17,RESET_BUTTON:33,RETRY_BUTTON:32,RIBBON_BUTTON:131,SAVE_USER_SETTINGS_BUTTON:130,SEARCH_ALL_WITH_QUERY:254,SEARCH_BOARDS_BUTTON:221,SEARCH_BOX_ADD_TOKEN_BUTTON:228,SEARCH_BOX_TEXT_INPUT:227,SEARCH_BUTTON:43,SEARCH_GUIDE_SUGGESTION:226,SEARCH_MY_PINS_BUTTON:223,SEARCH_PINNERS_BUTTON:222,SEARCH_PINS_BUTTON:220,SEARCH_PLACES_BUTTON:224,SEARCH_PRIVACY_BUTTON:243,SEARCH_RELATED_CATEGORY:192,SEARCH_RELATED_QUERY:191,SEARCH_TOKEN:225,SEE_MORE_BUTTON:179,SEE_OTHER_PINS_BUTTON:140,SEND_BUTTON:103,SEND_INVITE_BUTTON:172,SEND_SMS_INVITE_BUTTON:209,SEND_TO_PINNER_BUTTON:204,SETTINGS_BUTTON:57,SHOW_PASSWORD_BUTTON:129,SIGNUP_BUTTON:31,SINGLE_PIN_POPOVER:217,STORIES_FEED_ACTOR:263,STORIES_FEED_ACTOR_IMAGE:272,STORIES_FEED_LARGE_STORY:261,STORIES_FEED_RELATED_MORE_CELL:269,STORIES_FEED_RELATED_OBJECT:264,STORIES_FEED_SMALL_STORY:262,SUGGESTED_EMAIL:121,SUGGESTED_USER:13,SUGGEST_INTEREST_BUTTON:230,SUPPORT_BUTTON:60,TOS_BUTTON:61,TWITTER_CONNECT:69,UNDO_BUTTON:113,UNFOLLOW_BOARDS_BUTTON:119,UPDATE_BUTTON:126,UPLOAD_PIN_BUTTON:251,USERNAME_BUTTON:122,USER_ABOUT_BUTTON:85,USER_ABOUT_EDIT_BUTTON:91,USER_BLOCK_BUTTON:87,USER_BOARDS_BUTTON:84,USER_EDIT_BUTTON:94,USER_FEED_FOLLOW:71,USER_FEED_INVITE_CUSTOM_EMAIL:135,USER_FEED_INVITE_EMAIL:133,USER_FEED_INVITE_SMS:134,USER_FLAG_BUTTON:80,USER_FOLLOW:62,USER_ICON:138,USER_LIKES_BUTTON:82,USER_LIST_CONTACT:132,USER_LIST_USER:112,USER_PINS_BUTTON:83,USER_RECENT_CONTACT:111,USER_REPORT_BUTTON:89,USER_UNBLOCK_BUTTON:88,USER_URL_EDIT_BUTTON:92,VISUAL_OBJECT_BUTTON:233,VISUAL_SEARCH_BUTTON:234,WEBSITE_BUTTON:162,WHO_CAN_PIN_BUTTON:108,YOUR_PROFILE_BUTTON:246,YOUR_SETTINGS_BUTTON:247},goog.provide("P.ContextLogging.EventType"),P.ContextLogging.EventType={ANDROID_REQUEST:1001,ANDROID_WIDGET_DISABLE:401,ANDROID_WIDGET_ENABLE:400,ANDROID_WIDGET_UPDATE:402,ANSWER_CREATE:240,ANSWER_DELETE:243,ANSWER_EDIT:242,ANSWER_LIKE:244,ANSWER_REPORT:246,ANSWER_UNLIKE:245,ANSWER_VIEW:241,API_PAGEVIEW:100,APP_INSTALL:1008,APP_START:406,APP_TIMING:404,BOARD_ACCEPT_INVITE_COLLABORATOR:32,BOARD_ADD_COLLABORATOR:24,BOARD_CREATE:20,BOARD_DECLINE_INVITE_COLLABORATOR:29,BOARD_DELETE:22,BOARD_EDIT:21,BOARD_FOLLOW:26,BOARD_INVITE_COLLABORATOR:28,BOARD_REMOVE_COLLABORATOR:25,BOARD_REQUEST_APPROVAL_INVITE_COLLABORATOR:34,BOARD_REQUEST_INVITE_COLLABORATOR:33,BOARD_SEND:35,BOARD_SET_PRIVATE:30,BOARD_SET_PUBLIC:31,BOARD_UNFOLLOW:27,BOARD_VIEW:23,BROWSER:83,CLICK:101,CLIENT_NOTIFICATION_OPENED_BY:511,CLIENT_NOTIFICATION_RECEIVED_BY:510,CONTEXTUAL_MENU_CLOSE:119,CONTEXTUAL_MENU_OPEN:118,CONVERSATION_CREATE:181,CONVERSATION_HIDE:182,CONVERSATION_MESSAGE_SEND:180,CONVERSATION_REPORT:183,CONVERSATION_UPGRADE_EXTERNAL_USER:184,DEEP_LINK_HTTP:701,DEEP_LINK_OTHER:702,DEEP_LINK_PINTEREST:700,DEVICE_START:405,DOMAIN_VERIFIED:200,DRAG:104,EMAIL_CLICKTHROUGH_DEPRECATED:800,EMAIL_CLICK_API_DEPRECATED:74,EMAIL_CLICK_DEPRECATED:73,EMAIL_OPEN_API_DEPRECATED:72,EMAIL_OPEN_DEPRECATED:71,EMAIL_RECEIVE:70,EMAIL_SUBSCRIBE_SETTINGS_CHANGE:502,EMAIL_UNSUBSCRIBE_SETTINGS_CHANGE:503,EXPLAIN_CREATE:260,EXPLAIN_DELETE:263,EXPLAIN_EDIT:262,EXPLAIN_VIEW:261,FEED_SUBCATEGORY:69,FEED_VIEW:80,GOT_BOARD_FOLLOW:1104,GOT_BOARD_INVITE_COLLABORATOR:1105,GOT_PIN_COMMENT:1101,GOT_PIN_LIKE:1103,GOT_PIN_REPIN:1102,GOT_PIN_VIEW:1100,GOT_USER_FOLLOW:1106,HOVER:105,INTEREST_FOLLOW:601,INTEREST_IMPRESSION_SERVER_SIDE:600,INTEREST_PIN_DOWNVOTE:606,INTEREST_PIN_UPVOTE:605,INTEREST_REMOVE:603,INTEREST_UNFOLLOW:602,INTEREST_UNREMOVE:604,INTERSTITIAL_LOADED:1700,INTERSTITIAL_OPEN_IN_APP:1701,INTERSTITIAL_OPEN_IN_BROWSER:1702,IPAD_REQUEST:1002,IPHONE_REQUEST:1003,IPOD_REQUEST:1004,LINK_EXTRACT:251,LONG_PRESS:103,MAC_REQUEST:1005,NOTIFICATION:1500,NOTIFICATION_SUBSCRIBE_SETTINGS_CHANGE:500,NOTIFICATION_UNSUBSCRIBE_SETTINGS_CHANGE:501,OTHER_REQUEST:1007,PAGEVIEW:0,PINCH:109,PIN_CLICKTHROUGH:12,PIN_CLOSEUP:16,PIN_COMMENT:7,PIN_COMMENT_FLAG:76,PIN_CREATE:1,PIN_DEACTIVATE:133,PIN_DELETE:3,PIN_DELETE_COMMENT:10,PIN_EDIT:2,PIN_FLAG:11,PIN_HIDE:17,PIN_IMPRESSION_ONE_PIXEL:18,PIN_IMPRESSION_SERVER_SIDE:19,PIN_INSERTION:15,PIN_INSERT_TO_HOME_FEED:1401,PIN_INSERT_TO_INTEREST_FEED:1402,PIN_INSERT_TO_PUBLIC_FEED:1400,PIN_LIKE:6,PIN_LONG_CLICKTHROUGH:1600,PIN_REACTIVATE:134,PIN_REPIN:5,PIN_REPORT:59,PIN_SAVE_TO_DEVICE:82,PIN_SEND:14,PIN_SHARE:8,PIN_SHARE_FACEBOOK:1300,PIN_SHORT_CLICKTHROUGH:1601,PIN_UNLIKE:9,PIN_UPVOTE:130,PIN_VIEW:4,PLACE_CREATE:1200,PROMOTED_PIN_FLAG:131,PROMOTED_PIN_HIDE:132,PULL_NOTIFICATION_OPENED_BY:408,PULL_NOTIFICATION_RECEIVED_BY:407,PULL_TO_REFRESH:158,PUSH_NOTIFICATION_DEVICE_ASSOCIATED:114,PUSH_NOTIFICATION_DEVICE_DISABLED:117,PUSH_NOTIFICATION_DEVICE_DISASSOCIATED:115,PUSH_NOTIFICATION_DEVICE_ENABLED:116,PUSH_NOTIFICATION_OPENED_BY:113,PUSH_NOTIFICATION_RECEIVED_BY:112,PUSH_NOTIFICATION_REGISTRATION_FAILED:121,PUSH_NOTIFICATION_SENT_TO:111,QUESTION_ANSWERED:253,QUESTION_CREATE:220,QUESTION_DELETE:223,QUESTION_EDIT:222,QUESTION_LIKE:224,QUESTION_REPORT:226,QUESTION_UNLIKE:225,QUESTION_VIEW:221,REFERRER_APP_INSTALL:1009,REFERRER_APP_INSTALL_ATTEMPT:1010,REFRESH:81,RENDER:120,REPLY_CREATE:247,REPLY_DELETE:248,REPLY_EDIT:250,REPLY_REPORT:249,REPLY_VIEW:252,SCROLL:110,SEARCH_BOARDS:61,SEARCH_MY_PINS:63,SEARCH_PINS:60,SEARCH_PLACE_BOARDS:66,SEARCH_RECIPES:65,SEARCH_RESULT_IMPRESSION_ONE_PIXEL:640,SEARCH_USERS:62,SEARCH_VIDEOS:64,SEND_PIN_RECOMMENDATION:410,SERVICE_ENTRY:801,SWIPE:108,TAP:102,TOGGLE_OFF:107,TOGGLE_ON:106,TOP_NOTIFICATION_CLICKED:300,URL_CHECK:201,URL_CLICKTHROUGH:203,URL_IMAGE:202,USER_BLOCK:54,USER_CREATE:40,USER_DEACTIVATED:48,USER_DELETE:42,USER_DELETED_APP:96,USER_DISABLE_ANALYTICS:85,USER_DISABLE_FACBOOK:87,USER_DISABLE_FACEBOOK_TIMELINE:89,USER_DISABLE_GPLUS:93,USER_DISABLE_RAKUTEN:95,USER_DISABLE_TWITTER:91,USER_EDIT:41,USER_ENABLE_ANALYTICS:84,USER_ENABLE_FACEBOOK:86,USER_ENABLE_FACEBOOK_TIMELINE:88,USER_ENABLE_GPLUS:92,USER_ENABLE_RAKUTEN:94,USER_ENABLE_TWITTER:90,USER_FOLLOW:45,USER_GENDER_CHANGED:155,USER_INVITE:47,USER_INVITE_CREATE:151,USER_INVITE_CREATE_DEPRECATED:1201,USER_INVITE_EMAIL_SENT:154,USER_INVITE_FACEBOOK_CREATE:152,USER_INVITE_FACEBOOK_SENT:153,USER_LOGIN_ATTEMPT:50,USER_PARTNER_CONVERT:58,USER_PARTNER_CREATE:57,USER_PASSWORD_RESET_COMPLETED:52,USER_PASSWORD_RESET_REQUEST:51,USER_PERSONALIZED_RECOMMENDATIONS_CHANGED:157,USER_PUBLISH_TO_SOCIAL_NETWORK:75,USER_REACTIVATED:49,USER_REORDER_BOARDS:44,USER_REPORT:56,USER_SEARCH_PRIVACY_CHANGED:156,USER_SEND:150,USER_SUSPICIOUS_LOGIN:53,USER_UNBLOCK:55,USER_UNFOLLOW:46,USER_VIEW:43,VIEW:13,VISUAL_OBJECT_IMPRESSION_SERVER_SIDE:670,WEB_OR_API_REQUEST:1e3,WINDOWS_REQUEST:1006},goog.provide("P.Experiences"),P.Experiences={},goog.provide("P.Experiences.Placement"),P.Experiences.Placement={ANDROID_BOARD_TAKEOVER:20003,ANDROID_GLOBAL_NAG:20002,ANDROID_HOME_HEADER:20001,ANDROID_MAIN_USER_ED:20006,ANDROID_NOOP:2e4,ANDROID_PIN_CLOSEUP_TAKEOVER:20005,ANDROID_USER_PROFILE_TAKEOVER:20004,IOS_BOARD_TAKEOVER:10008,IOS_GLOBAL_NAG:10001,IOS_HOMEFEED_TAKEOVER:10003,IOS_HOME_PR_NAG:10002,IOS_MAIN_USER_ED:10006,IOS_MESSAGES_LIST_VIEW_TAKEOVER:10011,IOS_MESSAGE_SPLIT_VIEW_TAKEOVER:10013,IOS_MESSAGE_VIEW_TAKEOVER:10012,IOS_NOOP:1e4,IOS_NOTIFICATIONS_TAKEOVER:10010,IOS_PERMISSIONS_TAKEOVER:10007,IOS_PIN_CLOSEUP_TAKEOVER:10004,IOS_REPIN_DIALOG_TAKEOVER:10005,IOS_USER_PROFILE_TAKEOVER:10009,NOOP:1,PUSH_NOTIFICATION_AUTH:50001,PUSH_NOTIFICATION_NONAUTH:50002,PUSH_NOTIFICATION_NOOP:5e4,WEB_BOARD_HERO:17,WEB_BOARD_TAKEOVER:18,WEB_CATEGORY_HERO:23,WEB_EMPTY_PLACES_BOARD_TAKEOVER:20,WEB_EXPLORE_TAKEOVER:22,WEB_FILLED_PLACES_BOARD_TAKEOVER:21,WEB_HERO:13,WEB_HOME_HERO:15,WEB_HOME_TAKEOVER:11,WEB_MOBILE_EVERYTHING_FEED_TAKEOVER:40001,WEB_MOBILE_NOOP:4e4,WEB_NOOP:10,WEB_PIN_CLOSEUP:12,WEB_PIN_CLOSEUP_TAKEOVER:24,WEB_PIN_SUCCESS:14,WEB_SEARCH_HERO:25,WEB_TOOLTIP:16,WEB_USER_PROFILE_TAKEOVER:19},goog.provide("P.Experiences.PlacementReverse"),P.Experiences.PlacementReverse={1:"NOOP",10:"WEB_NOOP",11:"WEB_HOME_TAKEOVER",12:"WEB_PIN_CLOSEUP",13:"WEB_HERO",14:"WEB_PIN_SUCCESS",15:"WEB_HOME_HERO",16:"WEB_TOOLTIP",17:"WEB_BOARD_HERO",18:"WEB_BOARD_TAKEOVER",19:"WEB_USER_PROFILE_TAKEOVER",20:"WEB_EMPTY_PLACES_BOARD_TAKEOVER",21:"WEB_FILLED_PLACES_BOARD_TAKEOVER",22:"WEB_EXPLORE_TAKEOVER",23:"WEB_CATEGORY_HERO",24:"WEB_PIN_CLOSEUP_TAKEOVER",25:"WEB_SEARCH_HERO",10000:"IOS_NOOP",10001:"IOS_GLOBAL_NAG",10002:"IOS_HOME_PR_NAG",10003:"IOS_HOMEFEED_TAKEOVER",10004:"IOS_PIN_CLOSEUP_TAKEOVER",10005:"IOS_REPIN_DIALOG_TAKEOVER",10006:"IOS_MAIN_USER_ED",10007:"IOS_PERMISSIONS_TAKEOVER",10008:"IOS_BOARD_TAKEOVER",10009:"IOS_USER_PROFILE_TAKEOVER",10010:"IOS_NOTIFICATIONS_TAKEOVER",10011:"IOS_MESSAGES_LIST_VIEW_TAKEOVER",10012:"IOS_MESSAGE_VIEW_TAKEOVER",10013:"IOS_MESSAGE_SPLIT_VIEW_TAKEOVER",20000:"ANDROID_NOOP",20001:"ANDROID_HOME_HEADER",20002:"ANDROID_GLOBAL_NAG",20003:"ANDROID_BOARD_TAKEOVER",20004:"ANDROID_USER_PROFILE_TAKEOVER",20005:"ANDROID_PIN_CLOSEUP_TAKEOVER",20006:"ANDROID_MAIN_USER_ED",40000:"WEB_MOBILE_NOOP",40001:"WEB_MOBILE_EVERYTHING_FEED_TAKEOVER",50000:"PUSH_NOTIFICATION_NOOP",50001:"PUSH_NOTIFICATION_AUTH",50002:"PUSH_NOTIFICATION_NONAUTH"},goog.provide("P.Experiences.Experience"),P.Experiences.Experience={ANDROID_CLICKTHROUGH_ED:30017,ANDROID_EMPTY_BOARD_ED:30005,ANDROID_EMPTY_BOARD_ED_HELPER:30009,ANDROID_EMPTY_BOARD_ED_HELPER_TABLET:30014,ANDROID_EMPTY_BOARD_ED_TABLET:30013,ANDROID_EMPTY_USER_PROFILE_ED:30006,ANDROID_EMPTY_USER_PROFILE_ED_HELPER:30010,ANDROID_EMPTY_USER_PROFILE_ED_HELPER_TABLET:30016,ANDROID_EMPTY_USER_PROFILE_ED_TABLET:30015,ANDROID_HERO_EMPTY_HOMEFEED:30001,ANDROID_NAG_CONFIRM_EMAIL:30002,ANDROID_NAG_INVITER:30004,ANDROID_NAG_WRITE_BANNED:30003,ANDROID_NOOP:3e4,ANDROID_NUX_MANDATORY_MEN:30011,ANDROID_NUX_MANDATORY_WOMEN:30012,ANDROID_QA_EDUCATION:30007,ANDROID_QA_NOTIFICATION_EDUCATION:30008,CONFIRM_EMAIL:2,IOS_CONTACTS_AND_FACEBOOK_PERMISSIONS:20012,IOS_CONTACTS_PERMISSIONS:20011,IOS_EMPTY_BOARD_ED:20014,IOS_EMPTY_BOARD_ED_HELPER:20016,IOS_EMPTY_USER_PROFILE_ED:20015,IOS_EMPTY_USER_PROFILE_ED_HELPER:20017,IOS_HOME_WELCOME_HELPER:20006,IOS_MSGS_MESSAGE_LIST_USER_ED:20022,IOS_MSGS_MESSAGE_USER_ED:20023,IOS_MSGS_MESSAGE_USER_ED_IPAD:20025,IOS_MSGS_NOTIFICATIONS_USER_ED:20021,IOS_MSGS_NOTIFICATIONS_USER_ED_IPAD:20024,IOS_NAG_CONFIRM_EMAIL:20001,IOS_NAG_CONFIRM_EMAIL_V3_5_1:20009,IOS_NAG_INVITER:20003,IOS_NAG_PLACE_PINS:20002,IOS_NAG_WRITE_BANNED:20008,IOS_NOOP:2e4,IOS_NUX_FIRST_PIN:20004,IOS_NUX_MANDATORY:20005,IOS_NUX_MANDATORY_MEN:20019,IOS_NUX_MANDATORY_WOMEN:20020,IOS_PINS_LIVE_PROFILE_HELPER:20007,IOS_QA_EDUCATION:20010,IOS_QA_NOTIFICATION_EDUCATION:20018,IOS_UPDATE_APP_HELPER:20013,NOOP:1,PUSH_NOTIFICATION_FRIEND_PIN:50003,PUSH_NOTIFICATION_NOOP:5e4,PUSH_NOTIFICATION_PIN_TWINS:50002,PUSH_NOTIFICATION_SIMILAR_REPINS:50001,WEB_BLANK_SESSION:10009,WEB_CATEGORY_SEARCH_USER_ED:10014,WEB_EMPTY_PLACES_BOARD_USER_ED:10016,WEB_EXPLORE_BUTTON_USER_ED:10019,WEB_EXPLORE_HEADER_USER_ED:10023,WEB_EXPLORE_PAGE_USER_ED:10020,WEB_FAST_FOLLOW_USER_ED:10012,WEB_FEED_EDITOR_USER_ED:10001,WEB_FILLED_PLACES_BOARD_USER_ED:10017,WEB_FIND_FRIENDS_USER_ED:10013,WEB_FIRST_BOARD_USER_ED:10018,WEB_FIRST_FOLLOW:10007,WEB_FIRST_PIN_SUCCESS:10005,WEB_FIRST_PIN_USER_ED:10010,WEB_HERO_CONVERT_TO_BUSINESS:10063,WEB_HERO_EMPTY_HOMEFEED:10051,WEB_HERO_HOLIDAY_GUIDE:10058,WEB_HERO_INSTALL_APP:10052,WEB_HERO_INSTALL_EXTENSION:10060,WEB_HERO_INVITE_FRIENDS:10050,WEB_HERO_LANGUAGE:10054,WEB_HERO_LANGUAGE_BROWSER_SAFE:10061,WEB_HERO_PINIT_BUTTON:10053,WEB_HERO_PINIT_BUTTON_INTERNATIONAL:10062,WEB_HERO_PINIT_WEBMASTER:10055,WEB_HERO_PLACE_PINS:10056,WEB_HERO_PLACE_PINS_BOARD:10057,WEB_HERO_PROMOTED_PINS_BETA_REMINDER:10067,WEB_HERO_PROMOTE_A_PIN:10064,WEB_HERO_SCOOTER_PINNER_STORY:10066,WEB_HERO_VALENTINES:10059,WEB_HERO_WORLD_CUP:10065,WEB_MANDATORY_AUTOBAHN:10004,WEB_MOBILE_NOOP:4e4,WEB_MOBILE_NUX_MANDATORY:40001,WEB_MODERN_HEADER_USER_ED:10021,WEB_NOOP:1e4,WEB_PINIT_BOOKMARKLET:10008,WEB_PIN_CLOSEUP_AUTOBAHN:10003,WEB_PIN_CLOSEUP_LITE:10002,WEB_PIN_SUCCESS_EXTENSION_UPSELL:10022,WEB_PLACE_PINS_TOOLTIP:10015,WEB_QA_CLOSEUP_NOTIFICATION_USER_ED:11001,WEB_QA_CLOSEUP_USER_ED:11e3,WEB_SEARCH_DISCOVER_TOOLTIP:10006,WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED:10024,WEB_YOUR_BOARDS_USER_ED:10011},goog.provide("P.Experiences.ExperienceReverse"),P.Experiences.ExperienceReverse={1:"NOOP",2:"CONFIRM_EMAIL",10000:"WEB_NOOP",10001:"WEB_FEED_EDITOR_USER_ED",10002:"WEB_PIN_CLOSEUP_LITE",10003:"WEB_PIN_CLOSEUP_AUTOBAHN",10004:"WEB_MANDATORY_AUTOBAHN",10005:"WEB_FIRST_PIN_SUCCESS",10006:"WEB_SEARCH_DISCOVER_TOOLTIP",10007:"WEB_FIRST_FOLLOW",10008:"WEB_PINIT_BOOKMARKLET",10009:"WEB_BLANK_SESSION",10010:"WEB_FIRST_PIN_USER_ED",10011:"WEB_YOUR_BOARDS_USER_ED",10012:"WEB_FAST_FOLLOW_USER_ED",10013:"WEB_FIND_FRIENDS_USER_ED",10014:"WEB_CATEGORY_SEARCH_USER_ED",10015:"WEB_PLACE_PINS_TOOLTIP",10016:"WEB_EMPTY_PLACES_BOARD_USER_ED",10017:"WEB_FILLED_PLACES_BOARD_USER_ED",10018:"WEB_FIRST_BOARD_USER_ED",10019:"WEB_EXPLORE_BUTTON_USER_ED",10020:"WEB_EXPLORE_PAGE_USER_ED",10021:"WEB_MODERN_HEADER_USER_ED",10022:"WEB_PIN_SUCCESS_EXTENSION_UPSELL",10023:"WEB_EXPLORE_HEADER_USER_ED",10024:"WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED",10050:"WEB_HERO_INVITE_FRIENDS",10051:"WEB_HERO_EMPTY_HOMEFEED",10052:"WEB_HERO_INSTALL_APP",10053:"WEB_HERO_PINIT_BUTTON",10054:"WEB_HERO_LANGUAGE",10055:"WEB_HERO_PINIT_WEBMASTER",10056:"WEB_HERO_PLACE_PINS",10057:"WEB_HERO_PLACE_PINS_BOARD",10058:"WEB_HERO_HOLIDAY_GUIDE",10059:"WEB_HERO_VALENTINES",10060:"WEB_HERO_INSTALL_EXTENSION",10061:"WEB_HERO_LANGUAGE_BROWSER_SAFE",10062:"WEB_HERO_PINIT_BUTTON_INTERNATIONAL",10063:"WEB_HERO_CONVERT_TO_BUSINESS",10064:"WEB_HERO_PROMOTE_A_PIN",10065:"WEB_HERO_WORLD_CUP",10066:"WEB_HERO_SCOOTER_PINNER_STORY",10067:"WEB_HERO_PROMOTED_PINS_BETA_REMINDER",11000:"WEB_QA_CLOSEUP_USER_ED",11001:"WEB_QA_CLOSEUP_NOTIFICATION_USER_ED",20000:"IOS_NOOP",20001:"IOS_NAG_CONFIRM_EMAIL",20002:"IOS_NAG_PLACE_PINS",20003:"IOS_NAG_INVITER",20004:"IOS_NUX_FIRST_PIN",20005:"IOS_NUX_MANDATORY",20006:"IOS_HOME_WELCOME_HELPER",20007:"IOS_PINS_LIVE_PROFILE_HELPER",20008:"IOS_NAG_WRITE_BANNED",20009:"IOS_NAG_CONFIRM_EMAIL_V3_5_1",20010:"IOS_QA_EDUCATION",20011:"IOS_CONTACTS_PERMISSIONS",20012:"IOS_CONTACTS_AND_FACEBOOK_PERMISSIONS",20013:"IOS_UPDATE_APP_HELPER",20014:"IOS_EMPTY_BOARD_ED",20015:"IOS_EMPTY_USER_PROFILE_ED",20016:"IOS_EMPTY_BOARD_ED_HELPER",20017:"IOS_EMPTY_USER_PROFILE_ED_HELPER",20018:"IOS_QA_NOTIFICATION_EDUCATION",20019:"IOS_NUX_MANDATORY_MEN",20020:"IOS_NUX_MANDATORY_WOMEN",20021:"IOS_MSGS_NOTIFICATIONS_USER_ED",20022:"IOS_MSGS_MESSAGE_LIST_USER_ED",20023:"IOS_MSGS_MESSAGE_USER_ED",20024:"IOS_MSGS_NOTIFICATIONS_USER_ED_IPAD",20025:"IOS_MSGS_MESSAGE_USER_ED_IPAD",30000:"ANDROID_NOOP",30001:"ANDROID_HERO_EMPTY_HOMEFEED",30002:"ANDROID_NAG_CONFIRM_EMAIL",30003:"ANDROID_NAG_WRITE_BANNED",30004:"ANDROID_NAG_INVITER",30005:"ANDROID_EMPTY_BOARD_ED",30006:"ANDROID_EMPTY_USER_PROFILE_ED",30007:"ANDROID_QA_EDUCATION",30008:"ANDROID_QA_NOTIFICATION_EDUCATION",30009:"ANDROID_EMPTY_BOARD_ED_HELPER",30010:"ANDROID_EMPTY_USER_PROFILE_ED_HELPER",30011:"ANDROID_NUX_MANDATORY_MEN",30012:"ANDROID_NUX_MANDATORY_WOMEN",30013:"ANDROID_EMPTY_BOARD_ED_TABLET",30014:"ANDROID_EMPTY_BOARD_ED_HELPER_TABLET",30015:"ANDROID_EMPTY_USER_PROFILE_ED_TABLET",30016:"ANDROID_EMPTY_USER_PROFILE_ED_HELPER_TABLET",30017:"ANDROID_CLICKTHROUGH_ED",40000:"WEB_MOBILE_NOOP",40001:"WEB_MOBILE_NUX_MANDATORY",50000:"PUSH_NOTIFICATION_NOOP",50001:"PUSH_NOTIFICATION_SIMILAR_REPINS",50002:"PUSH_NOTIFICATION_PIN_TWINS",50003:"PUSH_NOTIFICATION_FRIEND_PIN"},goog.provide("P.Experiences.ExperienceCompleteAction"),P.Experiences.ExperienceCompleteAction={COMPLETE:1,COMPLETE_AND_SHOW:2,DONT_COMPLETE_AND_HIDE:3,DONT_COMPLETE_AND_SHOW:4},goog.provide("P.Experiences.ExperienceCompleteActionReverse"),P.Experiences.ExperienceCompleteActionReverse={1:"COMPLETE",2:"COMPLETE_AND_SHOW",3:"DONT_COMPLETE_AND_HIDE",4:"DONT_COMPLETE_AND_SHOW"},goog.provide("P.ModalPresentationTypes"),P.ModalPresentationTypes={FORM_SHEET:0,PANEL:1},function(){goog.provide("P.spinner");
var a={SMALL:"Small",MEDIUM:"Medium"},b={size:a.MEDIUM},c=function(a){this.options=_.extend({},b,a),this.$spinEl=null};c.Size=a,c.prototype={spin:function(a,b){this.$spinEl&&this.stop(),b=b||"spinner";var c=b+this.options.size;this.$spinEl=$('<div class="Spinner"><div class="'+c+'"></div></div>'),this.$spinEl.prependTo(a)},stop:function(){this.$spinEl.remove(),this.$spinEl=null}},P.Spinner=c}(),function(){goog.provide("P.body"),goog.require("P.logger");var a=P.Logger.getLogger("Body"),b="noScroll",c=function(){this.scrollStack=[!0]};c.prototype={pushScrolling:function(a){return this.push().setScrolling(a),this},pop:function(){return this.scrollStack.length<=1?void a.error("Tried to pop with only one item on stack.  Mismatched push and pops?"):(this.scrollStack.pop(),this.updateElement(),this)},setScrolling:function(a){return this.scrollStack[this.scrollStack.length-1]=a,this.updateElement(),this},push:function(){return this.scrollStack.push(this.peek()),this},peek:function(){return this.scrollStack[this.scrollStack.length-1]},updateElement:function(){var a=this.peek();$("body").toggleClass(b,!a)}},P.Body=new c,Pc.TEST_MODE&&(P.Body.constructor=c)}(),function(){goog.provide("P.polyfills");for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];Date.now=Date.now||function(){return(new Date).getTime()}}(),function(){goog.provide("P.pubsub");var a=0;P.PubSub=function(a){this.ns=a,this.channels={}};var b=function(a,b,c){this.pubsub=a,this.target=b,this.options=c,this.topics={}},c=function(a,b){this.pubsub=a,this.target=b,this.subscribers={},this.filters={},this.messages={}};_.extend(P.PubSub.prototype,{createSubscriber:function(a,c){return new b(this,a,c)},subscribe:function(a,b,c,d){var e=this.createSubscriber(a,{handler:c,scope:d});return e.subscribe(b),e},publish:function(a,b,c){this.getChannel(a).publish(b,c)},getChannel:function(a){return this.channels[a]||(this.channels[a]=new c(this,a)),this.channels[a]},clearChannel:function(a){var b=this.channels[a];b&&(b.unsubscribeAll(),delete this.channels[a])}}),_.extend(c.prototype,{addSubscriber:function(a,b){var c=this,d=a.getId();return this.subscribers[d]=a,_.each(b,function(b){c.filters[b]||(c.filters[b]={}),c.filters[b][d]||(c.filters[b][d]=a,_.isUndefined(c.messages[b])||a.publish(b,c.messages[b]))}),a},removeSubscriber:function(a,b){var c=this,d=a.getId();_.each(b,function(a){c.filters[a]&&delete c.filters[a][d]}),_.keys(this.subscribers).length<1&&this.pubsub.clearChannel(this.target)},publish:function(a,b){_.each(this.filters[a],function(c){c.publish(a,b)}),"*"!==a&&this.publish("*",b),this.messages[a]=b},getSubscribers:function(){var a=_.toArray(arguments);if(!a.length)return _.values(this.subscribers);var b=this,c={};return _.each(a,function(a){_.extend(c,b.filters[a])}),_.values(c)},unsubscribeAll:function(){_.each(this.subscribers,function(a){a.unsubscribe()})}}),_.extend(b.prototype,{publish:function(a,b){return this.getHandler().call(this.getScope(),this.target,a,b),this},subscribe:function(){var a=this,b=_.toArray(arguments);return this.getChannel().addSubscriber(a,b),_.each(b,function(b){a.topics[b]=1}),this},unsubscribe:function(){var a=this,b=_.toArray(arguments);return 0===b.length&&(b=this.getTopics()),_.each(b,function(b){delete a.topics[b]}),this.getChannel().removeSubscriber(this,b),this},getChannel:function(){return this.pubsub.getChannel(this.target)},getHandler:function(){return this.options.handler},getScope:function(){return _.result(this.options,"scope")},getName:function(){return _.result(this.options,"name")},getId:function(){return this.id||(this.id=a++),this.id},getTopics:function(){return _.keys(this.topics)}}),P.PubSub.Subscriber=b,P.PubSub.Channel=c,P.pubsub=new P.PubSub("local")}(),function(){goog.provide("P.appVersion");var a={CURRENT:1,NEW_VERSION_AVAILABLE:2,NEW_VERSION_REQUIRED:3},b=function(){this.currentVersion="",this.versionState=a.CURRENT};_.extend(b.prototype,{setup:function(b){var c=this;this.currentVersion=b,$(document).ajaxSend(function(a,b){b.setRequestHeader("X-APP-VERSION",c.currentVersion)}),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION,function(a,b,d){c._checkVersion(d)}),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION_AVAILABLE,function(){c.versionState===a.CURRENT&&(c.versionState=a.NEW_VERSION_AVAILABLE)})},_checkVersion:function(b){b!==this.currentVersion&&(this.versionState=a.NEW_VERSION_REQUIRED)},isNewVersionAvailable:function(){return this.versionState===a.NEW_VERSION_AVAILABLE||this.isNewVersionRequired()},isNewVersionRequired:function(){return this.versionState===a.NEW_VERSION_REQUIRED}}),P.AppVersion=new b}(),function(){goog.provide("P.deepLink");var a=function(){this.url=null};_.extend(a.prototype,{updateUrl:function(a){this.url=a},setup:function(a,b){var c=this;this.url=a||b,P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,function(a,b,d){c.updateUrl(d)})},getUrl:function(){return this.url},attemptIOSDeepLink:function(a){var b=this.getUrl();window.setTimeout(function(){window.location=b,window.setTimeout(function(){window.location=a},50)},100)},attemptAndroidDeepLink:function(a){var b=document.createElement("iframe");b.style.display="none",b.src=this.getUrl(),document.body.appendChild(b),window.setTimeout(function(){window.location=a},50)},redirectToDeepLink:function(a,b){b===P.CONST.USER_AGENT_PLATFORM_IOS?this.attemptIOSDeepLink(a):b===P.CONST.USER_AGENT_PLATFORM_ANDROID&&this.attemptAndroidDeepLink(a)},appDownloadClick:function(a,b,c,d){a===P.CONST.USER_AGENT_PLATFORM_IOS?this.deeplinkToUrl(b,a,d):a===P.CONST.USER_AGENT_PLATFORM_ANDROID&&this.deeplinkToUrl(c,a,d)},deeplinkToUrl:function(a,b,c){if(a){P.trackRegisterAction("mobile_app_nag_click");var d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.REFERRER_APP_INSTALL_ATTEMPT);d.updateAuxData({utm_medium:c,utm_source:b}),P.ContextLogger.getInstance().addEvent(d),P.DeepLink.redirectToDeepLink(a,b)}},getLinkForUserAgent:function(a,b){var c;return a===P.CONST.USER_AGENT_PLATFORM_IOS?c=b.ios_deep_link:a===P.CONST.USER_AGENT_PLATFORM_ANDROID&&(c=b.android_deep_link),c&&b.deep_link_tracking&&(c=P.url.appendQueryString(c,b.deep_link_tracking)),c}}),P.DeepLink=new a}(),function(){goog.provide("P.experiments"),P.experiments.Client=function(a,b){this.active=_.clone(a),this.triggerable=_.clone(b)},P.experiments.Client.prototype.getGroupForExperiment=function(a,b){void 0===b&&(b=!0);var c=this.active[a];return void 0===c&&b&&(c=this.triggerable[a],void 0!==c&&(delete this.triggerable[a],this.active[a]=c,this.reportExperimentActivated(a))),c||null},P.experiments.Client.prototype.inExperimentGroups=function(a,b,c){var d=this.getGroupForExperiment(a,c);return null!==d&&_.contains(b,d)},P.experiments.Client.prototype.inExperimentGroup=function(a,b,c){return this.inExperimentGroups(a,[b],c)},P.experiments.Client.prototype.inExperimentGroupsActiveOrTriggerable=function(a,b){for(var c in b)if(this.inExperimentGroupActiveOrTriggerable(a,b[c]))return!0;return!1},P.experiments.Client.prototype.inExperimentGroupActiveOrTriggerable=function(a,b){return(this.active[a]||this.triggerable[a])===b},P.experiments.Client.prototype.reportExperimentActivated=function(a,b){var c=P.resourceFactory.create("ActivateExperimentResource",{experiment_name:a,add_to_experiment:b});c.callCreate({error:P.NOOP})},P.experiments.Client.prototype.getDebugInfo=function(){return JSON.stringify({active:this.active,triggerable:this.triggerable})};var a=Pc.experiments;P.experiments.instance=new P.experiments.Client(a.active,a.triggerable),P.experiments.modernHeader=P.experiments.instance.inExperimentGroups("modern_header_update",["enabled_grid","enabled_dropdown","enabled_grid_no_tutorial","employees"])}(),function(){goog.provide("P.error"),P.Error=function(){this.name="P.Error",this.code=null,this.http_status=null,this.api_error_code=null,this.target=null,this.stack_trace=null,this.extra_data=null,this.request_identifier=null},P.Error.prototype=new Error,P.Error.prototype.constructor=P.Error,P.Error.fromPlainObject=function(a){var b=new P.Error;return a.message&&(b.message=a.message),a.code&&(b.code=a.code),a.http_status&&(b.http_status=a.http_status),a.api_error_code&&(b.api_error_code=a.api_error_code),a.target&&(b.target=a.target),a.stack_trace&&(b.stack_trace=a.stack_trace),a.extra_data&&(b.extra_data=a.extra_data),a.request_identifier&&(b.request_identifier=a.request_identifier),b}}(),function(){goog.provide("P.errors"),goog.require("P.experiments"),P.Errors={},P.Errors.ENABLE_WRAPPING=P.experiments.instance.inExperimentGroup("denzel_error_wrap","enabled"),P.Errors.wrapFn=function(a,b){return b?P.Errors.ENABLE_WRAPPING?function(){try{return b.apply(this,arguments)}catch(c){if(!c.loggedToServer){var d=Array.prototype.slice.call(arguments,0);P.Errors.reportError(this,a,d,c),c.loggedToServer=!0}throw c}}:b:function(){}},P.Errors.wrap=function(a,b){_.each(b,function(b){var c=a[b];a[b]=P.Errors.wrapFn(b,c)})},P.Errors.reportError=function(a,b,c,d){var e={format:"sentry",fn_name:b||"unknown_function_name"};if(a instanceof P.Module){for(var f=b,g=a;g;)f=g.getDebugInfo()+":"+f,g=g.parent;e.error_path=f}else a instanceof P.Resource&&(e.resource_name=a.name);if(c[0]instanceof $.Event){var h=c[0],i=h.currentTarget;e.event={type:h.type,target_class:i.className.replace(/\s+/g," ")},i.href&&(e.event.target_href=i.href)}e.traceback=printStackTrace({e:d}).join("\n"),P.Logger.getLogger("Errors").error(d.message,e)},P.showError=function(a,b){a=_.escape(a),P.showHtmlError(a,b)},P.showHtmlError=function(a,b){var c,d={name:"ConfirmDialog",options:{view_type:"error",message:a,template:null}},e=P.getModalManager().getTopModal();if(e){var f=e.options.module;c="error"===f.options.view_type}c||P.loadModule(d,function(a){b&&a.on(P.CONST.EVENT_CONFIRM,b),P.getModalManager().showInModal(a)})}}(),function(){goog.provide("P.fb"),goog.require("P.script");var a=!1;P.fb={},P.fb.ensureInit=function(b){var c="fb";P.script.load([],"//connect.facebook.net/en_US/all.js",c),P.script.ready(c,function(){var c=window.FB;c&&(a||(c.init({appId:P.FB_KEY,status:!0}),a=!0),b(c))})},P.fb.ensureLoggedIn=function(a){P.fb.ensureInit(function(b){b.getUserID()?a(b):b.login(function(){a(b)})})}}(),function(){goog.provide("P.gapi"),P.gapi={},P.gapi.get=function(a){var b="gplus";P.script.load([],"https://apis.google.com/js/client:plusone.js",b),P.script.ready(b,function(){a(window.gapi)})}}(),function(){goog.provide("P.hoverIntent"),P.HoverIntent=function(a,b){this.$el=a,this.options=_.extend({sensitivity:10,enterDelay:0,exitDelay:0,interval:40},b),this.$el.on("mouseenter mouseleave",_.bindFn(this._handleHover,this))},_.extend(P.HoverIntent.prototype,Backbone.Events,{_checkMouseEnter:function(){this._clearTimeout(),this._isMouseStill()?this._onMouseEnterComplete():(this._setPreviousXY(this._currX,this._currY),this._timeout=P.setTimeout(_.bindFn(this._checkMouseEnter,this),this.options.interval))},_clearTimeout:function(){this._timeout&&(this._timeout=clearTimeout(this._timeout))},_handleHover:function(a){this._clearTimeout();var b=this;"mouseenter"===a.type?(this._onMouseEnterStart(),this.options.enterDelay?(this._setPreviousXY(a.pageX,a.pageY),this.$el.on("mousemove.HoverIntent",function(a){b._setCurrentXY(a.pageX,a.pageY)}),this._isEntered||(this._timeout=window.setTimeout(function(){b._checkMouseEnter()},this.options.enterDelay))):this._onMouseEnterComplete()):(this._onMouseOutStart(),this._isEntered&&(this._timeout=window.setTimeout(function(){b._onMouseOutComplete()},this.options.exitDelay)))},_isMouseStill:function(){var a=Math.abs(this._prevX-this._currX),b=Math.abs(this._prevY-this._currY);return a||b||(a=0,b=0),a+b<this.options.sensitivity},_onMouseEnterStart:function(){this.trigger(P.CONST.EVENT_HOVERINTENT_ENTER_START)},_onMouseEnterComplete:function(){this.$el.off("mousemove.HoverIntent"),this._isEntered=1,this.trigger(P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE)},_onMouseOutStart:function(){this.$el.off("mousemove.HoverIntent"),this.trigger(P.CONST.EVENT_HOVERINTENT_OUT_START)},_onMouseOutComplete:function(){this._clearTimeout(),this._isEntered=0,this.trigger(P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE)},_setCurrentXY:function(a,b){this._currX=a,this._currY=b},_setPreviousXY:function(a,b){this._prevX=a,this._prevY=b}})}(),function(){goog.provide("P.isHovering");var a="data-is-hovering";jQuery.fn.initHovering=function(){return this.each(function(b,c){$(c).hover(function(){$(c).attr(a,"true")},function(){$(c).removeAttr(a)}).removeAttr(a)}),this},jQuery.fn.isHovering=function(){return!!$(this).attr(a)}}(),function(){goog.provide("P.fbUtil"),goog.require("P.fb");var a="publish_actions";P.FbUtil={},P.FbUtil.checkFbTimelinePermission=function(b){var c=function(c){c.api("/me/permissions",function(c){var d=c.data;d&&d[0][a]?b.success&&b.success():b.error&&b.error()})};P.fb.ensureInit(c)},P.FbUtil.fbConnectedAccountMatchesLoggedInAccount=function(a,b){if(!b)return!0;var c=a.getAuthResponse();return c?b===c.userID:!0},P.FbUtil.maybeRequestFbTimelinePermission=function(a,b){P.fb.ensureInit(function(c){var d=P.FbUtil.fbConnectedAccountMatchesLoggedInAccount(c,b);return d?void P.FbUtil.checkFbTimelinePermission({success:function(){a.success&&a.success(),a.complete&&a.complete()},error:function(){P.FbUtil.fbLogin(a)}}):(P.showError(P._("Oops! Your account is linked to a different Facebook account than the one you're logged into now.")),a.error&&a.error(),void(a.complete&&a.complete()))})},P.FbUtil.fbLogin=function(b){P.fb.ensureInit(function(c){c.login(function(a){a.authResponse?P.FbUtil.checkFbTimelinePermission(b):b.error&&b.error(),b.complete&&b.complete()},{scope:a})})}}(),function(){goog.provide("P.user"),goog.require("P.start"),goog.require("P.fb"),P.User=Backbone.Model.extend({initialize:function(){this.log=P.Logger.getLogger("User")},isAuthenticated:function(){return!!this.get("id")},attemptLogin:function(){this.attemptLoginWithFacebook()},attemptLoginWithFacebook:function(){var a=P.getQueryStringParams(),b=!1;if(a.next&&(b=P.beginsWith(a.next,"/oauth/dialog")),b||!Cookie.get(P.CONST.COOKIE_FB_AUTO_LOGIN_DISABLED)){var c=this;P.fb.ensureInit(function(a){var b=_.bindFn(c._attemptLoginWithFacebook,c);a.getLoginStatus(b,!0)})}},_attemptLoginWithFacebook:function(a){var b=a.authResponse;if(b){var c={facebook_id:b.userID,facebook_token:b.accessToken,facebook_autologin:!0};this.login(c,function(){window.location.reload(!0)})}},login:function(a,b,c,d){var e=P.resourceFactory.create("UserSessionResource",a),f=this;e.callCreate({success:function(a){f.log.debug("Login, successful",a),f.set(a.resource_response.data),b&&b(a)},error:c||P.NOOP,complete:d||P.NOOP,async:!1})},logout:function(a){Cookie.set(P.CONST.COOKIE_FB_AUTO_LOGIN_DISABLED,"True"),a()},isWriteBanned:function(){var a=P.currentUser.get("nags")||[];return a.length>0&&"write_banned"===a[0].type}}),P.currentUser=new P.User,P.start.ready(function(a){P.currentUser.set(a.user)})}(),function(){goog.provide("P._"),goog.provide("P.string"),P._=function(a){return P.STRINGS&&P.STRINGS.hasOwnProperty(a)?P.STRINGS[a]:a},P.string.common={},P.string.initializeCommonStrings=function(){P.string.common={successInviteSentToEmail:P._("Success! Invitation sent to {{ email }}"),connectError:P._("Couldn't connect. You must authorize Pinterest."),defaultErrorMessage:P._("Sorry! Something went wrong on our end!"),asciiPasswordError:P._("Oops! Your password can only have English letters, numbers and basic symbols.")}};var a=/\{\{\s*(\w+)\s*\}\}/g;P.string.format=function(b,c){var d=function(a,d){return c&&c.hasOwnProperty(d)?c[d]:(P.string.logError("Missing arg for format string",{format:b,argId:d}),"")},e=b.replace(a,d);return e},P.string.logError=function(a,b){P.Logger.getLogger("Strings").error(a,b)}}(),function(){goog.provide("P.router"),goog.require("P.logger"),function(){var a=P.Logger.getLogger("P.router"),b=/\$\{(\d+)\}/g,c=/\?\{(\w+)\}/g,d=/\$\{(\w+)\}/g,e=/^([^\?]*?)\?(.*)$/,f=function(a,e,f,g){var h=!1;return a=a.replace(c,function(a,b){var c=f[b];return void 0===c&&(h=!0),c}),h?null:(a=a.replace(b,function(a,b){return e[parseInt(b,10)]}),g&&(a=a.replace(d,function(a,b){var c=g[b];return e[c]})),a)},g=function(a,b,c,d){var e=a;return _.isObject(a)?(e={},_.each(a,function(a,f){e[g(f,b,c,d)]=g(a,b,c,d)})):_.isString(a)&&(e=f(a,b,c,d)),e};P.Route=function(a){this.pathPattern=new RegExp(a,"i"),this.module="",this.named={},this.options={},this.resource=null,this.extraContent={}},P.Route.fromPlainObject=function(a){var b=a.pathPattern;if(!b)throw new Error("pathPattern is required");var c=new P.Route(b);return"module"in a&&(c.module=a.module),"named"in a&&(c.named=a.named),"options"in a&&(c.options=a.options),"resource"in a&&(c.resource=a.resource),"extraContent"in a&&(c.extraContent=a.extraContent),c},P.RouteMatch=function(){this.pathPattern=null,this.module="",this.named={},this.options={},this.resource=null,this.extraContent={},this.navigateData=null},P.Router=function(){this.routes=[],this.lastUrl=window.location.href,this.log=P.Logger.getLogger("Router")},_.extend(P.Router.prototype,Backbone.Events),_.extend(P.Router.prototype,{start:function(){var a=this;if(_.each(P.ROUTES,function(b){var c=P.Route.fromPlainObject(b);a.addRoute(c)}),P.useHistory()){if(window.history.replaceState){var b=$("link[rel=canonical]").attr("href");if(window.location.href!==b){var c="state"in window.history?window.history.state:{};try{window.history.replaceState(c,document.title,b)}catch(d){this.log.error("replaceState failed",d)}this.lastUrl=window.location.href}}$(window).on("popstate",function(b){a.log.debug("popstate fired, lastUrl",a.lastUrl," new URL ",window.location.href),a.lastUrl===window.location.href?a.log.debug("ignoring spurious popstate event"):a.onStateChange(b),a.lastUrl=window.location.href})}},navigate:function(a,b,c){c=c||new P.navigateData.NavigateData,this.navigateData=c,b.trigger&&($("link[rel=canonical]").remove(),window.history.pushState({},document.title,a),this.lastUrl=window.location.href);var d=this.resolve(a);this.log.debug("route matched",d,a),d?this.trigger(P.CONST.EVENT_ROUTE_MATCHED,d):this.trigger(P.CONST.EVENT_ROUTE_NO_MATCH,a)},resolve:function(a){var b=null,c=null,d=null;(d=e.exec(a))?(b=d[1],c=d[2]):b=a;for(var f=decodeURIComponent(b),g=null,h=0;h<this.routes.length;h++){var i=this.routes[h],j=i.pathPattern.exec(f);if(j){var k=j.slice(1);g=this.subRoute(i,k,c);break}}return g},addRoute:function(a){this.routes.push(a)},subRoute:function(a,b,c){var d=P.getQueryStringParams(c),e=new P.RouteMatch;return e.pathPattern=a.pathPattern,e.module=g(a.module,b,d,a.named),e.named=g(a.named,b,d,a.named),e.options=g(a.options,b,d,a.named),e.resource=g(a.resource,b,d,a.named),e.extraContent=g(a.extraContent,b,d,a.named),e.navigateData=this.navigateData,this.navigateData=new P.navigateData.NavigateData,e},onStateChange:function(){this.navigate(window.location.pathname,{trigger:!1})}}),P.navigate=function(b,c){b=P.normalizeUrl(b),c=c||new P.navigateData.NavigateData;var d=P.url.getUrlClass(b);if(d===P.url.UrlClass.UNTRUSTED||c.evt&&c.evt.data&&c.evt.data.useNewTab){var e=null;return c.evt&&c.evt.data&&(e=c.evt.data.pinId),void P.SafeLink.open(b,e)}return P.useHistory()&&d!==P.url.UrlClass.TRUSTED_DIFFERENT_ORIGIN?d===P.url.UrlClass.SAME_ORIGIN?(c.fromNavigate=!0,void P.router.get().navigate(b,{trigger:!0},c)):void a.error("unexpected UrlClass",d,b):void P.changeWindowLocation(b,!1)},P.Errors.wrap(P.Router.prototype,["start"]),P.router.set=function(a){P._router=a},P.router.get=function(){return P._router},P.router.set(new P.Router)}()}(),function(){goog.provide("P.filter"),P.filter={},P.filter.FilterMatchResult=function(){this.hasExactMatch=!1,this.itemMatched=[]},P.filter._escapeRegExp=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},P.filter._getTestFunction=function(a){var b=a.split(" "),c=_.without(b,""),d=_.map(c,P.filter._escapeRegExp),e=new RegExp(d.join(".*"),"i");return function(a){return e.test(a)}},P.filter._makeCaseInsensitiveEqualsRegExp=function(a){return new RegExp("^"+P.filter._escapeRegExp(a)+"$","i")},P.filter.match=function(a,b){var c=P.filter._getTestFunction(a),d=new P.filter.FilterMatchResult;d.itemMatched=_.map(b,c);var e=P.filter._makeCaseInsensitiveEqualsRegExp(a);return d.hasExactMatch=_.some(b,function(a){return e.test(a)}),d}}(),function(){goog.provide("P.url"),goog.provide("P.beginsWith");var a;P.Logger&&(a=P.Logger.getLogger("P.url")),P.url={},P.beginsWith=function(a,b){return 0===a.lastIndexOf(b,0)},P.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},P.getQueryStringParams=function(a){a=a||window.location.search,"?"===a[0]&&(a=a.substring(1));for(var b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f={};b=d.exec(a);)f[e(b[1])]=e(b[2]);return f};var b="";P.url._getAuthenticationOrigin=function(){return b};var c="";P.url._getTrustedHostnameEnding=function(){return c},P.start&&P.start.ready(function(a){b=a.authenticationOrigin,c=a.trustedHostnameEnding});var d=function(b,c){c=c||{},c.next&&a&&a.error('makeNextUrl: passing "next" in "params" is not allowed',{next:c.next});var d=_.extend({},c,{next:window.location.href}),e=P.url._getAuthenticationOrigin()+b+"?"+$.param(d);return e};P.getRegisterUrl=function(a){return d("/join/",a)},P.getLoginUrl=function(a){return d("/login/",a)},P.absolutify=function(a,b,c){return a.match(/^https{0,1}:\/\//)?a:(void 0===b&&(b=window.location.protocol),void 0===c&&(c=window.location.hostname,window.location.port&&(c+=":"+window.location.port)),b+"//"+c+a)},P.normalizeUrl=function(a){var b=P.absolutify("/");return P.beginsWith(a,b)?a.substr(b.length-1):a},P.getCurrentUrl=function(){return window.location.pathname+("?"===window.location.search?"":window.location.search)},P.isOffsiteUrl=function(a){return!(!a||!a.match(/^https{0,1}:\/\//)||P.url.isTrustedOrigin(a))},P.url.UrlClass={SAME_ORIGIN:1,TRUSTED_DIFFERENT_ORIGIN:2,UNTRUSTED:3,INVALID:4},P.url._parse=function(){var a=document.createElement("a"),b=/^https{0,1}:\/\/[^\/]+/;return function(c){a.href=c;var d=a.href,e=b.exec(d),f=e?e[0]:null,g=a.hostname;return{origin:f,hostname:g}}}(),P.url.getUrlClass=function(a){var b=P.url._parse(a);if(b.origin===window.location.origin)return P.url.UrlClass.SAME_ORIGIN;if(b.hostname===window.location.hostname)return P.url.UrlClass.TRUSTED_DIFFERENT_ORIGIN;if(b.hostname){var c=P.url._getTrustedHostnameEnding();if(b.hostname===c||P.endsWith(b.hostname,"."+c))return P.url.UrlClass.TRUSTED_DIFFERENT_ORIGIN}var d=P.url._getAuthenticationOrigin();return b.origin&&b.origin===d?P.url.UrlClass.TRUSTED_DIFFERENT_ORIGIN:b.origin?P.url.UrlClass.UNTRUSTED:P.url.UrlClass.INVALID},P.url.isTrustedOrigin=function(a){switch(P.url.getUrlClass(a)){case P.url.UrlClass.SAME_ORIGIN:case P.url.UrlClass.TRUSTED_DIFFERENT_ORIGIN:return!0}return!1},P.url.buildRelativeUrl=function(a,b){var c=$.param(b);return a+"?"+c},P.url.appendQueryString=function(a,b){var c=/\?/.test(a)?"&":"?";return a+c+$.param(b)}}(),function(){goog.provide("P.util"),goog.require("P.errors"),goog.require("P.ContextLogging.ComponentType"),goog.require("P.ContextLogging.EventType");var a={_:function(a){return nunjucks.runtime.markSafe(P._(a))},_ngettext:function(a,b,c){return nunjucks.runtime.markSafe(goog.i18n.pluralRules.select(c,null,P.currentUser.get("locale"))===goog.i18n.pluralRules.Keyword.ONE?P._(a):P._(b))},_interpolate:function(a,b){return P.string.format(a,b)},ComponentType:P.ContextLogging.ComponentType,ElementType:P.ContextLogging.ElementType},b=_.memoize(function(){var a=nunjucks.configure({autoescape:!0,dev:!0});return a.addFilter("to_json",function(a){return JSON.stringify(a)}),a.addFilter("dict_copy",function(a){if(!(a instanceof Object)||a instanceof Array||a instanceof Function)return a;var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}),a.addFilter("should_include_timestamp",function(a,b){var c=b.previous_message_time,d=b.chunk_time||3600;c||(c=new Date);var e=Math.abs((new Date(a)-new Date(c))/1e3);return e>d}),a.addFilter("urlparams",function(a,b){var c=$.param(_.omit(b,"__keywords"));return c?(a+=-1!==a.indexOf("?")?"&":"?",a+=c):a}),a.addFilter("named_format",function(a,b){return P.string.format(a.toString(),b)}),a.addFilter("emojify",function(a){function b(a,b){return 1024*(a-55296)+(b-56320)+65536}var c,d=/([\ud800-\udbff])([\udc00-\udfff])/g,e=a.match(d);return e?c=a.replace(d,function(a,c,d){var e=b(c.charCodeAt(0),d.charCodeAt(0));return'<span class="emoji'+e.toString(16)+'"></span>'}):a}),a.addFilter("humanize_timesince",function(a){var b=function(a,b){var d=c(a,b);return Math.floor(d/52)},c=function(a,b){return a.getWeekNumber()-b.getWeekNumber()},d=function(a,b){var c=864e5;return Math.round(Math.abs((a.getTime()-b.getTime())/c))},e=function(a,b){var c=36e5;return Math.floor(Math.abs(a-b)/c)},f=function(a,b){return Math.floor((b-a)/1e3/60)};if(a){var g=new Date(a),h=new Date,i=b(g,h);if(i>0)return i>1?P.string.format(P._("{{ years }} years ago"),{years:i}):P.string.format(P._("{{ year }} year ago"),{year:i});var j=c(g,h);if(j>1)return j>1?P.string.format(P._("{{ weeks }} weeks ago"),{weeks:j}):P.string.format(P._("{{ week }} week ago"),{week:j});var k=d(g,h);if(k>0)return k>1?P.string.format(P._("{{ days }} days ago"),{days:k}):P.string.format(P._("{{ day }} day ago"),{day:k});var l=e(g,h);if(l>0)return l>1?P.string.format(P._("{{ hours }} hours ago"),{hours:l}):P.string.format(P._("{{ hour }} hour ago"),{hour:l});var m=f(g,h);return m>0?m>1?P.string.format(P._("{{ minutes }} minutes ago"),{minutes:m}):P.string.format(P._("{{ minute }} minute ago"),{minute:m}):P._("just now")}}),a.addFilter("contains",function(a,b){return-1!==a.indexOf(b)}),a});P.renderNunjucks=function(c,d){var e=b(),f=_.extend({},d,a);return e.render(c,f)},P.useHistory=function(){return!!(window.history&&window.history.pushState&&window.history.replaceState)},jQuery.fn.positionAncestor=function(a){var b=0,c=0;return a.length>0&&this.each(function(d,e){var f=$(e),g=f.offset();if(a[0]===window)b=g.left,c=g.top;else{var h=a.scrollLeft(),i=a.scrollTop(),j=a.offset();b=h+g.left-j.left,c=i+g.top-j.top}return!1}),{left:b,top:c}},P.debounce=function(a,b,c){var d=_.debounce(a,c,!0),e=_.debounce(b,c);return function(){d.apply(this,arguments),e.apply(this,arguments)}},P.toArgumentString=function(a){var b=[];return _.each(a,function(a,c){a=a&&a.toString?a.toString():JSON.stringify(a),b.push(c+"="+a)}),b.join(", ")};var c=/(<([^>]+)>)/gi;P.stripTags=function(a){return a.replace(c,"")},P.normalizeScroller=function(a){return a&&a[0]&&a[0]!==window||(a=$("body,html")),a},P.scrollToTop=function(a){var b=a.callback||P.NOOP,c=a.duration||P.CONST.SCROLL_TO_TOP_ANIMATION_TIME,d=P.normalizeScroller(a.$scroller),e=a.newScrollOffset||0;d.animate({scrollTop:e},{duration:c,complete:_.once(b)})},P.changeWindowLocation=function(a,b){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_LOCATION_CHANGE,{}),b?window.open(a,"_blank"):(P.trackRegisterAction("setting_new_window_location"),window.location.href=a)},P.navigateAfterLoginStatusChange=function(a){P.url.isTrustedOrigin(a)||(a="/",P.trackRegisterAction("url_reset")),P.changeWindowLocation(a,!1)},P.trackRegisterAction=function(a){var b=P.resourceFactory.create("UserRegisterTrackActionResource",{action:a});b.callUpdate({error:P.NOOP})},P.getDebugWindow=function(){return window.opener||window},P.prefixVendorAttributes=function(a){for(var b=["ms","moz","webkit","o"],c=0;c<b.length;c++)b[c]="-"+b[c]+"-"+a;return b.push(a),b},P.getResetPasswordOneClickUrl=function(a){return"/login/reset/?"+$.param(a)},P.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},P.downloadFile=function(a){var b="downloaderIFrame",c=document.getElementById(b);null===c&&(c=document.createElement("iframe"),c.id=b,c.style.display="none",document.body.appendChild(c)),c.src=a},P.logWidgetEvent=function(a){var b=new Image,c="//log.pinterest.com/";b.src=c+"?"+$.param(a)},P.showSignupPromptForExperiment=function(a,b,c){return P.currentUser.isAuthenticated()?!1:P.experiments.instance.inExperimentGroupsActiveOrTriggerable(a,["control_3","can_dismiss_no_skip_3","cannot_dismiss_3"])&&(P.trackRegisterAction(b),P.experiments.instance.reportExperimentActivated(a,!0),P.experiments.instance.inExperimentGroups(a,["can_dismiss_no_skip_3","cannot_dismiss_3"],!0))?(P.UserRegistration.showSignupModal(null,{redirect_to_signup:!0,can_dismiss:P.experiments.instance.inExperimentGroup(a,"can_dismiss_no_skip_3"),show_skip_button:!1,tagline:c}),!0):!1}}(),function(){goog.provide("P.dom"),goog.require("P.errors"),P.dom={},P.dom.scrollIntoView=function(a,b){var c=a.position().top,d=c+a.outerHeight(),e=b.outerHeight(),f=b.scrollTop();c<0?b.scrollTop(f+c):d>e&&b.scrollTop(f-e+d)};var a=window.requestAnimationFrame||function(a){setTimeout(a,16)},b=function(){return new Promise(function(b){a(function(){b(void 0)})})};P.dom.deferWrite=b,P.deferDomManipulation=function(a){P.dom.deferWrite().then(a)}}(),function(){goog.provide("P.boardPickerUtil"),P.boardPickerUtil={},P.boardPickerUtil.showNoBoardsTooltip=function(a,b){if(b.length){var c={name:"Dropdown",options:{anchor:b,class_name:"large aboveModal",fixed:!0,position_point:"TOP_CENTER",text:P._("<strong>You collect your Pins on boards</strong> so everything's nice and organized.")}};P.loadModule(c,function(b){var c=b;c.render(function(){a.appendChild(c),_.defer(function(){c.positionModule(),c.fadeIn()})})})}}}(),function(){Promise.prototype.fin=function(a){return this.then(function(b){return Promise.resolve(void 0).then(a).then(function(){return b})},function(b){return Promise.resolve(void 0).then(a).then(function(){throw b})})}}(),function(){goog.provide("P.desktopUtil"),goog.require("P.HistoryManager"),goog.require("P.interfaces.HistoryManagerProvider"),P.scrollbarWidth=_.memoize(function(){var a=document.createElement("div");$(a).css({height:"100px",left:"100px",overflow:"scroll",position:"absolute",width:"100px"}),document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b}),P.preloadImage=function(a,b,c){var d=new Image;d.src=a,d.onload=b||P.NOOP,d.onerror=c||P.NOOP};var a=function(){};a.prototype.navigate=function(a,b){var c=P.app;c.getHistoryManager().navigate(a,b||{})},P.setHistoryNavigator(new a),P.supportCSSTransitions=_.memoize(function(){var a=document.createElement("p").style,b="transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a;return b})}(),function(){goog.provide("P.nativeApp"),P.nativeApp={getOpenInAppPreference:function(){return!!Cookie.get(P.CONST.COOKIE_OPEN_IN_APP)},setOpenInAppPreference:function(){Cookie.set(P.CONST.COOKIE_OPEN_IN_APP,"1",8760)},getStayInBrowserPreference:function(){return!!Cookie.get(P.CONST.COOKIE_STAY_IN_BROWSER)},setStayInBrowserPreference:function(a){var b;b=a?720:24,Cookie.set(P.CONST.COOKIE_STAY_IN_BROWSER,"1",b)}}}(),function(){goog.provide("P.viewport"),goog.require("P.start");var a=function(){this.height=0,this.width=0};_.extend(a.prototype,{init:function(){this.on(P.CONST.EVENT_RESIZE,this._onResize,this),$(window).on("resize",_.debounce(_.bindFn(this._cacheWindowSize,this),200)),this._cacheWindowSize(),this.updateBodyColumns()},_cacheWindowSize:function(){var a=$(window),b=a.height(),c=a.width();(b!==this.height||c!==this.width)&&(this.height=b,this.width=c,this.trigger(P.CONST.EVENT_RESIZE))},_onResize:function(){this.updateBodyColumns()},updateBodyColumns:function(){this.setBodyColumns(P.bodyColumns.getBodyColumnsNeeded())
},setBodyColumns:function(a){a!==this.numColumns&&(this.numColumns=a,P.bodyColumns.setNumColumns(a),this.trigger(P.CONST.EVENT_BODY_COLUMN_CHANGE))}}),P.Viewport=new a,_.extend(P.Viewport,Backbone.Events),P.start.ready(function(){P.Viewport.init()})}(),function(){function a(a){return a===window.setTimeout?function(a,b){return window.setTimeout(a,b)}:a===window.setInterval?function(a,b){return window.setInterval(a,b)}:a}goog.provide("P.window");var b=function(b,c){var d=a(c);if(!P.Errors.ENABLE_WRAPPING)return d;var e=function(a,c,e){if("string"===typeof a&&(a=window[a]),!a)return-1;var f=b+":"+e,g=_.isFunction(a)?P.Errors.wrapFn(f,a):a;return d(g,c)};return e};P.setTimeout=b("setTimeout",window.setTimeout),P.setInterval=b("setInterval",window.setInterval)}(),function(){goog.provide("P.googleAnalytics"),goog.require("P.start"),goog.require("P.logger"),goog.require("P.pubsub"),window._gaq=window._gaq||[];var a,b=P.Logger.getLogger("GoogleAnalytics"),c=function(c){b.finer("gaqPush",c);for(var d=0;d<a.length;d++){var e=a[d];window._gaq.push(["_setAccount",e]),window._gaq.push(c)}},d=function(b){a=b;var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d),P.DEBUG&&(c(["_setSampleRate",100]),c(["_setSiteSpeedSampleRate",100]))},e={VISITOR:1,SESSION:2,PAGE:3},f=function(a){var b=a?"logged in":"logged out";c(["_setCustomVar",1,"is_logged_in",b,e.SESSION])};P.start.ready(function(a){d(a.gaAccountNumbers),f(a.isLoggedIn)}),P.getTrackGAPageviewUrl=function(a,b){var c=a,d=P.getQueryStringParams(b),e=d.q;return e&&(c+="?"+$.param({q:e})),c},P.trackGAPageview=function(a,b){b=b||{streaming:void 0,scriptLoadLocation:void 0},c(["_setCustomVar",2,"page_name",a,e.PAGE]),c(["_setCustomVar",3,"streaming",String(b.streaming),e.PAGE]),c(["_setCustomVar",4,"script_load_location",String(b.scriptLoadLocation),e.PAGE]),c(["_trackPageview",P.getTrackGAPageviewUrl(window.location.pathname,window.location.search)]),c(["_setPageGroup",1,a])},P.trackGAEvent=function(a,b,d,e){c(["_trackEvent",a,b,d,e])},P.trackGACategoryEvent=function(a,b,c){P.trackGAEvent(a+"_"+b,c)}}(),function(){goog.provide("P.event"),P.Event=function(a,b,c){this.type=a,this.target=b,this.currentTarget=b,this.data=c||{},this.stopped=!1},P.Event.prototype.stopPropagation=function(){this.stopped=!0},P.Event.prototype.shouldPropagate=function(){return!this.stopped}}(),function(){goog.provide("P.loader"),goog.require("P.modules"),goog.require("P.resourceFactory");P.ModuleConstructorNotFoundError=function(){Error.apply(this,arguments)},P.ModuleConstructorNotFoundError.prototype=new Error,P.ModuleConstructorNotFoundError.prototype.name="P.ModuleConstructorNotFoundError",P._loadModuleConstructor=function(a){for(var b,c=P.modules,d=a.split(/\./),e=0;e<d.length&&c;e++)if(c=c[d[e]],!c)return b=new P.ModuleConstructorNotFoundError,b.moduleName=a,Promise.reject(b);var f=c;return _.isFunction(f)?Promise.resolve(f):(b=new P.ModuleConstructorNotFoundError,b.moduleName=a,Promise.reject(b))},P.loadModuleConstructor=_.memoize(P._loadModuleConstructor),P.loadModule=function(a,b){var c=a.name,d=P.loadModuleConstructor(c).then(function(b){var c=new b({id:a.id,resource:a.resource,options:a.options,data:a.data});return c});return b&&d.then(b),d},P.moduleFactory={create:function(a,b,c){return P.loadModuleConstructor(a.name).then(function(d){var e=$("#"+a.uid,b),f={el:e,options:a.options,id:a.id||void 0,resource:a.resource||void 0,data:a.data||void 0},g=new d(f);return c&&c.addChild(g),g.loadFromModuleTree(a).then(function(){return g})})}}}(),function(){goog.provide("P.resourceFactory"),goog.require("P.interfaces.IResource");var a=function(){this.defaultConstructorFn=null,this.nameToConstructorFn={}};a.prototype={setDefaultConstructorFn:function(a){this.defaultConstructorFn=a},create:function(a,b){var c,d=b||{},e=this.nameToConstructorFn[a];if(e)c=new e(d);else{if(!this.defaultConstructorFn)throw new Error("Couldn't find constructor function for "+a);c=new this.defaultConstructorFn(a,d)}return c},clone:function(a){return this.create(a.getName(),a.copyOptions(!0))},register:function(a,b){this.nameToConstructorFn[a]=b}},P.ResourceFactory=a,P.resourceFactory=new a}(),function(){function a(a){this.name=a,this.id=null,this.options={},this.data=null,this.async=!1,this.resource=null,this.renderType=P.ModuleRenderType.NORMAL,this.errorStrategy=P.CONST.ErrorStrategy.REMOVE}goog.provide("P.moduleRenderOptions"),goog.require("P.interfaces.IResource"),goog.require("P.ModuleRenderType"),a.prototype={setName:function(a){this.name=a},setId:function(a){this.id=a},setOptions:function(a){this.options=a},setData:function(a){this.data=a},setAsync:function(a){this.async=a},setResource:function(a){this.resource=a},setRenderType:function(a){this.renderType=a},setErrorStrategy:function(a){this.errorStrategy=a}},a.fromPlainObject=function(b){var c=new a(b.name);if("id"in b&&c.setId(b.id),"options"in b&&c.setOptions(b.options),"data"in b&&c.setData(b.data),"async"in b&&c.setAsync(b.async),b.resource){var d=P.resourceFactory.create(b.resource.name,b.resource.options);c.setResource(d)}return"renderType"in b&&c.setRenderType(b.renderType),"errorStrategy"in b&&c.setErrorStrategy(b.errorStrategy),c},P.ModuleRenderOptions=a}(),function(){goog.provide("P.ModuleRenderType"),P.ModuleRenderType={NORMAL:1,PREPEND:2,APPEND:3}}(),function(){goog.provide("P.ModuleRenderer"),P.ModuleRenderer=function(){},P.ModuleRenderer.prototype={render:function(){}}}(),function(){function a(a){this.name=a,this.attributes={"class":"",id:""},this.id=null,this.children=[],this.data=null,this.extraData={},this.errorStrategy=P.CONST.ErrorStrategy.REMOVE,this.options={},this.uid="",this.async=!1,this.resource=null,this.tagName=null,this.additionalClasses=null,this.additionalAttributes=null,this.innerHtml=null,this.outerHtml=null,this.error=null}goog.provide("P.moduleTree"),goog.require("P.interfaces.IResource"),a.prototype={setAttributes:function(a){this.attributes=a},setId:function(a){this.id=a},setChildren:function(a){this.children=a},addChild:function(a){this.children.push(a)},setData:function(a){this.data=a},setExtraData:function(a){this.extraData=a},setErrorStrategy:function(a){this.errorStrategy=a},setError:function(a){this.error=a},setOptions:function(a){this.options=a},setUid:function(a){this.uid=a},setAsync:function(a){this.async=a},setResource:function(a){this.resource=a},setTagName:function(a){this.tagName=a},setAdditionalClasses:function(a){this.additionalClasses=a},setAdditionalAttributes:function(a){this.additionalAttributes=a},setInnerHtml:function(a){this.innerHtml=a},setOuterHtml:function(a){this.outerHtml=a},flattenHtml:function(){var b=this,c=this.innerHtml?this.innerHtml.split(a.modulePlaceholder):[],d=this.name.replace(".","-");this.uid=_.uniqueId("m");var e=this.tagName||"div",f="<"+e+' class="Module '+d;this.additionalClasses&&(f+=" "+this.additionalClasses.join(" ")),f+='" id="'+this.uid+'"',this.additionalAttributes&&_.each(this.additionalAttributes,function(a,b){f+=" "+_.escape(b)+'="'+_.escape(a)+'"'}),f+=">",_.each(c,function(a,c){f+=a;var d=b.children[c];d&&(f+=d.getTreeOuterHtml(),d.outerHtml=null)}),f+="</"+e+">",this.outerHtml=f},getTreeOuterHtml:function(){return this.outerHtml}},a.fromPlainObject=function(b){var c=new a(b.name);return"attributes"in b&&c.setAttributes(b.attributes),"id"in b&&c.setId(b.id),"data"in b&&c.setData(b.data),"extraData"in b&&c.setExtraData(b.extraData),"errorStrategy"in b&&c.setErrorStrategy(b.errorStrategy),"options"in b&&c.setOptions(b.options),"uid"in b&&c.setUid(b.uid),"async"in b&&c.setAsync(b.async),"resource"in b&&c.setResource(b.resource),"error"in b&&c.setError(b.error),_.each(b.children,function(b){var d=a.fromPlainObject(b);c.addChild(d)}),c},a.modulePlaceholder="<!--placeholder-->",P.ModuleTree=a}(),function(){goog.provide("P.moduleTemplate"),goog.require("P.user"),goog.require("P.experiments"),goog.require("P.interfaces.IResource"),goog.require("P.moduleTree");var a=nunjucks.runtime.markSafe(P.ModuleTree.modulePlaceholder),b=function(a,b){for(var c in b)"__keywords"!==c&&(a[c]=b[c])};P.moduleTemplate={},P.moduleTemplate.Result=function(){this.innerHtml="",this.childrenModuleRenderOptions=[],this.additionalClasses=[],this.additionalAttributes={},this.data=null,this.extraData={},this.tagName=null},P.moduleTemplate.TemplateContext=function(a,b,c,d){this.options=a,this.data=b,this.resource=c,this._result=d,this.module=_.bindFn(this.module,this),this.ProxyModule=_.bindFn(this.ProxyModule,this),this.tag_name=_.bindFn(this.tag_name,this),this.addclass=_.bindFn(this.addclass,this),this.attr=_.bindFn(this.attr,this),this.extra_data=_.bindFn(this.extra_data,this),this.describe=_.bindFn(this.describe,this),this.base=_.bindFn(this.base,this)},P.moduleTemplate.TemplateContext.prototype={context:{experiments:{in_experiment_group:function(a,b,c){var d=c&&c.activate;return P.experiments.instance.inExperimentGroup(a,b,d)},in_experiment_groups:function(a,b,c){var d=c&&c.activate;return P.experiments.instance.inExperimentGroups(a,b,d)},get_group_for_experiment:function(a,b){var c=b&&b.activate;return P.experiments.instance.getGroupForExperiment(a,c)}},experiences:{is_placed_experience:function(a,b){var c=P.Experiences.Placement[a],d=P.Experiences.Experience[b];return P.ExperienceManager.instance().isPlacedExperience(c,d)},experience_viewed:function(){throw new Error("not implemented")}},user:P.currentUser.attributes,is_authenticated:P.currentUser.isAuthenticated()},module:function(b,c){var d=P.ModuleRenderOptions.fromPlainObject(c);return d.setName(b),this._result.childrenModuleRenderOptions.push(d),a},ProxyModule:function(b){var c=P.ModuleRenderOptions.fromPlainObject(b);return this._result.childrenModuleRenderOptions.push(c),a},create_resource:function(a,b){var c=P.resourceFactory.create(a);return b||(b={}),c.options=b.options||{},c},tag_name:function(a){this._result.tagName=a},addclass:function(a){this._result.additionalClasses.push(a)},attr:function(a){b(this._result.additionalAttributes,a)},extra_data:function(a){_.extend(this._result.extraData,a)},include_data:function(){},describe:function(a){b(this.options,a)},base:function(a){var b=a.replace(".","-");this.addclass(b)}},P.moduleTemplate.render=function(a,b,c,d){var e=new P.moduleTemplate.Result,f=new P.moduleTemplate.TemplateContext(a,b,c,e);return e.data=b,e.innerHtml=P.renderNunjucks(d,f),e}}(),function(){goog.provide("P.ModuleRendererLocal"),goog.require("P.logger"),goog.require("P.ModuleRenderer"),goog.require("P.moduleTemplate"),goog.require("P.moduleTree"),goog.require("P.resourceCache");var a=P.Logger.getLogger("ModuleRendererLocal"),b=function(a){this.templateName=a};b.prototype={_getData:function(a){return a.data||!a.resource?Promise.resolve(a.data):P.resourceCache.instance.callGet(a.resource).then(function(a){return a})},_getErrorModuleTree:function(a){var b=new P.ModuleTree(a.name);return b.setInnerHtml("error"),Promise.resolve(b)},_getAsyncModuleTree:function(a){var b=new P.ModuleTree(a.name);return a.id&&b.setId(a.id),a.options&&b.setOptions(a.options),a.resource&&b.setResource(a.resource),b.setAsync(a.async),b.flattenHtml(),Promise.resolve(b)},_renderModuleTree:function(a,b){var c=a.resource,d=P.moduleTemplate.render(a.options,b,c,this.templateName),e=this,f=_.map(d.childrenModuleRenderOptions,function(a){return a.async?e._getAsyncModuleTree(a):P.loadModuleConstructor(a.name).then(function(b){var c=b.prototype,d=c.moduleRenderer;return d.render(a)})});return Promise.all(f).then(function(b){b=_.without(b,null);var c=new P.ModuleTree(a.name);return a.id&&c.setId(a.id),a.options&&c.setOptions(a.options),a.resource&&c.setResource(a.resource),c.setAdditionalClasses(d.additionalClasses),c.setAdditionalAttributes(d.additionalAttributes),c.setData(d.data),c.setExtraData(d.extraData),d.tagName&&c.setTagName(d.tagName),c.setChildren(b),c.setInnerHtml(d.innerHtml),c.flattenHtml(),c})},render:function(b){var c=this;return this._getData(b).then(function(a){return c._renderModuleTree(b,a)}).then(void 0,function(d){switch(a.error(d,"errorStrategy",b.errorStrategy),b.errorStrategy){case P.CONST.ErrorStrategy.SHOW:return c._getErrorModuleTree(b);case P.CONST.ErrorStrategy.REMOVE:return null;default:return a.warn("unknown moduleRenderOptions.errorStrategy",b.errorStrategy),null;case P.CONST.ErrorStrategy.BUBBLE:throw d}})}},P.ModuleRendererLocal=b}(),function(){goog.provide("P.moduleRendererRemote"),goog.require("P.ModuleRenderer");var a=function(){};a.prototype={render:function(a){var b=a.resource;b||(b=P.resourceFactory.create(P.Resource.NOOP_RESOURCE.name,P.Resource.NOOP_RESOURCE.options));var c={error:P.NOOP};return b.callGet(c,a).then(function(a){return a.moduleTree})}},P.ModuleRendererRemote=a}(),function(){"use strict";function a(a,b,c,d){var f=a.$el,g=_.map(b,c);return Promise.all(g).then(function(b){var c=[],g=[];_.each(b,function(a){c=c.concat(a.errors),g=g.concat(a.warnings)});var h={$el:f,errors:c,warnings:g};return a.trigger(e,h),d&&d(h),h})}goog.provide("P.form"),goog.require("P.placeholder");var b=P.Logger.getLogger("Form"),c="hasError",d="hasWarning",e="validated",f="disabled",g="[type=submit]",h=["button","file","image","reset","submit"],i=100,j=["pinterest","password","123456","welcome","ninja","abc123","123456789","12345678","sunshine","princess","qwerty","master","michael","jordan","dragon","soccer","killer","pepper","devil","princess","1234567","iloveyou"],k=function(a,b){this.$el=a,this.rules=b};_.extend(k.prototype,Backbone.Events),_.extend(k.prototype,{validate:function(b){var c=this;return a(this,this.rules,function(a){return a(c.$el)},b)}}),k.Required=function(a){return function(b,c){var d=b.val(),e=[],f="checkbox"===b.attr("type")&&!b.is(":checked"),g="radio"===b.attr("type")&&!b.is(":checked");if(f||g||!d){var h=a&&a.message?a.message:P._("Required");e.push(h)}var i={$el:b,errors:e,warnings:[]};return c&&c(i),Promise.resolve(i)}},k.Email=function(a){return function(b,c){var d=$.trim(b.val()),e=[];if(d&&!d.match(/.+@.+\..+/gi)){var f=a&&a.message?a.message:P._("Not a valid email.");e.push(f)}var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.PhoneNumber=function(a){return function(b,c){var d=$.trim(b.val()),e=d.replace(/[\(\)\+\-\. ]/g,""),f=/^(\(?\+?[0-9]*\)?)?[0-9_\- \.\(\)]*$/g,g=[];if(d&&(!d.match(f)||e.length<7)){var h=a&&a.message?a.message:P._("Not a phone number.");g.push(h)}var i={$el:b,errors:g,warnings:[]};return c&&c(i),Promise.resolve(i)}},k.Number=function(a){return function(b,c){var d=$.trim(b.val()),e=/^\d+$/,f=[];if(d&&!d.match(e)){var g=a&&a.message?a.message:P._("Not a number.");f.push(g)}var h={$el:b,errors:f};return c&&c(h),Promise.resolve(h)}},k.URL=function(a){return function(b,c){var d=b.val(),e=[];if(d&&!d.match(/^(https?:\/\/){0,1}[a-z0-9_\-]+\..+/gi)){var f=a&&a.message?a.message:P._("Not a valid url.");e.push(f)}var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.Password=function(a){return function(b,c){var d=b.val(),e=[],f={shortPassStr:a&&a.shortPassStr||P._("Too short"),badPassStyle:a&&a.badPassStyle||P._("Not proper style"),samePasswordStr:a&&a.samePasswordStr||P._("Password and username can't match"),blackPassStr:a&&a.blackPassStr||P._("Please try using a stronger password"),goodPassStr:a&&a.goodPassStr||P._("Great!"),userid:$('[name="username"]').length?$('[name="username"]').val():""},g=$.fn.teststrength(d,f,j);if(g.length){var h=g[g.length-1];if(h){var i=g[0];e.push(i)}}var k={$el:b,errors:e,warnings:[]};return c&&c(k),Promise.resolve(k)}},k.Length=function(a){return function(b,c){var d,e,f=b.val(),g=a.max||1/0,h=a.min||0,i=[],j=f.length;j<h?(d=P.string.format(P._("Please enter at least {{ character_count }} characters."),{character_count:h}),e=a&&a.messages&&a.messages.min?a.messages.min:d,i.push(e)):j>g&&(d=P.string.format(P._("Please enter no more than {{ character_count }} characters."),{character_count:g}),e=a&&a.messages&&a.messages.max?a.messages.max:d,i.push(e));var k={$el:b,errors:i,warnings:[]};return c&&c(k),Promise.resolve(k)}},k.EqualTo=function(a){return function(b,c){var d=b.val(),e=$('[name="'+a.targetFieldName+'"]').val(),f=[];d!==e&&f.push(a.message);var g={$el:b,errors:f,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.GreaterThan=function(a){return function(b,c){var d=$.trim(b.val()),e=[];d.length&&d<=a.value&&e.push(a.message);var f={$el:b,errors:e,warnings:[]};return c&&c(f),Promise.resolve(f)}},k.LaterThanOrEqualToDate=function(a){return function(b,c){var d=new Date(b.val()),e=a.date,f=[];!b.is(":disabled")&&e instanceof Date&&d.getTime()&&e.getTime()&&d<e&&f.push(a.message);var g={$el:b,errors:f,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.ContainsOnlyAscii=function(a){return function(b,c){var d=b.val(),e=[],f=/^[\040-\176]*$/.test(d);f||e.push(a.message);var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.CurrencyValue=function(a){return function(b,c){var d=$.trim(b.val()),e=/^\d*(\.\d\d?)?$/,f=[];if(d&&!d.match(e)){var g=a&&a.message?a.message:P._("Not a valid currency value.");f.push(g)}var h={$el:b,errors:f};return c&&c(h),Promise.resolve(h)}},k.Date=function(a){return function(b,c){var d=$.trim(b.val()),e=[],f=new Date(d);if(d&&!f.getTime()){var g=a&&a.message?a.message:P._("Not a valid date.");e.push(g)}var h={$el:b,errors:e};return c&&c(h),Promise.resolve(h)}},k.MatchesRegex=function(a){return function(b,c){var d=b.val(),e=[];a.pattern.test(d)||e.push(a.message);var f={$el:b,errors:e};return c&&c(f),Promise.resolve(f)}},P.Validator=k,P.Form=function(a,c,d){var f=this;d=d||{},this.$el=a,this.validators={},this.errorFields={},this.warningFields={},this.fastValidateFields={},this.hideErrors=!!d.hideErrors,this.prevalidating=!!d.prevalidate,this.disableAutoValidation=!!d.disableAutoValidation,this.onFieldBlur=_.bindFn(this.onFieldBlur,this),this.onFieldChange=_.bindFn(this.onFieldChange,this),this.onFieldKeyup=_.bindFn(this.onFieldKeyup,this),this.onFieldValidated=_.bindFn(this.onFieldValidated,this),this.onSubmit=_.bindFn(this.onSubmit,this),_.each(c,function(a,c){var d=f.getField(c);if(d[0]){var g=new P.Validator(d,a);f.validators[c]=g,g.on(e,f.onFieldValidated),d.on("blur",f.onFieldBlur),d.on("change",f.onFieldChange),d.on("keyup",f.onFieldKeyup)}else b.warn(c+" wasn't found in the form")}),this.prevalidating&&this.validate(function(){f.prevalidating=!1}),a.submit(this.onSubmit),a.find("[placeholder]").placeholder()},_.extend(P.Form.prototype,Backbone.Events),_.extend(P.Form.prototype,{validate:function(b){return a(this,this.validators,function(a){return a.validate()},b)},getField:function(a){var b=this.$el.find("[name="+a+"]");return"radio"===b.attr("type")&&(b=this.$el.find("[name="+a+"]:checked")),b},getFieldErrorMessages:function(a){return a.nextAll(".formErrorMessage")},getFieldWarningMessages:function(a){return a.nextAll(".formWarningMessage")},getFieldLabels:function(a){var b=a.attr("id"),c=this.$el.find('label[for="'+b+'"]'),d=a.closest("label",this.$el);return c.add(d)},validateField:function(a,b){var c=a.attr("name");return this.validators[c].validate(b)},getValue:function(a){var b=this.getField(a);return"checkbox"===b.attr("type")?b.is(":checked"):b.val()},getSubmitButtons:function(){return this.$el.find(g)},disableSubmitButtons:function(){this.getSubmitButtons().prop(f,!0).addClass(f)},enableSubmitButtons:function(){this.getSubmitButtons().not(".loading").prop(f,!1).removeClass(f)},hasErrors:function(){return!(!_.find(this.errorFields,function(a){return a})&&!this.$el.find("."+c)[0])},hasWarnings:function(){return!(!_.find(this.warningFields,function(a){return a})&&!this.$el.find("."+d)[0])},setFieldErrorsAndWarnings:function(a,b,e){this.clearFieldErrorAndWarningMessages(a);var f=!!b[0],g=!!e[0];if(this.errorFields[a.attr("name")]=f,this.warningFields[a.attr("name")]=g,!this.prevalidating&&!this.hideErrors){var h=this.getFieldLabels(a),i=h.add(a);i.toggleClass(c,f),i.toggleClass(d,g),this.appendFieldErrorMessages(a,b),this.appendFieldWarningMessages(a,e)}},appendFieldErrorMessages:function(a,b){b&&b.length&&a.parent().children().last().after('<p class="formErrorMessage">'+b.join(" ")+"</p>")},appendFieldWarningMessages:function(a,b){b&&b.length&&a.parent().children().last().after('<p class="formWarningMessage">'+b.join(" ")+"</p>")},clearFieldErrorAndWarningMessages:function(a){var b=this.getFieldErrorMessages(a);b.remove();var c=this.getFieldWarningMessages(a);c.remove()},clearAllErrorAndWarning:function(){var a,b=_.keys(this.errorFields),c=_.keys(this.warningFields),d=_.uniq(_.union(b,c)),e=this;_.each(d,function(b){(e.errorFields[b]||e.warningFields[b])&&(a=e.getField(b),e.setFieldErrorsAndWarnings(a,[],[]))})},enableFastValidateOnField:function(a){this.fastValidateFields[a]=1},onSubmit:function(a){a.preventDefault(),a.stopPropagation();var b=this;this.trigger("submitStarted",this.$el),this.validate(function(a,c){b.trigger(P.CONST.EVENT_SUBMIT_VALIDATED,a,c)})},onFieldValidated:function(a){var b=a.$el,c=a.errors,d=a.warnings;(c[0]||d[0])&&this.enableFastValidateOnField(b.attr("name")),this.setFieldErrorsAndWarnings(b,c,d),this.hasErrors()?this.disableSubmitButtons():this.enableSubmitButtons()},onFieldKeyup:function(a){if(a.keyCode!==P.keyCode.TAB){var b=$(a.target);this.fastValidateFields[b.attr("name")]&&!this.disableAutoValidation&&this.validateField(b)}},onFieldBlur:function(a){if(!this.disableAutoValidation){var b=this,c=$(a.target);_.delay(function(){b.validateField(c)},i)}},onFieldChange:function(a){if(!this.disableAutoValidation){var b=$(a.target);this.validateField(b)}},getData:function(){for(var a,b,c,d,e,f=this.$el.find("input,select,textarea"),g=f.length,i={},j=0;j<g;++j)a=$(f[j]),c=a.attr("name"),void 0===c||a.is(":disabled")||(b=a.attr("type"),_.contains(h,b)||"radio"===b&&!a.is(":checked")||(d="checkbox"===b?a.is(":checked"):a.val(),_.has(i,c)?(e=i[c],_.isArray(e)||(e=[e],i[c]=e),e.push(d)):i[c]=d));return i}}),P.Errors.wrap(P.Form.prototype,["onSubmit"])}(),function(){goog.provide("P.placeholder");var a=P.Logger.getLogger("Placeholder"),b="placeholder",c="placeholder",d="placeholder-visible";if(P.isPlaceholderSupported=b in document.createElement("input"),P.isPlaceholderSupported)jQuery.fn.placeholder=function(){return this};else{var e={initPlaceholder:function(){this.blur(e._onPlaceholderBlur),this.focus(e._onPlaceholderFocus),this.each(function(a,b){e._clearPlaceholder(b),e._setPlaceholder(b)})},_onPlaceholderBlur:function(){e._setPlaceholder(this)},_onPlaceholderFocus:function(){e._clearPlaceholder(this)},_setPlaceholder:function(a){var e=$(a),f=e.val();f||(a[d]=!0,e.addClass(c),a.value=e.attr(b))},_clearPlaceholder:function(a){var b=$(a);a&&a[d]&&(a[d]=!1,b.removeClass(c),a.value="")}};jQuery.fn.placeholder=function(){return e.initPlaceholder.apply(this),this};var f={get:function(a){var c=$(a),e=a[d];return e&&c.attr(b)===a.value?"":a.value},set:function(a,b){var c=$(a);return b&&a[d]?e._clearPlaceholder(a):b||e._setPlaceholder(a),a.value=b,e._setPlaceholder(a),c}};a.debug("Adding hooks on input and textarea for placeholders."),$.valHooks.input=f,$.valHooks.textarea=f,$(document).delegate("form","submit",function(){var a=$("input",this).each(e._clearPlaceholder);window.setTimeout(function(){a.each(e._setPlaceholder)},10)})}}(),function(){goog.provide("P.Module"),goog.require("P.CONST"),goog.require("P.errors"),goog.require("P.interfaces.IResource"),goog.require("P.ModuleRenderer"),goog.require("P.ModuleRenderType"),goog.require("P.logger");var a=300,b="fadeIn",c="fadeOut",d=b+" "+c,e="loading",f=300,g="moduleMask",h="inModal",i="notNavigatable",j="savedScrollTop",k="data-element-type",l="data-component-type",m="data-aux",n=_.invert(P.CONST.ErrorStrategy),o=0,p=function(a,b,c){var d="other";this.object=a,this.event=b,this.fn=c,this.id="",this.object instanceof P.Module?this.id=this.object.cid:(this.id=d+o,o+=1)};P.Module=function(){},P.Module=Backbone.View.extend({className:"Module",GACategory:null,moduleRenderer:new P.ModuleRendererRemote,constructor:function(a){Backbone.View.call(this,a),a&&(a.id&&(this.id=a.id),a.options&&this.setOptions(a.options),a.resource&&this.setResource(a.resource),a.data&&(this.data=a.data))},initialize:function(a){this.log=P.Logger.getLogger(this.className),this.id=null,this.cid=this.cid||"",this.options={},a&&a.options&&(this.options=a.options),this.resource=null,this.parent=null,this.children=[],this._childrenIdMap={},this._listeners={},this._pubsubHandlers={},this.inDom=!1,this.contentReady=!1,this._html=null,this._pendingRenderRequest=!1,this.extraState={},this._spinner=null,this._$mask=null,this.data=null,this.extraData=null,this.model=null,this._breadcrumbs=null,this.onCreated(),this.collection=null},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=this.attributes||{};if(!a["class"]){var b=["Module"],c=this.className.replace(/\./g,"-");b.push(c),a["class"]=b.join(" ")}var d=$(document.createElement(this.tagName));d.attr(a),this.setElement(d,!1)}},setAsMainModule:function(a,b,c){return this.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.hasSameOptions(a,b)&&this.contentReady&&!this._forceRefreshRequested(c)?Promise.resolve(void 0):(this.empty(),this._forceRefreshRequested(c)&&(this.extraState={}),this.setOptions(a),this.setResource(b),this.performTransition(c))},_forceRefreshRequested:function(a){return!!(a&&a.evt&&a.evt.data&&a.evt.data.forceRefresh)},performTransition:function(){return this.render()},setResource:function(a){(!a||_.isEqual(a,{}))&&(a=P.Resource.NOOP_RESOURCE),this.resource=P.resourceFactory.create(a.name,a.options)},setOptions:function(a){var b=this.options;this.options=a||{},this.onOptionsChanged(b,this.options)},setModal:function(a){this.$el.toggleClass(h,!!a),this.modal!==a&&(this.modal=a,a&&this.onAddedToModal(a))},prependChild:function(a){this.$el.prepend(a.$el),this.addChild(a,0)},appendChild:function(a){this.insertChild(a,this.$el)},insertChild:function(a,b,c,d){d?a.$el.insertAfter(d):a.$el.appendTo(b),this.addChild(a,c)},insertChildBefore:function(a,b,c,d){d?a.$el.insertBefore(d):a.$el.appendTo(b),this.addChild(a,c)},removeChild:function(a){if(a.parent===this){a.parent=null,this._removeListenersOnModule(a),this.children=_.filter(this.children,function(b){return a!==b}),a.id&&delete this._childrenIdMap[a.id];var b=a.getParentElement();a.detachElement(),a.onRemoved(),this.onChildRemoved(a,b)}},getChildByElement:function(a){var b=_.find(this.children,function(b){return b.$el.is(a)});return b},getChildByModuleName:function(a){var b=_.find(this.children,function(b){return b.className===a});return b},getChildrenByModuleName:function(a){var b=_.filter(this.children,function(b){return b.className===a});return b},getChildById:function(a){return this._childrenIdMap[a]},getHasError:function(){return!!this.error},removeChildById:function(a){var b=this.getChildById(a);b&&b.remove()},remove:function(){this.parent&&this.parent.removeChild(this)},detachElement:function(){this.remove(),this.$el.detach(),this.inDom&&this._setInDom(!1)},destroy:function(){this.triggerEvent(P.CONST.EVENT_DESTROYED),this.empty(),this.detachElement(),this._removeListeners(),this._subscribers&&_.each(this._subscribers,function(a){a.unsubscribe()}),this.undelegateEvents(),this.destroyed=!0,this.onDestroyed()},destroyIfEmpty:function(){return this.isEmpty()?(this.destroy(),!0):!1},empty:function(){for(this.$el.empty();this.children.length;)this.children[0].destroy();this.children=[],this._childrenIdMap={},this.contentReady=!1,this.onEmpty()},onEmpty:P.NOOP,onRendered:P.NOOP,onContentReady:P.NOOP,onAdded:P.NOOP,onRemoved:P.NOOP,onDestroyed:P.NOOP,onCreated:P.NOOP,onChildAdded:function(){},onChildRemoved:function(){},onChildRendered:P.NOOP,onAddedToDom:P.NOOP,onRemovedFromDom:P.NOOP,onPubSubMessage:function(){},onOptionsChanged:function(){},onAddedToModal:function(){},handleError:function(a){var b=this.getFullName();this.errorStrategy===P.CONST.ErrorStrategy.REMOVE?(this.log.warn("Removing module because of error."),this.destroy()):this.errorStrategy===P.CONST.ErrorStrategy.BUBBLE&&(this.log.warn("Bubbling up the error."),this.parent.handleError(a)),this.log.warn("Error in: "+b+"\nError Strategy: "+n[this.errorStrategy]+"\nStack Trace:"+a.stack_trace+"\nError Object: ",a),this.triggerEvent(P.CONST.EVENT_ERROR,a,this)},getSubscriber:function(a){if(this._subscribers||(this._subscribers={}),!this._subscribers[a]){var b=P.pubsub.createSubscriber(a,{handler:this._handlePubsub,scope:this,name:this.className});this._subscribers[a]=b}return this._subscribers[a]},pubsubSubscribe:function(a,b){var c=this.getSubscriber(a);c.subscribe.apply(c,_.keys(b)),this._pubsubHandlers[a]||(this._pubsubHandlers[a]={}),_.extend(this._pubsubHandlers[a],b)},pubsubUnsubscribe:function(a){var b=_.tail(_.toArray(arguments)),c=this.getSubscriber(a);c.unsubscribe.apply(c,b)},_handlePubsub:function(a,b,c){var d=(this._pubsubHandlers[a]||{})[b];d&&d.call(this,a,b,c),this.onPubSubMessage(a,b,c)},ensureAuthentication:function(){if(!P.currentUser.isAuthenticated()){var a={contextualResource:this.getContextualResource(),authRedirectUrl:this.getAuthRedirectUrl()};return this.triggerEvent(P.CONST.EVENT_REQUIRES_AUTHENTICATION,a,!0),!1}return!0},getAuthRedirectUrl:function(){return P.getRegisterUrl()},getContextualResource:function(){return null},getFullName:function(){for(var a=[this.toString(!0)],b=this;b.parent;)b=b.parent,a.unshift(b.toString());return a.join(">")},toString:function(a){var b=this.className,c=[];return a&&this.options&&c.push(P.toArgumentString(this.options)),this.resource&&"NoopResource"!==this.resource.name&&c.push("resource="+this.resource.toString()),b+"("+c.join(", ")+")"},getHeight:function(a){return a=a||!1,this.$el.outerHeight(a)},getWidth:function(a){return a=a||!1,this.$el.outerWidth(a)},getOffset:function(){return this.$el.offset()},getPosition:function(){return this.$el.position()},getParentElement:function(){return this.$el.parent()},getContent:function(){return this.$el},getScrollableElement:function(){return this.getScrollableElementForElement(this.$el)},getScrollableElementForElement:function(a){var b=this.getOwnedScrollables();if(b.length>0){var c=a;c=c.add(a.parentsUntil(this.$el)),c=c.add(this.$el);var d=c.filter(b);if(d.length>0)return d.last()}return this.parent?this.parent.getScrollableElementForElement(this.$el.parent()):$(window)},listen:function(a,b,c){var d=this,e=function(){c.apply(d,_.toArray(arguments))};a.on(b,e);var f=new p(a,b,e);return this._listeners[f.id]||(this._listeners[f.id]=[]),this._listeners[f.id].push(f),f},childListen:function(a,b){return this.listen(this,"child:"+a,b)},delegateEvents:function(){if(!this.__wrapEvents){this.events=this.events||{},this.events["click.logging"]="_logContextEvent",this.events["click.logging ["+k+"]"]="_logContextEvent",this.events["click a"]="_handleLinkClick";var a=this,b={};_.each(this.events,function(c,d){b[d]=_.isFunction(c)?P.Errors.wrapFn("eventFunction",c):P.Errors.wrapFn(c,function(){return P.state.activeTarget=a,a[c].apply(a,_.toArray(arguments))})}),this._wrappedLogContextEvent=this.events["click.logging"],this.events=b,this.__wrapEvents=!0}return this.$el.attr(k)||0===this.$el.attr(k)?this.events["click.logging"]=this._wrappedLogContextEvent:delete this.events["click.logging"],Backbone.View.prototype.delegateEvents.call(this)},navigate:function(a,b,c,d){var e={url:a,$el:b};if(c&&(e.forceRefresh=1),_.extend(e,d),this.triggerEvent(P.CONST.EVENT_NAVIGATE,e,!0)){this.log.debug("Navigate event wasn't prevented. Navigating to:",a);var f=new P.navigateData.NavigateData;f.evt=new P.Event("",null,e),P.getHistoryNavigator().navigate(a,f)}},showInModal:function(a,b){var c={module:a,showModalOptions:b};this.triggerEvent(P.CONST.EVENT_MODAL,c,!0)&&(this.log.debug("Modal event wasn't prevented. Telling modalManager to open:",a),P.getModalManager().showInModal(a,b||{},this))
},removeListener:function(a){a.object.off(a.event,a.fn),this._listeners[a.id]=_.filter(this._listeners[a.id],function(b){return a!==b})},triggerEvent:function(a,b,c){var d=new P.Event(a,this,b);if(this.trigger(a,d),d.shouldPropagate()&&c){for(var e=new P.Event("child:"+a,this,b),f=this.parent;f&&e.shouldPropagate();)f.trigger.call(f,e.type,e),e.currentTarget=f,f=f.parent;return e.shouldPropagate()}return d.shouldPropagate()},_removeListenersOnModule:function(a){_.each(this._listeners[a.cid],function(a){a.object.off(a.event,a.fn)}),delete this._listeners[a.cid]},showLoading:function(a,b){if(a=!!a,b=b||this.$el,this.$el.addClass(e),null===this._spinner){var c=this.getLoadingSpinnerOptions();null===c||void 0!==c.enable&&!c.enable||(this._spinner=new P.Spinner(c),this._spinner.spin(b,this.getLoadingSpinnerClassName()))}a?this.showMask():this.hideMask()},hideLoading:function(){this.$el.removeClass(e),null!==this._spinner&&(this._spinner.stop(),this._spinner=null),this.hideMask()},isLoading:function(){return this.$el.hasClass(e)},showMask:function(){null===this._$mask&&(this._$mask=$("<div></div>").addClass(g).css({left:0,top:0,width:this.getWidth(),height:this.getHeight()}).prependTo(this.$el))},hideMask:function(){null!==this._$mask&&(this._$mask.remove(),this._$mask=null)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},fadeIn:function(d){this.$el.removeClass(c).addClass(b);var e=function(){d&&d()};P.setTimeout(e,a)},fadeOut:function(d){this.$el.removeClass(b).addClass(c);var e=function(){d&&d()};P.setTimeout(e,a)},clearFades:function(){this.$el.removeClass(d)},getLoadingSpinnerOptions:function(){return _.extend({enable:!0},this.options.spinner||{})},getLoadingSpinnerClassName:function(){return null},render:function(a,b){return this._renderInternal(!1).then(a,b)},renderExistingData:function(){return this._renderInternal(!0)},_renderInternal:function(a){var b=this.getParentElement();return 0===b.length&&(b=$(document.body)),this._render(b,a)},renderAdditional:function(a,b,c,d){var e=this;return!this.contentReady||this._pendingRenderAdditionalRequest||this.resource.atEnd()?(d.call(e),!1):(this._fetch(a,!1).then(function(){e._pendingRenderAdditionalRequest=!1,b&&b.call(e),e.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},function(){e._pendingRenderAdditionalRequest=!1,c&&c.call(e),e.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}).fin(function(){d&&d.call(e),e._pendingRenderAdditionalRequest=!1}),e._pendingRenderAdditionalRequest=!0,!0)},renderAbort:function(){return this._pendingRenderRequest?(this.resource?this.resource.abort():this._pendingRenderRequest=!1,!0):!1},insertAfterModule:function(a,b){a.insertAfter(b.$el)},appendToElement:function(a){a.append(this.$el)},_render:function(a,b){if(this._pendingRenderRequest)return Promise.reject(new Error("render already in progress"));this._pendingRenderAdditionalRequest&&this.resource.abort();var c=this,d=P.setTimeout(function(){c.showLoading(),d=null},f,"_render Loading"),e=function(){d?clearTimeout(d):c.hideLoading()},g=function(){c.rendered=!0,c._pendingRenderRequest=!1,e(),c.onRendered(),c.parent&&c.parent.onChildRendered(c),c.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},h=function(){c._pendingRenderRequest=!1,e()},i=function(a,b){"abort"===b&&(c._pendingRenderRequest=!1,e())};this._pendingRenderRequest=!0;var j=this._fetch(P.ModuleRenderType.NORMAL,b).then(g,h).fin(i);return j},_fetch:function(a,b){var c=this;a!==P.ModuleRenderType.PREPEND&&a!==P.ModuleRenderType.APPEND&&this.resource&&this.resource.resetBookmark();var d=new P.ModuleRenderOptions(this.className);if(d.setOptions(this.options),b){var e=this.model||this.collection,f=e?e.toJSON():this.data;d.setData(f)}return d.setResource(this.resource),d.setRenderType(a),d.setErrorStrategy(this.errorStrategy),this.moduleRenderer.render(d).then(function(b){return c.loadFromModuleTree(b,a)},function(a){throw c.error=a,a.target=this,c.handleError(a),a})},loadFromModuleTree:function(a,b){var c=a.getTreeOuterHtml(),d=c?$(c):this.$el;if(b=b||P.ModuleRenderType.NORMAL,d&&b!==P.ModuleRenderType.APPEND&&b!==P.ModuleRenderType.PREPEND&&(this.contentReady=!1),a.id&&(this.id=a.id),a.data&&(this.data=a.data),a.extraData&&(this.extraData=a.extraData),a.options&&this.setOptions(a.options),a.resource&&(!a.error||b===P.ModuleRenderType.APPEND&&b===P.ModuleRenderType.PREPEND)&&this.setResource(a.resource),this.data&&this.resource&&(P.resourceCache.instance.addDataToCache(this.data),this.model=P.resourceCache.instance.getModel(this.resource),this.collection=P.resourceCache.instance.getCollection(this.resource)),b===P.ModuleRenderType.APPEND)d.children().appendTo(this.$el);else if(b===P.ModuleRenderType.PREPEND)d.children().prependTo(this.$el);else{var e=d.attr("id"),f=e&&!!document.getElementById(e),g=!this.inDom&&f;this.inDom=this.inDom||f,this._replaceElement(d),this.$el.removeAttr("id"),g&&this.onAddedToDom()}if(_.isUndefined(a.errorStrategy)||null===a.errorStrategy||(this.errorStrategy=a.errorStrategy),this.error=a.error,a.error)return a.error.target=this,this.handleError(a.error),Promise.resolve();if(a.async)return this.render(),Promise.resolve();var h=this,i=_.map(a.children,function(a){return P.moduleFactory.create(a,h.$el,h)});return i=i,Promise.all(i).then(function(){d&&b!==P.ModuleRenderType.APPEND&&b!==P.ModuleRenderType.PREPEND&&(h.contentReady=!0,h.onContentReady())})},addChild:function(a,b){var c="undefined"===typeof b&&-1||b;a.parent!==this&&(a.parent&&a.remove(),a.parent=this,-1===c?this.children.push(a):this.children.splice(c,0,a),a.id&&(this._childrenIdMap[a.id]=a),a.onAdded(),this.onChildAdded(a,b),this.inDom&&a._setInDom(!0))},isEmpty:function(){return!$.trim(this.$el.html())&&!this.children.length},isInModal:function(){return!!this.modal},isElement:function(a){return this.$el.get(0)===$(a).get(0)},loadFromData:function(){this.log.error("override method loadFromData")},hasSameOptions:function(a,b){var c=this.hasSameModuleOptions(a),d=this.hasSameResourceOptions(b);return this.log.debug("has same options? ",c,this.options,a,d,!this.resource||this.resource.options,b),c&&d},hasSameModuleOptions:function(a){return a=a||{},_.isEqual(this.options,a)},hasSameResourceOptions:function(a){(!a||_.isEqual(a,{}))&&(a=P.Resource.NOOP_RESOURCE);var b=!this.resource&&_.isEqual(a,P.Resource.NOOP_RESOURCE);return b||this.resource&&this.resource.isEqual(a)},setChildId:function(a,b){a.parent===this&&(this.removeChildId(a),a.id=b,this._childrenIdMap[a.id]=a)},removeChildId:function(a){a.id&&a.parent===this&&(delete this._childrenIdMap[a.id],delete a.id)},getOwnedScrollables:function(){return $()},saveExtraState:function(a){if(a){var b=this.getScrollableElement().scrollTop();this.extraState={scrollableElementScrollTop:b}}this.getOwnedScrollables().each(function(a,b){var c=$(b),d=c.scrollTop();c.data(j,d)}),_.each(this.children,function(a){a.saveExtraState(!1)})},restoreExtraState:function(a){var b=this;if(a){var c=this.extraState.scrollableElementScrollTop||0;b.getScrollableElement().scrollTop(c)}var d=b.getOwnedScrollables();d.length&&P.deferDomManipulation(function(){d.each(function(a,b){var c=$(b),d=c.data(j);void 0!==d&&c.scrollTop(d)})}),_.each(this.children,function(a){a.restoreExtraState(!1)})},_setInDom:function(a){this.inDom!==a&&(this.inDom=a,a?this.onAddedToDom():this.onRemovedFromDom(),_.each(this.children,function(b){b._setInDom(a)}))},_replaceElement:function(a){a[0]!==this.$el[0]&&(this.empty(),this.undelegateEvents(),a.insertBefore(this.$el),this.$el.remove(),this.$el=a,this.el=a[0],this.delegateEvents())},_removeListeners:function(){_.each(this._listeners,function(a){_.each(a,function(a){a.object.off(a.event,a.fn)})}),this._listeners={}},_handleLinkClick:function(a){this._logContextEvent(a);var b=$(a.currentTarget),c=$(a.target),d=b.attr("href"),e=!c.hasClass(i)&&!b.hasClass(i),f=b.hasClass("external"),g=c.attr("data-ga");if(g&&P.trackGAEvent(g,P.CONST.GA_ACTION_CLICK),!e)return!1;if(f)return P.changeWindowLocation(d,!0),this.triggerEvent(P.CONST.EVENT_EXTERNAL_CLICK,null,!0),!1;if(P.isOffsiteUrl(d)||!(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)){var h=d&&d.length&&"#"!==d.charAt(0)&&!P.beginsWith(d,"javascript:")&&!P.beginsWith(d,"mailto:");return h?(this.navigate(d,c,!!b.attr("data-force-refresh")),!1):void 0}},_logContextEvent:function(a){if(!P.ContextLogger.getInstance().eventLogged(a)){var b=P.ContextLogging.EventType.CLICK,c=$(a.target).closest("["+k+"]",this.$el),d=c.parent().closest("["+l+"]");if(0!==c.length&&0!==d.length){var e=c.attr(m)||"{}",f=P.ContextEvent.fromEventType(b),g=parseInt(c.attr(k),10),h=parseInt(d.attr(l),10),i=JSON.parse(e);f.setElement(g),f.setComponent(h),f.updateAuxData(i);var j=this.getLoggingObjectIdStr();j&&f.setObjectIdStr(j),P.ContextLogger.getInstance().addEvent(f,a)}}},_logCustomContextEvent:function(a,b,c,d){var e=P.ContextEvent.fromEventType(a);e.setElement(b),e.setComponent(c),e.updateAuxData(d),P.ContextLogger.getInstance().addEvent(e,null)},getDebugInfo:function(){return this.className},getLoggingObjectIdStr:function(){return null},getBreadcrumbs:function(){return this._breadcrumbs},setBreadcrumbs:function(a){this._breadcrumbs=a},focus:function(){this.$el.focusWithoutScrolling()},initScroll:P.NOOP}),P.Errors.wrap(P.Module.prototype,["loadFromModuleTree","render","renderExistingData"]);var q=P.Module.extend;P.Module.extend=function(a,b){return a&&a.mixins&&_.extend.apply(_,[a].concat(a.mixins)),q.call(this,a,b)}}(),function(){goog.provide("P.integrationTesting"),goog.require("P.Module");var a=function(){};a.prototype.getChildrenByModuleName=function(a,b){var c=[],d=this;return _.each(a.children,function(a){a.className===b&&c.push(a),c=c.concat(d.getChildrenByModuleName(a,b))}),c},a.prototype.getParentsForModule=function(a){for(var b=[];a.parent;)a=a.parent,b.push(a);return b},a.prototype.getElementsForModules=function(a){return a?_.isArray(a)?_.map(a,function(a){return a.$el.get()}):[a.$el.get()]:[]},P.integrationTesting.getHelper=function(){return new a}}(),function(){goog.provide("P.tutorialManager"),goog.require("P.event"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.interfaces.TutorialStep");var a=P.Logger.getLogger("TutorialManager"),b=function(a,b){this.url=a,this.forceRefresh=!!b},c={yourBoards:{stepNames:["ModalSeeProfileIntro"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b("/"+P.currentUser.get("username")+"/",!1)},onUserExit:P.NOOP},findFriends:{stepNames:["ModalFindFriendsIntro"],expiredSteps:{},nextUrlInfo:function(){return new b("/find_friends/",!1)},canExit:!1,inModal:!0,onUserExit:P.NOOP},fastFollowIntro:{stepNames:["ModalFastFollowIntro"],expiredSteps:{},nextUrlInfo:function(){return new b(null,!1)},canExit:!1,inModal:!0,onUserExit:P.NOOP},firstPinIntro:{stepNames:["ModalFirstPinIntro"],expiredSteps:{},canExit:!0,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},categorySearchIntro:{stepNames:["ModalCategorySearchIntro"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},placePinsIntro:{stepNames:["ModalPlacePinsIntro"],expiredSteps:{},canExit:!0,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},emptyPlacesBoardIntro:{stepNames:["ModalPlacePinsAddEmpty","ModalPlacePinsSearch"],expiredSteps:{},canExit:!0,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},exploreButton:{stepNames:["ModalExploreButton"],expiredSteps:{},canExit:!0,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},explorePage:{stepNames:["ModalExplorePage","ModalExploreInterest","ModalExploreCheckBack"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},filledPlacesBoardIntro:{stepNames:["ModalPlacePinsEdit","ModalPlacePinsShow","ModalPlacePinsAddFilled"],expiredSteps:{},canExit:!0,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},newUserIgnitionSteps:{stepNames:["NewUserPin","NewUserPinSource","NewUserPinUsage","NewUserInterestSearch"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},newUserBastilleMaleSteps:{stepNames:["NewUserInterestPicker","NewUserFindFriends"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},newUserBastilleNonMaleSteps:{stepNames:["NewUserInterestPicker"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},newUserIgnitionPinCreate:{stepNames:["NewUserPin","NewUserPinSource","NewUserPinUsage","NewUserPinCreate"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},firstBoardIntro:{stepNames:["ModalFirstBoardIntro"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},newUserWhitneyEd:{stepNames:["ModalNuxWelcome","ModalNuxDiscover","ModalNuxPin","ModalNuxBoard"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b("/",!0)},onUserExit:P.NOOP},qaNotificationIntro:{stepNames:["ModalQuestionIntroOne","ModalQuestionIntroTwo"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},qaAnswerIntro:{stepNames:["ModalAnswerIntroOne","ModalAnswerIntroTwo"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP},visualObjectSearchIntro:{stepNames:["ModalVisualObjectSearchIntro"],expiredSteps:{},canExit:!1,inModal:!0,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP}},d="tutorial",e="Tutorial";P.TutorialManager=function(){this.init()},P.TutorialManager.prototype={init:function(){this._isActive=!1,this.moduleContainer=null,this.renderModule=!0,this.progressModule=null,$("body").removeClass(this.tutorialClassName),this.tutorialName=null,this.tutorialClassName=null,this.tutorial=null,this.allStepNames=null,this.numTotalSteps=null,this.currentStep=null},startTutorial:function(a,b){return b=b||{},this.moduleContainer=b.moduleContainer,this.renderModule=b.renderModule,this.progressModule=b.progressModule||this.progressModule,this._isActive?void(this.renderModule===!1||this.currentModule||this._loadModuleForStep(this.currentStep)):void this._start(a,!0)},setProgressModule:function(a){this.progressModule!==a&&(this.progressModule=a,this.progressModule.listen(this.progressModule,P.CONST.EVENT_NEXT,_.bindFn(this._next,this)),this.progressModule.listen(this.progressModule,P.CONST.EVENT_PREVIOUS,_.bindFn(this._previous,this)),this._updateProgressModuleStep())},stopTutorial:function(){this._isActive&&this.init()},resumeTutorial:function(){if(!this._isActive){var a=this._getStoredData();a&&a.name&&this._start(a.name,!1)}},_start:function(a,b){var d=c[a];d&&(this._clear(b),this._isActive=!0,this.tutorialName=a,this.tutorialClassName=this.tutorialName+e,$("body").addClass(this.tutorialClassName),this.tutorial=d,this.expiredSteps=this.tutorial.expiredSteps,this.allStepNames=this.tutorial.stepNames,this.numTotalSteps=this.tutorial.stepNames.length,this._funnelPrefix="tutorial_"+a,this.renderModule=this.renderModule===!1?!1:!0,this.tutorial.inModal?(this._setupModal(),this._setStep(this._getStoredStep()||this.allStepNames[0])):(this.moduleContainer||!this.renderModule)&&this._setStep(this._getStoredStep()||this.allStepNames[0]))},isTutorialActive:function(){return this._isActive},_setupModal:function(){var a=this,b={name:"Modal",options:{mask_type:"dark",can_dismiss:!1}};P.loadModule(b,function(b){a.modal=b,a.modal.render(),a.modal.childListen(P.CONST.EVENT_NEXT,_.bindFn(a._next,a)),a.modal.childListen(P.CONST.EVENT_PREVIOUS,_.bindFn(a._previous,a)),P.getModalManager().showModal(a.modal,null)})},_next:function(){var a=this._getStepIndex(this.currentStep);return this.currentStep===_.last(this.allStepNames)?void this._endTutorial(!0):void this._setStep(this.allStepNames[a+1])},_previous:function(){var b=this._getStepIndex(this.currentStep);return 0===b?(a.logToServer(P.Logger.SERVER_LOG_TYPE.LOG,"get",{type:"tutorial",tutorial:this.tutorialName,step:this.currentStep,step_number:b,action:"exit"}),this.tutorial.onUserExit(b),void this._endTutorial(!1)):void this._setStep(this.allStepNames[b-1])},_endTutorial:function(a){var b=this,c=function(){var c=b.tutorial.nextUrlInfo().url,d=b.tutorial.nextUrlInfo().forceRefresh;if(b._clear(!0),a&&c){var e=new P.navigateData.NavigateData;d&&(e.evt=new P.Event("",null,{forceRefresh:1})),P.getHistoryNavigator().navigate(c,e)}},d=function(a){b.progressModule?b.progressModule.onExit(a):a()},e=function(){b.currentModule.onExit(function(){d(c)})},f=function(){b.currentModule?a?b.currentModule.completePlacedExperience(e):b.currentModule.dismissPlacedExperience(e):d(c)};f(),P.trackRegisterAction(this._funnelPrefix+"_complete")},_setStep:function(b){if(P.trackRegisterAction(this._funnelPrefix+"_"+b),a.debug("set step from",this.currentStep,"to",b),b!==this.currentStep){if(_.contains(this.allStepNames,b)||this.expiredSteps[b]||this._endTutorial(!0),this.expiredSteps[b]&&(b=this.expiredSteps[b]),this.currentStep=b,this._saveCurrentStep(),this._updateProgressModuleStep(),!this.currentModule)return void(this.renderModule&&this._loadModuleForStep(this.currentStep));var c=this;this.currentModule.onExit(function(){c.currentModule.onRemoved(),c._loadModuleForStep(b)})}},_updateProgressModuleStep:function(){if(this.currentStep){var a=this._getStepIndex(this.currentStep);this.progressModule&&this.progressModule.nextStep(a+1)}},_loadModuleForStep:function(a){var b=this,c={name:"tutorials."+a,options:{tutorial_name:this.tutorialName,current_step:this._getStepIndex(a),total_steps:this.numTotalSteps,can_exit:this.tutorial.canExit}};P.loadModule(c,function(a){var c=b.currentModule;b.currentModule=a;var d=a;d.onEnter(function(){b.modal?a.render().then(function(){var d=b.modal;d.setModule(a);var e=a;c&&c.destroy(),e.setModalPosition(),e.onShow()}):a.render(function(){var c=b.moduleContainer.children[0];b.moduleContainer.prependChild(a),c&&c.destroy(),a.onShow()})})})},_getStepIndex:function(a){var b=_.indexOf(this.allStepNames,a);return-1!==b?b:0},_getStoredStep:function(){var a=this._getStoredData();return a&&a.name!==this.tutorialName&&(this._clearStoredData(),a=null),a&&a.step||null},_getStoredData:function(){var a=P.SessionStorage.getItem(d);return a},_saveCurrentStep:function(){P.SessionStorage.setItem(d,{name:this.tutorialName,step:this.currentStep})},_clear:function(a){this.tutorial&&(this.stopTutorial(),this.modal&&this._destroyModal(),a&&this._clearStoredData())},_clearStoredData:function(){P.SessionStorage.removeItem(d)},_destroyModal:function(){this.modal.destroy(),this.modal=null}};var f=null;P.TutorialManager.instance=function(){return f||(f=new P.TutorialManager),f}}(),function(){goog.provide("P.modalManager"),goog.require("P.interfaces.IModalManager");var a=function(a){this._onModalDestroyed=_.bindFn(this._onModalDestroyed,this),this._onModalDismiss=_.bindFn(this._onModalDismiss,this),this._onKeyup=_.bindFn(this._onKeyup,this),this.$container=a||null,this.modals=[]};_.extend(a.prototype,{getContainer:function(){return this.$container||(this.$container=$("body")),this.$container},showModal:function(a,b,c){var d=this.getContainer();return this.modals.push(a),d.append(a.$el),a.moduleOpener=c,a._setInDom(!0),a.on(P.CONST.EVENT_DESTROYED,this._onModalDestroyed),a.on("child:"+P.CONST.EVENT_DISMISS,this._onModalDismiss),a.show(),1===this.modals.length&&this._addListeners(),a},hasModals:function(){return this.modals.length>=1},removeModal:function(a){a.destroy()},removeAllModals:function(a){_.each(this.modals,function(b){var c=b;(a||c.getCanDismiss())&&c.destroy()})},showInModal:function(a,b,c){var d={module:a};_.extend(d,b);var e=this,f={name:"Modal",options:d};P.loadModule(f,function(a){e.showModal(a,b,c)})},_onModalDismiss:function(a){var b=a.target.parent;this.removeModal(b)},_onModalDestroyed:function(a){var b=a.target;b.off(P.CONST.EVENT_DESTROYED,this._onModalDestroyed),b.off("child:"+P.CONST.EVENT_DISMISS,this._onModalDismiss),this.modals=_.filter(this.modals,function(a){return b!==a}),this.modals.length||this._removeListeners()},_addListeners:function(){$(document).on("keyup",this._onKeyup)},_removeListeners:function(){$(document).off("keyup",this._onKeyup)},getTopModal:function(){if(!this.hasModals())return null;var a=this.modals[this.modals.length-1];return a},removeTopModal:function(){if(this.hasModals()){var a=this.modals.pop();a.hide()}},_onKeyup:function(a){a.keyCode===P.keyCode.ESCAPE&&this.removeTopModal()}}),P.setModalManager(new a)}(),function(){goog.provide("P.resourceResponse"),P.resourceResponse={fromPlainObject:function(a){var b=new P.ResourceResponse;b.client_context=a.client_context,b.page_info=a.page_info,b.request_identifier=a.request_identifier;var c=a.resource;c&&c.options&&(b.bookmarks=c.options.bookmarks||[]),b.resource_response.data=a.resource_response.data;var d=a.resource_response.error;b.resource_response.error=d?P.Error.fromPlainObject(d):null;var e=a.module;if(e){var f=P.ModuleTree.fromPlainObject(e.tree);f.setOuterHtml(e.html),b.moduleTree=f}return b}},P.ResourceResponse=function(){this.resource_response={data:null,error:null},this.client_context=null,this.moduleTree=null,this.page_info=null,this.request_identifier="",this.bookmarks=[]}}(),function(){goog.provide("P.resource"),goog.require("P.interfaces.IResource"),goog.require("P.logger"),goog.require("P.resourceFactory"),goog.require("P.resourceResponse");var a=P.Logger.getLogger("Resource"),b="-end-",c={BoardEdit:!0,PinEdit:!0},d=P.DEBUG?["test_mode","test_user","allow_api_side_effects","memoize_api","request_debug"]:[];P.Resource=function(a,b){this.name=a,this.options=b||{}},_.extend(P.Resource.prototype,{getName:function(){return this.name},setOptions:function(a){this.options=a},set:function(a,b){this.options[a]=b},get:function(a){return this.options[a]||null},copyOptions:function(a){var b=_.clone(this.options);return b&&a&&delete b.bookmarks,b},callGet:function(a,b){return this.call("get",a,b)},callCreate:function(a){return this.call("create",a)},callUpdate:function(a){return this.call("update",a)},callDelete:function(a){return this.call("delete",a)},_isUrlShortEnoughForHttpGet:function(a,b){var c=a+"?"+$.param(b);return c.length<=2e3},call:function(a,b,c){var d=this,e=b&&void 0!==b.async?b.async:!0,f=b&&b.timeout||null,g=this._call(a,e,f,c);g.then(function(a){d.onResponseSuccess(a)},function(a){d.onResponseError(a)}),b&&b.success&&g.then(b.success);var h=b&&b.error?b.error:function(a){P.showError(a.message)};return g.then(void 0,function(a){if(a&&19===a.api_error_code){var b=new P.Module;P.writeban.showWriteBanned(b)}else h(a)}),b&&b.complete&&g.fin(b.complete),g},_call:function(b,e,f,g){var h=this;this.xhr&&(this.xhr.abort(),this.xhr=null);var i,j={options:this.options,context:_.pick(P.CONTEXT,d)};if(i="/resource/"+this.name+"/"+b+"/",g){if(P.currentUser.get("autologin")&&c[g.name]){var k=P.getLoginUrl({next:g.options.next_url});return P.getHistoryNavigator().navigate(k),Promise.reject(new Error("navigating to login URL"))}j.module={name:g.name,options:g.options},j.render_type=g.renderType,j.error_strategy=g.errorStrategy}var l={source_url:P.getCurrentUrl(),data:JSON.stringify(j)};P.state.activeTarget&&(l.module_path=P.state.activeTarget.getFullName());var m="get"===b&&this._isUrlShortEnoughForHttpGet(i,l);return new Promise(function(b,c){h.xhr=$.ajax({cache:!1,url:i,async:e,data:l,dataType:"json",timeout:f,type:m?"get":"post",complete:function(d,e){if("abort"===e)return void c(new Error("aborted"));if(0===d.status)return void c(new Error("Connectivity error or cancelled by navigation"));var f=null,g=null;try{var k=JSON.parse(d.responseText);if(!(k instanceof Object))throw Error("JSON.parse did not return an object");f=P.resourceResponse.fromPlainObject(k),g=f.resource_response.error;var l=!!d.getResponseHeader("X-Pinterest-New-Version");l&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION_AVAILABLE)}catch(m){g=new P.Error,g.message=P.string.common.defaultErrorMessage,g.http_status=d.status,a.error("Failed to parse resource response JSON.  HTTP status: "+d.status,{format:"sentry",js_exception_message:m.message,resource_name:h.name,response_headers:d.getAllResponseHeaders(),http_status:d.status,text_status:e,respose_text:d.responseText})}if(g&&403===g.http_status&&!P.currentUser.isAuthenticated())return void P.changeWindowLocation(P.getLoginUrl(),!1);var n=j&&j.options&&j.options.disable_auth_failure_redirect===!0;if(g&&401===g.http_status&&1001===g.api_error_code&&!n){var o=P.getLoginUrl();return void P.changeWindowLocation(o,!1)}g?f&&f.moduleTree?b(f):c(g):f?b(f):a.error("no error and no resource response",{status:d.status,textStatus:e,xhrUrl:i}),h.xhr=null}})})},abort:function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},resetBookmark:function(){this.options&&delete this.options.bookmarks},setBookmarks:function(a){this.set("bookmarks",a)},getLatestBookmark:function(){var a=this.options.bookmarks;return a?a[a.length-1]:void 0},atEnd:function(){return this.getLatestBookmark()===b},onResponseSuccess:function(a){if(a.client_context){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION,a.client_context.app_version);var b=a.client_context.event_log_info;b&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,P.CONST.PUBSUB_TOPIC_CONTEXT_LOG_PLAIN_OBJECT,b);var c=a.client_context.placed_experiences;c&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,c)}P.CONTEXT=a.client_context,a.page_info&&(a.page_info.title||_.keys(a.page_info.meta).length)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PAGE_INFO,a.page_info),a.bookmarks&&this.setBookmarks(a.bookmarks),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_REQUEST,P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER,a.request_identifier)},onResponseError:function(b){a.warn("Request error for "+this.name,b,b.stack_trace)},isEqual:function(a,b){if(this.name!==a.name)return!1;var c=_.omit(this.options,"bookmarks"),d=_.omit(a.options,"bookmarks");if(b){c.latest_bookmark=this.getLatestBookmark();var e=a.options.bookmarks;d.latest_bookmark=e&&e[e.length-1]}return _.isEqual(c,d)},toString:function(){var a=_.omit(this.options,"bookmarks","field_set_key");return this.name+"("+P.toArgumentString(a)+")"},isCalling:function(){return!!this.xhr}}),P.Resource.NOOP_RESOURCE={name:"NoopResource",options:{}},P.resourceFactory.setDefaultConstructorFn(P.Resource),P.logFrontEndEvent=function(a){var b=P.resourceFactory.create("IncrementEventResource",{event:a});b.callCreate({error:P.NOOP})}}(),function(){goog.provide("P.safeLink");var a="offsite_",b="-";P.SafeLink={open:function(c,d){var e=Math.round(1e3*Math.random())+"",f=Math.round(1e3*Math.random())+"";Cookie.set(a+e,f);var g={token:e+b+f,url:c};d&&(g.pin=d),P.changeWindowLocation("/offsite/?"+$.param(g),!0)}}}(),function(){goog.provide("P.socialConnect"),P.SocialConnect=function(){};var a;_.extend(P.SocialConnect.prototype,Backbone.Events),_.extend(P.SocialConnect.prototype,{connect:function(a,b){b=_.extend({},{success:P.NOOP,error:P.NOOP,complete:P.NOOP},b);var c=null,d=null;a===P.SocialConnect.RAKUTEN&&(c=800,d=600);var e,f=P.FacebookDialog.getWindowOptions(c,d);if(e=window.open("/connect/"+a+"/","",f),!e)return void P.showError(P._("You must enable popups!"));var g=this,h=P.setInterval(function(){e.closed&&(clearInterval(h),g.handleComplete({network:a,error_message:"Window closed."}))},1e3);this.once("connect:"+a,function(a){clearInterval(h),a.error_message?b.error(a):b.success(a),b.complete()})},complete:function(a){var b=JSON.parse(a);this.handleComplete(b)},handleComplete:function(a){var b="connect:"+a.network;this.trigger(b,a)}}),_.extend(P.SocialConnect,{instance:function(){return a||(a=new P.SocialConnect),a},FACEBOOK:"facebook",TWITTER:"twitter",GOOGLE:"google",GPLUS:"gplus",YAHOO:"yahoo",RAKUTEN:"rakuten"})}(),function(){goog.provide("P.facebookDialog");var a=20,b=580,c=400;P.FacebookDialog={open:function(a){var d=_.pick(a,P.FacebookDialog._validParams),e=P.FacebookDialog._getDialogType(a),f=P.FacebookDialog.generateFbRef(),g="feed"===e&&P.experiments.instance.inExperimentGroups("fb_sharers",["sharer_php","employees"]),h=a.object_type&&a.object_id&&("feed"===e||g);if(d.method=e,d.link=P.absolutify(a.path),h&&(d.link+="?"+$.param({fb_ref:f})),g){var i=P.FacebookDialog.getWindowOptions(a.width||b,a.height||c);window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(d.link),"sharer",i)}else P.fb.ensureInit(function(b){b.getLoginStatus(function(){b.ui(d,function(b){if(h&&b&&b.post_id){var c=P.resourceFactory.create("LogFacebookFeedShare",{});c.options={object_type:a.object_type,object_id:a.object_id,fb_ref:f},c.callCreate({error:P.NOOP})}a.callback&&a.callback(b)})})})},_validParams:["description","name","picture","to","href"],_validOptions:["send","feed","share"],generateFbRef:function(){for(var b="";b.length<a;)b+=Math.floor(65535*Math.random()).toString(16);return P.currentUser.id+":"+b},_getDialogType:function(a){var b=_.contains(P.FacebookDialog._validOptions,a.type),c=b?a.type:"feed";return c},getWindowOptions:function(a,d){var e=a?a:b,f=d?d:c,g=screen.width,h=screen.height,i=Math.round((g-e)/2),j=h>f?Math.round((h-f)/2):0;return"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+e+",height="+f+",left="+i+",top="+j}}}(),function(){!function(a){a.fn.getCursorPosition=function(){var a=this.get(0);if(a){if("selectionStart"in a)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}}}(jQuery)}(),function(){goog.provide("P.lruCache");var a=10,b=function(a,b){this.uid=a,this.item=b,this.next=null,this.prev=null};P.LruCache=function(b){this._maxNumItems=b||a,this._uidToData={},this._numItems=0,this._firstData=null,this._lastData=null},P.LruCache.prototype.set=function(a,c){var d=this._uidToData[a];d||(d=new b(a,c),this._uidToData[a]=d,this._numItems+=1),this._moveToFront(d),this._numItems>this._maxNumItems&&this._evict()},P.LruCache.prototype.get=function(a){var b=this._uidToData[a];return b?(this._moveToFront(b),b.item):null},P.LruCache.prototype.remove=function(a){var b=this._uidToData[a];b&&(delete this._uidToData[a],this._firstData===b&&(this._firstData=b.next),this._lastData===b&&(this._lastData=b.prev),b.prev&&(b.prev.next=b.next),b.next&&(b.next.prev=b.prev),this._numItems-=1)},P.LruCache.prototype._moveToFront=function(a){this._firstData!==a&&(this._firstData?(this._lastData===a&&(this._lastData=a.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),this._firstData.prev=a,a.next=this._firstData,a.prev=null,this._firstData=a):(this._firstData=a,this._lastData=a))},P.LruCache.prototype._evict=function(){delete this._uidToData[this._lastData.uid],this._firstData===this._lastData?(this._firstData=null,this._lastData=null):(this._lastData=this._lastData.prev,this._lastData.next=null),this._numItems-=1}}(),function(){goog.provide("P.set"),P.Set=function(){this.items={}},P.Set.prototype.add=function(a){this.items[a]=!0},P.Set.prototype.remove=function(a){delete this.items[a]},P.Set.prototype.contains=function(a){return Object.prototype.hasOwnProperty.call(this.items,a)}}(),function(){goog.provide("P.modelManager"),goog.require("P.lruCache"),P.modelManager.EntityType={PIN:"pin"},P.modelManager.EntityDict,P.modelManager.EntityId,P.modelManager.CACHE_FOR_TYPE_SIZE=1e3,P.modelManager.CacheForType=function(a){this.cache=new P.LruCache(P.modelManager.CACHE_FOR_TYPE_SIZE),this._entityType=a
},P.modelManager.CacheForType.prototype.getModel=function(a){var b=this.cache.get(a);return b||null},P.modelManager.CacheForType.prototype.addEntityDict=function(a){if(a.type!==this._entityType)throw new Error("invalid entityDict type");var b=a.id,c=this.cache.get(b);c||(c=new Backbone.Model,this.cache.set(b,c));var d=c.toJSON();$.extend(!0,d,a),c.set(d)},P.modelManager.ModelManager=function(){var a=this;this.entityTypeToCache={},_.each(P.modelManager.EntityType,function(b){a.entityTypeToCache[b]=new P.modelManager.CacheForType(b)})},P.modelManager.ModelManager.prototype.getModel=function(a,b){var c=this.entityTypeToCache[a];return c?c.getModel(b):null},P.modelManager.ModelManager.prototype.add=function(a){var b=this;if(a instanceof Array)_.each(a,function(a){b._addEntity(a)});else if(a instanceof Object){var c=a;b._addEntity(c)}},P.modelManager.ModelManager.prototype._addEntity=function(a){var b=a.type;if(b){var c=b,d=this.entityTypeToCache[c];d&&d.addEntityDict(a)}},P.modelManager.instance=new P.modelManager.ModelManager}(),function(){goog.provide("P.resourceCache"),goog.require("P.modelManager"),P.resourceCache={},P.resourceCache.IResourceCacheStrategy=function(){},P.resourceCache.IResourceCacheStrategy.prototype.getCacheKey=function(){},P.resourceCache.IResourceCacheStrategy.prototype.getModel=function(){},P.resourceCache.IResourceCacheStrategy.prototype.getCollection=function(){},P.resourceCache.IResourceCacheStrategy.prototype.getCachedData=function(){},P.resourceCache.IResourceCacheStrategy.prototype.setCachedData=function(){},P.resourceCache.ResourceCacheStrategyEntity=function(a){this._entityType=a},P.resourceCache.ResourceCacheStrategyEntity.prototype.getCacheKey=function(a){return a.options.id},P.resourceCache.ResourceCacheStrategyEntity.prototype.getModel=function(a,b){return b.getModel(this._entityType,a)},P.resourceCache.ResourceCacheStrategyEntity.prototype.getCollection=function(){return null},P.resourceCache.ResourceCacheStrategyEntity.prototype.getCachedData=function(a,b){var c=this.getModel(a,b);if(c){var d=c.toJSON();if(d instanceof Object)return d}return null},P.resourceCache.ResourceCacheStrategyEntity.prototype.setCachedData=function(a,b,c){b.add(c)},P.resourceCache.ResourceCacheStrategyCollection=function(){this._cache={}},P.resourceCache.ResourceCacheStrategyCollection.prototype._keyFromObject=function(a){function b(a){return _.isObject(a)?_.sortBy(_.map(_.pairs(a),function(a){return[a[0],b(a[1])]}),function(a){return a[0]}):a}return JSON.stringify(b(a))},P.resourceCache.ResourceCacheStrategyCollection.prototype.getCacheKey=function(a){var b=_.omit(a.options,"bookmarks");return b.bookmark=a.getLatestBookmark(),this._keyFromObject(b)},P.resourceCache.ResourceCacheStrategyCollection.prototype._hasEmptyData=function(a){return this._emptyData&&this._emptyData[a]},P.resourceCache.ResourceCacheStrategyCollection.prototype._setHasEmptyData=function(a,b){b?(this._emptyData||(this._emptyData={}),this._emptyData[a]=!0):this._emptyData&&this._emptyData[a]&&delete this._emptyData[a]},P.resourceCache.ResourceCacheStrategyCollection.prototype.getModel=function(){return null},P.resourceCache.ResourceCacheStrategyCollection.prototype.getCollection=function(a){var b=this._cache[a];return b||(b=this._cache[a]=new Backbone.Collection),b},P.resourceCache.ResourceCacheStrategyCollection.prototype.getCachedData=function(a,b){var c=this.getCollection(a,b);if(c.length>0||0===c.length&&this._hasEmptyData(a)){var d=c.toJSON();if(d instanceof Object)return d}return null},P.resourceCache.ResourceCacheStrategyCollection.prototype.setCachedData=function(a,b,c){var d=this._cache[a];d||(d=this._cache[a]=new Backbone.Collection),c instanceof Array&&(d.set(c),this._setHasEmptyData(a,0===d.length))},P.resourceCache.ResourceCache=function(a){this._modelManager=a},P.resourceCache.ResourceCache.prototype.callGet=function(a){var b,c=this,d=this._resourceCacheStrategies[a.name],e=null;if(d){b=d.getCacheKey(a);var f=d.getCachedData(b,this._modelManager);f&&(e=Promise.resolve(f))}var g=a.callGet().then(function(a){var e=a.resource_response.data;return d&&e instanceof Object&&d.setCachedData(b,c._modelManager,e),e});return e||g},P.resourceCache.ResourceCache.prototype.getModel=function(a){var b=this._resourceCacheStrategies[a.name];if(b){var c=b.getCacheKey(a);return b.getModel(c,this._modelManager)}return null},P.resourceCache.ResourceCache.prototype.getCollection=function(a){var b=this._resourceCacheStrategies[a.name];if(b){var c=b.getCacheKey(a);return b.getCollection(c,this._modelManager)}return null},P.resourceCache.ResourceCache.prototype.addDataToCache=function(a){this._modelManager.add(a)},P.resourceCache.ResourceCache.prototype._resourceCacheStrategies={PinResource:new P.resourceCache.ResourceCacheStrategyEntity(P.modelManager.EntityType.PIN),BoardsResource:new P.resourceCache.ResourceCacheStrategyCollection,ConversationsResource:new P.resourceCache.ResourceCacheStrategyCollection},P.resourceCache.instance=new P.resourceCache.ResourceCache(P.modelManager.instance)}(),function(){goog.provide("P.typeaheadProvider");var a=5;P.TypeaheadProvider=function(b){b=b||{},this.tags=b.tags,this.enable_recent_queries=!!b.enable_recent_queries,this.minimum_term_character_length=b.minimum_term_character_length||0,this.bypass_lru_cache=b.bypass_lru_cache;var c={tags:b.tags,pin:b.pin_id},d=b.num_places;d?c.num_places=d:c.count="count"in b?b.count:a,b.should_geocode&&(c.should_geocode=!0),b.exclude_non_followers&&(c.exclude_non_followers=!0);var e="TypeaheadResource";b.resource_name&&(e=b.resource_name),this.searchResource=P.resourceFactory.create(e,c),this.itemsCache=new P.LruCache},_.extend(P.TypeaheadProvider.prototype,Backbone.Events),_.extend(P.TypeaheadProvider.prototype,{search:function(a,b){var c;if(a=$.trim(a),!a&&"pinners_and_contacts"===this.tags)return this.abortSearch(),this.publishData(a,[],{},b);if(!a&&this.enable_recent_queries&&P.currentUser&&P.currentUser.isAuthenticated())c="recent_search";else{var d=this.bypass_lru_cache?{}:this.itemsCache.get(a);if(d){var e=d.items;if(e&&e.length){this.abortSearch();var f=d.hint;return void this.publishData(a,e,f,b)}}}a.length>=this.minimum_term_character_length?this.fetch(a,c,b):this.publishData(a,[],{},b)},getResource:function(){return this.searchResource},abortSearch:function(){this.getResource().abort()},publishData:function(a,b,c,d){var e={term:a,items:b,hint:c};this.trigger(P.CONST.EVENT_DATA,e),d&&d(e)},setAutocompleteScope:function(a){this.getResource().set("autocompleteScope",a)},fetch:function(a,b,c){var d=this.getResource();if(d.isCalling()){var e=d.get("term");if(a===e)return;this.abortSearch()}var f=this;""!==this.tags&&(this.trigger(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,a),d.set("term",a),d.set("tags",b||this.tags),d.resetBookmark(),d.callGet({success:function(b){var d=b.resource_response.data,e=d.items,g=d.hint||{},h={hint:g,items:e};f.cacheData(a,h),f.publishData(a,e,g,c)},error:function(a){f.trigger("fetchError",a)}}),this.warm=!0)},removeCacheForTerm:function(a){this.itemsCache.remove(a)},cacheData:function(a,b){this.itemsCache.set(a,b)},prefetch:function(){if(!this.warm){var a=P.resourceFactory.create("TypeaheadPrepareResource");a.callGet({success:P.NOOP,error:P.NOOP}),this.warm=!0}}})}(),function(){goog.provide("P.invite"),P.Invite={_logInvites:function(a){var b={invite_id:null,invite_code:null,invite_metadata:{invite_type:a,to_follow:[P.currentUser.id]}},c={topic:"sent_invites",content:b},d=P.resourceFactory.create("EventLoggingResource",c);d.callCreate({error:P.NOOP})},trackInvite:function(a,b){b?P.trackGACategoryEvent("user_invite",a,P.CONST.GA_ACTION_SUCCESS):P.trackGACategoryEvent("user_invite",a,P.CONST.GA_ACTION_ERROR),"gplus"===a&&P.Invite._logInvites(a)},_inviteFacebookUserId:function(a){var b=P.resourceFactory.create("FacebookInviteCreateResource",{type:"facebook",facebook_id:a});return b.callCreate()},_showFacebookDialog:function(a,b){P.Invite._inviteFacebookUserId(a).then(function(c){var d=c.resource_response.data,e=d.url,f=d.invite_code;P.FacebookDialog.open({type:"send",name:"name",path:e,to:a,callback:function(a){if(a&&a.success){P.Invite.trackInvite("facebook",!0);var c=P.resourceFactory.create("FacebookInviteSentResource",{invite_code:f});c.callCreate()}b&&b(a&&a.success)}}),P.trackGACategoryEvent("user_invite","facebook",P.CONST.GA_ACTION_OPEN_MODAL)},function(){P.Invite.trackInvite("facebook",!1)})},userInviteFacebook:function(a,b){P.fb.ensureLoggedIn(function(){P.Invite._showFacebookDialog(a,b)})},userInviteEmail:function(a,b){var c=P.resourceFactory.create("EmailInviteSentResource",{email:a,type:"email"});c.callCreate().then(function(){P.Invite.trackInvite("email",!0),b&&b(!0)},function(){P.Invite.trackInvite("email",!1),b&&b(!1)})},trackInviteFunnelAction:function(a,b){b="undefined"!==typeof b?b:!1;var c={action:a,is_recipient_funnel:b};P.resourceFactory.create("TrackInviteFunnelActionResource",c).callCreate({error:P.NOOP})}}}(),function(){goog.provide("P.userRegistration"),goog.require("P.fb");var a=P.Logger.getLogger("UserRegistration");P.UserRegistration={fastTrackSocialRegistration:function(a,b){var c=P.UserRegistration;if(a===P.SocialConnect.FACEBOOK)return c.fetchNetworkData(a).then(function(a){return c.sendImmediateFbRegisterRequest(a,b)});if(a===P.SocialConnect.RAKUTEN){var d={rakuten_id:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_ID),rakuten_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_TOKEN),rakuten_refresh_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN),first_name:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME),email:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_EMAIL),gender:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_GENDER),country:null};return c.register(P.SocialConnect.RAKUTEN,d)}return Promise.resolve(void 0)},sendImmediateFbRegisterRequest:function(a,b){var c=P.UserRegistration,d={first_name:a.first_name,last_name:a.last_name,email:a.email,gender:a.gender,social_username:a.username,image_url:a.image_url,facebook_id:a.id,facebook_token:a.access_token,country:null};return b&&_.extend(d,b),c.addExtraSocialParams(P.SocialConnect.FACEBOOK,d).then(function(){return c.register(P.SocialConnect.FACEBOOK,d)})},addExtraSocialParams:function(a,b){var c=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_ID),d=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_TOKEN);c&&(b.facebook_id||(b.facebook_id=c),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_ID)),d&&(b.facebook_token||(b.facebook_token=d),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_TOKEN));var e=P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW);return e&&(e.invite_follow_board&&(b.board_to_follow=e.invite_follow_board),e.invite_follow_user&&(b.user_to_follow=e.invite_follow_user)),Promise.resolve(void 0)},fetchNetworkData:function(a){return a===P.SocialConnect.FACEBOOK?(P.trackRegisterAction("register_facebook"),new Promise(function(a,b){P.fb.ensureInit(function(c){c.getLoginStatus(function(d){if(d.authResponse){var e=["picture.type(large)","id","first_name","last_name","email","username","gender"],f="/me?fields="+e.join(",");c.api(f,function(c){c&&!c.error?(c.picture&&c.picture.data&&c.picture.data.url&&!c.picture.data.is_silhouette&&(c.image_url=c.picture.data.url),a(c)):b(new Error("FB.api errored: "+c.error))})}else b(new Error("not authed"))},!0)})})):Promise.reject(new Error("Unsupported social network: "+a))},register:function(b,c){var d=P.UserRegistration.getResource(c),e=function(a,b){var c=b||"nonetwork";window.optimizely=window.optimizely||[],window.optimizely.push(["trackEvent",a]),window.optimizely.push(["trackEvent",c+a])};return e("SignupInit",b),d.callCreate({success:function(c){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_SUCCESS),e("SignupSuccess",b),P.SessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW),a.debug("Login, successful",c),Cookie.set(P.CONST.COOKIE_USER_JUST_REGISTERED,"1")},error:function(a){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_ERROR),e("SignupFail",b),a.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT?(Cookie.set(P.CONST.COOKIE_REGISTER_RESTRICT,"1",87600),Cookie.set(P.CONST.COOKIE_PERSONALIZE_FROM_OFFSITE_BROWSING_COOKIE_NAME,"disabled")):P.showError(a.message)}})},getResource:function(a){return P.resourceFactory.create("UserRegisterResource",a)},showSignupModal:function(a,b){var c={name:"reg.ContextualSignup",options:b||{}};a&&(c.resource=a),P.loadModule(c,function(a){P.getModalManager().showInModal(a,{mask_type:"dark",can_dismiss:b.can_dismiss})})}}}(),function(){goog.provide("P.preventScroll"),function(){P.Mixins.PreventScroll={startPreventScroll:function(a,b){this.stopPreventScroll(),this._preventScrollListener=this.listen(a,"mousewheel",function(c){var d=c.originalEvent.wheelDeltaY<0?"down":"up",e=a.scrollTop();if("down"===d){var f=a.outerHeight()+e;f>=b.outerHeight()&&c.preventDefault()}else 0===e&&c.preventDefault()})},stopPreventScroll:function(){this._preventScrollListener&&(this.removeListener(this._preventScrollListener),this._preventScrollListener=null)}}}()}(),function(){goog.provide("P.navigateData.NavigateData"),goog.require("P.Module"),P.navigateData.NavigateData=function(){this.evt=null,this.handled=!1,this.reuseLast=!1,this.fromHistoryUid=null,this.fromNavigate=!1,this.currentModule=null}}(),function(){goog.provide("P.number"),P.number.quantize=function(a,b){var c=a*Math.pow(10,b),d=Math.round(10*(c-parseInt(c,10)))/10;return d===-.5&&(d=-.6),c=Math.round(parseInt(c,10)+d)/Math.pow(10,b)},P.number.toRadians=function(a){return a*Math.PI/180},P.number.dollarToMicrodollar=function(a){return 1e6*a},P.number.microdollarToDollar=function(a){return a/1e6},P.number.formatUSD=function(a){return a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}}(),function(){goog.provide("P.positioning"),P.Positioning={positionElementAtAnchor:function(a,b,c,d,e){var f=P.CONST.PositionPointFlag,g=b.offset(),h=a.outerWidth(),i=b.outerWidth();if(g){var j=0,k=0;if(c&f.FLAG_VERTICAL_BOTTOM||c&f.FLAG_VERTICAL_TOP?(j=c&f.FLAG_VERTICAL_BOTTOM?g.top+b.outerHeight():g.top-a.outerHeight(),k=c&f.FLAG_VERTICAL_LEFT?g.left:c&f.FLAG_VERTICAL_RIGHT?g.left+i-h:g.left+(i-h)/2):(c&f.FLAG_HORIZONTAL_LEFT||c&f.FLAG_HORIZONTAL_RIGHT)&&(k=c&f.FLAG_HORIZONTAL_LEFT?g.left-h:g.left+i,j=c&f.FLAG_HORIZONTAL_TOP?g.top:c&f.FLAG_HORIZONTAL_BOTTOM?g.top+b.outerHeight()-a.outerHeight():g.top+(b.outerHeight()-a.outerHeight())/2),d){var l=j-$(window).scrollTop();l>0&&(j=l)}else{var m=a.parents().filter(function(){return"fixed"===$(this).css("position")});m[0]&&(j+=m.scrollTop(),j-=$(window).scrollTop())}var n={left:k,top:j};return e&&(n=P.Positioning.checkIfInViewportAndAdjustAccordingly(a,n,c)),a.css(n),c}},checkIfInViewportAndAdjustAccordingly:function(a,b){var c,d,e=a.width(),f=b.left,g=b.top,h=f+e,i=7;h>P.Viewport.width?c=f-(h-P.Viewport.width+i):f<i&&(c=i);var j={};return j.left=c?c:f,j.top=d?d:g,j}}}(),function(){goog.provide("P.browserHistory"),P.BrowserHistory=function(a){this._onRemoved=a,this._uidToData={},this._views=[],this._currentIndex=-1},_.extend(P.BrowserHistory.prototype,{add:function(a){var b=this.getCurrentUid(),c=void 0===this._uidToData[b],d=c&&null!==b;b=null!==b?b:this._getNewUid(),c?(d||(this._removeViewsAfter(this._currentIndex),this._saveState(b)),this._insert(b)):this._currentIndex=this._views.indexOf(b),this._uidToData[b]=a},_insert:function(a){var b=this._views.length;if(0===b||a>this._views[b-1])return this._views.push(a),void(this._currentIndex=b);for(var c=0;c<b;c++){var d=this._views[c];if(a<d){this._views.splice(c,0,a),this._currentIndex=c;break}if(a===d){this._currentIndex=c,this.log.error("Duplicate uid in browser history.");break}}},_removeViewsAfter:function(a){a<0&&(a=-1);var b=this,c=this._views.slice(a+1);_.each(c,function(a){var c=b._uidToData[a];b._onRemoved&&b._onRemoved(c),delete b._uidToData[a]}),this._views=this._views.slice(0,a+1)},_saveState:function(a){window.history.replaceState({uid:a},document.title,window.location.href)},getCurrentUid:function(){var a=window.history.state&&void 0!==window.history.state.uid?window.history.state.uid:null;return a},_getNewUid:function(){return window.history.length},getCurrent:function(){return this._uidToData[this.getCurrentUid()]},get:function(a){return this._uidToData[a]}})}(),function(){goog.provide("P.simpleBrowserHistory"),P.SimpleBrowserHistory=function(){this._uidToData={}},_.extend(P.SimpleBrowserHistory.prototype,{add:function(a){var b=this.getCurrentUid();b=null!==b?b:this._getNewUid(),this._uidToData[b]=a},getCurrentUid:function(){return window.location.href},_getNewUid:function(){return window.location.href},getCurrent:function(){return this._uidToData[this.getCurrentUid()]},get:function(a){return this._uidToData[a]}})}(),function(){goog.provide("P.HistoryManager"),goog.require("P.navigateData.NavigateData");var a=10,b=function(a,b,c){this.url=a,this.moduleUid=b,this.backgroundModuleUid=c||null,this.numHopsToBackground=0},c=function(a,b){this.module=a,this.backgroundModule=b||null},d=function(){this._browserHistory=null,this._seenModules=null,this._pageInfoCache={},this._init()};_.extend(d.prototype,{start:function(a){this._init(),a&&(a.uid=this._getNewUid(a),this._addToHistory(a,null))},_init:function(){this._seenModules=new P.LruCache(a),this._browserHistory=new P.SimpleBrowserHistory},navigate:function(a,b){b.fromHistoryUid=this._browserHistory.getCurrentUid(),b.reuseLast=!!b.handled,P.navigate(a,b,{})},getModule:function(a,b){var d=null,e=null,f=null,g=null;return g=b.reuseLast?this._browserHistory.get(b.fromHistoryUid):this._browserHistory.getCurrent(),g&&(d=this._seenModules.get(g.moduleUid),f=g.moduleUid,e=this._seenModules.get(g.backgroundModuleUid)),d||(d=new a,f=null!==f?f:this._getNewUid(d),d.uid=f),this._addToHistory(d,e),new c(d,e)},updateBackgroundModule:function(a,b){var c=this._browserHistory.getCurrent(),d=this._browserHistory.get(b.fromHistoryUid);a?(c.backgroundModuleUid=a.uid,this._seenModules.set(a.uid,a),b.fromNavigate&&d&&(c.numHopsToBackground=d.numHopsToBackground+1)):(c.backgroundModuleUid=null,c.numHopsToBackground=0)},cancelNavigation:function(){var a=this._browserHistory.getCurrent();this._seenModules.remove(a.moduleUid),this._go(-1)},closeCurrentModule:function(){var a=this._browserHistory.getCurrent();a&&0!==a.numHopsToBackground&&this._go(-a.numHopsToBackground)},setPageInfo:function(a){var b=this._getUrl();this._pageInfoCache[b]=a},getPageInfo:function(a){return a=a||this._getUrl(),this._pageInfoCache[a]},_go:function(a){window.history.go(a)},_getUrl:function(){return window.location.href},_getNewUid:function(a){return a.cid},_addToHistory:function(a,c){var d=this._getUrl(),e=c?c.uid:null,f=this._browserHistory.getCurrent();f||(f=new b(d,a.uid,e)),this._browserHistory.add(f),this._seenModules.set(a.uid,a),c&&this._seenModules.set(e,c)}});var e=function(){this._pageInfoCache={}};_.extend(e.prototype,{start:P.NOOP,navigate:function(a,b){P.navigate(a,b,{})},getModule:function(a){return[new a({}),[]]},updateBackgroundModule:P.NOOP,cancelNavigation:P.NOOP,closeCurrentModule:P.NOOP,setPageInfo:function(a){var b=this._getUrl();this._pageInfoCache[b]=a},getPageInfo:function(a){return a=a||this._getUrl(),this._pageInfoCache[a]},_getUrl:function(){return window.location.href}}),P.HistoryManager=P.useHistory()?d:e,Pc.TEST_MODE&&(P.PushStateHistoryManager=d,P.NoPushStateHistoryManager=e,P.HistoryRecord=b)}(),function(){window.console&&console.log&&!function(){function a(a,b){var c='font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;font-size: 15px;'+(a?"font-weight: bold;":"")+"color: "+b+";";return c}console.log("%c web? %c--> %cjoinUs()",a(!0,"#d22"),a(!0,"#777"),a(!0,"#2b2")),window.joinUs=function(){return console.log("%cWe're excited to have you! %c",a(!1,"#d22"),a(!1,"#333")),window.location.href="/_/_/about/careers/",""}}()}(),function(){goog.provide("P.date"),P.date.today=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate())},P.date.UTCToday=function(){var a=new Date;return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())},P.date.addDays=function(a,b){return new Date(a.getTime()+24*b*60*60*1e3)}}(),function(){goog.provide("P.socialNetworkSettingsManager"),goog.require("P.string"),goog.require("P.socialConnect"),P.SocialNetworkSettingsManager=function(){},_.extend(P.SocialNetworkSettingsManager.prototype,{handleConnect:function(a,b,c){var d=this;if(b){var e={success:function(e){var f={network:a,data:e};d._internalConnectNetwork(b,f,c)},error:function(){P.showError(P.string.common.connectError),c.error&&c.error(),c.complete&&c.complete()}};this._externalConnectNetwork(a,b,e)}else{var f={network:a};this._internalConnectNetwork(b,f,c)}},_externalConnectNetwork:function(a,b,c){if(!b)return void(c.success&&c.success());var d=P.SocialConnect.instance();d.connect(a,c)},_internalConnectNetwork:function(a,b,c){var d=a?"create":"delete",e=P.resourceFactory.create("UserSocialNetworkResource",b),f=c.error;_.extend(c,{error:function(a){P.showError(a.message),f()}}),e.call(d,c)}});var a=null;P.SocialNetworkSettingsManager.instance=function(){return a||(a=new P.SocialNetworkSettingsManager),a}}(),function(){goog.provide("P.conversationsManager"),goog.require("P.resourceResponse"),goog.require("P.modules.Conversation"),goog.require("P.modules.ActiveConversations");var a=5,b="activeConversations",c=72,d=function(){this.activeConversationsContainer=null,this.conversations={},this.conversationIds=[],this._openConversation=null};_.extend(d.prototype,Backbone.Events),_.extend(d.prototype,{getContainer:function(){return this.activeConversationsContainer},setContainer:function(a){this.activeConversationsContainer=a},setup:function(){var a=P.resourceFactory.create("ConversationsResource",{});this.collection=P.resourceCache.instance.getCollection(a)},openPendingConversation:function(){this.$animatedElement.remove(),this.addConversation(this.pendingConversation),this.pendingConversation=null},setDraggedObject:function(a){this._draggedObject=a},getDraggedObject:function(){return this._draggedObject},listenForConversations:function(){this.listenTo(P.Updater.instance(),"conversations",this.onNewConversations)},onNewConversations:function(a){this._updateConversations(a,!0)},_updateConversations:function(a,b){var c=this,d=a.badge,e=a.conversations;this.collection.set(e),_.each(e,function(a){var e=a.unread;if(e>0){var f=a.id;if(_.contains(c.conversationIds,f)){var g=c.conversations[f];if(g.popupIsVisible()){b&&0===d&&c.deleteConversationBadgeCount();var h=g.getConversationPopup();if(h.isScrolledToBottom())d-=a.unread;else{var i=g.getConversationHeadBadgeCount();d=i+e,h.setUnseenMessageCount(d),g.setBadgeCount(d)}g.fetchNewMessages(e),g.setMessagesNeedRendered(!1)}else g.setBadgeCount(e),g.setMessagesNeedRendered(!0)}}}),b&&(d?P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT,d):this.deleteConversationBadgeCount())},onActiveConversationUpdates:function(a){this._updateConversations(a,!1)},deleteConversationBadgeCount:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT,0);var a=P.resourceFactory.create("ConversationBadgeResource",{});a.callDelete({error:P.NOOP})},_addConversationToDom:function(a,b,c){var d,e=this,f=this.getContainer();_.each(a.users,function(a,b){a.id===P.currentUser.get("id")&&(d=b)}),d>=0&&a.users.splice(d,1),this._openConversation&&this._openConversation.getConversationId()!==a.id&&this._openConversation.closePopup();var g=a.id,h=this.conversations[g];if(h)e.openConversation(h),c||h.renderMessages(),h.setBadgeCount(0);else{this.conversationIds.push(g),this.cacheActiveConversations();var i=new P.modules.Conversation({options:{id:g},data:a});i.renderExistingData().then(function(){e.conversations[g]=i,e.resetConversationHeadTransforms(),f.appendChild(i),b&&e.openConversation(i),i.focus()})}this._ensureWithinMaxNumberOfConversations()},_animateOpenEl:function(a){var b=this,d=this.getContainer(),e=d.getContent(),f=e.offset(),g=f.left,h=f.top,i=d.getHeight(!0),j=e.find(".ConversationHead");this.closeAllConversations(),j.transition({y:-c},280,"ease"),a.addClass("normal opening"),a.removeClass("medium small"),a.width(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).height(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).css("visibility","hidden"),a.offset({left:g,top:h+i-P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION-3}),a.transition({scale:0,duration:1},function(){$(this).css("visibility","")}).transition({scale:1.2,duration:180}).transition({scale:1,duration:100},function(){b.openPendingConversation()})},animateConversationHeadToActiveConversations:function(a,b){var c=this.conversations[b.id];if(c)this.openConversation(c);else{this.pendingConversation=b;var d=a.clone();d.offset(a.offset()),d.position(a.position()),d.addClass("cloned"),d.appendTo($("body")),this.$animatedElement=d,this._animateOpenEl(d)}},cacheActiveConversations:function(){P.LocalStorage.setItem(b,this.conversationIds)},_ensureWithinMaxNumberOfConversations:function(){if(this.conversationIds.length>a){var b=this.conversationIds[0];this.removeOverboundsConversation(b)}},removeOverboundsConversation:function(a){var b=this,c=this.conversations[a],d=c.getContent();d.transition({scale:.8},200).transition({scale:2,opacity:0},200,"ease",function(){b.resetConversationHeadTransforms(),b.removeConversationById(a)})},loadCachedConversations:function(){var a=P.LocalStorage.getItem(b);if(a&&a.length){var c=this,d=P.resourceFactory.create("ConversationsResource",{});P.resourceCache.instance.callGet(d).then(function(b){var d=b;d&&(a=a,_.each(a,function(a){_.each(d,function(b){a===b.id&&c.addConversation(b,!1)})}))}),this.cacheActiveConversations()}},addConversation:function(a,b){_.isUndefined(b)&&(b=!0),this.listenForActiveConversationUpdates(),this._addConversationToDom(a,b)},addConversationById:function(a,b){var c=this,d=P.resourceFactory.create("ConversationResource",{conversation_id:a});d.callGet({error:P.NOOP}).then(function(a){var d=a.resource_response.data;c.addConversation(d,b)})},listenForActiveConversationUpdates:function(){P.Updater.instance().setMinPoll(P.CONST.UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL),P.ConversationsUpdater.instance().activate(),this.activeConversationsListener||(this.activeConversationsListener=this.listenTo(P.ConversationsUpdater.instance(),"conversations",this.onActiveConversationUpdates))},stopListeningForActiveConversationUpdates:function(){P.ConversationsUpdater.instance().deactivate(),P.Updater.instance().setMinPoll(P.CONST.UPDATES_MIN_POLL),this.stopListening(this.activeConversationsListener),this.activeConversationsListener=null},getConversations:function(){return this.conversations},hasConversations:function(){return!_.isEmpty(this.conversations)},removeAllConversations:function(){var a=this,b=_.map(this.conversations,function(a){return a.getConversationId()});_.each(b,function(b){a.removeConversationById(b)})},resetConversationHeadTransforms:function(){this.getContainer().$(".ConversationHead").css("transform","")},scaleConversationDownAndRemove:function(a){var b=this,d=this.conversations[a],e=d.getContent();e.transition({scale:1.1},120,function(){var a=b.getContainer().getConversationHeads();a.not(e.find(".ConversationHead")).not(a.last()).transition({y:c},140)}).transition({scale:0},140,"ease",function(){b.resetConversationHeadTransforms(),b.removeConversationById(a)})},removeConversationById:function(a){if(this.conversationIds=_.without(this.conversationIds,a),this.conversations[a]){this._openConversation&&(this._openConversation.getConversationId()===a?this.closeConversation(this._openConversation):this._openConversation.adjustPopup());var b=this.conversations[a];b.destroy(),delete this.conversations[a],this.conversations.length||this.stopListeningForActiveConversationUpdates(),this.cacheActiveConversations()}},closeAllConversations:function(){var a=this;_.each(this.conversations,function(b){a.closeConversation(b)})},closeConversation:function(a){a.closePopup(),this._openConversation===a&&(this._openConversation=null,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED,null),this.stopListeningForActiveConversationUpdates())},closeConversationById:function(a){var b=this.conversations[a];b&&this.closeConversation(b)},openConversation:function(a){this.conversations[a.getConversationId()]&&(this._openConversation&&this._openConversation.closePopup(),this._openConversation=a,a.showPopup(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN,null),P.ConversationsUpdater.instance().activate())}}),P.setConversationsManager=function(a){P._conversationsManager=a},P.getConversationsManager=function(){return P._conversationsManager},P.setConversationsManager(new d)}(),function(){goog.provide("P.conversationsUtil"),goog.require("P.socialConnect"),goog.require("P.socialNetworkSettingsManager");var a=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i;P.isEmailAddress=function(b){return a.test(b)},function(){P.Mixins.SocialConnectInTypeahead={_getSocialConnectItems:function(){var a=_.map(this._networksToConnect,function(a){return{template:"socialConnect",selectable:!0,network:a}});return a},updateTypeaheadStaticItems:function(a,b){var c=[];if(b){var d=a.getValue();P.isEmailAddress(d)&&(c=[{template:"emailSelect",selectable:!0,email:d}])}var e=this._socialConnectItems.concat(c);a.setAppendedStaticItems(e)},initSocialConnectItems:function(){var a=P.currentUser;this._networksToConnect=[],a.get("connected_to_facebook")||a.get("facebook_url")||this._networksToConnect.push(P.SocialConnect.FACEBOOK),a.get("connected_to_twitter")||a.get("twitter_url")||this._networksToConnect.push(P.SocialConnect.TWITTER),a.get("connected_to_gplus")||this._networksToConnect.push(P.SocialConnect.GPLUS),a.get("connected_to_yahoo")||this._networksToConnect.push(P.SocialConnect.YAHOO),this._socialConnectItems=this._getSocialConnectItems()},connectToNetwork:function(a,b){P.SocialNetworkSettingsManager.instance().handleConnect(a,!0,b)},markNetworkConnected:function(a,b){this._networksToConnect=_.without(this._networksToConnect,b),this._socialConnectItems=this._getSocialConnectItems(),this.updateTypeaheadStaticItems(a)}}}()}(),function(){goog.provide("P.updater");var a="mousemove.updater";P.Updater=function(){this.decay=0,this.lastFetchTime=0,this.timeout=null,this.recentPinId=null,this._minPoll=P.CONST.UPDATES_MIN_POLL,this.updatesResource=P.resourceFactory.create("UpdatesResource",{});var b=this;$(document).on(a,_.throttle(function(){b.wake()},1e3)),this.deferredFetch()},_.extend(P.Updater.prototype,Backbone.Events),_.extend(P.Updater.prototype,{getUpdatesResourceOptions:function(){var a={};return this.recentPinId&&(a.last_pin_id=this.recentPinId),a},setRecentPinId:function(a){this.recentPinId=a},setMinPoll:function(a){this._minPoll=a},wake:function(){this.msSinceLastFetch()>this._minPoll&&(this.decay=0,this.fetch())},fetch:function(){var b=this;clearTimeout(this.timeout);var c=function(a){var c=a.resource_response.data;_.each(c,function(a,c){b.trigger(c,a)}),b.deferredFetch()};this.lastFetchTime=(new Date).getTime(),this.updatesResource.setOptions(this.getUpdatesResourceOptions()),this.updatesResource.callGet({success:c,error:function(){$(document).off(a)}})},deferredFetch:function(){this.decay=Math.min(2*(this.decay||1e3),P.CONST.UPDATES_MAX_POLL);var a=this;this.timeout=P.setTimeout(function(){a.fetch()},this._minPoll+this.decay)},msSinceLastFetch:function(){return(new Date).getTime()-this.lastFetchTime}}),P.Updater.instance=function(){return P.Updater._instance||(P.Updater._instance=new P.Updater),P.Updater._instance}}(),function(){goog.provide("P.conversationsUpdater"),P.ConversationsUpdater=function(){this.conversationsUpdatesResource=P.resourceFactory.create("ConversationsUpdatesResource",{}),this.poller=null},_.extend(P.ConversationsUpdater.prototype,Backbone.Events),_.extend(P.ConversationsUpdater.prototype,{fetch:function(){if(!this.pendingRequest){var a=this;
this.pendingRequest=!0;var b=function(b){a.pendingRequest=!1;var c=b.resource_response.data;_.each(c,function(b,c){a.trigger(c,b)})};this.conversationsUpdatesResource.setOptions(),this.conversationsUpdatesResource.callGet({success:b,error:function(){a.pendingRequest=!1,a.deactivate()}})}},deactivate:function(){var a=this;clearInterval(a.poller),this.poller=null,a.pendingRequest=!1},activate:function(){if(!this.poller){var a=this;this.poller=window.setInterval(function(){a.fetch()},P.CONST.OPEN_CONVERSATION_MIN_POLL)}}}),P.ConversationsUpdater.instance=function(){return P.ConversationsUpdater._instance||(P.ConversationsUpdater._instance=new P.ConversationsUpdater),P.ConversationsUpdater._instance}}(),function(){goog.provide("P.title"),P.Title=function(){this.prefixCount=0,this.previousCount=0},_.extend(P.Title.prototype,{setPrefixCount:function(a){this.previousCount=this.prefixCount,this.prefixCount=Math.max(a,0),this._updateTitle()},incrementPrefixCount:function(){this.setPrefixCount(this.prefixCount+1)},resetPrefix:function(){this.setPrefixCount(0)},decrementPrefixCount:function(){this.setPrefixCount(this.prefixCount-1)},_updateTitle:function(){if(this.prefixCount!==this.previousCount){var a,b=document.title,c=b.split("("+this.previousCount+") ");if(this.prefixCount&&this.previousCount){var d="("+this.prefixCount+") ";a=d+_.rest(c).join("")}else this.previousCount?a=_.rest(c).join(""):this.prefixCount&&(a="("+this.prefixCount+") "+b);window.document.title=a}}}),P.Title.instance=function(){return P.Title._instance||(P.Title._instance=new P.Title),P.Title._instance}}(),function(){goog.provide("P.writeban"),P.writeban={},P.writeban.showWriteBanned=function(a){var b=a,c=P.string.format(P._("Due to strange activity, we put your account in safe mode to protect your Pins. You just need to reset your password.")),d={name:"ConfirmDialog",options:{button_text:P._("Reset Password"),body_message:c,title:P._("Safe mode alert!"),template:"generic"}},e=function(){b.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)},f=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_CLICK),b.showLoading();var a=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username}),c=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_SUCCESS);var a={name:"ConfirmDialog",options:{email:P.currentUser.attributes.email,template:"password_reset_email_sent"}};P.loadModule(a,function(a){b.showInModal(a,null),b.listen(a,P.CONST.EVENT_DESTROYED,e)})},d=function(){b.hideLoading()},f=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_ERROR)};a.callCreate({error:P.NOOP}).then(c,f).fin(d)};P.loadModule(d,function(a){b.showInModal(a,null),b.listen(a,P.CONST.EVENT_CONFIRM,f),b.listen(a,P.CONST.EVENT_DISMISS,e)})}}(),goog.provide("P.experienceManager"),goog.require("P.Experiences"),goog.require("P.logger"),goog.require("P.resourceFactory"),goog.require("P.set");var logger=P.Logger.getLogger("ExperienceManager"),PlacedExperience,PlacedExperiences;P.ExperienceManager=function(a){this._placedExperiences=a,this._triggered=new P.Set},P.ExperienceManager.prototype={_getResource:function(a,b){return P.resourceFactory.create(a,b)},constructPlacedExperienceId:function(a,b){return a&&b?a+":"+b:null},isPlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);return c&&this.triggerPlacedExperienceId(a,c),null!==c},getPlacedExperienceId:function(a,b){if(a&&b){var c=this._placedExperiences[a];if(c&&c.experience_id===b)return c.id}return null},getPlacedExperience:function(a){return this._placedExperiences[a]},refreshPlacedExperiences:function(){logger.debug("Refreshing all placed experiences.");var a=this._getResource("UserExperiencePlatformResource");a.callGet({error:P.NOOP}).then(function(a){if(a.resource_response.data){var b=a.resource_response.data;this._placedExperiences=b}})},dismissPlacedExperience:function(a,b,c){var d=this.getPlacedExperienceId(a,b);d?(delete this._placedExperiences[a],this.dismissPlacedExperienceId(d,c)):c&&c()},dismissPlacedExperienceId:function(a,b){var c=this;if(a){logger.debug("Delete placed experience: ",a);var d=this._getResource("UserExperienceResource",{placed_experience_id:a});d.callDelete({error:P.NOOP}).then(function(){c.refreshPlacedExperiences(),b&&b()})}else b&&b()},viewPlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);c&&this.viewPlacedExperienceId(c)},triggerPlacedExperienceId:function(a,b){if(!this._triggered.contains(a)){this._triggered.add(a);var c=this._getResource("UserExperienceTriggerResource",{placed_experience_id:b});c.callUpdate({error:P.NOOP})}},viewPlacedExperienceId:function(a){if(a){logger.debug("Viewed placed experience: ",a);var b=this._getResource("UserExperienceViewedResource",{placed_experience_id:a});b.callUpdate({error:P.NOOP})}},completePlacedExperience:function(a,b,c){var d=this.getPlacedExperienceId(a,b);d?(delete this._placedExperiences[a],this.completePlacedExperienceId(d,c)):c&&c()},completePlacedExperienceId:function(a,b){var c=this;if(a){logger.debug("Complete placed experience: ",a);var d=this._getResource("UserExperienceCompletedResource",{placed_experience_id:a});d.callUpdate({error:P.NOOP}).then(function(){c.refreshPlacedExperiences(),b&&b()})}else b&&b()}};var instance=null;P.ExperienceManager.instance=function(){if(!instance){var a=P.expns;instance=new P.ExperienceManager(a),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,function(a,b,c){instance=new P.ExperienceManager(c)})}return instance},P.ExperienceManager.Tutorials={},P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_PIN_USER_ED]="firstPinIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_YOUR_BOARDS_USER_ED]="yourBoards",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FAST_FOLLOW_USER_ED]="fastFollowIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIND_FRIENDS_USER_ED]="findFriends",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_CATEGORY_SEARCH_USER_ED]="categorySearchIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_PLACE_PINS_TOOLTIP]="placePinsIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED]="emptyPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED]="filledPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EXPLORE_BUTTON_USER_ED]="exploreButton",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EXPLORE_PAGE_USER_ED]="explorePage",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_BOARD_USER_ED]="firstBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_MOBILE_NUX_MANDATORY]="newUserWhitneyEd",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED]="visualObjectSearchIntro",goog.provide("P.versionedFileLoader"),goog.require("P.logger"),goog.require("P.script");var versionedFileLoaderLog=P.Logger.getLogger("VersionedFileLoader");P.VersionedFileLoader=function(){},P.VersionedFileLoader.prototype={getJSFiles:function(){return Pc.dynamicallyLoadedJSFiles},loadScript:function(a,b){var c=this.getJSFiles(),d=c[a];return d?(P.script.load([],d,a),void P.script.ready(a,function(){b()})):void versionedFileLoaderLog.error("Tried loading file (",+a+"), but it does not exist.")}},P.VersionedFileLoader.instance=new P.VersionedFileLoader,goog.provide("P.adTracking"),P.AdTracking={},P.AdTracking.trackConversions=function(){P.currentUser.isAuthenticated()&&Cookie.get(P.CONST.COOKIE_USER_JUST_REGISTERED)&&(P.AdTracking.pingGoogleConversion(),P.AdTracking.pingFacebookConversion(),Cookie.unset(P.CONST.COOKIE_USER_JUST_REGISTERED))},P.AdTracking.pingUrl=function(a){var b=new Image;a+="&cache_bust="+Date.now(),b.src=a},P.AdTracking.pingGoogleConversion=function(){P.AdTracking.pingUrl("https://www.googleadservices.com/pagead/conversion/983308403/?value=0&label=BAZXCN218AYQ87Dw1AM&guid=ON&script=0")},P.AdTracking.pingFacebookConversion=function(){P.AdTracking.pingUrl("https://www.facebook.com/offsite_event.php?id=6007773338208&value=0&currency=USD")},function(){goog.provide("P.nuxUtils"),goog.require("P.event"),P.NuxUtils={},P.NuxUtils.MODULE_NAME_CLOSEUP="Closeup",P.NuxUtils.MODULE_NAME_FEEDPAGE="FeedPage",P.NuxUtils.MODULE_NAME_SEARCHPAGE="SearchPage",P.NuxUtils.preventNavigationIfNecessary=function(a){var b=a&&a.data?a.data.url:"";if(P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)){var c=P.router.get().resolve(b);if(!c)return P.NuxUtils.handleAutobahnExternalClick(a),!0;var d=c.module;if(d!==P.NuxUtils.MODULE_NAME_CLOSEUP&&d!==P.NuxUtils.MODULE_NAME_FEEDPAGE&&d!==P.NuxUtils.MODULE_NAME_SEARCHPAGE)return P.NuxUtils.handleAutobahnExternalClick(a),!0}return!1},P.NuxUtils.handleAutobahnExternalClick=function(a){P.trackRegisterAction("autobahn_disabled_link"),a.stopPropagation();var b={name:"ConfirmDialog",options:{template:"autobahn_click_tip"}};P.loadModule(b,function(a){P.app.showInModal(a,{mask_type:"dark",can_dismiss:!1})})}}(),"undefined"!==typeof Modernizr&&Modernizr.csstransforms3d&&function(){var a,b,c,d;a=function(a){return $("<style>").attr({"class":"keyframe-style",id:a.id,type:"text/css"}).appendTo("head")},$.keyframe={getVendorPrefix:function(){function a(){var a;return a=navigator.userAgent,-1!==a.indexOf("Opera")?"-o-":-1!==a.indexOf("MSIE")?"-ms-":-1!==a.indexOf("WebKit")?"-webkit-":""}var b=a();return function(){return b}}(),isSupported:function(){var a,b,c;if(b=$("body").get(0),a=!1,b.style.animationName)a=!0;else{c=this.getVendorPrefix().slice(1,-1);var d=c+"AnimationName";d in b.style&&(a=!0)}return a},getProperty:function(a){var b=a;switch(a){case"transform":b=this.getVendorPrefix()+b}return b},generate:function(b){var c,d,e,f,g,h;f=b.name||"",e="@"+this.getVendorPrefix()+"keyframes "+f+" {";for(h in b)if("name"!==h){e+=h+" {";for(g in b[h]){var i=this.getProperty(g);e+=i+":"+b[h][g]+";"}e+="}"}e+="}",d=$("style#"+b.name),d.length>0?(d.html(e),c=$("*").filter(function(){this.style[""+$.keyframe.getVendorPrefix().slice(1,-1)+"AnimationName"]===f}),c.each(function(){var a,b;a=$(this),b=a.data("keyframeOptions"),a.resetKeyframe(function(){a.playKeyframe(b)})})):a({id:f}).append(e)},define:function(a){if(!a.length)return this.generate(a);for(var b=0;b<a.length;b++){var c=a[b];this.generate(c)}}},d=$.keyframe.getVendorPrefix(),b="animation-play-state",c="running",$.fn.resetKeyframe=function(a){$(this).css(d+b,c).css(d+"animation","none");a&&setTimeout(a,1)},$.fn.pauseKeyframe=function(){$(this).css(d+b,"paused")},$.fn.resumeKeyframe=function(){return $(this).css(d+b,c)},$.fn.playKeyframe=function(a,e){var f,g,h,i,j,k;if("string"===typeof a){var l=a.trim().split(" ");a={name:l[0],duration:parseInt(l[1]),timingFunction:l[2],delay:parseInt(l[3]),repeat:l[4],complete:e}}a=$.extend({duration:0,timingFunction:"ease",delay:0,repeat:1,direction:"normal",fillMode:"forwards",complete:e},a),i=a.duration,h=a.delay,k=a.repeat,f=""+a.name+" "+i+"ms "+a.timingFunction+" "+h+"ms "+k+" "+a.direction+" "+a.fillMode,e=a.complete,g=d+"animation",j=["webkit","moz","MS","o",""];var m=function(a,b,c){var d,e,f;for(e=0,f=[];e<j.length;)j[e]||(b=b.toLowerCase()),d=j[e]+b,a.off(d).on(d,c),f.push(e++)};this.each(function(){var h=$(this).addClass("boostKeyframe").css(d+b,c).css(g,f).data("keyframeOptions",a);e&&(m(h,"AnimationIteration",e),m(h,"AnimationEnd",e))})},a({id:"boost-keyframe"}).append(" .boostKeyframe{"+d+"transform:scale3d(1,1,1);}")}.call(this),function(){goog.provide("P.animateIfSupported"),function(){$.fn.playAnimationIfSupported=function(a,b){return this.each(function(c,d){if(Modernizr.csstransforms3d){var e=$(d);return e.resetKeyframe(),$(d).playKeyframe(a,b)}b&&b()}),this}}()}(),function(){goog.provide("P.reportMetrics");var a=P.Logger.getLogger("ReportMetrics"),b={reportPageLoadMetrics:function(){if(Pc.reportPageLoadTimings){var b={};window.performance&&(window.performance.getEntriesByType&&(b.resourceTimings=window.performance.getEntriesByType("resource")),window.performance.navigation&&(b.navigation=window.performance.navigation),window.performance.timing&&(b.timing=window.performance.timing),_.isEmpty(b)||(P.PAGE_ROUTE_PATTERN&&(b.routePattern=P.PAGE_ROUTE_PATTERN),a.logToServer(P.Logger.SERVER_LOG_TYPE.PAGE_LOAD_METRIC,"post",b)))}}};$(window).on("load",function(){b.reportPageLoadMetrics()}),P.Errors.wrap(b,["reportPageLoadMetrics"])}(),function(){function a(){}goog.provide("P.desktopWindow"),goog.require("P.interfaces.IWindowManager"),_.extend(a.prototype,{open:function(a,b,c,d){var e=this._makeWindowOptions(c,d);P.debugWindow=window.open(a,b,e)},_makeWindowOptions:function(a,b){var c=screen.width,d=screen.height,e=Math.round((c-a)/2),f=d>b?Math.round((d-b)/2):0;return"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+a+",height="+b+",left="+e+",top="+f},shrinkWrap:function(){this._resizeToFit()},contain:function(){this._resizeToFit(!0)},_resizeToFit:function(a){var b=document.documentElement,c=b.scrollWidth-b.clientWidth,d=b.scrollHeight-b.clientHeight;a&&(c=Math.max(c,0),d=Math.max(d,0)),window.resizeBy(c,d)}}),P.setWindowManager(new a)}(),function(){goog.provide("P.sticky");var a="sticky",b="absolute",c="below",d=b+" "+c,e=d+" "+a,f=a,g=0,h=1,i=2;P.Sticky=function(a,b){this.$el=a,this.elementHeight=null,this.headerHeight=b.headerHeight,this.boundElementHeight=null,this.$boundTo=b.$boundTo,this.$scrollable=b.$scrollable,this.updateFixed=_.bindFn(this.updateFixed,this),this._onScroll=_.bindFn(this._onScroll,this),this.$scrollable.on("scroll.sticky",this._onScroll),this.pendingScrollRAF=!1,this.lastState=null;var c=this;P.deferDomManipulation(function(){c.elementHeight=a.height(),c.boundElementHeight=c.$boundTo.height()})},_.extend(P.Sticky.prototype,Backbone.Events),P.Sticky.prototype.destroy=function(){this.$scrollable.off("scroll.sticky",this.updateFixed)},P.Sticky.prototype.unSticky=function(){this.destroy()},P.Sticky.prototype._onScroll=function(){if(!this.pendingScrollRAF){var a=this;P.deferDomManipulation(function(){return a.scrollTop=a.$scrollable.scrollTop(),a.scrollTop===a.lastScrollTop?void(a.pendingScrollRAF=!1):(a.updateFixed(),a.lastScrollTop=a.scrollTop,void(a.pendingScrollRAF=!1))}),this.pendingScrollRAF=!0}},P.Sticky.prototype.updateFixed=function(){var b,c=$(window),f=c.scrollTop(),j=f,k=this.$boundTo.offset().top,l=k-this.headerHeight,m=k+this.boundElementHeight-this.headerHeight;b=j>=l&&j<=m?h:j>=m?i:g,b!==this.lastState&&(b===h?(this.$el.css("top","").addClass(a).removeClass(d),this.trigger(P.CONST.EVENT_STICKY_FIXED,!0)):b===i?(this.$el.removeClass(a),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1),this.handleReachingBottom()):b===g&&(this.$el.removeClass(e),this.trigger(P.CONST.EVENT_STICKY_NORMAL),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1))),this.lastState=b},P.Sticky.prototype.handleReachingBottom=function(){if(!this.$el.hasClass(d)){var a=this.boundElementHeight||0,e=this.$el.css("top");e=e?e.split("px")[0]:0,e=parseInt(e,10)||0,this.$el.addClass(b+" "+c).css("top",a+e+1)}},jQuery.fn.sticky=function(b){return this.each(function(c,d){var e=$(d),g=e.data(f);if(g&&(g.destroy(),e.removeData(a)),"unsticky"===b);else if("object"===typeof b){var h={$scrollable:b.$scrollable,$boundTo:b.$boundTo,headerHeight:b.headerHeight||0};b.$scrollable&&(g=new P.Sticky(e,h),e.data(f,g))}}),this}}(),function(){goog.provide("P.overflowingText"),jQuery.fn.overflowingText=function(){return this.each(function(a,b){if(b.offsetHeight<b.scrollHeight||b.offsetWidth<b.scrollWidth){var c=$(b);c.addClass(P.CONST.OVERFLOWING_TEXT_OVERFLOWING_CLASS)}}),this}}(),function(){goog.provide("P.focusWithoutScrolling"),jQuery.fn.focusWithoutScrolling=function(){return this.each(function(a,b){var c=$(window),d=c.scrollLeft(),e=c.scrollTop();$(b).focus();var f=$(".Closeup");return f.length?(e=f.scrollTop(),void f.scrollTop(e)):(c.scrollLeft(d),void c.scrollTop(e))}),this}}(),function(){goog.provide("P.style"),P.Style=function(a,b){P.Style.addStyle(a,b)},P.Style.addStyle=function(a,b){var c=a+"Styles",d=document.getElementById(c);d||(d=document.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("id",c),document.getElementsByTagName("head")[0].appendChild(d)),d.styleSheet?d.styleSheet.cssText=b:d.appendChild(document.createTextNode(b))}}(),function(){jQuery.fn.flashScrollbar=function(){return this.each(function(){var a=$(this).scrollTop();$(this).scrollTop(a+1),$(this).scrollTop(a-1)}),this}}(),goog.require("P.resourceFactory");var LogLevelResource=function(){};LogLevelResource.prototype={callGet:function(a){a=a||{};var b=P.getDebugWindow(),c=P.Logger.getAll();b&&(c=b.P.Logger.getAll()),c=_.sortBy(c,function(a){return a.name.toLowerCase()});for(var d=3,e=Math.ceil(c.length/d),f=[],g=0;g<d;g++){for(var h=[],i=0;i<e;i++){var j=g*e+i;if(j>=c.length)break;h.push(c[j])}f.push(h)}var k=new P.ResourceResponse;return k.resource_response.data={levels:_.pairs(b.P.Logger.LOG_LEVEL),loggerColumns:f},a.success&&a.success(resourceData),a.complete&&a.complete(),Promise.resolve(k)},resetBookmark:function(){}},P.resourceFactory.register("LogLevelResource",LogLevelResource),function(){goog.provide("P.transition"),P.TransitionState={NOT_STARTED:0,STARTED:1,ENDED:2};var a=function(a){return{"animation-duration":a,"-webkit-animation-duration":a,"-o-animation-duration":a}},b=function(a){return{width:a.width+"px",height:a.height+"px"}},c=function(a){return{top:a.top+"px",left:a.left+"px"}},d=function(a){return{transition:a,"-moz-transition":a,"-webkit-transition":a,"-o-transition-duration":a}};P.Transition=function(a,b,c,d){this.element=a,this.endPos=b,this.endDim=c,this.duration=d,this.state=P.TransitionState.NOT_STARTED,this.listener=null},_.extend(P.Transition.prototype,{start:function(){this.state=P.TransitionState.STARTED,this.onStart(),this.listener.started();var a=this;P.setTimeout(function(){a.end()},this.duration)},end:function(){this.state=P.TransitionState.ENDED,this.onEnd(),this.listener.ended()},addListener:function(a){this.listener=a},onStart:function(){},onEnd:function(){}}),P.Transition.extend=Backbone.View.extend,P.Transition.Zoom=P.Transition.extend({onStart:function(){var a=this.duration/1e3,e="all "+a+"s ease-out",f=_.extend({position:"fixed"},d(e),b(this.endDim),c(this.endPos));this.element.css(f)}}),P.Transition.Spin=P.Transition.extend({onStart:function(){var e=this.duration/1e3+"s",f="all "+e+" ease-out",g=_.extend({position:"fixed"},d(f),a(e),b(this.endDim),c(this.endPos));this.element.addClass("rotate").css(g)}})}(),function(){goog.provide("P.pushNotifications");var a="web.com.pinterest.www";P.requestPushNotifications=function(){if(P.currentUser.isAuthenticated()&&window.safari&&window.safari.pushNotification){var b=window.safari.pushNotification.permission(a);"default"===b.permission&&window.safari.pushNotification.requestPermission("https://"+window.location.hostname+"/_/_/push",a,{},function(){})}}}(),goog.provide("P.modules.ActiveConversations"),goog.require("P.Module"),P.modules.ActiveConversations=P.Module.extend({getConversationHeads:function(){return this.$(".ConversationHead")}}),goog.provide("P.modules.AddressForm"),goog.require("P.Module"),P.modules.AddressForm=P.Module.extend({}),goog.provide("P.modules.AnimationPlacesBase"),goog.require("P.Module"),P.modules.AnimationPlacesBase=P.Module.extend({}),goog.provide("P.modules.AnswerBase"),goog.require("P.Module");var ANSWER_CLASS_LIKED="liked";P.modules.AnswerBase=P.Module.extend({onContentReady:function(){},_getLikeCountEl:function(){return this.$(".answerLikesCount")},_getLikeCount:function(){var a=$.trim(this._getLikeCountEl().text());return a?parseInt(a,10):0},_getReplyButton:function(){return this.getChildById("replyBtn")},_getReplies:function(){return this.getChildById("replies")},_setLikeCount:function(a){this._getLikeCountEl().text(a||"")},_onAnswerLiked:function(){this._setLikeCount(this._getLikeCount()+1),this._getLikeCountEl().addClass(ANSWER_CLASS_LIKED);var a=this,b={name:"Toast",options:{position_mode:"ANCHORED",position_point:"RIGHT_TOP",template:"like_answer_success",created_by_user_name:this.data.created_by_user.first_name}};P.loadModule(b,function(b){a.addChild(b),b.render().then(function(){b.options.anchor=a.$el,b.positionModule()})})},_onAnswerUnliked:function(){this._setLikeCount(this._getLikeCount()-1),this._getLikeCountEl().removeClass(ANSWER_CLASS_LIKED)}}),goog.provide("P.modules.AppBase"),goog.require("P.HistoryManager"),goog.require("P.interfaces.HistoryManagerProvider"),goog.require("P.Module"),goog.require("P.util");var LOADING_DELAY=500,NEXT_ACTION={REPLACE:0,REPLACE_TOP:1,APPEND:2,CLOSE:3,IGNORE:4};P.modules.AppBase=P.Module.extend({MAIN_MODULE_ID:"mainModule",CLOSEUP_NAME:"Closeup",onCreated:function(){P.currentUser.isAuthenticated()||P.currentUser.attemptLogin(),this.historyManager=new P.HistoryManager,this.backgroundModule=null,this.canUpdatePageInfo=!1;var a=this;P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_LOCATION_CHANGE,function(){a.midNavigate=!1})},onAddedToDom:function(){var a=P.router.get();a.start(),P.AppVersion.setup(P.CONTEXT.app_version),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_SCROLL_TO_ELEMENT,this._onChildScrollToElement),this.childListen(P.CONST.EVENT_SCROLL_TO_TOP,this.onChildScrollToTop),this.listen(a,P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),this.listen(a,P.CONST.EVENT_ROUTE_NO_MATCH,this.onRouteNoMatch),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,this.onChildEventRequiresAuthentication);var b={};b[P.CONST.PUBSUB_TOPIC_PAGE_INFO]=this.onPageInfoChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b)},onChildAdded:function(){this._adjustScrollToTopPositionIfNeeded()},onChildEventRequiresAuthentication:function(a){this.navigate(a.data.authRedirectUrl)},_onChildScrollToElement:function(a){var b=a.data,c=b.$el,d={scrollOffset:b.scrollOffset,callback:b.callback};this._scrollToElement(c,d)},onChildScrollToTop:function(){var a=this._getCurrentMainModule(),b=a.getScrollableElement();P.scrollToTop({$scroller:b})},_getCurrentMainModule:function(){var a=this.getChildById(this.MAIN_MODULE_ID);return a?a:this.children[this.children.length-1]},_scrollToElement:function(a,b){var c=this._getCurrentMainModule(),d=P.normalizeScroller(c.getScrollableElement()),e=a.positionAncestor(d).top,f=0===b.scrollOffset?0:b.scrollOffset||P.CONST.SCROLL_TO_ELEMENT_OFFSET,g={newScrollOffset:Math.max(e-f,0),$scroller:d,callback:b.callback};P.scrollToTop(g)},setUpContextLogging:function(){var a=this._getCurrentMainModule();if(!a.getHasError()){var b=window.location.pathname+window.location.search,c=P.router.get().resolve(b);if(c){var d=c.extraContent.log;if(d){var e=P.ContextEvent.fromPlainObject(d);e.setEventType(P.ContextLogging.EventType.VIEW),e.setRequestIdentifier(P.PAGE_LOAD_REQUEST_IDENTIFIER);var f=a.getLoggingObjectIdStr();f&&e.setObjectIdStr(f),P.ContextLogger.getInstance().addEvent(e)}}else this.log.error("Router couldn't resolve url for context logging",{url:b})}},onRemovedFromDom:function(){this._removeListeners()},onRouteMatched:function(a){if(P.AppVersion.isNewVersionAvailable()&&this.midNavigate&&(P.AppVersion.isNewVersionRequired()||"Closeup"!==a.module))return this._setVersionRedirectCookie(),void window.location.reload();this.log.debug("onRoute",a),P.trackGAPageview(a.module);var b,c=a.module,d=a.options,e=a.resource;this.extraData&&this.extraData.userAgent&&a.extraContent&&(b=P.DeepLink.getLinkForUserAgent(this.extraData.userAgent,a.extraContent)),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,b);var f="https:"===window.location.protocol,g=a.extraContent.https||a.extraContent.https_if_unauth&&!P.currentUser.isAuthenticated();if(a.extraContent.require_explicit_login&&P.currentUser.get("autologin"))return void P.navigate(P.getLoginUrl());if(a.extraContent.require_authentication&&!P.currentUser.isAuthenticated())return void P.navigate(P.getRegisterUrl());if(a.extraContent.require_sterling_access&&!P.currentUser.get("has_sterling_access"))return void P.navigate("/");if(a.extraContent.require_analytics_access&&!P.currentUser.get("has_analytics_access"))return void P.navigate("/");if(g&&!f)return void window.location.replace(window.location.href.replace(/http:\/\//,"https://"));if(!g&&f)return void window.location.replace(window.location.href.replace(/https:\/\//,"http://"));this.removeAllModals();var h=this._getCurrentMainModule();a.navigateData.currentModule=h;var i=this;P.loadModuleConstructor(c).then(function(b){var c=i.historyManager.getModule(b,a.navigateData);if(!i._getCurrentMainModule())return void window.location.reload();var f=null,g=a.extraContent.log;g?(g.event_type=P.ContextLogging.EventType.VIEW,f=P.ContextEvent.fromPlainObject(g)):P.ContextLogger.getInstance().clearContext(),i.updateMainModule(c,d,e,a.navigateData,f)});var j=this.historyManager.getPageInfo();j&&this.setPageInfo(j),this.canUpdatePageInfo=!j;var k=this.getChildById("nags");k&&k.clearKeywords()},onRouteNoMatch:function(){window.location.reload()},onPageInfoChange:function(a,b,c){this.canUpdatePageInfo&&(this.historyManager.setPageInfo(c),this.setPageInfo(c),this.canUpdatePageInfo=!1)},setPageInfo:function(a){a.title&&$(document).attr("title",a.title),$("head meta[data-app]").remove();var b=[];_.each(a.meta,function(a,c){b.push($("<meta>").prop({name:c,property:c,content:a,"data-app":1}))}),$("head").append(b)},startModuleTransition:function(a){var b=this;a.fadeOut(),clearTimeout(this._loaderTimeout),this._loaderTimeout=P.setTimeout(function(){b.loadingShown=!0,b.showLoading()},LOADING_DELAY,"App loader")},stopModuleTransition:function(a){clearTimeout(this._loaderTimeout),a.fadeIn(),this.loadingShown&&(this.hideLoading(),this.loadingShown=!1)},updateMainModule:function(a,b,c,d,e){var f=a.module,g=a.backgroundModule,h=this._getCurrentMainModule();h.saveExtraState(!0),this.log.debug("Current:",h.className,"New:",f.className);var i=this._getNextAction(h,f,g,d),j=i===NEXT_ACTION.REPLACE&&h.className!==this.CLOSEUP_NAME&&f.className!==this.CLOSEUP_NAME;j&&this.startModuleTransition(h),f.clearFades();var k=this._getCanClose(h,a,i);null!==k&&(b.can_close=k);var l=null===k||k===!1;P.Body.setScrolling(l);var m=this;if(e){var n=function(a,b,c){var d=c;e.setRequestIdentifier(d),m.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST)},o={};o[P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER]=n,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_REQUEST,o)}var p=function(){if(m.midNavigate=!1,j&&m.stopModuleTransition(f),m.updateScrollWatchers(f),e&&!f.getHasError()){var a=f.getLoggingObjectIdStr();a&&e.setObjectIdStr(a),P.ContextLogger.getInstance().addEvent(e),P.pubsub.clearChannel(P.CONST.PUBSUB_CHANNEL_REQUEST)}};f.errorStrategy=P.CONST.ErrorStrategy.SHOW,f.setAsMainModule(b,c,d).then(function(){m._performNextAction(i,h,a,d),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW,m._getCurrentMainModule());var b=P.CONTEXT.breadcrumbs||f.getBreadcrumbs();f.setBreadcrumbs(b),P.CONTEXT.breadcrumbs=null,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_BREADCRUMBS,P.CONST.PUBSUB_TOPIC_BREADCRUMB_UPDATE,b),m._adjustScrollToTopPositionIfNeeded(),m._scrollMainModuleIfNeeded()},function(){m.historyManager.cancelNavigation()}).fin(function(){p()})},_getNextAction:function(a,b,c,d){var e=null;return e=a===b?NEXT_ACTION.IGNORE:b.className!==this.CLOSEUP_NAME?a.className===this.CLOSEUP_NAME&&a.options.can_close&&this.backgroundModule&&b===this.backgroundModule?NEXT_ACTION.CLOSE:NEXT_ACTION.REPLACE:d.fromNavigate?a.className===this.CLOSEUP_NAME?a.options.can_close?NEXT_ACTION.REPLACE_TOP:NEXT_ACTION.REPLACE:NEXT_ACTION.APPEND:a===c&&b.className===this.CLOSEUP_NAME?NEXT_ACTION.APPEND:NEXT_ACTION.REPLACE},_getCanClose:function(a,b,c){var d=b.module,e=b.backgroundModule;if(d.className!==this.CLOSEUP_NAME)return null;var f=a.className===this.CLOSEUP_NAME,g=!!a.options.can_close;switch(c){case NEXT_ACTION.REPLACE:return!!e;case NEXT_ACTION.REPLACE_TOP:return g;case NEXT_ACTION.APPEND:return!f||g;case NEXT_ACTION.IGNORE:return g}return null},_performNextAction:function(a,b,c,d){var e=this,f=c.module,g=c.backgroundModule,h=f.$el,i=a!==NEXT_ACTION.IGNORE,j=this.getChildById("header"),k=0;if(j&&(k=j.getHeight()),a===NEXT_ACTION.IGNORE)e.backgroundModule&&e.historyManager.updateBackgroundModule(e.backgroundModule,d);else if(a===NEXT_ACTION.CLOSE)e.backgroundModule=null,b.detachElement(),e.removeChildId(b);else if(a===NEXT_ACTION.REPLACE){e.backgroundModule!==g&&(e.backgroundModule&&(e.backgroundModule.detachElement(),e.backgroundModule=null),g&&(g!==b&&(g.appendToElement(e.$(".mainContainer")),e.addChild(g)),e.backgroundModule=g)),b!==g&&(this.removeChildId(b),b.detachElement()),e.removeChildId(b),h.css("min-height",P.Viewport.height-k);var l=$(e.backgroundModule?".appendedContainer":".mainContainer");l.append(h),e.addChild(f)}else a===NEXT_ACTION.REPLACE_TOP?(b.detachElement(),h.css("min-height",P.Viewport.height-k),$(".appendedContainer").append(h),e.addChild(f),e.historyManager.updateBackgroundModule(e.backgroundModule,d)):a===NEXT_ACTION.APPEND&&(e.backgroundModule=b,e.removeChildId(b),h.css("min-height",P.Viewport.height-k),$(".appendedContainer").append(h),e.addChild(f),e.historyManager.updateBackgroundModule(e.backgroundModule,d));(i||this._forceRefreshRequested(d))&&(e.setChildId(f,this.MAIN_MODULE_ID),f.restoreExtraState(!0))},_setVersionRedirectCookie:function(){Cookie.set(P.CONST.COOKIE_VERSION_REFRESH,P.AppVersion.currentVersion,1)},onContentReady:function(){this.setUpContextLogging();var a=this._getCurrentMainModule();P.trackGAPageview(a.className,this._getGAPageviewOptions()),_.defer(_.bindFn(this._startTutorials,this)),this.setChildId(a,this.MAIN_MODULE_ID),this.historyManager.start(a),this.historyManager.setPageInfo(P.PAGE_INFO),P.STREAMING&&this.setPageInfo(P.PAGE_INFO),this.updateScrollWatchers(a),this._setDevicePixelRatioCookie(),this._adjustScrollToTopPositionIfNeeded(),this._scrollMainModuleIfNeeded()},_setDevicePixelRatioCookie:function(){var a=(window.devicePixelRatio||1)+"";Cookie.set(P.CONST.COOKIE_DEVICE_PIXEL_RATIO,a)},onChildNavigate:function(a){if(this.midNavigate)return void a.stopPropagation();this._adjustScrollToTopPositionIfNeeded();var b=a.data.url;if(!P.isOffsiteUrl(b)&&(this.midNavigate=!0,P.AppVersion.isNewVersionRequired()))return this._setVersionRedirectCookie(),P.changeWindowLocation(b,!1),void a.stopPropagation();this.log.debug("App got navigate event from child",a.target,"for url:",b);var c=new P.navigateData.NavigateData;c.handled=!!a.data.handled,c.evt=a,this.historyManager.navigate(b,c),a.stopPropagation()},_adjustScrollToTopPositionIfNeeded:function(){},_scrollMainModuleIfNeeded:P.NOOP,_getGAPageviewOptions:function(){return{}},_startTutorials:function(){P.TutorialManager.instance().resumeTutorial()},isTutorialActive:function(){return P.TutorialManager.instance().isTutorialActive()},updateScrollWatchers:function(){},removeAllModals:function(){}}),goog.provide("P.modules.AutoFollow"),goog.require("P.Module"),P.modules.AutoFollow=P.Module.extend({events:{},onContentReady:function(){var a={username:this.options.username,username_and_slug:this.options.username_and_slug},b="UserAutoFollowResource",c="/"+this.options.username+"/",d="user_auto_follow";this.options.username_and_slug&&(b="BoardAutoFollowResource",c="/"+this.options.username_and_slug+"/",d="board_auto_follow");var e=this,f=P.resourceFactory.create(b,a);f.callCreate({success:function(){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS)},error:function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)},complete:function(){e.navigate(c+"?auto_follow=1")}})}}),goog.provide("P.modules.AuxiliarySiteHeader"),goog.require("P.Module"),P.modules.AuxiliarySiteHeader=P.Module.extend({}),goog.provide("P.modules.BackgroundImage"),goog.require("P.Module"),P.modules.BackgroundImage=P.Module.extend({setNewImage:function(a,b){this.options.image_preload_bg=a,this.options.image_url=b,this.$el.css("background-color",this.options.image_preload_bg),this.background.removeClass("loaded"),this.holderImage.attr("src",this.options.image_url)
},onContentReady:function(){this.holderImage=this.$(".holderImage"),this.background=this.$(".background"),this.holderImage.load(_.bindFn(this.onImageLoaded,this)),this.setNewImage(this.options.image_preload_bg,this.options.image_url)},onImageLoaded:function(){var a=this;a.background.css("background-image","url('"+a.options.image_url+"')"),setTimeout(function(){a.background.addClass("loaded")},100)},setActive:function(a){this.$el.toggleClass("active",a)}}),goog.provide("P.modules.BoardBase"),goog.require("P.Module"),P.modules.BoardBase=P.Module.extend({getId:function(){return this.data&&this.data.id},onBoardDeleted:function(){this.destroy()},onBoardUpdated:function(){this.render()},getLoggingObjectIdStr:function(){return this.getId()}}),goog.provide("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.Module"),P.modules.BoardCollaboratorInvitesBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildInviteUser),this.childListen(P.CONST.EVENT_INVITE_EMAIL,this.onChildInviteEmail)},onChildInviteUser:function(a){var b,c=this,d=this.getChildById("boardInviteForm");d.showLoading();var e=a.data.userId,f=a.data.type,g=this.getBoardId();"user"===f?(b=P.resourceFactory.create("BoardInviteResource",{board_id:g,invited_user_id:e}),b.callCreate({success:function(){d.clearTypeahead()},complete:function(){d.hideLoading()}})):f===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER&&(b=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:g}),b.callGet({error:P.NOOP}).then(function(a){var f=a.resource_response.data;d.hideLoading(),P.FacebookDialog.open({type:"send",path:f.url,to:e,callback:function(a){a&&a.success&&(b=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:c.getBoardId(),invite_code:f.invite_code}),b.callUpdate())}})},function(a){d.hideLoading(),P.showError(a.message)}))},getBoardId:function(){return this.resource.options.board_id},onChildInviteEmail:function(a){var b=this,c=this.getChildById("boardInviteForm");c.showLoading();var d=a.data.email,e={board_id:this.getBoardId(),emails:[d]},f=P.resourceFactory.create("BoardEmailInviteResource",e);f.callCreate({success:function(){c.clearTypeahead();var a=P.string.format(P.string.common.successInviteSentToEmail,{email:d}),e=$("<div class='alert'>"+a+"</div>").hide();b.insertAfterModule(e,c),e.fadeIn(function(){e.delay(5e3).fadeOut(function(){e.remove()})})},complete:function(){c.hideLoading()}})}}),goog.provide("P.modules.BoardCollaboratorsBase"),goog.require("P.Module"),P.modules.BoardCollaboratorsBase=P.Module.extend({events:{}}),goog.provide("P.modules.BoardIcons"),goog.require("P.Module"),P.modules.BoardIcons=P.Module.extend({setLightColor:function(a){this.$el.toggleClass("light",a)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/BoardIcons/BoardIcons.nunjucks")}),goog.provide("P.modules.BoardInviteBase"),goog.require("P.Module");var showSuccessMs=5e3;P.modules.BoardInviteBase=P.Module.extend({onContentReady:function(){this.declineButton=this.getChildById("declineButton"),this.removeButton=this.getChildById("removeButton"),this.acceptButton=this.getChildById("acceptButton"),this.approveButton=this.getChildById("approveButton"),this.declineButton&&this.listen(this.declineButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDecline),this.removeButton&&this.listen(this.removeButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickRemove),this.acceptButton&&this.listen(this.acceptButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickAccept),this.approveButton&&this.listen(this.approveButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickApprove)},getConfirmBoardInvite:function(){return"boardEdit"===this.options.view_type},deleteBoardInvite:function(a){var b,c=this._getCurrentUserIsInvitedUser(),d=this;b=c?"collaborator_decline_invite":"collaborator_delete_invite",P.trackGAEvent(b,P.CONST.GA_ACTION_CLICK),this.removeButton&&this.removeButton.showLoading();var e=!1;if(a){var f=a.data.formData;e=f&&f.ban}var g=this._getRemoveResource(e);g.callDelete({success:function(){P.trackGAEvent(b,P.CONST.GA_ACTION_SUCCESS);var a=d.data.board.id;d.fadeOut(function(){d.destroy(),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED),e&&d.extraData.has_delete_permission&&P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR)}),c&&(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF))},error:function(){P.trackGAEvent(b,P.CONST.GA_ACTION_ERROR)},complete:function(){d.removeButton.hideLoading()}})},onClickDecline:function(){},onClickRemove:function(){},onClickAccept:function(){var a="collaborator_invite_accept";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK);var b=this;this.acceptButton&&this.acceptButton.showLoading();var c=P.resourceFactory.clone(this.resource);c.callUpdate({success:function(){P.trackGAEvent(a,P.CONST.GA_ACTION_SUCCESS);var c=b.$(".pending"),d=b.$(".success"),e=b.data.board.id;P.pubsub.publish(e,P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED),c.fadeOut(function(){d.fadeIn(function(){d.delay(showSuccessMs).fadeOut(function(){b.destroy()})})})},error:function(){P.trackGAEvent(a,P.CONST.GA_ACTION_ERROR)},complete:function(){b.acceptButton.hideLoading()}})},onClickApprove:function(){var a="collaborator_approve_invite",b=P.resourceFactory.create("BoardInviteResource",this.resource.copyOptions(!0));this.approveButton&&this.approveButton.showLoading();var c=this;b.callUpdate({success:function(){P.trackGAEvent(a,P.CONST.GA_ACTION_SUCCESS),c.fadeOut(function(){c.destroy()});var b=c.data.board.id;P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE,{userId:c._getInviteUserId()})},error:function(){P.trackGAEvent(a,P.CONST.GA_ACTION_ERROR)},complete:function(){c.approveButton.hideLoading()}})},_getRemoveResource:function(a){var b=this.extraData.accepted,c=b?"BoardCollaboratorResource":"BoardInviteResource",d=this.resource.copyOptions(!0);b&&this.getConfirmBoardInvite()&&(d.ban=a);var e=P.resourceFactory.create(c,d);return e},_getInviteUserId:function(){return this.extraData.invitedUserId},_getCurrentUserIsInvitedUser:function(){return this.extraData.currentUserIsInvitedUser},_getInvitedUserFullName:function(){return this.extraData.invitedUserFullName}}),goog.provide("P.modules.BoardInviteForm"),goog.require("P.Module"),P.modules.BoardInviteForm=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onChildEnterPressed),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onClickInviteButton),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged)},onChildItemSelected:function(a){P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_SELECT_SUBMIT);var b=a.data.item;this._inviteUser(b),a.stopPropagation()},onChildEnterPressed:function(a){P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_ENTER_SUBMIT),this.submit(),a.stopPropagation()},onClickInviteButton:function(a){P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_CLICK_SUBMIT),this.submit(),a.stopPropagation()},onChildContentChanged:function(a){a.stopPropagation()},submit:function(){var a=this.getChildById("typeaheadField"),b=a.getValue(),c=a.getField(),d=this;if(this.options.email_supported){var e=new P.Validator(c,[P.Validator.Length({min:1}),P.Validator.Email()]);e.validate(function(a){a.errors.length>0?d.log.debug(a.errors):d._inviteEmail(b)})}return!1},setTypeaheadFieldValue:function(a){var b=this.getChildById("typeaheadField");b.setValue(a)},clearTypeahead:function(){var a=this.getChildById("typeaheadField");a.clear()},_inviteEmail:function(a){this.triggerEvent(P.CONST.EVENT_INVITE_EMAIL,{email:a},!0)},_inviteUser:function(a){var b=a.get("id"),c=a.get("type"),d=a.attributes;this.triggerEvent(P.CONST.EVENT_INVITE_USER,{userId:b,type:c,pending:this.options.pending,attributes:d},!0)}}),goog.provide("P.modules.BoardLabel"),goog.require("P.Module"),P.modules.BoardLabel=P.Module.extend({setSelectedStyle:function(a){this.getChildById("boardIcons").setLightColor(a)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/BoardLabel/BoardLabel.nunjucks")}),goog.provide("P.modules.BoardPageBase"),goog.require("P.Module");var ID_ADD_TO_MAP_BUTTON="addToMap";P.modules.BoardPageBase=P.Module.extend({events:{},onContentReady:function(){this.map=this.getChildById("map"),this.map&&(this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady),this.childListen(P.CONST.EVENT_PIN_DELETED,this.onPinDeleted))},getGrid:function(){return this.getChildById("grid")},showAddToMapButtonIfPossible:function(){var a=this._getAddToMapButton();a&&a.getContent().removeClass("hidden")},onMapReady:function(){this.showAddToMapButtonIfPossible(),this.setMapPaddingTopLeft(),this.addMarkersToMap()},_removePinFromMap:function(a){if(this.map){var b=a.getId();this.map.removeMarkerForPinId(b)}},onPinDeleted:function(a){var b=a.data;this._removePinFromMap(b)},addMarkersToMap:function(){var a=this.getPins();this._pinCount=a.length;var b=_.filter(a,function(a){return null!==a.getCoordinates()}),c=b.length>0;this._pinCount&&c?(this.map.addMarkersToMap(a),this.map.fitViewToPinMarkers()):this.map.fitWorld()},getPins:function(){var a=this.getGrid();if(!a)return[];var b=a.getGridItemsChildren();return b.length?b:[]},_getAddToMapButton:function(){return this.getChildById(ID_ADD_TO_MAP_BUTTON)},setMapPaddingTopLeft:function(){}}),goog.provide("P.modules.BusinessAccountCreateBase"),goog.require("P.Module"),P.modules.BusinessAccountCreateBase=P.Module.extend({events:{"keyup .aboutText":"onAboutTextKeyup"},onContentReady:function(){var a={first_name:[P.Validator.Required()],last_name:[P.Validator.Required()],email:[P.Validator.Email({}),P.Validator.Required()],account_type:[P.Validator.Required()],business_name:[P.Validator.Required()],about:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})],accept_terms:[P.Validator.Required()],website_url:[P.Validator.URL()]};this.$(".password")&&(a.password=[P.Validator.Password(),P.Validator.Required()]),this.$(".email")&&(a.email=[P.Validator.Email({}),P.Validator.Required()]),this.$(".username")&&(a.username=[P.Validator.Required()]);var b={};this.$aboutCounter=this.$(".aboutCounter"),this.$(".aboutText").keyup(),this.$form=this.$("form"),this.form=new P.Form(this.$form,a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onAboutTextKeyup:function(a){var b=a.target.value.replace(/\{.*\}/g,"").length,c=P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION,d=c-b;this.$aboutCounter.text(d)},getFormData:function(){var a=this.$("form").serializeArray(),b={};return _.each(a,function(a){b[a.name]="on"===a.value?!0:a.value}),b},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.getChildById("submitButton"),c=this.getFormData();b.showLoading();var d=this;P.UserRegistration.register("partner",c).then(function(a){d.log.debug("Signup success:",a),d.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0)&&(window.location="/")}).fin(function(){b.hideLoading()})}}}),goog.provide("P.modules.BusinessTOS"),goog.require("P.Module"),P.modules.BusinessTOS=P.Module.extend({}),goog.provide("P.modules.Button"),goog.require("P.Module");var ButtonStates={ATTR_DISABLED:"disabled",CLASS_DISABLED:"disabled",CLASS_ACTIVE:"active",CLASS_BADGED:"badged",SELECTOR_BUTTON_TEXT:".buttonText",SELECTOR_BUTTON_BADGE:".buttonBadge",CLASS_SELECTED:"selected"};P.modules.Button=P.Module.extend({events:{click:"onClick"},onClick:function(a){return a&&this.isDisabled()?(a.preventDefault(),!1):void this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)},disable:function(){this.$el.attr(ButtonStates.ATTR_DISABLED,!0).addClass(ButtonStates.CLASS_DISABLED)},enable:function(){this.$el.removeAttr(ButtonStates.ATTR_DISABLED).removeClass(ButtonStates.CLASS_DISABLED)},setEnabled:function(a){a?this.enable():this.disable()},setHighlight:function(a){this.$el.toggleClass(P.CONST.CLASS_BUTTON_HIGHLIGHTED,a)},isDisabled:function(){return this.$el.is(":disabled")},isCancelButton:function(){return this.options.cancelButton},isSegmentedControlButton:function(){return this.options.segmented_control_button},getText:function(){var a=this.$(ButtonStates.SELECTOR_BUTTON_TEXT).text();return $.trim(a)},setText:function(a){var b=$.trim(a);this.$(ButtonStates.SELECTOR_BUTTON_TEXT).text(b)},setStyles:function(a){var b=this.$el;_.each(a,function(a,c){b.toggleClass(c,a)})},getLoadingSpinnerOptions:function(){return _.extend(P.Module.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},setBadge:function(a){var b=$.trim(a);this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text(b),this.$el.addClass(ButtonStates.CLASS_BADGED)},getBadgeCount:function(){var a=$.trim(this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text());return a&&void 0!==a||(a=0),parseInt(a,10)},clearBadge:function(){this.$(ButtonStates.SELECTOR_BUTTON_BADGE).text(""),this.$el.removeClass(ButtonStates.CLASS_BADGED)},setBadgeCount:function(a){a<=0?this.clearBadge():this.setBadge(a)},setActiveStyle:function(a){this.$el.toggleClass(ButtonStates.CLASS_ACTIVE,a)},setSelectedStyle:function(a){this.$el.toggleClass(ButtonStates.CLASS_SELECTED,a)},isActive:function(){return this.$el.hasClass(ButtonStates.CLASS_ACTIVE)},showLoading:function(){this.disable(),(!this.options.borderless||this.options.show_spinner)&&P.Module.prototype.showLoading.call(this)},hideLoading:function(){this.enable(),(!this.options.borderless||this.options.show_spinner)&&P.Module.prototype.hideLoading.call(this)},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null},_getLabelModule:function(){return this.getChildById("label")},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/Button/Button.nunjucks")}),goog.provide("P.modules.CategoriesSelect"),goog.require("P.Module"),P.modules.CategoriesSelect=P.Module.extend({getValue:function(){return $.trim(this.$("option:selected").val())}}),goog.provide("P.modules.ClippedPinVisualObject"),goog.require("P.Module"),P.modules.ClippedPinVisualObject=P.Module.extend({}),goog.provide("P.modules.CloseupRichPinContentBase"),goog.require("P.Module"),P.modules.CloseupRichPinContentBase=P.Module.extend({getLoggingObjectIdStr:function(){return this.resource.id},onCreated:function(){this.childListen(P.CONST.EVENT_MAP_READY,this.onMapReady)},onMapReady:function(){var a=this.getChildById("map");a&&a.addMarkerToCloseupMap()}}),goog.provide("P.modules.ConfirmDialog"),goog.require("P.form"),goog.require("P.Module"),P.modules.ConfirmDialog=P.Module.extend({events:{"click .cancelButton":"onCloseClick","click .confirm":"onConfirmClick","change #confirmCheckbox":"onConfirmCheckboxChange"},returnData:null,onContentReady:function(){var a=this.$("form");a&&(this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(a,this.formConfig),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated));var b=this.options.auto_close_delay_ms;b&&this.closeOnDelay(b)},render:function(a){var b=this,c=function(){b.triggerEvent("rendered",b),a&&a()};if(!this.options.message)return P.Module.prototype.render.call(this,c);this.empty();var d='<form class="standardForm"><h1>'+P._("Oops!")+'</h1><p class="body">'+this.options.message+'</p><div class="formFooter"><div class="formFooterButtons"><button class="Button confirm btn primary rounded">'+P._("Okay")+"</button></div></div></form>";this.$el.append(d),c()},onConfirmCheckboxChange:function(){this.$("#confirmCheckbox").is(":checked")?this.$(".confirm").removeAttr("disabled"):this.$(".confirm").attr("disabled","disabled")},onSubmitValidated:function(a){if(!a.errors[0]){this.formData={};var b=this;_.each(this.returnData,function(a){b.formData[a]=b.form.getValue(a)}),this.confirm()}},onCloseClick:function(a){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,a.currentTarget,!0),this.close(),!1},close:function(){this.triggerEvent(P.CONST.EVENT_CLOSE,this),this.destroy()},closeOnDelay:function(a){this.closeTimer&&clearTimeout(this.closeTimer);var b=this;this.closeTimer=P.setTimeout(function(){b.closeTimer=null,b.destroy()},a)},open:function(){this.triggerEvent(P.CONST.EVENT_OPEN,this)},onConfirmClick:function(a){return this.triggerEvent(P.CONST.EVENT_DIALOG_BUTTON_CLICKED,a.currentTarget,!0),this.confirm(),!1},confirm:function(){this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_CONFIRM,this,!0),this.destroy()},setPrimaryButtonText:function(a){this.$(".primary .buttonText").text(a)},onDestroyed:function(){this.closeTimer&&clearTimeout(this.closeTimer)}}),goog.provide("P.modules.ConversationListItem"),goog.require("P.Module");var CONVERSATION_LIST_ITEM_ACTIVE_CLASS="active",CLASS_ANIMATING_OUT="animatingOut",CLASS_ANIMATED_OUT="animatedOut";P.modules.ConversationListItem=P.Module.extend({events:{click:"onListItemClick"},onListItemClick:function(a){var b=this.getChildById("hideConversation");if(b){var c=$(a.target);if(b.getContent().find(c).length){var d={conversation_id:this.data.id};this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!0,!0);var e=P.resourceFactory.create("ConversationResource",d);e.callDelete({error:P.NOOP});var f=this.$el;return f.addClass(CLASS_ANIMATING_OUT),void f.one("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",_.bindFn(function(){var a=this;f.addClass(CLASS_ANIMATED_OUT),window.setTimeout(function(){a.destroy(),a.remove(),a.triggerEvent(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,!1,!0),P.getConversationsManager().removeConversationById(a.data.id)},200)},this))}}var g=this.data;if(this.triggerEvent(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,g,!0),this.options.open_conversation_on_click){this.data.unread&&this.triggerEvent(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,null,!0),this.$el.removeClass("unread");var h=this.getChildById("conversationHead").getContent();P.getConversationsManager().animateConversationHeadToActiveConversations(h,g),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)}},setActive:function(a){this.$el.toggleClass(CONVERSATION_LIST_ITEM_ACTIVE_CLASS,a)},isActive:function(){return this.$el.hasClass(CONVERSATION_LIST_ITEM_ACTIVE_CLASS)},getUsers:function(){return this.data.users},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getOtherUsers:function(){var a=this.getUsers();return _.reject(a,function(a){return a.id===P.currentUser.get("id")})},getEmails:function(){return this.data.emails},getFirstUser:function(){var a=this.getOtherUsers();return a.length>0?a[0]:{id:this.getEmails()[0]}},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationListItem/ConversationListItem.nunjucks")}),goog.provide("P.modules.ConversationMessage"),goog.require("P.Module"),P.modules.ConversationMessage=P.Module.extend({moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationMessage/ConversationMessage.nunjucks")}),goog.provide("P.modules.ConversationMessages"),goog.require("P.Module"),goog.require("P.modules.ConversationMessage"),goog.require("P.ModuleRenderType"),P.modules.ConversationMessages=P.Module.extend({onCreated:function(){this._clientMessages=[]},onContentReady:function(){this.triggerEvent(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,null,!0)},appendTextMessage:function(a,b){var c=this,d=this._createMessageWrapper(),e={is_own_message:!0,text:a},f=new P.modules.ConversationMessage({options:e});f.render().then(function(){c._appendMessage(d,f),b&&b()})},_appendMessage:function(a,b){b.getContent().appendTo(a),a.appendTo(this.$el),this.$(".emptyState").remove(),this.$el.removeClass("empty"),this._clientMessages.push(b)},_createMessageWrapper:function(){return $('<li class="messageWrapper"></li>')},getBottomPosition:function(a){var b=this.children[this.children.length-a],c=b.getContent(),d=c.parent(),e=d.position().top;return e},fetchNewMessages:function(a,b){var c=this,d=P.resourceFactory.clone(this.resource);d.set("prepend",!1),d.resetBookmark(),a?(d.set("page_size",a),this.setResource(d),this.renderAdditional(P.ModuleRenderType.APPEND,function(){_.each(c._clientMessages,function(a){a.destroy()}),b()})):(this.setResource(d),this.render().then(function(){_.each(c._clientMessages,function(a){a.destroy()}),b()})),d=P.resourceFactory.clone(this.resource),d.set("page_size",15),this.setResource(d)},appendObjectMessage:function(a,b){var c=this,d=$('<li class="messageWrapper"></li>'),e={is_own_message:!0},f=new P.modules.ConversationMessage({options:e});f.render().then(function(){c._appendMessage(d,f),f.getContent().append(a).addClass("hasObject").appendTo(d),b&&b()})},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationMessages/ConversationMessages.nunjucks")}),goog.provide("P.modules.ConversationPopup"),goog.require("P.Module");var MIN_REQUEST_MORE_SCROLL_THRESHOLD=220,MAX_SCROLL_DISTANCE_TO_SCROLL_TO_BOTTOM_AFTER_MESSAGE=35;P.modules.ConversationPopup=P.Module.extend({mixins:[P.Mixins.PreventScroll],onCreated:function(){this._unseenMessageCount=0},onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_ENTER_PRESSED,this.onInputEnterPressed),this.childListen(P.CONST.EVENT_TEXT_INPUT_RESIZED,this.onInputSizeChanged),this.childListen(P.CONST.EVENT_CONVERSATION_MESSAGES_SCROLL,this.onConversationMessagesReady),this.startPreventingScroll(),this.listen(this,P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,this.onShownInDropdown),this.onMessagesScroll=_.bindFn(this.onMessagesScroll,this),this.onMessagesScroll=_.throttle(this.onMessagesScroll,200),this.scrollToLatest(),this._scrollListener=this.listen(this.getConversationMessagesList(),"scroll",this.onMessagesScroll)},onConversationMessagesReady:function(){this.showEmailSentIfNecessary(),this.scrollToLatest()},showEmailSentIfNecessary:function(){var a=this.data.emails||[],b=this.data.count;if(a.length>0&&b>0&&b<=6){var c=this.$(".emailSentText");c.show()}},getConversationMessagesList:function(){return this.$(".conversationMessagesList")},getConversationMessagesModule:function(){return this.getChildByModuleName("ConversationMessages")},onInputSizeChanged:function(a){if("textField"===a.target.id){var b=this.getChildById("textField").getHeight(),c=this.$(".messagesContainer");c.css("bottom",b+"px"),this.isScrolledToBottom()&&this.scrollToLatest()}},startPreventingScroll:function(){var a=this.getConversationMessagesModule();a&&this.startPreventScroll(this.getConversationMessagesList(),this.$(".messagesContent"))},_getSpinner:function(){return this.$(".spinner")},setUnseenMessageCount:function(a){this._unseenMessageCount=this._unseenMessageCount+a},onMessagesScroll:function(){var a=this;if(this._unseenMessageCount){var b=this.getConversationMessagesModule(),c=b.getBottomPosition(this._unseenMessageCount);c<=this.getConversationMessagesList().height()&&(this._unseenMessageCount=Math.max(this._unseenMessageCount-1,0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,1),this.triggerEvent(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,null,!0))}if(this.getConversationMessagesList().scrollTop()<=MIN_REQUEST_MORE_SCROLL_THRESHOLD){this._getSpinner().addClass("visible");var d=this.getConversationMessagesModule(),e=d.getHeight();d.resource.set("page_size",12),d.renderAdditional(P.ModuleRenderType.PREPEND,function(){var b=d.getHeight();a.startPreventingScroll(),a.getConversationMessagesList().scrollTop(b-e)},null,function(){a._getSpinner().removeClass("visible")})}},onShownInDropdown:function(){this.focus(),this.scrollToLatest()},getDropTarget:function(){return this.$(".dropTarget")},scrollToLatest:function(){this.getConversationMessagesModule()&&(this.getConversationMessagesList().scrollTop(this.getConversationMessagesModule().getHeight()),this.startPreventingScroll())},setDropTargetText:function(a){var b=this.getDropTarget(),c=b.find("p");c.text(a)},focus:function(){return this._focusInput()},_focusInput:function(){var a=this.getChildById("textField");a&&a.focus()},onInputEnterPressed:function(a){a.stopPropagation();var b=$.trim(a.target.getValue());b.length&&(this.sendMessage(b,null),this.clearInput())},clearInput:function(){var a=this.getChildById("textField");a.setValue("")},showDropTarget:function(){this.getDropTarget().addClass("visible")},hideDropTarget:function(){this.getDropTarget().removeClass("visible")},sendMessage:function(a,b){if(a||!_.isEmpty(b)){var c=this,d={conversation_id:this.options.id};a&&(d.text=a);var e=this.getConversationMessagesModule(),f=this.isScrolledToBottom(),g=P.NOOP;if(f&&(g=_.bindFn(this.scrollToLatest,this)),b){var h=b.data;d[h.type]=h.id,P.currentUser&&!P.currentUser.isWriteBanned()&&e.appendObjectMessage(b.getContent().clone(),g)}else P.currentUser&&!P.currentUser.isWriteBanned()&&e.appendTextMessage(a,g);var i=P.resourceFactory.create("ConversationMessagesResource",d);i.callCreate().then(function(){c.fetchNewMessages(1),c.focus()})}},isScrolledToBottom:function(){var a=this.getConversationMessagesList(),b=this.getConversationMessagesModule(),c=a.scrollTop(),d=a.height(),e=b.getHeight(),f=c+d+MAX_SCROLL_DISTANCE_TO_SCROLL_TO_BOTTOM_AFTER_MESSAGE;return f>=e},fetchNewMessages:function(a){var b=this.getConversationMessagesModule();if(b){var c=this.isScrolledToBottom();b.fetchNewMessages(a,_.bindFn(function(){this.showEmailSentIfNecessary(),c?this.scrollToLatest():this.ensureScrollbarFlash()},this))}},ensureScrollbarFlash:function(){var a=this.getConversationMessagesList();a.flashScrollbar()},renderMessages:function(){var a=this,b=this.getConversationMessagesModule();b&&b.fetchNewMessages(null,function(){this.showEmailSentIfNecessary(),a.scrollToLatest()})},onButtonClick:function(a){var b=a.target;"closeChatButton"===b.id&&(P.getConversationsManager().closeConversationById(this.options.id),a.stopPropagation())},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationPopup/ConversationPopup.nunjucks")}),goog.provide("P.modules.ConversationsList"),goog.require("P.Module"),P.modules.ConversationsList=P.Module.extend({onCreated:function(){this._preventRenderOnChange=!1,this.childListen(P.CONST.EVENT_CONVERSATIONS_PREVENT_CONVERSATIONS_RENDERING_ON_CHANGE,this.onPreventConversationsRenderingOnChange)},onPreventConversationsRenderingOnChange:function(a){this._preventRenderOnChange=a.data},onContentReady:function(){var a=!this.options.no_rerender;a&&!this.collectionListener&&(this.collectionUpdateHandler=_.debounce(_.bindFn(this.onCollectionAddRemoveChange,this),100),this.collectionListener=this.collection.on("add change remove",this.collectionUpdateHandler)),this.data.length||this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,null,!0)},onRemovedFromDom:function(){this.collectionListener&&this.collectionUpdateHandler&&this.collection.off("add change remove",this.collectionUpdateHandler)},onCollectionAddRemoveChange:function(){this.options.no_rerender||this._preventRenderOnChange||this.renderExistingData()},setListItemWithUserId:function(a,b){var c=this.getChildById("list"),d=c.children;_.each(d,function(c,e){_.each(c.data.users,function(c){c.id===a&&d[e].setActive(b)}),_.each(c.data.emails,function(c){c===a&&d[e].setActive(b)})})},fetchMore:function(){if(!this.rendering&&!this.resource.atEnd()){var a=this;this.rendering=!0,this.renderAdditional(P.ModuleRenderType.APPEND,function(){a.rendering=!1})}},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationsList/ConversationsList.nunjucks")}),goog.provide("P.modules.Counter"),goog.require("P.Module"),P.modules.Counter=P.Module.extend({setCount:function(a){this.options.count=a,this.render()},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/Counter/Counter.nunjucks")}),goog.provide("P.modules.DomainFeedPageContainerBase"),goog.require("P.Module"),P.modules.DomainFeedPageContainerBase=P.Module.extend({}),goog.provide("P.modules.EmailVerificationError"),goog.require("P.Module"),P.modules.EmailVerificationError=P.Module.extend({}),goog.provide("P.modules.FeedPageBase"),goog.require("P.Module"),P.modules.FeedPageBase=P.Module.extend({events:{}}),goog.provide("P.modules.FollowingSwitcher"),goog.require("P.Module"),P.modules.FollowingSwitcher=P.Module.extend({}),goog.provide("P.modules.GplusConnectButton"),goog.require("P.Module"),goog.require("P.modules.Button");var GPLUS_LOGIN_FAIL=P._("Oops! Log in with your Pinterest email and password first, then follow <a href='{{ help_link }}'>these instructions</a> to link your account to Google+."),GPLUS_ACCOUNT_NOT_LINKED=180,GPLUS_REDIRECT_URI="postmessage",SIGNUP_ACTION="signup";P.modules.GplusConnectButton=P.modules.Button.extend({onContentReady:function(){var a=this;this.readyForConnect=!1,P.gapi.get(function(b){b.signin.render(a.$el.get(0),{scope:a.extraData.gplusScope,clientid:a.extraData.gplusClientId,apppackagename:a.extraData.gplusAppPackageName,redirecturi:GPLUS_REDIRECT_URI,accesstype:"offline",cookiepolicy:"single_host_origin",callback:function(b){a.readyForConnect&&a.onSignInCallback(b),a.readyForConnect=!0}})})},onSignInCallback:function(a){var b=this,c=function(){b.showLoading(),b.onLoginSuccess(a)},d=function(c){b.onLoginError(c,a)},e={gplus_id_token:a.id_token},f=a.status;P.trackRegisterAction("register_gplus_attempt"),f.signed_in&&P.currentUser.login(e,c,d,null)},onLoginSuccess:function(){window.location.reload()},onLoginError:function(a,b){if(a.api_error_code===GPLUS_ACCOUNT_NOT_LINKED){var c=P.string.format(GPLUS_LOGIN_FAIL,{help_link:this.extraData.gplusErrorLink});P.showHtmlError(c)}else this.options.action===SIGNUP_ACTION&&(P.SessionStorage.setItem(P.CONST.SESSION_GPLUS_CODE,b.code),P.SessionStorage.setItem(P.CONST.SESSION_GPLUS_REDIRECT_URI,GPLUS_REDIRECT_URI),P.navigate("/join/register/gplus/"))}}),goog.provide("P.modules.GridFooter"),goog.require("P.Module");var SHOW_GRID_LOADING_CLASS="showGridLoading";P.modules.GridFooter=P.Module.extend({events:{"click .gridError .Button":"onTryAgainClick"},onTryAgainClick:function(a){this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,a,!0)},show:function(){this.$el.css("display","block")},_getErrorDiv:function(){return this.$el.find(".gridError")},showError:function(){var a=this._getErrorDiv();a.css("display","block")},hideError:function(){var a=this._getErrorDiv();a.css("display","none")},showGridLoading:function(){this.$el.addClass(SHOW_GRID_LOADING_CLASS)},hideGridLoading:function(){this.$el.removeClass(SHOW_GRID_LOADING_CLASS)}}),goog.provide("P.modules.GridItems"),goog.require("P.Module");var CLASS_ACTIVE_ITEM="activeItem",DEFAULT_MINIMUM_NUM_COLUMNS=P.CONST.MIN_COLUMNS,ITEM_HIDE_BUFFER=3e3,SORTABLE_ZINDEX=1e3,SORTABLE_ITEM_CLASS="gridSortable",MODULE_NAME_PIN="Pin",INITIAL_IMPRESSION_LOGGING_INTERVAL_MS=1e4,Direction={UP:0,DOWN:1},pxToInt=function(a){var b=parseInt(a.replace("px",""),10);return isNaN(b)?0:b},ItemInfo=function(a){this.childModule=a,this.top=null,this.height=null,this.bottom=null,this.$itemWrapper=a.getParentElement().closest(".item"),this.columnIndex=null,this.inDom=!0,this.initialImpressionReported=!1,this.impressionStart=null};ItemInfo.prototype={log:P.Logger.getLogger("ItemInfo"),_logHeightError:_.throttle(function(){},1e3),_logHeightRecovery:_.throttle(function(){this.log.warn("recovered from unexpected height value")},1e3),_calculateHeight:function(){this.height=this.$itemWrapper.height(),this.height<=0&&(this.$itemWrapper.appendTo(this.$itemWrapper.parent()),this.height=this.$itemWrapper.height(),this.height<=0?this._logHeightError():this._logHeightRecovery())},ensureHeightCalculated:function(){null===this.height&&this._calculateHeight()},recalculateHeight:function(){this.inDom?this._calculateHeight():this.log.error("Cannot calculate height because this item is not inDom")},setPosition:function(a,b){this.top=a,this.bottom=b},hasPosition:function(){return null!==this.top}};var VariableHeightLayoutManager=function(a,b){this.gridItems=a,this.options=b,this.shortestColumnIndex=0,this.columnLengths=[],this.childCidToItemInfo={};
var c=this;_.each(this.gridItems.children,function(a){c.childCidToItemInfo[a.cid]=new ItemInfo(a)}),this._flushItemsToShow=this._flushItemsToShow.bind(this),this._flushItemsToHide=this._flushItemsToHide.bind(this),this.lastKnownItemInfosInViewport=[],this._itemsToHide={},this._itemsToShow={},this._ITEMS_TO_HIDE_THRESHOLD=50};VariableHeightLayoutManager.prototype={getFilledHeight:function(){return this.columnLengths[this.shortestColumnIndex]},onChildRendered:function(a){this._reflowOnChildChanged(a)},onChildAdded:function(a){this.childCidToItemInfo[a.cid]=new ItemInfo(a)},onChildRemoved:function(a,b){if(!this.gridItems.isEmptying){b.remove();var c=this.childCidToItemInfo[a.cid],d=c.columnIndex;delete this.childCidToItemInfo[a.cid],this._reflowColumnContent(d)}},empty:function(){this.childCidToItemInfo={}},onChildContentChanged:function(a){this._reflowOnChildChanged(a)},onChildDimsChanged:function(a){this._reflowOnChildChanged(a,!1)},_reflowOnChildChanged:function(a,b){var c=this.childCidToItemInfo[a.cid];c.recalculateHeight(),this._reflowColumnContent(c.columnIndex,b)},_reflowColumnContent:function(a,b){void 0===b&&(b=this.options.reflow_all),b?this.positionGrid():this._repositionItemsInColumn(a)},_calculateNumColumns:function(){var a=this.options.minimum_num_columns||DEFAULT_MINIMUM_NUM_COLUMNS;if(!this.itemWidth)return a;this.options.centered||this.gridItems.$el.css("width","auto");var b=this.gridItems.getWidth(!1),c=Math.floor(b/this.itemWidth);return Math.max(a,c)},_positionItemInColumn:function(a,b){if(this.gridItems.isReady()){var c=this.childCidToItemInfo[a.cid],d=c.$itemWrapper;b=Math.max(0,b),b=Math.min(this.columnLengths.length-1,b);var e=this.columnLengths[b];d.css({top:e+"px",left:b*this.itemWidth+"px",visibility:"visible"}),c.columnIndex=b;var f=c.height+this.topBuffer+this.bottomBuffer,g=e+f;c.setPosition(e,g),this.columnLengths[b]=g,this._setShortestColumnIndex()}},_positionItem:function(a){if(this.gridItems.isReady()){if(0===this.columnLengths.length){if(!this.itemWidth){var b=this.childCidToItemInfo[a.cid],c=b.$itemWrapper;this.itemWidth=c.outerWidth(!0);var d=c.css("margin-top"),e=c.css("padding-top"),f=c.css("margin-bottom"),g=c.css("padding-bottom");this.topBuffer=pxToInt(d)+pxToInt(e),this.bottomBuffer=pxToInt(f)+pxToInt(g)}var h=this._calculateNumColumns();this.options.centered||this.gridItems.$el.css("width",h*this.itemWidth),this.columnLengths=new Array(h),this._setShortestColumnIndex()}var i=this.shortestColumnIndex;this._positionItemInColumn(a,i)}},_setShortestColumnIndex:function(){this.shortestColumnIndex=0;for(var a=0;a<this.columnLengths.length;a++)this.columnLengths[a]=this.columnLengths[a]||0,this.columnLengths[a]<this.columnLengths[this.shortestColumnIndex]&&(this.shortestColumnIndex=a)},_repositionItemsInColumn:function(a){if(this.gridItems.isReady()){var b=this;this.columnLengths[a]=0;var c=_.filter(this.childCidToItemInfo,function(b){return b.columnIndex===a}),d=_.sortBy(c,function(a){return a.top});_.each(d,function(c){b._positionItemInColumn(c.childModule,a)}),this.resizeContainer()}},resizeGrid:function(){var a=this.columnLengths.length,b=this._calculateNumColumns();a!==b&&(this.positionGridChildren(),this.gridItems.rearrangeItems(!0),this.gridItems.scheduleImpressionLogging())},resizeContainer:function(){var a=Math.max.apply(Math,this.columnLengths);this.gridItems.$el.css("height",a+"px"),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},positionGrid:function(){this.gridItems.isReady()&&(this.positionGridChildren(),this.gridItems.rearrangeItems(),this.gridItems.scheduleImpressionLogging())},positionGridChildren:function(a){if(this.gridItems.isReady()){var b=this;a||(this.columnLengths=[]),_.each(this.gridItems.children,function(a){var c=b.childCidToItemInfo[a.cid];c.ensureHeightCalculated()}),_.each(this.gridItems.children,function(c){var d=b.childCidToItemInfo[c.cid];a&&d.hasPosition()||b._positionItem(d.childModule)}),this.resizeContainer()}},hideAndShowItems:function(a,b,c,d,e){var f;for(f in this.childCidToItemInfo){var g=this.childCidToItemInfo[f],h=g.$itemWrapper[0];g.bottom<d?a&&g.inDom&&(b||c!==Direction.DOWN||(this._itemsToHide[f]=h,delete this._itemsToShow[f],g.inDom=!1)):g.top>e?a&&g.inDom&&(b||c!==Direction.UP||(this._itemsToHide[f]=h,delete this._itemsToShow[f],g.inDom=!1)):g.inDom||(this._itemsToShow[f]=h,delete this._itemsToHide[f],g.inDom=!0)}Object.keys(this._itemsToShow).length&&P.deferDomManipulation(this._flushItemsToShow),Object.keys(this._itemsToHide).length>this._ITEMS_TO_HIDE_THRESHOLD&&P.deferDomManipulation(this._flushItemsToHide)},_flushItemsToShow:function(){var a;this.gridItems.log.debug("_flushItemsToShow: showing ",Object.keys(this._itemsToShow).length);var b=document.createDocumentFragment();for(a in this._itemsToShow)b.appendChild(this._itemsToShow[a]);this.gridItems.$el[0].appendChild(b),this._itemsToShow={}},_flushItemsToHide:function(){var a;this.gridItems.log.debug("_flushItemsToHide: hiding ",Object.keys(this._itemsToHide).length);for(a in this._itemsToHide){var b=this._itemsToHide[a];b.parentNode&&b.parentNode.removeChild(b)}this._itemsToHide={}},logImpressions:function(a,b){var c=this._getItemsInViewport(a,b),d=_.difference(this.lastKnownItemInfosInViewport,c);this.lastKnownItemInfosInViewport=c,this._reportImpressions(d,!1)},logInitialImpressions:function(a,b){var c=this._getItemsInViewport(a,b),d=_.intersection(this.knownItemInfosInLastInterval,c);this.knownItemInfosInLastInterval=c,this._reportImpressions(d,!0)},_getItemsInViewport:function(a,b){var c=[],d=this;return _.each(this.childCidToItemInfo,function(e){var f=e.top+d.topBuffer,g=e.bottom-d.bottomBuffer,h=!(f>=b||g<=a);h&&(c.push(e),null==e.impressionStart&&(e.impressionStart=Date.now()))}),c},flushImpressions:function(){this._reportImpressions(this.lastKnownItemInfosInViewport,!1)},_reportImpressions:function(a,b){var c=a;b&&(c=_.filter(c,function(a){return!a.initialImpressionReported}));for(var d=[],e=0;e<c.length;e++){var f=c[e];if(f.childModule.className===MODULE_NAME_PIN){var g=f.childModule.getLoggingObjectIdStr();if(g){var h=f.childModule.getGridIndex();d.push({time:1e6*f.impressionStart,pinIdStr:g,endTime:1e6*Date.now(),yPosition:f.top,columnIndex:f.columnIndex,slotIndex:h}),b&&(f.initialImpressionReported=!0)}}}if(d.length){var i=this.options.impression_event_type||P.ContextLogging.EventType.PIN_IMPRESSION_ONE_PIXEL,j=P.ContextEvent.fromEventType(i);j.setPinImpressions(d),this.options.impression_metadata&&j.updateAuxData(this.options.impression_metadata),P.ContextLogger.getInstance().addEvent(j)}}};var FixedHeightLayoutManager=function(a,b){this.gridItems=a,this.options=b};FixedHeightLayoutManager.prototype={resizeGrid:function(){},onChildContentChanged:function(){},onChildDimsChanged:function(){},onChildRendered:function(){},onChildAdded:function(){},positionGridChildren:function(){},empty:function(){},positionGrid:function(){this.gridItems.isReady()&&this.gridItems._requestMoreItemsIfNeeded()},hideAndShowItems:function(){},onChildRemoved:function(a,b){b.remove(),this.gridItems.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getFilledHeight:function(){var a=this.gridItems.getWidth(!1),b=this.gridItems.children.length;if(0===b)return 0;var c=this.gridItems.children[0],d=c.$el.outerWidth(!0),e=c.$el.outerHeight(!0),f=Math.floor(a/d),g=Math.ceil(b/f),h=b%f!==0,i=g*e;return h&&(i-=e),i},logImpressions:P.NOOP,flushImpressions:P.NOOP};var CloudGridLayoutManager=function(a,b){this.gridItems=a,this.options=b,this.$gridEl=this.gridItems.$el,this.$gridEl.grid({children:[],gridGutter:this.options.layout_manager_options.grid_gutter,gridSize:this.options.layout_manager_options.grid_size,setChildPosition:function(a,b){var c=a.parent();c.css(b)},unsetChildPosition:function(a){var b=a.parent();b.css({left:"auto",top:"auto"})},setChildProperties:function(a,b){a.css(b);var c=a.parent();c.css({visibility:"visible"})},unsetChildProperties:function(a){var b=a.parent();b.css({visibility:"hidden"})},maxRows:this.options.layout_manager_options.max_rows});var c=this;_.each(this.gridItems.children,function(a){c.$gridEl.grid("appendChild",a.$el,!0)})};CloudGridLayoutManager.prototype={resizeGrid:function(){this.positionGridChildren(!1)},onChildContentChanged:function(){this.positionGridChildren(!1)},onChildDimsChanged:function(){this.positionGridChildren(!1)},onChildRendered:function(){},onChildAdded:function(a){this.$gridEl.grid("appendChild",a.$el,!0)},positionGridChildren:function(a){this.$gridEl.grid("reflowContent",a)},empty:function(){},positionGrid:function(){this.positionGridChildren(!1)},hideAndShowItems:function(){},onChildRemoved:function(){},getFilledHeight:function(){return this.$gridEl.grid("getFilledHeight")},logImpressions:P.NOOP,flushImpressions:P.NOOP};var DragManager=function(a,b){var c=this;this.gridItems=a,b||(b={}),b=_.extend({appendTo:$(".App"),cursor:"move",distance:3,helper:"clone",scroll:!1,handle:".draggable",revert:!1,drag:function(a,b){var c=parseInt($(this).data("startingScrollTop"),10);b.position.top-=c;var d=a.clientX-b.position.left,e=window.pageYOffset+a.clientY-b.position.top,f=b.helper.height(),g=b.helper.width(),h=d/g*100,i=e/f*100,j=""+h+"% "+i+"%";b.helper.css("transformOrigin",j)},start:function(a){var b=c.gridItems.getChildByElement($(a.target).find(".Module"));b&&P.getConversationsManager().setDraggedObject(b),$(this).data("startingScrollTop",window.pageYOffset-P.CONST.PIN_MARGIN)},stop:function(a,b){var c=parseInt($(this).data("startingScrollTop"),10);P.getConversationsManager().setDraggedObject(null),b.position.top-=c}},b),void 0!==$.fn.draggable&&this.gridItems.$(".item").draggable(b)};DragManager.prototype={enable:function(){this.gridItems.$(".item").draggable("enable")},disable:function(){this.gridItems.$(".item").draggable("disable")}};var SortManager=function(a,b,c,d){this.gridItems=a,b||(b={}),b=_.extend({containment:"parent",cursor:"move",items:"."+SORTABLE_ITEM_CLASS,tolerance:"pointer",zIndex:SORTABLE_ZINDEX},b),this.gridItems.$el.sortable(b),this.childModuleName=c,this.idFn=d,this._setSortableMetadata(),this._hasNewElements=!0};SortManager.prototype={_setSortableMetadata:function(){var a=this;_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(b){a._addSortableItemClass(b)})},_addSortableItemClass:function(a){var b=a.getParentElement();b.addClass(SORTABLE_ITEM_CLASS)},onChildAdded:function(a){this._addSortableItemClass(a),this._hasNewElements=!0},getSortOrder:function(){var a=this.idFn,b=[];return this._hasNewElements&&(_.each(this.gridItems.getChildrenByModuleName(this.childModuleName),function(b){b.$el.attr("data-sort-id")||b.$el.attr("data-sort-id",a(b))}),this._hasNewElements=!1),_.each(this.gridItems.$el.find("."+this.childModuleName),function(a){b.push($(a).attr("data-sort-id"))}),b}};var GridItems=P.Module.extend({events:{"click .trackActiveItem .item":"onTrackItemClick","click .itemClickMask":"onItemMaskClick"},mixins:[P.Mixins.PreventScroll],onChildNavigate:function(a){var b=a.currentTarget;this.updateActiveItem(b.getParentElement()),this.signupShownOnce||!a.data.url.match("^/pin/[0-9]+/$")||"Pin"!==a.target.className||"boardPinsGrid"===a.target.options.view_type||P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_clickthrough_prompted_signup",["control_3","can_dismiss_no_skip_3","cannot_dismiss_3"])||P.experiments.instance.inExperimentGroupsActiveOrTriggerable("board_signup",["control_2","no_scroll_small_2","scroll_small_2"])||P.showSignupPromptForExperiment("pin_closeup_prompted_signup","click_pin_closeup",P._("Sign up to get more details about this Pin and discover more great ideas"))&&(this.signupShownOnce=!0,a.stopPropagation())},onItemMaskClick:function(a){var b=$(a.currentTarget),c=b.next(),d=this.getChildByElement(c[0]);return d?void this.triggerEvent(P.CONST.EVENT_GRID_ITEM_SELECTED,{module:d},!0):void this.log.error("cannot find selected child module.")},onTrackItemClick:function(a){var b=a.currentTarget;this.updateActiveItem($(b))},updateActiveItem:function(a){var b=this.$(".activeItem");b.removeClass(CLASS_ACTIVE_ITEM),a.addClass(CLASS_ACTIVE_ITEM)},onCreated:function(){this._scrollListener=null,this._scrollStopListener=null,this.alreadyInitialized=!1,this.scrollTop=0,this.lastScrollTop=null,this.viewableHeight=null,this.lastTopBorder=null,this.lastBottomBorder=null,this.layoutManager=null,this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_DIMS_CHANGED,this.onChildDimsChanged)},initializeSortManager:function(a,b,c){this.sortManager=new SortManager(this,a,b,c)},initializeDragManager:function(a){this.dragManager=new DragManager(this,a)},enableDragging:function(){this.dragManager&&this.dragManager.enable()},disableDragging:function(){this.dragManager&&this.dragManager.disable()},getSortOrder:function(a,b){return this.sortManager?this.sortManager.getSortOrder(a,b):void 0},getChildModuleAtIndex:function(a,b){var c=this.children[a];return c&&c.className===b?c:null},getChildren:function(){return this.children},onOptionsChanged:function(){this._setScrollableElement(),this.alreadyInitialized=!1},onResourceChanged:function(){this.alreadyInitialized=!1},prependChildItem:function(a){var b=0;this.children.length>0&&this.children[0].options.anchored&&(b=1);var c;this.children.length>b&&(c=this.children[b].$el.parent()),this.insertChildBefore(a,this.$el,b,c),this.layoutManager.positionGrid()},prependNewItems:function(a,b){var c=this,d=0,e=P.resourceFactory.clone(this.resource);e.resetBookmark(),e.set("prepend",!1),e.set("page_size",a);var f=new GridItems({resource:e});this.children.length>0&&this.children[0].options.anchored&&(d=1),f.options=this.options,f.render(function(){_.each(f.children.reverse(),function(a){a.remove(),c.insertChild(a,c.$el,d)}),c.layoutManager.positionGrid(),b&&b()})},requestMoreItems:function(){this.isReady()&&this._requestMoreItems()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},_triggerIfItemsEnd:function(){this.hasMoreItems()||this.triggerEvent(P.CONST.EVENT_ITEMS_END,null,!0)},setPageSize:function(a){this.resource&&this.resource.set("page_size",a)},setHasScroll:function(a){this.$el.toggleClass("hasScroll",a)},onAddedToDom:function(){this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize),this.navigateListener=this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this._setUpGrid(),this.onResize(),this.signupShownOnce=!1},onResize:function(){this.isReady()&&this.layoutManager.resizeGrid()},hasItems:function(){return this.children.length>0},onContentReady:function(){this.$el.removeClass("loadingItems");var a=this.options.layout;if(a&&"variable_height"!==a)if("fixed_height"===a)this.layoutManager=new FixedHeightLayoutManager(this,this.options);else{if("cloud_grid"!==a)return void this.log.error('GridItems invalid value for "layout"',a);this.layoutManager=new CloudGridLayoutManager(this,this.options)}else this.layoutManager=new VariableHeightLayoutManager(this,this.options);this._setUpGrid(),this._triggerIfItemsEnd(),P.setInterval(_.bindFn(this.scheduleInitialImpressions,this),INITIAL_IMPRESSION_LOGGING_INTERVAL_MS)},onRemovedFromDom:function(){this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.stopPreventScroll(),this.layoutManager&&this.layoutManager.flushImpressions(),this.navigateListener&&this.removeListener(this.navigateListener),this.resizeListener&&this.removeListener(this.resizeListener)},scrollToActiveItem:function(a){var b=a.height(),c=this.$(".activeItem"),d=c.offset().top;a.scrollTop(d-b)},onChildContentChanged:function(a){a.stopPropagation();var b=a.currentTarget;this.isReady()&&(this.layoutManager.onChildContentChanged(b),this.rearrangeItems(!0),this.scheduleImpressionLogging())},onChildDimsChanged:function(a){a.stopPropagation();var b=a.currentTarget;this.isReady()&&this.layoutManager.onChildDimsChanged(b)},onChildRendered:function(a){this.isReady()&&this.layoutManager.onChildRendered(a)},onChildAdded:function(a){var b=a.getParentElement();if(!b.hasClass("item")){var c=$("<div></div>").addClass("item");c.insertBefore(a.$el),c.append(a.$el),b=c}this.layoutManager&&this.layoutManager.onChildAdded(a),this.sortManager&&this.sortManager.onChildAdded(a)},onChildRemoved:function(a,b){this.layoutManager&&this.layoutManager.onChildRemoved(a,b)},empty:function(){this.isEmptying=!0,P.Module.prototype.empty.call(this),this.alreadyInitialized=!1,this.contentReady=!1,this.layoutManager&&this.layoutManager.empty(),this.isEmptying=!1},handleError:function(a){this.pendingMoreRequest?this.$(".errorMessage").remove():P.Module.prototype.handleError.call(this,a)},_setUpGrid:function(){this._setScrollableElement(),this.isReady()&&!this.alreadyInitialized&&(this.layoutManager.positionGrid(),this.alreadyInitialized=!0,this._computeScrollableHeightAndOffset())},_setScrollableElement:function(){var a=_.throttle(this._onScroll,16),b=_.debounce(this._onScrollStop,2e3);this._scrollListener&&(this.removeListener(this._scrollListener),this._scrollListener=null),this._scrollStopListener&&(this.removeListener(this._scrollStopListener),this._scrollStopListener=null),this.scrollableElement=this.getScrollableElement(),this.options.scrollable&&(this._scrollListener=this.listen(this.scrollableElement,"scroll",a),this._scrollStopListener=this.listen(this.scrollableElement,"scroll",b)),this._preventDefaultIfNeeded()},isReady:function(){return this.inDom&&this.contentReady},rearrangeItems:function(a){this._requestMoreItemsIfNeeded(),this._hideAndShowItems(a)},_onScroll:function(){this.lastScrollTop=this.scrollTop,this.scrollTop=this.getScrollableElement().scrollTop(),this.lastScrollTop!==this.scrollTop&&(this.rearrangeItems(!0),this.scheduleImpressionLogging())},_onScrollStop:function(){this.layoutManager._flushItemsToHide&&P.deferDomManipulation(this.layoutManager._flushItemsToHide)},scheduleImpressionLogging:function(){this.options.track_item_impressions&&(this._impressionLoggingScheduled||(this._impressionLoggingScheduled=!0,P.deferDomManipulation(_.bindFn(function(){this._impressionLoggingScheduled=!1;var a=this.scrollTop-this.offsetFromScrollElement,b=a+this.viewableHeight;this.layoutManager.logImpressions(a,b)},this))))},scheduleInitialImpressions:function(){if(this.options.track_item_impressions){var a=this.scrollTop-this.offsetFromScrollElement,b=a+this.viewableHeight;this.layoutManager.logInitialImpressions(a,b)}},_hideAndShowItems:function(a){if(this.options.virtualize){a=a||!1;var b=!this.lastScrollTop||this.scrollTop>=this.lastScrollTop?Direction.DOWN:Direction.UP,c=this.scrollTop-this.offsetFromScrollElement,d=c+this.viewableHeight,e=c-ITEM_HIDE_BUFFER,f=d+ITEM_HIDE_BUFFER,g=null===this.lastTopBorder||null===this.lastBottomBorder||c<this.lastTopBorder||d>this.lastBottomBorder;(g||a)&&(this.layoutManager.hideAndShowItems(a,this.pendingMoreRequest,b,e,f),this.lastTopBorder=e,this.lastBottomBorder=f)}},onRendered:function(){this._requestMoreItemsIfNeeded(),P.Module.prototype.onRendered()},_computeScrollableHeightAndOffset:function(){this.viewableHeight=this.scrollableElement.height(),this.offsetFromScrollElement=this.$el.positionAncestor(this.scrollableElement).top},_requestMoreItemsIfNeeded:function(){if(this.isReady()&&this.options.scrollable&&!this.pendingMoreRequest&&!this.hasError&&this.hasMoreItems()){this._computeScrollableHeightAndOffset();var a=this.offsetFromScrollElement+this.layoutManager.getFilledHeight();a-(this.viewableHeight+this.scrollTop)>2*this.viewableHeight||this._requestMoreItems()}},_requestMoreItems:function(a){_.isUndefined(a)&&(a=2),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),this.pendingMoreRequest=!0;var b=this,c=this.renderAdditional(P.ModuleRenderType.APPEND,function(){b.layoutManager.positionGridChildren(!0),b.pendingMoreRequest=!1,b.hasError&&(b.triggerEvent(P.CONST.EVENT_ERROR_RESOLVED,null,!0),b.hasError=!1),b.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0),b._requestMoreItemsIfNeeded(),b._triggerIfItemsEnd(),b.scheduleImpressionLogging()},function(){a>0?b._requestMoreItems(a-1):(b.pendingMoreRequest=!1,b.hasError=!0,b.triggerEvent(P.CONST.EVENT_ERROR,null,!0),b._triggerIfItemsEnd())});return c||(b.pendingMoreRequest=!1),c},_preventDefaultIfNeeded:function(){this.options.prevent_default_scroll&&this.startPreventScroll(this.scrollableElement,this.$el)}});P.modules.GridItems=GridItems,goog.provide("P.modules.HeroHelperBase"),goog.require("P.Module");var BUTTON_ID_CLOSE="close",HIDE_DELAY_MILLISECONDS=1e3;P.modules.HeroHelperBase=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick),this.placementId=Number(this.options.placement_id),this.experienceId=Number(this.options.experience_id),this.placedExperienceId=this.options.placed_experience_id,this.setExperienceViewed()},hide:function(){var a=this;this.fadeOut(function(){a.destroy()})},dismiss:function(a){P.trackGAEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CLOSE),this.dismissPlacedExperience(),a||this.hide()},complete:function(a){var b=this;P.trackGAEvent("hero_helper_"+this.options.type,P.CONST.GA_ACTION_CLICK_CONFIRM),this.completePlacedExperience(),a||(this.options.delay_hide?P.setTimeout(function(){b.hide()},HIDE_DELAY_MILLISECONDS):this.hide())},setExperienceViewed:function(){P.trackGAEvent("hero_helper_"+this.options.type,"viewed");var a=P.ExperienceManager.instance();this.placedExperienceId?a.viewPlacedExperienceId(this.placedExperienceId):a.viewPlacedExperience(this.placementId,this.experienceId)},completePlacedExperience:function(a){var b=P.ExperienceManager.instance();this.placedExperienceId?b.completePlacedExperienceId(this.placedExperienceId,a):b.completePlacedExperience(this.placementId,this.experienceId,a)},dismissPlacedExperience:function(a){var b=P.ExperienceManager.instance();this.placedExperienceId?b.dismissPlacedExperienceId(this.placedExperienceId,a):b.dismissPlacedExperience(this.placementId,this.experienceId,a)},onButtonClick:function(){},_onButtonClick:function(a){this.onButtonClick(a);var b=a.target;b.id===BUTTON_ID_CLOSE&&this.dismiss()}}),goog.provide("P.modules.HeroPlacePinsBase"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroPlacePinsBase=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HeroPlacePinsExamplesBase"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroPlacePinsExamplesBase=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HeroScooterPinnerStory"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroScooterPinnerStory=P.modules.HeroHelperBase.extend({onContentReady:function(){P.modules.HeroHelperBase.prototype.onContentReady.apply(this,arguments),this.placedExperienceId=P.ExperienceManager.instance().constructPlacedExperienceId(this.placementId,this.experienceId)}}),goog.provide("P.modules.Image"),goog.require("P.Module"),P.modules.Image=P.Module.extend({}),goog.provide("P.modules.ImagesFeedPageBase"),goog.require("P.Module"),P.modules.ImagesFeedPageBase=P.Module.extend({}),goog.provide("P.modules.InterestFeedPageBase"),goog.require("P.Module"),P.modules.InterestFeedPageBase=P.Module.extend({}),goog.provide("P.modules.LikeButton"),goog.require("P.Module"),goog.require("P.modules.Button");var CLASS_UNLIKE="unlike";P.modules.LikeButton=P.modules.Button.extend({onClick:function(){this.ensureAuthentication()&&this._toggle()},getAuthRedirectUrl:function(){return P.getRegisterUrl({action:"like"})},setState:function(a){var b=this.$el;this.options.liked=a,a?(b.addClass(CLASS_UNLIKE),this.$(".buttonText").html(b.data("text-unlike"))):(b.removeClass(CLASS_UNLIKE),this.$(".buttonText").html(b.data("text-like")))},getLikeResource:function(){return null},onOptimisticToggle:function(){},onToggleSuccess:function(){},_toggle:function(){var a=!this.options.liked,b=this.getLikeResource(a);if(b){var c,d=this,e=a?"create":"delete";this.options.optimistic?(this.setState(a),this.onOptimisticToggle(a),c={success:function(){d.onToggleSuccess(a)},error:function(){d.setState(!a)}}):(this.showLoading(),c={success:function(){d.setState(a),d.onToggleSuccess(a)},complete:function(){d.hideLoading()}}),b.call(e,c)}},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/LikeButton/LikeButton.nunjucks")}),goog.provide("P.modules.List"),goog.require("P.Module"),P.modules.List=P.Module.extend({events:{"click li":"onItemClick"},onItemClick:function(a){this.triggerEvent(P.CONST.EVENT_LIST_ITEM_CLICK,a.target,!1)},onChildRemoved:function(a,b){b.remove()},hasMoreItems:function(){return this.resource&&!this.resource.atEnd()},requestMoreItems:function(){this._requestMoreItems()},_requestMoreItems:function(a){_.isUndefined(a)&&(a=2),this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0);var b=this;this.renderAdditional(P.ModuleRenderType.APPEND,function(){b.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0)},function(){a>0&&b._requestMoreItems(a-1),b.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_ERROR,null,!0)})},onChildAdded:function(a){var b=a.getContent(),c=b.parent(),d=this.options.list_item_class_name||"";if("LI"!==c.prop("tagName")||d&&!c.hasClass(d)){var e=$("<li></li>").addClass(d);e.insertBefore(b),e.append(b)}},setPageSize:function(a){this.resource&&this.resource.set("page_size",a)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/List/List.nunjucks")}),goog.provide("P.modules.LoginBase"),goog.require("P.Module"),P.modules.LoginBase=P.Module.extend({events:{},onContentReady:function(){if(P.getQueryStringParams().message&&"reactivate"===P.getQueryStringParams().message){var a=P._("Your account has been reactivated!  Please log in to continue.");this.showError(a)}this.setupForm(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.getChildById("facebookLogin")&&this.listen(this.getChildById("facebookLogin"),P.CONST.EVENT_BUTTON_CLICK,this.facebookConnect),this.getChildById("twitterLogin")&&this.listen(this.getChildById("twitterLogin"),P.CONST.EVENT_BUTTON_CLICK,this.twitterConnect),this.getChildById("rakutenLogin")&&this.listen(this.getChildById("rakutenLogin"),P.CONST.EVENT_BUTTON_CLICK,this.rakutenConnect),this.getChildById("emailSignup")&&this.listen(this.getChildById("emailSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onEmailSignup),this.getChildById("facebookSignup")&&this.listen(this.getChildById("facebookSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onFacebookSignup),this.getChildById("twitterSignup")&&this.listen(this.getChildById("twitterSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onTwitterSignup),this.getChildById("rakutenSignup")&&this.listen(this.getChildById("rakutenSignup"),P.CONST.EVENT_BUTTON_CLICK,this.onRakutenSignup),P.trackRegisterAction("register_landing")},setupForm:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{username_or_email:[P.Validator.Required(),P.Validator.Email()],password:[P.Validator.Required()]},{})},onSubmitValidated:function(a){a["errors[0]"]||this.login({username_or_email:this.form.getValue("username_or_email"),password:this.form.getValue("password")})},twitterConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.TWITTER,this.onTwitterConnectSuccess)},facebookConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.FACEBOOK,this.onFacebookConnectSuccess)},rakutenConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.RAKUTEN,this.onRakutenConnectSuccess)},onEmailSignup:function(){P.trackRegisterAction("register_email")},onFacebookSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_facebook_attempt"),this.facebookConnect(a)},onTwitterSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_twitter_attempt"),this.twitterConnect(a)},onRakutenSignup:function(a){a.stopPropagation(),P.trackRegisterAction("register_rakuten_attempt"),this.rakutenConnect(a)},onFacebookConnectSuccess:function(a){var b=this,c=function(a){a.message&&P.showError(a.message)},d=this.getChildById("facebookSignup");if(this.options.register){var e="/";this.options.auto_follow_interest&&(e=P.url.appendQueryString(e,{auto_follow_interest:this.options.auto_follow_interest})),c=function(){return d.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.FACEBOOK).then(function(){d.hideLoading(),P.changeWindowLocation(e,!1)},function(){d.hideLoading(),b.navigate("/join/register/facebook/")}),P.NOOP}}this.login({facebook_id:a.id,facebook_token:a.access_token},c)},onTwitterConnectSuccess:function(a){var b=function(a){a.message&&P.showError(a.message)};P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_ID,a.id),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN,a.oauth_token),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_TOKEN_SECRET,a.oauth_secret),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_FIRST_NAME,a.first_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_LAST_NAME,a.last_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_USERNAME,a.screen_name),P.SessionStorage.setItem(P.CONST.SESSION_TWITTER_IMAGE_URL,a.image_url),this.options.register?this.navigate("/join/register/twitter/"):this.login({twitter_id:a.id,twitter_token:a.oauth_token,twitter_token_secret:a.oauth_secret},b)},onRakutenConnectSuccess:function(a){var b=function(a){a.message&&P.showError(a.message)};if(P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_ID,a.id),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_TOKEN,a.access_token),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN,a.refresh_token),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME,a.first_name),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_GENDER,a.gender),P.SessionStorage.setItem(P.CONST.SESSION_RAKUTEN_EMAIL,a.email),this.options.register){var c=this.getChildById("rakutenSignup");b=function(){return c.showLoading(),P.UserRegistration.fastTrackSocialRegistration(P.SocialConnect.RAKUTEN).then(function(){c.hideLoading(),P.changeWindowLocation("/",!1)},function(){c.hideLoading(),this.navigate("/join/register/rakuten/")}),P.NOOP}}this.login({rakuten_id:a.id,rakuten_token:a.access_token,rakuten_refresh_token:a.refresh_token},b)},showError:function(a){this.$(".loginError").html("<p>"+a+"</p>").show()},connect:function(a,b){var c=P.SocialConnect.instance(),d=this;return c.connect(a,{success:function(a){b.call(d,a)},error:function(){P.showError(P.string.common.connectError)}}),!1},autoFollowInterest:function(a){var b={interest_list:"favorited",interest:a},c="InterestFollowResource",d="interest_auto_follow",e=P.resourceFactory.create(c,b);e.callCreate({success:function(){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS)},error:function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)}})},login:function(a,b,c){var d=this.getChildById("loginButton");d&&d.showLoading();var e=P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW),f=this;void 0===c&&(c=function(){f.showLoading(!0),f.options.auto_follow_interest&&f.autoFollowInterest(f.options.auto_follow_interest),f.redirect(e)}),b||(b=function(b){if(f.showError(b.message),b.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE&&a.username_or_email){var c=P.getResetPasswordOneClickUrl({username_or_email:a.username_or_email});f.navigate(c)}});var g=function(){d&&d.hideLoading()};P.currentUser.login(a,c,b,g)},redirect:function(a){var b="/";a&&(a.invite_follow_user?b="/"+a.invite_follow_user+"/":a.invite_follow_board&&(b="/"+a.invite_follow_board+"/"),P.SessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW));var c=this.options.next||b;this.options.auto_follow_interest&&(c=P.url.appendQueryString("/explore/"+this.options.auto_follow_interest,{auto_follow:"true"})),P.navigateAfterLoginStatusChange(c)}}),goog.provide("P.modules.LoginPageBase"),goog.require("P.Module"),P.modules.LoginPageBase=P.Module.extend({events:{}}),goog.provide("P.modules.LogoutPage"),goog.require("P.Module"),P.modules.LogoutPage=P.Module.extend({events:{},onContentReady:function(){this.logout()
},logout:function(){var a=P.resourceFactory.create("UserSessionResource",{disable_auth_failure_redirect:!0}),b=this.options.next||"/",c=P.currentUser.get("username");a.callDelete({success:function(){P.SessionStorage.clear(),P.LocalStorage.clear(),P.currentUser.logout(function(){if("/"!==b)P.navigateAfterLoginStatusChange(b);else{var a=b+"?username="+c;P.trackRegisterAction("app_install_logout"),P.navigateAfterLoginStatusChange(a)}})}})}}),goog.provide("P.modules.Map"),goog.require("P.Module"),goog.require("P.versionedFileLoader");var SAFE_ZONE_MIN_PADDING_VALUE=70;P.MarkerOptions=function(){this.pin=null,this.highlighted=!1,this.animated=!1,this.placeholder=!1,this.latitude=!1,this.longitude=!1},P.MarkerOptionsFactory={},P.MarkerOptionsFactory.fromPlainObject=function(a){var b=new P.MarkerOptions;return"pin"in a&&(b.pin=a.pin),"highlighted"in a&&(b.highlighted=a.highlighted),"animated"in a&&(b.animated=a.animated),"placeholder"in a&&(b.placeholder=a.placeholder),"latitude"in a&&(b.latitude=a.latitude),"longitude"in a&&(b.longitude=a.longitude),"type"in a&&"place"===a.type&&(b.place=a),b};var VIEW_TYPE_BOARD_PAGE="board_page",VIEW_TYPE_CLOSEUP="closeup",CLASS_FADE_OUT_UP="fadeOutUp",CLASS_TOP_ZINDEX="topZIndex",NUNJUCKS_TEMPLATE_DIRECTORY="app/common/modules/Map/",TEMPLATE_POPUP_DEFAULT=NUNJUCKS_TEMPLATE_DIRECTORY+"markerPopup.nunjucks",MARKER_CLUSTER_TEMPLATE=NUNJUCKS_TEMPLATE_DIRECTORY+"markerCluster.nunjucks",MARKER_TEMPLATE=NUNJUCKS_TEMPLATE_DIRECTORY+"marker.nunjucks",TEMPLATE_POPUP_TOAST=NUNJUCKS_TEMPLATE_DIRECTORY+"addToMapToast.nunjucks",MAX_ZOOM_LEVEL=17,DEFAULT_POPUP_WIDTH=270,TIME_UNTIL_TOAST_REMOVES_SELF=3e3,TIME_MARKER_ANIMATION=500,TIME_TOAST_FADE_ANIMATION=300;P.modules.Map=P.Module.extend({setup:function(){this.map||(this._generateMap(this.options.map_id),this._initializeMapHandlers(),this._paddingTopLeft=L.point(0,0)),this.triggerEvent(P.CONST.EVENT_MAP_READY,null,!0)},_isBoardView:function(){return this.options.view_type===VIEW_TYPE_BOARD_PAGE},_isCloseupView:function(){return this.options.view_type===VIEW_TYPE_CLOSEUP},addMarkerToCloseupMap:function(){var a=this.options.pin_geo;if(a){var b=[a.latitude,a.longitude],c=this.map,d={highlighted:!0,animated:!1,pin:this.options.pin},e=this._generateDivIcon(d),f=L.marker(b,{icon:e});f.addTo(c);var g=f.getLatLng();c.setView(g,15)}},replaceToastWithDefaultPopup:function(a){var b=a._source,c=b.options;c.template=TEMPLATE_POPUP_DEFAULT;var d=this._generatePopup(c);b.bindPopup(d,{closeButton:!1,autoPan:!1,maxWidth:DEFAULT_POPUP_WIDTH,minWidth:DEFAULT_POPUP_WIDTH})},addMarkerToMap:function(a){var b=this._generateMarker(a),c=a.placeholder?this.placeholderMarkerLayer:this.markerLayer;if(!a.placeholder){a.animated&&(a.template=TEMPLATE_POPUP_TOAST);var d=this._generatePopup(a);_.extend(b.options,a),b.bindPopup(d,{closeButton:!!a.animated,autoPan:!1,maxWidth:P.CONST.PIN_WIDTH,minWidth:P.CONST.PIN_WIDTH})}b.addTo(c),a.placeholder?b._bringToFront():this.map.fire("moveend")},toggleTranslucentMarkers:function(a){var b=this,c=this.markerLayer.getLayers();_.each(c,function(c){var d=b.markerLayer.getVisibleParent(c);d&&$(d._icon).toggleClass("fadeOut notActionable",a)})},_generateMarker:function(a){var b=a.pin,c=a.highlighted,d=a.animated,e=a.coordinates||b.getCoordinates(),f=a.name,g=a.placeholder,h={highlighted:c,animated:d,placeholder:g,pin:b};f&&(h.name=f);var i,j;if(b){i=b.getPinId();var k=b.getPlaceData();k&&(j=k.id)}"place"in a&&(j=a.place.id);var l=this._generateDivIcon(h),m=L.marker(e,{icon:l,riseOnHover:!0,pin_id:i,place:j});return i&&(m.pin_id=i),m},_generatePopup:function(a){var b=a.pin,c=a.url||a.source_url||b.getLink(),d=a.name||b.getPlaceName(),e=b.getPlaceData()||a,f=a.template||TEMPLATE_POPUP_DEFAULT,g=P.renderNunjucks(f,{url:c,name:d,place:e});return g},_generateDivIcon:function(a){var b=this._getDivIconOptions(a),c=L.divIcon(b);return c},clearMarkers:function(){this.markerLayer.clearLayers()},getCityBoundsFromCenter:function(a){var b=.05;return this.makeLatLngBoundsFromLatLngAndPadding(a,b)},makeLatLngBoundsFromLatLngAndPadding:function(a,b){var c=L.latLng(a.lat-b,a.lng-b),d=L.latLng(a.lat+b,a.lng+b);return L.latLngBounds(c,d)},getCenter:function(){var a=this.map&&this.map.getCenter();return a?a:null},setPaddingTopLeft:function(a){this._paddingTopLeft=a},getZoom:function(){return this.map?this.map.getZoom():null},getBounds:function(){return this.map?this.map.getBounds():null},highlightMarkerForPinId:function(a){this._setHighlightMarkerForPinId(a,!0)},showOnlyPlaceholderMarkerAtIndex:function(a){var b=this.placeholderMarkerLayer.getLayers();_.each(b,function(b,c){c!==a?$(b._icon).hide():$(b._icon).show()})},showAllPlaceholderMarkers:function(){var a=this.placeholderMarkerLayer.getLayers();_.each(a,function(a){$(a._icon).show()})},unHighlightMarkerForPinId:function(a){this._setHighlightMarkerForPinId(a,!1);var b=this.getMarkerForPin(a);b&&b.closePopup()},removeMarkerForPinId:function(a){var b=this.getMarkerForPin(a);b&&this.markerLayer.removeLayer(b)},_setHighlightMarkerForPinId:function(a,b){var c=this.getMarkerForPin(a);if(this.markerLayer){var d=this.markerLayer.getVisibleParent(c);b?this.highlightMarker(d):this.unHighlightMarker(d)}},unHighlightMarker:function(a){var b=this.markerLayer.getVisibleParent(a),c=this._getIconElement(b);c.removeClass("highlightedMarkerIcon"),this._highlightedPinMarker=null},_getIconElement:function(a){var b=$(a._icon);return b.find(".markerCluster, .markerIcon").first()},highlightMarker:function(a){var b=this.markerLayer.getVisibleParent(a),c=this._getIconElement(b);c.addClass("highlightedMarkerIcon"),this._highlightedPinMarker=b},_setHighlightMarker:function(a,b,c){var d=this._generateDivIcon({highlighted:b,animated:!1,placeholder:c});a.setIcon(d),a._highlighted=b,b&&a._bringToFront()},getHighlightedMarker:function(){return this._highlightedPinMarker},_initializeMapHandlers:function(){if(this._isBoardView()){var a=this;this.map.markerLayer.on("mousedown",function(){a._triggerBodyMousedown()}),this.map.on("mousedown",function(){a._triggerBodyMousedown()}),this.map.on("dragend",function(){a.onDragEnd()}),this.map.on("zoomend",function(){a.onZoomEnd()}),this.markerLayer.on("popupopen",function(b){var c=b.popup;a.onPopupOpen(c)}),this.markerLayer.on("popupclose",function(b){var c=b.popup;a.onPopupClose(c)}),this.markerLayer.on("clusterclick",function(){a.onClusterClick()})}},onClusterClick:function(a){this.closeAllMarkerPopups(),this.triggerEvent(P.CONST.EVENT_MAP_CLUSTER_CLICK,a,!0)},onPopupOpen:function(a){var b=a._wrapper,c=a._source,d=c._icon,e=this.clientRectToBounds(b.getBoundingClientRect()),f=this.clientRectToBounds(d.getBoundingClientRect()),g=this.mergeBounds(e,f);this.ensureBoundsInSafeBounds(g);var h=c.options.pin_id;this.triggerEvent(P.CONST.EVENT_MAP_POPUP_OPENED,h,!0),c._bringToFront(),$(d).addClass(CLASS_TOP_ZINDEX)},onPopupClose:function(a){var b=this,c=a._source,d=c._icon,e=c.__parent,f=this.markerLayer.getVisibleParent(e);c.options.animated&&(this.replaceToastWithDefaultPopup(a),c.options.animated=!1),this.unHighlightMarker(c),f&&"unspiderfy"in f&&c===this._singleMarkerSpiderfied?(this._singleMarkerSpiderfied=null,f.unspiderfy(),P.setTimeout(function(){f._group._unspiderfyLayer(c),b.unHighlightMarker(f)},180)):this.unHighlightMarker(c),this.resetPinButtons(),$(d).removeClass(CLASS_TOP_ZINDEX)},getSafeZonePaddingTopLeft:function(){return this._paddingTopLeft},unHighlightPlaceholderMarker:function(a){var b=this.placeholderMarkerLayer.getLayers()[a];b&&this._setHighlightMarker(b,!1,!0)},getSafeZonePaddingBottomRight:function(){var a=SAFE_ZONE_MIN_PADDING_VALUE,b=SAFE_ZONE_MIN_PADDING_VALUE;return L.point(a,b)},clientRectToBounds:function(a){var b=L.point(a.left,a.top),c=L.point(a.right,a.bottom);return L.bounds(b,c)},inflateBounds:function(a,b){var c=L.bounds(a.min.clone(),a.max.clone());return c.min.x-=b,c.min.y-=b,c.max.x+=b,c.max.y+=b,c},mergeBounds:function(a,b){var c=Math.min(a.min.x,b.min.x),d=Math.min(a.min.y,b.min.y),e=Math.max(a.max.x,b.max.x),f=Math.max(a.max.y,b.max.y);return L.bounds(L.point(c,d),L.point(e,f))},ensureBoundsInSafeBounds:function(a){var b=this.getSafeZoneBounds(),c=5,d=this.inflateBounds(b,-1*c),e=0;a.min.x<d.min.x?e=a.min.x-d.min.x:a.max.x>d.max.x&&(e=a.max.x-d.max.x);var f=0;a.min.y<d.min.y?f=a.min.y-d.min.y:a.max.y>d.max.y&&(f=a.max.y-d.max.y),(0!==e||0!==f)&&this.panBy(L.point(e,f))},getRawView:function(){return{center:this.map.getCenter(),zoom:this.map.getZoom()}},setRawView:function(a){this.map.setView(a.center,a.zoom)},panTo:function(a){this.setView(a,this.map.getZoom())},setView:function(a,b){var c=this.getSafeZonePaddingTopLeft(),d=this.getSafeZonePaddingBottomRight(),e=d.subtract(c).divideBy(2),f=this.map.project(a,b),g=this.map.unproject(f.add(e),b);this.map.setView(g,b)},panBy:function(a){this.map.panBy(a)},fitBounds:function(a){var b=this.getSafeZonePaddingTopLeft(),c=this.getSafeZonePaddingBottomRight();this.map.fitBounds(a,{paddingTopLeft:b,paddingBottomRight:c})},fitWorld:function(){this.map.fitWorld().panTo([40.58,-36.91])},getMinZoomToCover:function(a,b){for(var c=L.CRS.EPSG3857,d=1;d<=MAX_ZOOM_LEVEL;d++){var e=L.latLng(90,-180),f=L.latLng(-90,180),g=c.latLngToPoint(e,d),h=c.latLngToPoint(f,d),i=h.x-g.x,j=h.y-g.y,k=i>a&&j>b;if(k)return d}return MAX_ZOOM_LEVEL},getMinZoom:function(a){var b=$(a),c=b.width(),d=b.height();return this.getMinZoomToCover(c,d)},updateMinZoom:function(){var a=this.map.getContainer(),b=this.getMinZoom(a);this.map.options.minZoom=b,this.map._updateZoomLevels()},zoomIn:function(){this.map.zoomIn()},getAttributionElement:function(){return this.$(".attribution")},zoomOut:function(){this.map.zoomOut()},_generateMap:function(a){var b="",c=this._isBoardView();b=c?"mapbox_board_page":"mapbox_closeup";var d=this.$("#"+b)[0],e=this.getMinZoom(document.getElementById(b)),f={detectRetina:!0};$(".ielt9").length||(f.format="png64"),this.map=L.mapbox.map(d,a,{maxZoom:MAX_ZOOM_LEVEL,minZoom:e,worldCopyJump:!0,keyboard:!1,zoomControl:!1,attributionControl:!1,inertiaThreshold:75,inertiaDeceleration:5e3,tileLayer:f}),this.markerLayer=new L.MarkerClusterGroup({mapModule:this,showCoverageOnHover:!1,removeOutsideVisibleBounds:!1,maxClusterRadius:65,iconCreateFunction:function(a){a=a;var b=a.getAllChildMarkers(),c=b[0].options.pin,d=null,e=a.getChildCount();c&&(d=c.getImageUrl("236x"));var f={};return f.markerClusterPinImage=d,f.clusterChildCount=e,new L.DivIcon({html:P.renderNunjucks(MARKER_CLUSTER_TEMPLATE,f),iconSize:[52,74],iconAnchor:[24,66]})}}).addTo(this.map),this.placeholderMarkerLayer=L.featureGroup().addTo(this.map),this.map.scrollWheelZoom.disable(),c?this.options.is_mobile||(new L.Control.CustomMapZoomControl).addTo(this.map):new L.Control.Zoom({position:"bottomright"}).addTo(this.map)},onResize:function(){this.updateMinZoom()},addPermanentMarkerFromTypeahead:function(a){var b=this,c=a.pin,d=c.getId();this.addMarkerToMap(a),P.setTimeout(function(){b.openPopupForPin(d),P.setTimeout(function(){var a=b.getMarkerForPin(d),c=b.$(".leaflet-popup-content-wrapper, .leaflet-popup-tip-container");c.addClass(CLASS_FADE_OUT_UP),P.setTimeout(function(){a.closePopup(),c.removeClass(CLASS_FADE_OUT_UP)},TIME_TOAST_FADE_ANIMATION)},TIME_UNTIL_TOAST_REMOVES_SELF)},TIME_MARKER_ANIMATION)},clearPlaceholderMarkers:function(){this.placeholderMarkerLayer.clearLayers()},setPlaceholderMarkers:function(a,b){this.clearPlaceholderMarkers();for(var c=0,d=a.length;c<d;c++){var e=a[c];this.addMarkerToMap(e)}b&&this.fitViewToPlaceholderMarkers()},clearPlaceholderHighlights:function(){var a=this;_.each(this.placeholderMarkerLayer.getLayers(),function(b){a._setHighlightMarker(b,!1,!0)})},highlightPlaceholderMarker:function(a){var b=this.placeholderMarkerLayer.getLayers()[a];if(b){this._setHighlightMarker(b,!0,!0);var c=this.getSafeZoneBounds(),d=b.getLatLng(),e=this.map.latLngToContainerPoint(d);if(!c.contains(e)){var f=this.map.getZoom();this.setView(d,f)}}},onAddedToDom:function(){var a=_.bindFn(this.setup,this);P.VersionedFileLoader.instance.loadScript("webapp/js/app/common/bundle-mapbox.js",function(){a()})},fitViewToPlaceholderMarkers:function(){this.fitViewToMarkers(!0)},fitViewToPinMarkers:function(){this.fitViewToMarkers(!1)},closeAllMarkerPopups:function(){var a=this.markerLayer.getLayers();_.each(a,function(a){a.closePopup()})},fitViewToMarkers:function(a){if(this.map){var b=a?this.placeholderMarkerLayer:this.markerLayer,c=b.getBounds();c&&!_.isEmpty(c)&&(this.fitBounds(c),a||this._ensureMarkersAreInBounds())}},_ensureMarkersAreInBounds:function(){var a=this.markerLayer.getLayers();if(a.length){var b=this,c=this.getSafeZoneBounds(),d=!1;if(_.each(a,function(a){var e=a.getLatLng(),f=b.map.latLngToContainerPoint(e);c.contains(f)&&(d=!0)}),!d){var e=this.markerLayer.getLayers()[0];this.panTo(e.getLatLng())}}},resetPinButtons:function(){this.triggerEvent(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,null,!0)},getSafeZoneBounds:function(){var a=this.getSafeZonePaddingTopLeft(),b=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight());return L.bounds(a,b)},getSafeZoneLatLngBounds:function(){var a=this.getSafeZonePaddingTopLeft(),b=this.map.getSize().subtract(this.getSafeZonePaddingBottomRight()),c=this.map.containerPointToLatLng(a),d=this.map.containerPointToLatLng(b);return new L.LatLngBounds(c,d)},openPopupForMarker:function(a){var b=this.markerLayer.getVisibleParent(a);if(b&&"getChildCount"in b&&b.getChildCount()>1){var c=this.map.latLngToLayerPoint(a._latlng);c.y+=10;var d=b._generatePointsCircle(1,c);b._animationSpiderfy([a],d),this._singleMarkerSpiderfied=a}a.openPopup()},openPopupForPin:function(a){var b=this.getMarkerForPin(a);this.openPopupForMarker(b)},getMarkerForPin:function(a){if(this.markerLayer){var b=_.find(this.markerLayer.getLayers(),function(b){return b.pin_id===a});return b}},onCreated:function(){this._pinIdToMarkerIndex={},this._highlightedPinMarker=null,this.resizeListener=null,this._mapCardinalDirectionToNearestMoreMarker={},this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},_getDivIconOptions:function(a){var b=a.highlighted,c=a.animated,d=a.placeholder,e=[0,-55],f="markerIconWrapper";c&&(f+=" animated");var g="markerIcon";b&&(g+=" highlightedMarkerIcon");var h,i,j,k,l;d?(g+=" placeholder",h=9,i=9,j=[h,i],k=[h/2,i/2]):(g+=" pin",h=52,i=70,j=[h,i],k=[17,70],l=a.pin);var m={iconSize:[h,i],iconAnchor:[h/2,i],popupAnchor:e,pin:l},n=null;l&&!d&&(n="getImageUrl"in l?l.getImageUrl("236x"):l.images["236x"].url);var o={};return o.markerWrapperClassName=f,o.markerClassName=g,o.pinImage=[n],m.html=P.renderNunjucks(MARKER_TEMPLATE,o),m},addMarkersToMap:function(a){var b=this;_.each(a,function(a){var c=a.getCoordinates();if(c){var d={pin:a,highlighted:!1,animated:!1};b.addMarkerToMap(d)}})},_triggerBodyMousedown:function(){$("body").trigger("mousedown")},onDragEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_DRAG_END,null,!0)},onZoomEnd:function(){this.triggerEvent(P.CONST.EVENT_MAP_ZOOM_END,null,!0)}}),goog.provide("P.modules.ModalTrigger"),goog.require("P.Module"),P.modules.ModalTrigger=P.Module.extend({showModal:function(){this.options.ga_category&&P.trackGAEvent(this.options.ga_category,P.CONST.GA_ACTION_OPEN_MODAL);var a=this;this.showLoading(),P.loadModule(this.options.submodule,function(b){a.hideLoading(),a.showInModal(b,a.options.show_modal_options)})}}),goog.provide("P.modules.NavigateButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.NavigateButton=P.modules.Button.extend({getNavigateUrl:function(){return this.options.url},onClick:function(a){this.options.ga_category&&P.trackGAEvent(this.options.ga_category,P.CONST.GA_ACTION_CLICK),this._logContextEvent(a),a.stopPropagation(),a.preventDefault();var b=this.getNavigateUrl();P.modules.Button.prototype.onClick.call(this),this.navigate(b,null,this.options.force_refresh,{pinId:this.options.safe_link_pin_id,useNewTab:this.options.use_new_tab})},getLoggingObjectIdStr:function(){return this.options.log_obj_id?this.options.log_obj_id:P.modules.Button.prototype.getLoggingObjectIdStr.call(this)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/NavigateButton/NavigateButton.nunjucks")}),goog.provide("P.modules.NuxProgress"),goog.require("P.Module"),goog.require("P.tutorialManager"),P.modules.NuxProgress=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.options.auto_follow_interest&&this.autoFollowInterest(this.options.auto_follow_interest);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=this.triggerNextEvent,a[P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT]=this.updateMiniStep,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a)},initializeProgress:function(a){this.module=a?a.module:null,this.tutorialManager.isTutorialActive()||this.tutorialManager.startTutorial(this.tutorialName,{renderModule:!1}),this.tutorialManager.setProgressModule(this)},autoFollowInterest:function(a){var b={interest_list:"favorited",interest:a},c="InterestFollowResource",d="interest_auto_follow",e=P.resourceFactory.create(c,b);e.callCreate({success:function(a){P.trackGAEvent(d,P.CONST.GA_ACTION_SUCCESS);var b=a.resource_response.data;this.$headerImg=this.$(".headerContent");var c=$("<div>").attr("class","headerImg").append($("<img>").attr("src",b.images["300x300(ir.24)"].url));this.$headerImg.prepend(c),this.$("#interest_term").text(b.name),this.$(".contextualProgress").css("visibility","visible")},error:function(){P.trackGAEvent(d,P.CONST.GA_ACTION_ERROR)}})},onContentReady:function(){this.tutorialManager=P.TutorialManager.instance(),this.progressWrapper=this.$(".nuxProgress"),this.header1=this.$(".headerTitle1"),this.header2=this.$(".headerTitle2"),this.skip=this.$(".skip"),this.progressBar=this.getChildByModuleName("ui.Progress"),this.nextButton=this.getChildById("nextButton"),this.progressWrapper.removeClass("hidden"),this.tutorialName=this.getNuxTutorialName(),this.progressData=this.extraData?this.extraData.progressData:null,this.options.auto_follow_interest&&this.$(".contextualProgress").css("visibility","hidden"),this.nextStep(1),this.initializeProgress()},onExit:function(a){this.endMandatoryFlow(a)},nextStep:function(a){this.currentStep=a,this.setProgressBar(a),this.setStepTexts(a)},setProgressBar:function(a){var b=this.progressData[this.tutorialName];if(b){var c=b.steps,d=_.values(c);this.hasMinisteps=_.all(d,function(a){return _.has(a,"miniStepData")}),this.hasMinisteps?(_.isUndefined(this.stepSequences)&&(this.stepSequences=_.pluck(d,"miniStepData"),this.miniStepSequences=_.flatten(this.stepSequences,!1),this.progressBar.options={steps:this.miniStepSequences.length,ministeps:this.miniStepSequences,type:b.progressBarType},this.progressBar.render()),c[this.currentStep].enableOnMiniStepsFull&&this.nextButton.disable()):(this.progressBar.options={current_step:a,steps:d.length},this.progressBar.render())}},updateMiniStep:function(a,b,c){var d=c,e=_.where(this.miniStepSequences,{type:d.type}).length,f=_.isNumber(d.total)?d.total:1;f=Math.min(Math.max(f,0),e),this.progressBar.setMiniStepProgress(d.type,f),this.setMiniStepMessage(d.type,f);var g=this.progressData[this.tutorialName].steps[this.currentStep];g.enableOnMiniStepsFull&&(e===f?(this.nextButton.enable(),g.enabledButtonText&&this.nextButton.setText(g.enabledButtonText)):(this.nextButton.disable(),g.enabledButtonText&&this.nextButton.setText(g.buttonText)))},setMiniStepMessage:function(a,b){var c=_.filter(this.miniStepSequences,function(b){return b.type===a}),d="";if(b>0&&b<=c.length){var e=c[b-1];e&&(d=e.finishedStepText)}var f=this.$(".contextualProgress");f&&f.text(d)},onButtonClick:function(a){var b=a.target;b&&("previousButton"===b.id?(a.stopPropagation(),this.triggerPreviousEvent()):"nextButton"===b.id&&(a.stopPropagation(),this.triggerNextEvent()))},getNextButton:function(){return this.nextButton},endMandatoryFlow:function(a){var b=this,c=function(){a&&a(),b.remove();var c=P.app;c.updateNavigationBar()};P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)?P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN,function(){c()}):c()},setStepTexts:function(a){var b,c,d,e;if(this.progressData){var f=this.progressData[this.tutorialName];if(f){var g=f.steps;if(g){var h=g[a];h&&(b=h.buttonText,c=h.header1,d=h.header2,e=h.skip_data)}}}if(this.skip)if(this.skip.unbind(),e&&!_.isEmpty(e)){this.skip.removeClass("hidden");var i=this;this.skip.bind("click",function(){var a={name:"ConfirmDialog",options:{button_text:e.button_text,dismiss_button_text:e.dismiss_button_text,body_message:e.body_message,title:e.title,template:"generic"}};P.loadModule(a,function(a){i.showInModal(a,{mask_type:"dark",can_dismiss:!1}),i.listen(a,P.CONST.EVENT_CONFIRM,function(){i.triggerEvent(P.CONST.EVENT_NEXT)})})})}else this.skip.addClass("hidden");b&&this.getNextButton().setText(b),c&&this.header1.html(c),d&&this.header2.html(d)},getNuxTutorialName:function(){return this.extraData?this.extraData.tutorialName:"newUserIgnitionSteps"},getNuxTutorialStep:function(){return this.currentStep?this.currentStep:1},triggerPreviousEvent:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!1)},triggerNextEvent:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!1)}}),goog.provide("OAuthDialog"),goog.require("P.Module"),P.modules.OAuthDialog=P.Module.extend({events:{},onContentReady:function(){this.resizeWindowToFit()},onChildRemoved:function(){this.children.length?this.resizeWindowToFit():window.close()},resizeWindowToFit:function(){P.getWindowManager().shrinkWrap()}}),goog.provide("P.modules.OAuthPageBase"),goog.require("P.Module");var REDIRECT_DELAY=2e3;P.modules.OAuthPageBase=P.Module.extend({getOAuthResource:function(a){var b=_.extend(this.resource.copyOptions(!0),a);return P.resourceFactory.create("OAuthAuthorizationResource",b)},makeAuthorizationDecision:function(a,b,c){var d=this.getOAuthResource({authorized:a}),e=this;d.callCreate().then(function(a){e.tryRedirect(a.resource_response.data,c)}).fin(function(){b&&b.hideLoading()})},tryRedirect:function(a,b){if(a.redirect){var c=a.redirect_uri,d={};a.access_token?(c+="#",d={access_token:a.access_token,expires_at:a.expires_at,token_type:a.token_type}):a.code&&(c+="?",d={code:a.code}),a.state&&(d.state=a.state),c+=$.param(d),b?(this.showRedirectScreen(),P.setTimeout(function(){P.changeWindowLocation(c)},REDIRECT_DELAY)):P.changeWindowLocation(c)}},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){if(0!==this.$(".loginForm").length){var a={username_or_email:[P.Validator.Required(),P.Validator.Email()],password:[P.Validator.Required()]};this.loginForm=new P.Form(this.$("form"),a),this.loginFormListener=this.listen(this.loginForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(a){if(!a.errors||!a.errors.length){var b=this,c=function(){b.authorizeApp()},d=function(a){if(b.$(".loginError").html(a.message).show(),a.api_error_code===P.CONST.AUTO_PASSWORD_RESET_ERROR_CODE){var c=P.getResetPasswordOneClickUrl({username_or_email:this.loginForm.email});b.navigate(c)}};P.currentUser.login(this.loginForm.getData(),c,d,null)}},authorizeApp:function(){var a=this.getChildById("authorizeButton");a.showLoading(),this.makeAuthorizationDecision(!0,a,!0)},onAuthorizeButtonClicked:function(a){this.loginForm?this.loginForm.onSubmit(a):this.authorizeApp()},showRedirectScreen:function(){this.$(".body").hide(),this.$(".loading").show()}}),goog.provide("P.modules.OffsitePage"),goog.require("P.Module"),P.modules.OffsitePage=P.Module.extend({onContentReady:function(){var a=function(){window.close()};if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this),this.listen(this,P.CONST.EVENT_DISMISS,a);else{var b={name:"ConfirmDialog",options:{template:"offsite_warning",sanitized_url:this.options.sanitized_url,redirect_status:this.options.redirect_status}},c=this;P.loadModule(b,function(b){b.render(function(){P.getModalManager().showInModal(b),b.on(P.CONST.EVENT_CONFIRM,function(){window.location.replace(c.options.sanitized_url),b.off(P.CONST.EVENT_DESTROYED,a)}),b.on(P.CONST.EVENT_DESTROYED,a)})})}}}),goog.provide("P.modules.PagedCollection"),goog.require("P.Module"),P.modules.PagedCollection=P.Module.extend({onContentReady:function(){this._moreItemsButtonClickListener&&this.removeListener(this._moreItemsButtonClickListener),this._moreItemsButtonClickListener=this.listen(this.getMoreItemsButton(),P.CONST.EVENT_BUTTON_CLICK,this._onMoreItemsButtonClick)},_onMoreItemsButtonClick:function(a){a.stopPropagation(),this.requestMore()},getMoreItemsContainer:function(){return this.$el.children(".moreItemsContainer")},getMoreItemsButton:function(){return this.getChildById("moreItems")},_hasBorderedButton:function(){var a=this.getMoreItemsButton();return a&&!a.options.borderless},showMoreItemsLoading:function(){if(this._hasBorderedButton())this.getMoreItemsButton().showLoading();else if(!this._moreItemsSpinner){var a=this.getMoreItemsContainer();a.addClass("loading"),this._moreItemsSpinner=new P.Spinner({size:P.Spinner.Size.SMALL}),this._moreItemsSpinner.spin(a)}},hideMoreItemsLoading:function(){this._hasBorderedButton()?this.getMoreItemsButton().hideLoading():this._moreItemsSpinner&&(this.getMoreItemsContainer().removeClass("loading"),this._moreItemsSpinner.stop(),this._moreItemsSpinner=null)},requestMore:P.NOOP}),goog.provide("P.modules.PagedGrid"),goog.require("P.modules.PagedCollection");var DEFAULT_AJAX_PAGE_SIZE=9,HIDE_CLASS="hide";P.modules.PagedGrid=P.modules.PagedCollection.extend({onAddedToDom:function(){this.contentReady&&this._setUpGrid()},onContentReady:function(){P.modules.PagedCollection.prototype.onContentReady.call(this),this.inDom&&this._setUpGrid()},_getGrid:function(){return this.getChildById("grid")},prependChildItem:function(a){var b=this._getGrid();b.prependChildItem(a)},_setUpGrid:function(){var a=this._getGrid(),b=this.options.ajax_page_size||DEFAULT_AJAX_PAGE_SIZE;a.setPageSize(b),a.hasMoreItems()||this.getMoreItemsButton().getContent().addClass(HIDE_CLASS),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged),this.childListen(P.CONST.EVENT_ERROR,this.onChildError)},hasItems:function(){var a=this._getGrid();return a.hasItems()},requestMore:function(){if(this.contentReady){this.showMoreItemsLoading();var a=this._getGrid();a.requestMoreItems()}},onChildContentChanged:function(){this.hideMoreItemsLoading();var a=this.getMoreItemsButton();if(a){if(this.gridHasError)return a.hide(),void(this.gridHasError=!1);var b=this._getGrid();b.hasMoreItems()?a.show():a.destroy()}},onChildError:function(a){this.log.debug("Child error!",a),a.target===this._getGrid()&&(this.gridHasError=!0)}}),goog.provide("P.modules.PagedList"),goog.require("P.modules.PagedCollection"),P.modules.PagedList=P.modules.PagedCollection.extend({onContentReady:function(){P.modules.PagedCollection.prototype.onContentReady.call(this),this._hideMoreItemsContainerIfAtEnd(),this._moreItemsRequestStartListener&&this.removeListener(this._moreItemsRequestStartListener),this._moreItemsRequestSuccessListener&&this.removeListener(this._moreItemsRequestSuccessListener),this._moreItemsRequestErrorListener&&this.removeListener(this._moreItemsRequestErrorListener);var a=this._getList();this._moreItemsRequestStartListener=this.listen(a,P.CONST.EVENT_ITEMS_REQUEST_START,this._onItemsRequestStart),this._moreItemsRequestSuccessListener=this.listen(a,P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this._onItemsRequestSuccess),this._moreItemsRequestErrorListener=this.listen(a,P.CONST.EVENT_ITEMS_REQUEST_ERROR,this._onItemsRequestError)},_onItemsRequestStart:function(){this.showMoreItemsLoading()},_onItemsRequestSuccess:function(){this._onItemsRequestEnd()},_onItemsRequestError:function(){this._onItemsRequestEnd()},_getList:function(){return this.getChildById("list")},_hideMoreItemsContainerIfAtEnd:function(){this.hasMoreItems()||this.getMoreItemsContainer().hide()},_onItemsRequestEnd:function(){this.hideMoreItemsLoading(),this.hasMoreItems()||this.triggerEvent(P.CONST.EVENT_ITEMS_END,null,!0),this._hideMoreItemsContainerIfAtEnd()},requestMore:function(){var a=this.getChildById("list");a.requestMoreItems()},hasMoreItems:function(){return this._getList().hasMoreItems()},appendToList:function(a){this._getList().appendChild(a)},getModuleItems:function(){return this._getList().children},setPageSize:function(a){this.resource&&this.resource.set("page_size",a),this._getList().setPageSize(a)}}),goog.provide("P.modules.PinBase"),goog.require("P.Module");var CLASS_MAP_FOCUS="mapFocus";P.modules.PinBase=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.call(this);var a=this.data.id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,this.pubsubSubscribe(a,b)}},onPinDeleted:function(){this.triggerEvent(P.CONST.EVENT_PIN_DELETED,this,!0),this.destroy()},getLoggingObjectIdStr:function(){return this.getPinId()},getPinId:function(){return this.resource.get("id")},getGridIndex:function(){return"grid_index"in this.data?this.data.grid_index:null},getPlaceName:function(){var a=this.getPlaceData();return a?a.name:null},getLink:function(){return this.data.link||null},getPlaceProvider:function(){var a=this.getPlaceData();return a?a.source_name:null},getPlaceProviderImage:function(){var a=this.getPlaceData();return a?a.source_icon:null},getImageUrl:function(a){if(!a)return"";var b=this.data.images;return b[a]?b[a].url:a===P.CONST.IMAGE_SIZE_ORIG&&b.originals?b.originals.url:""},getCoordinates:function(){var a=this.getPlaceData();return a?[a.latitude,a.longitude]:null},getPlaceData:function(){return this.data.place||null},getLocality:function(){var a=this.getPlaceData();if(!a)return null;var b=a.address;return b?b.locality:null},_highlightMarkerOnMap:function(){var a=this.getPinId();this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,a,!0)},scrollIntoView:function(){var a=this;this._forceSeeOnMap=!0;var b,c=this.$el,d=c.offset().top,e=c.height(),f=P.Viewport.height,g=$(".headerBackground").height();b=e>=f-g?d-e/2+P.Viewport.height/2-g-1.5*P.CONST.PIN_MARGIN:d-f/2-g/2+e/2,this.$el.addClass(CLASS_MAP_FOCUS);var h=this.getChildById("seeOnMap");h&&h.setHighlight(!0),this._highlightMarkerOnMap();var i=function(){a._highlightMarkerOnMap()};P.scrollToTop({$scroller:null,newScrollOffset:b,callback:i})},resetShowOnMapButton:function(){var a=this.getChildById("seeOnMap");this.$el.removeClass(CLASS_MAP_FOCUS),a&&(a.setHighlight(!1),this._forceSeeOnMap=!1)}}),goog.provide("P.modules.PinCommentListBase"),goog.require("P.Module"),P.modules.PinCommentListBase=P.Module.extend({events:{"click .showAll":"onShowAll","focus .content":"onFocusCommentInput","click .addComment":"addComment"},onCreated:function(){this.commentContentHeight=null,this.prePopulate=this.options.pre_populate},onContentReady:function(){var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,this.pubsubSubscribe(a,b)}this.prePopulate&&(this.populateComment(this.prePopulate),delete this.prePopulate),this._visible=!0},_setOptionsForShowingAll:function(){var a=this.options.count;this.options.max_num_to_show=a,this.resource&&(this.resource.options.page_size=a)},onShowAll:function(a){a.stopPropagation(),a.preventDefault(),this._setOptionsForShowingAll(),this.render()},populateComment:function(a){var b=this.getChildById("pinCommentField");b.setValue(a),b.focus()},addComment:function(){P.trackGAEvent("comment_create",P.CONST.GA_ACTION_CLICK_SUBMIT);var a=this.getChildById("pinCommentField").getValue(),b=this.options.pin_id,c=P.resourceFactory.create("PinCommentResource",{pin_id:b,text:a}),d=this.getChildById("addCommentButton");d.showLoading(),c.callCreate({success:function(){P.trackGAEvent("comment_create",P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED)},complete:function(){d.hideLoading()
}})},onPinCommentCreated:function(){this.options.count++,this.render()},onFocusCommentInput:function(){var a=this.$el.find(".addComment");this.options.type&&"closeup"===this.options.type?a.css("display","block"):a.show(),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},toggle:function(){this._visible?this.hide():this.show(),this._visible=!this._visible}}),goog.provide("P.modules.PinEditBase"),goog.require("P.Module"),P.modules.PinEditBase=P.Module.extend({_onButtonClick:function(a){var b=a.target;switch(b.id){case"submitButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_SUBMIT);break;case"cancelButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CANCEL);break;case"deleteButton":P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation();break;default:this.onButtonClick(a)}},savePin:function(){var a=this,b=this.data.id,c=this.pinForm.getData();c.id=b;var d=P.resourceFactory.create("PinResource",c),e=function(a){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_ERROR),P.showError(a.message)},f=function(d){if(P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_SUCCESS),d){var f=d.resource_response;if(f&&!f.error){if(!a.refreshOnSave&&a.isInModal()){P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,f.data);var g=c.board_id,h=a.data.board.id;g!==h&&(P.pubsub.publish(g,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.pubsub.publish(h,P.CONST.PUBSUB_TOPIC_PIN_DELETED)),a.destroy()}else{var i="/pin/"+b+"/";a.navigate(i)}return}}e(d)};this.showLoading(!0),d.callUpdate({success:f,error:e,complete:function(){a.hideLoading()}})},onDeleteConfirm:function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_CLICK_SUBMIT),this.deletePin()},onButtonClick:function(){},deletePin:function(){var a=this.data.id,b=this,c={id:a},d=P.resourceFactory.create("PinResource",c),e=function(a){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_ERROR),P.showError(a.message)},f=function(c){if(P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_DELETE,P.CONST.GA_ACTION_SUCCESS),c){var d=c.resource_response;if(d&&!d.error){if(P.pubsub.publish(b.data.board.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),P.pubsub.publish(b.data.pinner.id,P.CONST.PUBSUB_TOPIC_PIN_DELETED),!b.refreshOnSave&&b.isInModal())P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_DELETED),b.destroy();else{var f=b.data.board.url;b.navigate(f)}return}}e(c)};this.showLoading(!0),d.callDelete({success:f,error:e,complete:function(){b.hideLoading()}})},showConfirmation:function(){},showPrivacyChangeConfirmation:function(){}}),goog.provide("P.modules.PinLikeButton"),goog.require("P.Module"),goog.require("P.modules.LikeButton"),P.modules.PinLikeButton=P.modules.LikeButton.extend({getLikeResource:function(){var a="PinLikeResource2";return P.resourceFactory.create(a,{pin_id:this.options.pin_id})},_getGACategory:function(a){return a?"pin_like":"pin_unlike"},onClick:function(){var a=!this.options.liked;P.modules.LikeButton.prototype.onClick.call(this);var b=this._getGACategory(a);P.trackGAEvent(b,P.CONST.GA_ACTION_CLICK)},onToggleSuccess:function(a){var b=this._getGACategory(a),c=a?P.CONST.PUBSUB_TOPIC_PIN_LIKED:P.CONST.PUBSUB_TOPIC_PIN_UNLIKED;P.trackGAEvent(b,P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(this.options.pin_id,c)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/PinLikeButton/PinLikeButton.nunjucks")}),goog.provide("P.modules.PinnableBase"),goog.require("P.Module"),P.modules.PinnableBase=P.Module.extend({events:{click:"onClick"},onCreated:function(){this.onImageLoad=_.bindFn(this.onImageLoad,this),this.onImageError=_.bindFn(this.onImageError,this)},onAdded:function(){this.updateImage()},updateImage:function(){var a=this.$(".pinImageWrapper"),b=this.$img=$("<img>");b.on("load",this.onImageLoad),b.on("error",this.onImageError),b.attr("src",this.options.url),a.append(b)},onImageLoad:function(){this.$img.width()<P.CONST.MIN_PINNABLE_IMAGE_WIDTH||this.$img.height()<P.CONST.MIN_PINNABLE_IMAGE_HEIGHT?(this.log.debug("Too small!",this.$img.width(),this.$img.height()),this.destroy()):this.$el.css("visibility","visible"),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},onImageError:function(){this.destroy()}}),goog.provide("P.modules.PositionModule"),goog.require("P.Module"),goog.require("P.viewport");var CLASS_CARET="positionModuleCaret",MIN_CARET_OFFSET=5,POINT=P.CONST.PositionPoint,POINT_FLAG=P.CONST.PositionPointFlag,MAP_FLAG_TO_CLASS={};MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_HORIZONTAL_LEFT]="positionLeft",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_HORIZONTAL_RIGHT]="positionRight",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_VERTICAL_TOP]="positionTop",MAP_FLAG_TO_CLASS[POINT_FLAG.FLAG_VERTICAL_BOTTOM]="positionBottom",P.modules.PositionModule=P.Module.extend({positionMode:P.CONST.PositionMode.ANCHORED,onCreated:function(){var a=_.bindFn(this.positionModule,this);this.childListen(P.CONST.EVENT_CONTENT_CHANGED,a),this.listen(this,P.CONST.EVENT_DIMS_CHANGED,a),this.listen(this,P.CONST.EVENT_NAVIGATE,a),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,a),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,a)},getPositionMode:function(){return P.CONST.PositionMode[this.options.position_mode]||this.positionMode},onOptionsChanged:function(){this.updateFixed()},getPositionElement:function(){return this.$el},getPositionAnchor:function(){return $(this.options.anchor)},getPositionPoint:function(){return POINT[this.options.position_point]||POINT.BOTTOM_LEFT},getPositionFixed:function(){return!!this.options.fixed},getPositionCaret:function(){return this.getCaret()},getCaret:function(){return this.$("."+CLASS_CARET)},_getPositionType:function(){return this.getPositionFixed?"fixed":"absolute"},positionModuleAtAnchor:function(a,b){var c=this;P.deferDomManipulation(function(){var d=c.getPositionElement();d.addClass("positionModuleElement"),d.toggleClass("positionFixed",c.getPositionFixed()),_.each(MAP_FLAG_TO_CLASS,function(a){d.removeClass(a)}),b=P.Positioning.positionElementAtAnchor(d,a,b,c.getPositionFixed(),c.options.force_in_viewport);var e=_.find(MAP_FLAG_TO_CLASS,function(a,c){return b&c?!0:void 0});d.addClass(e)}),this.positionCaret(a,b)},positionCaret:function(a,b){var c=this;P.deferDomManipulation(function(){var d=c.$("."+CLASS_CARET);if(d.length){var e=P.CONST.PositionPointFlag,f=c.getPositionElement();f.addClass(c.options.largeCaret?"bigCaret":"defaultCaret"),c.options.caret_style&&d.addClass(c.options.caret_style+"CaretStyle");var g="left",h="outerWidth",i="width";b&e.FLAG_HORIZONTAL&&(g="top",h="outerHeight",i="height");var j=0,k=b&(e.FLAG_HORIZONTAL_CENTER|e.FLAG_VERTICAL_CENTER),l=d[i]()>a[i]()-MIN_CARET_OFFSET;l&&!k&&(j=(d[i]()-a[i]())/2+MIN_CARET_OFFSET,(b&e.FLAG_VERTICAL_RIGHT||b&e.FLAG_HORIZONTAL_BOTTOM)&&(j=-j));var m=f.offset()[g],n=m+f[h](),o=a.offset()[g],p=o+a[h](),q=m;q<o&&(q=o);var r=n;r>p&&(r=p);var s=(q+r)/2-d[h]()/2+j,t={};if(t[g]=s,d.offset(t),j){var u=parseInt(f.css(g),10);f.css(g,u-j)}}})},positionModule:function(){this.cleanPositionModuleElement(),this.getPositionMode()===P.CONST.PositionMode.MANUAL?this._positionManually():this.getPositionMode()===P.CONST.PositionMode.ANCHORED?this.positionModuleAtAnchor(this.getPositionAnchor(),this.getPositionPoint()):this._positionAbsoluteCenter()},_positionAbsoluteCenter:function(){var a=this,b=this.getScrollableElement().outerHeight(),c=this.getContent().outerHeight(),d=Math.floor((b-c)/2),e=Math.max(0,d);if(P.deferDomManipulation(function(){a.getPositionElement().css({marginTop:e})}),!this.options.auto_width){var f=this.getModule().getWidth(!0);P.deferDomManipulation(function(){a.getContent().css({width:f})})}c>=P.Viewport.height&&P.deferDomManipulation(function(){a.$el.addClass("fullScreen")})},_positionManually:function(){var a=this;P.deferDomManipulation(function(){var b=a.getPositionElement();b.addClass("positionModuleElement"),b.toggleClass("positionFixed",a.getPositionFixed())})},cleanPositionModuleElement:function(){var a=this;P.deferDomManipulation(function(){var b=a.getPositionElement();b.removeClass("positionModuleElement"),b.css({top:"",left:"",margin:""})})},updateFixed:function(){var a=this;P.deferDomManipulation(function(){a.$el.toggleClass("positionModuleFixed",a.getPositionFixed())})},renderContainer:function(){this.empty();var a=this.$el;if(a.addClass("PositionModule"),a.addClass(this.options.class_name),this.updateFixed(),this.options.view_type&&a.addClass(this.options.view_type),!this.options.hide_caret){var b=$('<span class="'+CLASS_CARET+'"></span>');a.prepend(b)}},render:function(a){var b=_.bindFn(function(){this.onContentReady(),this.onRendered(),a&&a()},this);this.options.module?P.loadModule(this.options.module,_.bindFn(function(a){this.insertChild(a,this.getPositionElement()),a.render(b)},this)):b()}}),goog.provide("P.modules.PromotedPinInfo"),goog.require("P.Module"),P.modules.PromotedPinInfo=P.Module.extend({HIDDEN_CLASS:"hidden",HIDE_DELAY:3e3,events:{"click .hideThis":"onClickHideThis"},onClickHideThis:function(){var a=this.options.pin_id;this._hidePin(a)},_hidePin:function(a){var b=this;this.showLoading();var c=this._getResource(a);c.callUpdate().fin(function(){b.hideLoading()}).then(function(){b.$(".preAction").addClass(b.HIDDEN_CLASS),b.$(".confirmHideThis").removeClass(b.HIDDEN_CLASS),b.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){b.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_PIN_DELETED)},b.HIDE_DELAY)})},_getResource:function(a){var b=P.resourceFactory.create("PromotedPinHideResource",{pin_id:a});return b}}),goog.provide("P.modules.QALikeButton"),goog.require("P.modules.LikeButton"),P.modules.QALikeButton=P.modules.LikeButton.extend({}),goog.provide("P.modules.QAList"),goog.require("P.Module"),P.modules.QAList=P.Module.extend({onContentReady:function(){this.initPubsub(),this._listItemsEndListener&&this.removeListener(this._listItemsEndListener),this._listItemsEndListener=this.listen(this._getPagedList(),P.CONST.EVENT_ITEMS_END,this._onListItemsEnd),this._showCreateIfAtEnd(),this._getPagedList().setPageSize(this.getAjaxPageSize())},_getPagedList:function(){return this.getChildById("list")},_getCreate:function(){return this.getChildById("create")},_hasMoreItems:function(){return this._getPagedList().hasMoreItems()},_showCreateIfAtEnd:function(){if(!this._hasMoreItems()){var a=this._getCreate();a&&a.show()}},_onListItemsEnd:function(){this._showCreateIfAtEnd()},initPubsub:P.NOOP,getAjaxPageSize:function(){return 10},addItem:function(a){this._getPagedList().appendToList(a);var b=a.render();return b.then(function(){a.fadeIn()}),b}}),goog.provide("P.modules.QuestionBase"),goog.require("P.Module");var QUESTION_CLASS_LIKED="liked";P.modules.QuestionBase=P.Module.extend({onContentReady:function(){},_getLikeCountEl:function(){return this.$(".questionLikesCount")},_getLikeCount:function(){var a=$.trim(this._getLikeCountEl().text());return a?parseInt(a,10):0},_setLikeCount:function(a){this._getLikeCountEl().text(a||"")},_onQuestionLiked:function(){this._setLikeCount(this._getLikeCount()+1),this._getLikeCountEl().addClass(QUESTION_CLASS_LIKED);var a=this,b={name:"Toast",options:{position_mode:"ANCHORED",position_point:"RIGHT_TOP",template:"like_question_success"}};P.loadModule(b,function(b){a.addChild(b),b.render().then(function(){b.options.anchor=a.$el,b.positionModule()})})},_onQuestionUnliked:function(){this._setLikeCount(this._getLikeCount()-1),this._getLikeCountEl().removeClass(QUESTION_CLASS_LIKED)}}),goog.provide("P.modules.QuestionLikeButton"),goog.require("P.modules.QALikeButton"),P.modules.QuestionLikeButton=P.modules.QALikeButton.extend({getLikeResource:function(a){var b={question_id:this.options.question_id};return a&&(b.context_pin_id=this.options.context_pin_id),P.resourceFactory.create("QuestionLikeResource",b)},onToggleSuccess:function(a){var b=a?P.CONST.PUBSUB_TOPIC_QUESTION_LIKED:P.CONST.PUBSUB_TOPIC_QUESTION_UNLIKED;P.pubsub.publish(this.options.question_id,b)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/QuestionLikeButton/QuestionLikeButton.nunjucks")}),goog.provide("P.modules.QuestionsBase"),goog.require("P.modules.QAList"),P.modules.QuestionsBase=P.modules.QAList.extend({onCreated:function(){this.childListen(P.CONST.EVENT_SEE_QUESTION,this._onSeeQuestion)},initPubsub:function(){},scrollToQuestions:function(a,b){var c={$el:this.$el,callback:b,scrollOffset:a||P.CONST.SCROLL_TO_ELEMENT_OFFSET};this.triggerEvent(P.CONST.EVENT_SCROLL_TO_ELEMENT,c,!0)},_getQuestionById:function(a){var b=this._getPagedList().getModuleItems(),c=_.find(b,function(b){return"Question"===b.className&&b.data.id===a});return c},_onSeeQuestion:function(){},_hasValidCanonicalPinId:function(){var a=this.options.canonical_pin_id;return a&&"0"!==a},_onPinQuestionCreated:function(){}}),goog.provide("P.modules.RecipeFeedPage"),goog.require("P.Module"),P.modules.RecipeFeedPage=P.Module.extend({}),goog.provide("P.modules.RelatedPinInfo"),goog.require("P.Module"),P.modules.RelatedPinInfo=P.Module.extend({HIDDEN_CLASS:"hidden",HIDE_DELAY:3e3,onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},onChildButtonClick:function(a){var b=a.target.id;"downvote"===b?this._doVote(!1):"upvote"===b&&this._doVote(!0)},_getResource:function(a){var b=this.options.pin_id,c={pin_id:b,feedback_type:a?"positive":"negative"},d=this.options.recommendation_reason;if(d){c.reason=d.reason;var e=d.board;e&&(c.through_board_id=e.id)}var f=P.resourceFactory.create("RecommendedPinFeedbackResource",c);return f},_doVote:function(a){var b=this,c=this.options.pin_id;this.showLoading();var d=this._getResource(a);d.callCreate().fin(function(){b.hideLoading()}).then(function(){b.$(".preAction").addClass(b.HIDDEN_CLASS);var d=a?".confirmUpvote":".confirmDownvote";b.$(d).removeClass(b.HIDDEN_CLASS),b.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0),P.setTimeout(function(){b.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),a||P.pubsub.publish(c,P.CONST.PUBSUB_TOPIC_PIN_DELETED)},b.HIDE_DELAY)})}}),goog.provide("P.modules.RepinsLikesFeedPage"),goog.require("P.Module"),P.modules.RepinsLikesFeedPage=P.Module.extend({}),goog.provide("P.modules.RepliesBase"),goog.require("P.modules.QAList"),P.modules.RepliesBase=P.modules.QAList.extend({initPubsub:function(){var a,b={},c=this.options.answer_id;c?(a=c,b[P.CONST.PUBSUB_TOPIC_ANSWER_REPLY_CREATED]=this._onAnswerReplyCreated):(a=this.options.question_id,b[P.CONST.PUBSUB_TOPIC_QUESTION_REPLY_CREATED]=this._onQuestionReplyCreated),this.pubsubSubscribe(a,b)},_onQuestionReplyCreated:function(a,b,c){this._onReplyCreated(c)},_onAnswerReplyCreated:function(a,b,c){this._onReplyCreated(c)}}),goog.provide("P.modules.ReplyBase"),goog.require("P.Module"),P.modules.ReplyBase=P.Module.extend({}),goog.provide("P.modules.ReportedContent"),goog.require("P.Module"),P.modules.ReportedContent=P.Module.extend({}),goog.provide("P.modules.ResetPasswordPage"),goog.require("P.Module"),goog.require("P.router");var resetPasswordButtonId="resetPasswordSubmit";P.modules.ResetPasswordPage=P.Module.extend({onContentReady:function(){if(this.data.is_link_valid){var a={new_password:[P.Validator.Required(),P.Validator.ContainsOnlyAscii({message:P.string.common.asciiPasswordError}),P.Validator.Password()],new_password_confirm:[P.Validator.Required(),P.Validator.EqualTo({targetFieldName:"new_password",message:P._("Passwords don't match")})]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)}},onSubmitValidated:function(a){var b=this.getChildById(resetPasswordButtonId);a.errors[0]||(b.showLoading(!0),this.resetPassword())},resetPassword:function(){var a=this;this.hideLoading(!0);var b=function(){var b=a.getChildById(resetPasswordButtonId);b.hideLoading()},c=function(b){if(b){var c=b.resource_response;if(c&&!c.error&&c.data.password_changed){var d={name:"ConfirmDialog",options:{template:"change_password_success"}},e=function(){var a="/login";try{P.navigate(a)}catch(b){P.changeWindowLocation(a,!1)}};P.loadModule(d,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,e)})}}},d={new_password:this.form.getValue("new_password"),new_password_confirm:this.form.getValue("new_password_confirm")},e=$.extend(_.clone(this.options),d),f=P.resourceFactory.create("ResetPasswordFromEmailResource",e);f.callUpdate({success:c,complete:b})}}),goog.provide("P.modules.RichPinInfer"),goog.require("P.Module"),P.modules.RichPinInfer=P.Module.extend({}),goog.provide("P.modules.SearchPageContent"),goog.require("P.Module"),P.modules.SearchPageContent=P.Module.extend({events:{}}),goog.provide("P.modules.SegmentedController"),goog.require("P.Module");var CLASS_ACTIVE_SEGMENT="activeSegment";P.modules.SegmentedController=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onContentReady:function(){var a=this.getButtons();this.activeModule=this.children[a.length]},resetActiveButton:function(){var a=this.getButtons();_.each(a,function(a){a.getContent().removeClass(CLASS_ACTIVE_SEGMENT),a.enable()})},onButtonClick:function(a){var b=a.target;if(b.isSegmentedControlButton()){this.resetActiveButton(),b.getContent().addClass(CLASS_ACTIVE_SEGMENT);var c=this.getButtons(),d=_.indexOf(c,b),e=this.getModules(),f=e[d];_.isEqual(this.activeModule,f)||this.makeActiveModule(f)}},makeActiveModuleFromIndex:function(a){var b=this.getModules()[a];this.makeActiveButtonFromIndex(a),this.makeActiveModule(b)},makeActiveButtonFromIndex:function(a){var b=this.getButtons()[a];this.resetActiveButton(),b.getContent().addClass(CLASS_ACTIVE_SEGMENT)},makeActiveModule:function(a){var b=this;this.activeModule.remove(),this.showLoading(),P.loadModule(a,function(a){a.render(function(){var c=b.$(".content");b.hideLoading(),b.activeModule=a,b.insertChild(a,c)})})},getModules:function(){return this.options.modules},getButtons:function(){return this.getChildrenByModuleName("Button")}}),goog.provide("P.modules.ShoppingButtonBar"),goog.require("P.Module"),P.modules.ShoppingButtonBar=P.Module.extend({}),goog.provide("P.modules.ShowModalButton"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.modules.ModalTrigger"),P.modules.ShowModalButton=P.modules.Button.extend({onClick:function(a){if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this);else{if(P.modules.Button.prototype.onClick.call(this,a),this.options.require_auth&&!this.ensureAuthentication())return a.preventDefault(),!1;if(this.showModal(),"a"===this.options.element_type)return!1}}}),_.extend(P.modules.ShowModalButton.prototype,P.modules.ModalTrigger.prototype),_.extend(P.modules.ShowModalButton.prototype,{getAuthRedirectUrl:function(){var a={};return this.options.require_auth_params&&_.extend(a,this.options.require_auth_params),P.getRegisterUrl(a)},toString:function(){return this.className+"(module="+this.options.submodule.name+")"},getLoggingObjectIdStr:function(){return this.parent?this.parent.getLoggingObjectIdStr():null},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ShowModalButton/ShowModalButton.nunjucks")}),goog.provide("P.modules.SignedEmailDisassociatePage"),goog.require("P.Module"),P.modules.SignedEmailDisassociatePage=P.Module.extend({}),goog.provide("P.modules.SignedEmailSettingsPage"),goog.require("P.Module"),P.modules.SignedEmailSettingsPage=P.Module.extend({}),goog.provide("P.modules.SignedEmailUnsubscribePage"),goog.require("P.Module"),P.modules.SignedEmailUnsubscribePage=P.Module.extend({}),goog.provide("P.modules.TakedownFormBase"),goog.require("P.Module");var MAX_REPORTED_ITEMS=10,MAX_CONTEXT_NOTES_CHARS=800,MAX_MISC_FIELD_CHARS=128;P.modules.TakedownFormBase=P.Module.extend({events:{"click .addAnotherButton":"onAddAnotherClick","click .removeItemButton":"onRemoveItemClick","click .sameInfoButton":"onSameInfoClicked"},onCreated:function(){this.numReportedItems=1},onRemoveItemClick:function(){if(this.numReportedItems>1){var a=this.$(".ReportedContent:last");a.remove(),this.numReportedItems-=1}else{var b={name:"ConfirmDialog",options:{message:"You must report at least one item."}},c=this;P.loadModule(b,function(a){c.showInModal(a)})}},onAddAnotherClick:function(){var a=new P.modules.ReportedContent({options:{view_type:this.extraData.view_type}}),b=this.$(".reportedContent"),c=this;a.render(function(){if(c.numReportedItems<MAX_REPORTED_ITEMS)c.insertChild(a,b),c.numReportedItems+=1,c.onContentReady();else{var d={name:"ConfirmDialog",options:{message:"No more than 10 reported items per form, please."}};P.loadModule(d,function(a){this.showInModal(a)})}})},onSameInfoClicked:function(){for(var a=this.$(".contentReporter"),b=this.$(".rightsOwner"),c=0;c<a.length;c++)b[c].value=a[c].value;var d=this.form.getField("owner_name");this.form.validateField(d);var e=this.form.getField("owner_email");this.form.validateField(e)},onContentReady:function(){var a={agent_name:[P.Validator.Required()],agent_street_address:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_city:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_state:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_zipcode:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],agent_country:[],agent_phone:[P.Validator.PhoneNumber()],agent_email:[P.Validator.Email({}),P.Validator.Required()],owner_name:[P.Validator.Required()],owner_street_address:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],owner_city:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],owner_state:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],owner_zipcode:[P.Validator.Length({max:MAX_MISC_FIELD_CHARS})],owner_country:[],owner_phone:[P.Validator.PhoneNumber()],owner_email:[P.Validator.Email({}),P.Validator.Required()],is_accurate:[P.Validator.Required()],is_good_faith:[P.Validator.Required()],is_authorized_agent:[P.Validator.Required()],signed_name:[P.Validator.Required(),P.Validator.EqualTo({targetFieldName:"agent_name",message:"Electronic signature doesn't match your name."})]};this.$(".owner_website_url")&&(a.owner_website_url=[P.Validator.Required(),P.Validator.URL()]),this.$(".reported_content_url")&&(a.reported_content_url=[P.Validator.Required(),P.Validator.URL()]),this.$(".context_notes")&&(a.context_notes=[P.Validator.Length({max:MAX_CONTEXT_NOTES_CHARS})]),this.$(".exact_string")&&(a.exact_string=[P.Validator.Required()]);var b={prevalidate:!0};this.$form=this.$("form"),this.form=new P.Form(this.$form,a,b),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},getFormData:function(){var a=[],b={},c=this.form.$el.serializeArray(),d=["owner_website_url","reported_content_url","context_notes","exact_string"],e=[],f={};return _.each(c,function(c){-1!==d.indexOf(c.name)?(-1!==e.indexOf(c.name)&&(a.push(f),e=[],f={}),f[c.name]=c.value,e.push(c.name)):b[c.name]=b[c.name]="on"===c.value?!0:c.value}),a.push(f),b.reported_content=a,b},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.getChildById("submitButton");b.showLoading();var c=this.getFormData();c.form_type=this.extraData.view_type;var d=P.resourceFactory.create("TakedownRequestResource",c);d.options=c;var e=this;d.callCreate({error:P.NOOP}).then(function(a){b.hideLoading();var c=a.resource_response.data,d="Thanks for submitting. Your confirmation number is "+c+".",f={name:"ConfirmDialog",options:{button_text:"Got it!",body_message:d,title:"Request Submitted",template:"generic"}};P.loadModule(f,function(a){e.showInModal(a)})}).fin(function(){b.hideLoading()})}}}),goog.provide("P.modules.Token"),goog.require("P.Module"),P.modules.Token=P.Module.extend({getTokenData:function(){return{}},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/Token/Token.nunjucks")}),goog.provide("P.modules.TokenizedInput"),goog.require("P.Module"),goog.require("P.modules.Token");var MIN_INPUT_FIELD_WIDTH=100;P.modules.TokenizedInput=P.Module.extend({events:{"keyup input":"onInputKeyup","keydown input":"onInputKeydown","click .tokenWrapper":"onTokenModuleWrapperClick","click .inputToken":"onInputTokenClick","click .removeAll":"onRemoveAll"},onCreated:function(){this.options.handled_by_parent||this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.tokens=[],this.savedTokens=[],this.selectedToken=null,this.childListen(P.CONST.EVENT_REMOVE_TOKEN,this.onRemoveToken),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,_.bindFn(this.onBodyColumnChange,this)),this.updateTokenizedInputView=_.bindFn(this.updateTokenizedInputView,this)},onRemoveToken:function(a){var b=a.data,c=_.indexOf(this.tokens,b),d=this.tokens[c].getTokenData();this.removeToken(b),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,d,!0)},onInputTokenClick:function(){this.selectedToken&&this.unselectSelectedToken(),this.options.hide_tokens_on_focus&&this.setEditingTokenText()},setEditingTokenText:function(){var a=this,b=this.getTokens();if(b.length>0){var c=this.constructTokenTextLeftToRight();this.savedTokens=$.extend(!0,[],b);var d=_.clone(b);_.each(d,function(b){a.removeToken(b)}),this.getInputField().setValue(c),_.defer(function(){a.getInputField().setCursorPosition(c.length)})}},onBodyColumnChange:function(){this.updateTokenizedInputView()},constructTokenText:function(){return"prioritized"===this.options.token_text_strategy?this.constructTokenTextBasedOnPriority():this.constructTokenTextLeftToRight()},_getTokensWidth:function(a,b){for(var c=this.getTokens(),d=0,e=a;e<=b;e++)d+=c[e].getWidth(!0);return d},updateTokenizedInputView:function(){var a=this.getWidth(),b=this.getTokens(),c=this._getTokensWidth(0,b.length-1),d=a-c;if(d>=MIN_INPUT_FIELD_WIDTH)this.$(".tokensWrapper").css("left",0),this.$(".tokensWrapper").css("width",a+"px"),this.$(".inputToken").css("width",d+"px");else{var e=c+MIN_INPUT_FIELD_WIDTH;if(this.$(".tokensWrapper").css("width",e+"px"),this.$(".inputToken").css("width",MIN_INPUT_FIELD_WIDTH+"px"),this.selectedToken){var f=_.indexOf(b,this.selectedToken),g=Math.abs(parseInt(this.$(".tokensWrapper").css("left"),10)),h=this._getTokensWidth(0,f-1);h-g>=0?h-g>a&&this.$(".tokensWrapper").css("left",a-e+"px"):this.$(".tokensWrapper").css("left",0)}else this.$(".tokensWrapper").css("left",a-e+"px")}},constructTokenTextBasedOnPriority:function(){var a=this.getTokens(),b="";return _.each(a,function(a){var c=a.getTokenData(),d=c.text,e=c.priority;"0"===e?b=d+" "+b:b+=" "+d,b=$.trim(b)}),b},constructTokenTextLeftToRight:function(){var a=this.getTokens(),b="";return _.each(a,function(a){var c=a.getTokenData(),d=c.text;b+=" "+d,b=$.trim(b)}),b},getTokenInputValue:function(){var a=this.constructTokenText();return $.trim(a+" "+this.getInputValue())},getInputValue:function(){return $.trim(this.getInputField().getValue())},setTokenValue:function(a){var b=this,c=a.toLowerCase();if(this.savedTokens.length>0)return this.clearTokens(),this.addTokensAndUpdateInputView(this.savedTokens),"";var d=this.getTokens(),e=_.clone(d);return _.each(e,function(a){var d=a.getTokenData(),e=d.text,f=new RegExp("(^|\\s)"+e+"(?=\\s|$)");c.match(f)?c=c.replace(e,""):b.removeToken(a),c=$.trim(c)}),$.trim(c)},setInputValue:function(a){this.getInputField().setValue(a)},onTokenModuleWrapperClick:function(a){var b=this,c=$(a.currentTarget),d=c.find(".Module").first(),e=this.getChildByElement(d);if(e&&(e===this.selectedToken?this.unselectSelectedToken():this.selectToken(e),a.stopPropagation()),this.options.hide_tokens_on_focus){var f=this._findIndexSelectedToken();this.setEditingTokenText(),f>=0&&(_.defer(function(){b.getInputField().focus(),b.getInputField().setCursorPosition(f)}),this.unselectSelectedToken())}},getTokens:function(){return this.tokens},onInputKeydown:function(a){var b=a.keyCode,c=$(a.target),d=c[0].selectionEnd,e=_.indexOf(this.tokens,this.selectedToken);switch(b){case P.keyCode.LEFT:if(0!==d)break;if(!this.tokens.length)break;this.selectedToken?0!==e?this.selectAdjacentToken(!0):this.unselectSelectedToken():this._handleNoSelectedTokenKeydown(!1);break;case P.keyCode.RIGHT:this.selectedToken&&(e!==this.tokens.length-1?this.selectAdjacentToken(!1):this.unselectSelectedToken(),a.preventDefault());break;case P.keyCode.BACKSPACE:if(0===d)if(a.preventDefault(),this.selectedToken){var f=this.selectedToken;this.unselectSelectedToken(),this.removeToken(f),this._shouldSelectOnBackspaceKeydown=!1,this.getInputField().focus()}else this.removeToken(_.last(this.tokens))}},onInputKeyup:function(a){var b=a.keyCode;return b!==P.keyCode.LEFT&&b!==P.keyCode.RIGHT&&b!==P.keyCode.BACKSPACE?void this.unselectSelectedToken():(a.preventDefault(),this._shouldSelectOnBackspaceKeydown=!0,void a.stopPropagation())},_handleNoSelectedTokenKeydown:function(a){var b;b=a?_.first(this.tokens):_.last(this.tokens),this.selectToken(b)},selectAdjacentToken:function(a){var b,c=_.indexOf(this.tokens,this.selectedToken);b=-1!==c?a?this.tokens[c-1]:this.tokens[c+1]:a?_.last(this.tokens):_.first(this.tokens),b||(b=null),this.selectToken(b)},getInputFieldValue:function(){var a=this.getInputField(),b=a.getValue();return b},selectToken:function(a){this.selectedToken&&this.selectedToken.getContent().removeClass("tokenSelected"),this.selectedToken=a,a&&this.selectedToken.getContent().addClass("tokenSelected"),this.updateTokenizedInputView()},_findIndexSelectedToken:function(){if(this.selectedToken){for(var a=_.indexOf(this.tokens,this.selectedToken),b="",c=0;c<=a;c++)b+=" "+this.tokens[c].getTokenData().text;return $.trim(b).length}return-1},unselectSelectedToken:function(){this.selectedToken&&(this.selectedToken.getContent().removeClass("tokenSelected"),this.selectedToken=null,this.updateTokenizedInputView())},getInputField:function(){return this.getChildById("input")},onTypeaheadItemSelected:function(a){var b=this,c=$.extend(!0,{},this.options.token_module),d=a.data.item.attributes;if(c.data=d,!c)throw new Error("TokenizedInput module needs a `token_module` option.");P.loadModule(c).then(function(a){a.renderExistingData(),b.addToken(a);var c=this.getInputField();c.clear(),c.focus()})},updateInputPlaceholder:function(){this.tokens&&this.tokens.length>0?this.getInputField().clearPlaceholder():this.getInputField().restorePlaceholder()},addTokensAndUpdateInputView:function(a){var b=this,c=_.map(a,function(a){return b.addToken(a)});Promise.all(c).then(this.updateTokenizedInputView)},addToken:function(a){var b=$('<li class="tokenizedItem tokenWrapper"></li>'),c=this.$(".inputToken");return b.insertBefore(c),this.insertChild(a,b),this.tokens.push(a),this.triggerEvent(P.CONST.EVENT_TOKEN_ADDED,a,!0),this.updateInputPlaceholder(),this.options.show_remove_all&&this.updateRemoveAll(),a.render()},removeToken:function(a){var b=_.indexOf(this.tokens,a);this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED,a,!0),-1!==b&&(this.tokens.splice(b,1),this.$(".tokenWrapper").eq(b).remove(),a.destroy()),this.updateInputPlaceholder(),this.updateTokenizedInputView(),this.options.show_remove_all&&this.updateRemoveAll()},clearTokens:function(){var a=this,b=this.getTokens();if(b.length>0){var c=_.clone(b);_.each(c,function(b){a.removeToken(b)})}},clearSavedTokens:function(){this.savedTokens=[]},onRemoveAll:function(a){this.clearTokens(),this.clearSavedTokens(),this.getInputField().clear(),this.triggerEvent(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,null,!0),a.stopPropagation()},updateRemoveAll:function(){this.tokens.length>0?this.$(".removeAll").show():this.$(".removeAll").hide()},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/TokenizedInput/TokenizedInput.nunjucks")}),goog.provide("P.modules.Tutorial"),goog.require("P.Module"),P.modules.Tutorial=P.Module.extend({onContentReady:function(){this.manager=P.TutorialManager.instance(),this.childListen(P.CONST.EVENT_NEXT,_.bindFn(this.manager._next,this.manager)),this.childListen(P.CONST.EVENT_PREVIOUS,_.bindFn(this.manager._previous,this.manager)),this.manager.startTutorial(this.options.tutorial_name,{moduleContainer:this})
},onDestroyed:function(){this.manager.stopTutorial()}}),goog.provide("P.modules.UnauthHomePageBase"),goog.require("P.Module"),goog.require("P.modules.BackgroundImage"),P.modules.UnauthHomePageBase=P.Module.extend({onContentReady:function(){P.trackRegisterAction("unauth_home"),this.setupInspiredWall(),this.app_upsell_setup(),this.multi_step_signup_setup()},multi_step_signup_setup:function(){var a=this;this.title_div=this.$(".title"),this.subtitle_div=a.$(".subtitle"),this.homeUnauthNumbers=a.$(".homeUnauthNumbers"),this.businessSignup_div=a.$(".businessSignup"),this.fbButton=this.$(".unAuthFacebookConnect"),this.pinCaption=this.$(".inspiredSearchPinCaption"),this.registrationContainer=this.$(".inspiredSearchRegistrationContainer"),this.groupSeparator_div=this.$(".groupSeparator"),this.step1Bottom=this.$(".step1bottom"),this.buttonContainer=this.$(".registerButtons"),this.tosFooter=this.$(".termsOfServiceFooter"),this.default_delay=200,this.childListen("emailSignupClick",function(){a.transitionToSignupForm(this.default_delay)}),this.childListen("transitionToSecondStep",function(){a.transitionToSecondStep()}),this.childListen("fadeOutFbButton",function(){this.buttonContainer.width(this.buttonContainer.width()),a.fbButton.fadeOut(a.default_delay)}),this.extraData&&"variation_b"===this.extraData.multi_step&&(a.transitionToSignupForm(0),this.homeUnauthNumbers.css("top","435px"))},app_upsell_setup:function(){var a=P.getQueryStringParams().username;a&&(this.appUpsellButton=this.getChildById("appUpsellButton"),this.appUpsellButton&&this.listen(this.appUpsellButton,P.CONST.EVENT_BUTTON_CLICK,this.installAppEmail),this.$(".maskInput").show(),P.trackRegisterAction("app_install_show_banner"))},onFailure:function(){this.appUpsellButton.hideLoading(),this.$(".failureText").text("We are unable to send the email again because we've already sent you one today!"),this.$(".maskInput").hide(),this.$(".maskFailure").show()},onSuccess:function(a){this.$(".successText").text(a),this.$(".maskInput").hide(),this.$(".maskSuccess").show()},installAppEmail:function(){var a=this,b=P.getQueryStringParams().username,c=P.resourceFactory.create("AppUpsellResource",{username:b});P.trackRegisterAction("app_install_click_button"),c.callCreate({error:P.NOOP}).then(function(b){P.trackRegisterAction("app_install_sent_email");var c=b.resource_response.data,d=c.message;a.onSuccess(d)},_.bindFn(this.onFailure,this))},transitionToSignupForm:function(a){var b=this.default_delay;void 0!==a&&(b=a),this.extraData&&"variation_b"===this.extraData.multi_step||this.homeUnauthNumbers.animate({opacity:0}),this.pinCaption.animate({marginTop:"0"},b),this.registrationContainer.animate({marginTop:"10px"},b),this.groupSeparator_div.delay(1.5*b).fadeIn(b),this.step1Bottom.delay(1.5*b).fadeIn(b),this.tosFooter.fadeIn(),P.trackRegisterAction("register_multi_screen_username_pass_loaded")},transitionToSecondStep:function(){this.extraData&&"variation_b"===this.extraData.multi_step&&this.homeUnauthNumbers.animate({opacity:0}),this.title_div.text(this.extraData.secondStepMessage).fadeIn(),this.subtitle_div.animate({opacity:0}),this.businessSignup_div.fadeIn(),this.tosFooter.fadeOut(),P.trackRegisterAction("register_multi_screen_username_pass_complete")},setupInspiredWall:function(){this.story=this.extraData.story,this.inspiredSearchContentWrapper=this.$(".inspiredSearchContentWrapper"),$(this.$el).bind("mousewheel",_.bindFn(this.onWheelScroll,this)),$(this.$el).bind("DOMMouseScroll",_.bindFn(this.onWheelScroll,this)),this.setInspiredStory()},onWheelScroll:function(a){a.preventDefault&&a.preventDefault(),a.returnValue=!1},setInspiredStory:function(){var a=this.getChildById("bgImage_"+this.story.story_id);a.setActive(!0),this.loadedBackgrounds||(this.loadedBackgrounds=!0,a.setNewImage(this.story.bg_color,this.story.bg_image),this.inspiredSearchContentWrapper.css("background-image","url("+this.story.bg_dialog_image+")"))}}),goog.provide("P.modules.UserBase"),goog.require("P.Module"),P.modules.UserBase=P.Module.extend({events:{}}),goog.provide("P.modules.UserProfileContentBase"),goog.require("P.Module"),P.modules.UserProfileContentBase=P.Module.extend({events:{}}),goog.provide("P.modules.UserProfilePage"),goog.require("P.Module"),P.modules.UserProfilePage=P.Module.extend({events:{},_tabs_to_resource:{boards:"BoardsResource",pins:"UserPinsResource",likes:"UserLikesResource",followers:"UserFollowersResource",following:"UserFollowingResource"},getLoggingObjectIdStr:function(){return this.data.id},onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onRemovedFromDom:function(){this._removeListeners()},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_BLOCKED]=this.onAccessChange,a[P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED]=this.onAccessChange,this.pubsubSubscribe(this.data.id,a),"1"===this.options.show_redirected_memo&&this.showRedirectDialog()},showRedirectDialog:function(){var a={name:"ConfirmDialog",options:{template:"deleted_board_redirect",user_name:this.data.full_name,auto_close_delay_ms:7e3}};P.loadModule(a,function(a){P.getModalManager().showInModal(a)})},onAccessChange:function(){this.render()},onChildNavigate:function(a){this.log.debug("UserProfilePage got navigate event from child",a.target,"for url:",a.data.url);var b=P.router.get()&&P.router.get().resolve(a.data.url);if(b){var c=b.module,d=b.options,e=b.resource,f=e.options&&e.options.username,g=this.data;if(this.contentReady&&c===this.className&&f===(g&&g.username)){this.setOptions(d),this.setResource(e);var h=this.$el.height();this.$el.css("min-height",h);var i=this.getScrollableElement(),j=i.scrollTop(),k=this,l=d.tab,m=this.getChildByModuleName("UserProfileContent"),n=this.getChildByModuleName("UserInfoBar");n.setOptions({tab:l}),n.render(),m.setOptions({tab:l}),m.showLoading(),m.render(function(){m.hideLoading(),k.$el.css("min-height","");var a=i.height(),b=k.$el.positionAncestor(i).top,c=k.$el.height(),d=j+a-c+b;d>0&&(k.$el.css("min-height",c+d),i.scrollTop(j))}),a.data.handled=!0}}}}),goog.provide("P.modules.UserRegisterBase"),goog.require("P.Module"),goog.require("P.modules.LoginBase");var USER_REGISTER_BASE_CLASS_HIDDEN="hidden";P.modules.UserRegisterBase=P.modules.LoginBase.extend({events:{"blur #userFirstName,#userLastName,#userEmail":"computeUsernameSuggestion","keyup #userEmail":"computeUsernameSuggestion","focus #userUserName":"onSuggestUsername","keyup #userUserName":"onUsernameChanged","keyup #userAge":"onAgeChanged",'change select[name="country"]':"onCountryChanged","blur input[name=email]":"onBlurEmail","click .suggestionEmail":"onClickSuggestionEmail",'click input[name="facebook_timeline_enabled"]':"onCheckboxChanged"},network:null,networkCredentials:{},usernameSuggestionResource:null,fieldValues:{},currentUsernameSuggestion:"",userModifiedUsername:!1,fbAccess:!1,onCountryChanged:function(a){var b=this.$(".termsWrapper"),c=this.$(".helpText");"FR"===$(a.target).val()?(b.removeClass(USER_REGISTER_BASE_CLASS_HIDDEN),c.addClass(USER_REGISTER_BASE_CLASS_HIDDEN)):(b.addClass(USER_REGISTER_BASE_CLASS_HIDDEN),c.removeClass(USER_REGISTER_BASE_CLASS_HIDDEN))},onBlurEmail:function(){if(this.extraData.show_email_suggestion){var a=this,b=this.$inputEmail.val(),c=_.extend({},{email:b,email_filter:"unused"});null==this.emailSuggestionResource&&(this.emailSuggestionResource=P.resourceFactory.create("EmailSuggestionResource",c)),this.emailSuggestionResource.options=c,this.emailSuggestionResource.callGet({success:function(c){var d=c.resource_response.data;d.length>0?(a.$inputEmail.val(d[0]),a.$suggestionEmail.text(b),a.$suggestion.slideDown()):a.$suggestion.slideUp()},error:function(){a.$suggestion.slideUp()}})}},onClickSuggestionEmail:function(a){var b=this.$suggestionEmail.text();this.$inputEmail.val(b),this.$suggestion.slideUp(),a.preventDefault()},onContentReady:function(){if(P.currentUser.isAuthenticated())return void this.redirect();if(Cookie.get(P.CONST.COOKIE_REGISTER_RESTRICT))return void this.redirect();var a=this;P.FbUtil.checkFbTimelinePermission({success:function(){a.toggleFbTimelinePermission(!0)},error:function(){a.toggleFbTimelinePermission(!1)}});var b={first_name:[P.Validator.Required()],email:[P.Validator.Required(),P.Validator.Email()],age:[P.Validator.Number()]};this.$suggestion=this.$(".suggestion"),this.$suggestionEmail=this.$(".suggestionEmail"),this.$inputEmail=this.$("input[name=email]"),this.extraData.show_password&&(b.password=[P.Validator.ContainsOnlyAscii({message:P._("English letters, numbers, basic symbols only.")}),P.Validator.Password()]),this.short_signup_landing_setup(),this.extraData.multi_step&&(b={email:[P.Validator.Required({message:P._("Missed a spot-please enter a valid email to continue.")}),P.Validator.Email({message:P._("Hmm... that doesn't look like an email address.")})],age:[P.Validator.Number({message:P._("Please enter a valid number for your age.")})],password:[P.Validator.ContainsOnlyAscii({message:P._("Only letters, numbers, or basic symbols, please.")}),P.Validator.Password({shortPassStr:P._("Your password is too short! Use at least 6 characters."),badPassStyle:P._("Your password does not have the proper style."),samePasswordStr:P._("Please make your username and password different."),blackPassStr:P._("Please make a stronger password.")})]}),this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),b),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var c=this.options.network&&!this.options.network_data;c&&(this.showLoading(),P.UserRegistration.fetchNetworkData(this.options.network).then(function(b){a.populateForm(b)}).fin(function(){a.hideLoading()}));var d={};this.options.network===P.SocialConnect.GPLUS?(d.gplus_code=P.SessionStorage.getItem(P.CONST.SESSION_GPLUS_CODE),d.gplus_redirect_uri=P.SessionStorage.getItem(P.CONST.SESSION_GPLUS_REDIRECT_URI),a.populateForm(d),P.SessionStorage.removeItem(P.CONST.SESSION_GPLUS_CODE),P.SessionStorage.removeItem(P.CONST.SESSION_GPLUS_REDIRECT_URI)):this.options.network===P.SocialConnect.TWITTER?(d.twitter_id=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_ID),d.twitter_token=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_TOKEN),d.twitter_token_secret=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_TOKEN_SECRET),d.first_name=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_FIRST_NAME),d.last_name=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_LAST_NAME),d.username=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_USERNAME),d.image_url=P.SessionStorage.getItem(P.CONST.SESSION_TWITTER_IMAGE_URL),a.populateForm(d),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_ID),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_TOKEN),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_TOKEN_SECRET),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_FIRST_NAME),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_LAST_NAME),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_USERNAME),P.SessionStorage.removeItem(P.CONST.SESSION_TWITTER_IMAGE_URL)):this.options.network===P.SocialConnect.RAKUTEN&&(d.rakuten_id=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_ID),d.rakuten_token=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_TOKEN),d.rakuten_refresh_token=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN),d.first_name=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME),d.email=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_EMAIL),d.gender=P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_GENDER),a.populateForm(d),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_ID),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_TOKEN),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_EMAIL),P.SessionStorage.removeItem(P.CONST.SESSION_RAKUTEN_GENDER)),this.fieldValues=this.getFieldValues(),this.currentUsernameSuggestion=this.$("#userUserName").val(),this.currentUsernameSuggestion&&this.addUsernameAsSuggestionMessage(),this.first_step="first_step",this.second_step="second_step",this.email_input=this.$("input[name='email']"),this.password_input=this.$("input[name='password']"),this.email_signup_button=this.$("#emailSignupButton"),this.user_full_name_input=this.$("#userFullName"),this.user_age_input=this.$("#userAge"),this.final_signup_button=this.$(".signup"),this.step_1_div=this.$(".step1"),this.step_1_div_top=this.$(".step1top"),this.firstErrorTooltip=this.$("#firstStepTooltip"),this.secondErrorTooltip=this.$("#secondStepTooltip"),this.firstStepButton=this.$(".continueButton"),this.secondStepButton=this.$(".signup"),this.first_step_complete=!1,this.getChildById("emailSignup")&&this.listen(this.getChildById("emailSignup"),P.CONST.EVENT_BUTTON_CLICK,function(){this.email_signup_button.fadeOut(200),a.triggerEvent("emailSignupClick",null,!0)}),this.getChildById("emailCompleteFirstStep")&&this.listen(this.getChildById("emailCompleteFirstStep"),P.CONST.EVENT_BUTTON_CLICK,this.validateFirstStep),this.getChildById("submitButton")&&this.listen(this.getChildById("submitButton"),P.CONST.EVENT_BUTTON_CLICK,this.validateSecondStep),this.$(".inlineEmailForm").keypress(function(b){13===b.keyCode&&(a.first_step_complete?a.secondStepButton.click():a.firstStepButton.click())})},short_signup_landing_setup:function(){var a=P.getQueryStringParams().email;a&&this.$inputEmail.val(a)},facebookConnect:function(a){a.stopPropagation(),this.connect(P.SocialConnect.FACEBOOK,this.onFacebookConnectSuccess)},getErrorMessage:function(a,b){return a in this.extraData&&b in this.extraData[a]?this.extraData[a][b]:this.extraData.other.other},validateFirstStep:function(){var a=this;this.form.validateField(this.email_input,function(b){0!==b.errors.length?a.validateComplete(a.first_step,b.errors[0]):a.form.validateField(a.password_input,function(b){if(0!==b.errors.length)a.validateComplete(a.first_step,b.errors[0]);else{var c=P.resourceFactory.create("EmailExistsResource",{email:a.email_input.val()});c.callGet({success:function(b){if(b.resource_response.data===!1)a.validateComplete(a.first_step,null,a.email_input.val());else{var c={username_or_email:a.form.getValue("email"),password:a.form.getValue("password")},d=function(){P.trackRegisterAction("multi_step_login"),a.redirect(P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW))},e=function(){a.validateComplete(a.first_step,P._("That email's already taken."))};a.login(c,e,d)}},error:function(){a.validateComplete(a.first_step,P._("Hmm... that doesn't look like an email address."))}})}})})},validateSecondStep:function(){if(!this.first_step_complete)return void this.validateFirstStep();var a=this;if(this.extraData.multi_step&&""!==this.user_full_name_input.val().trim()){var b=this.user_age_input.val(),c=parseInt(b,10);""===b||c>=0&&c<=200?a.final_signup_button.submit():a.validateComplete(a.second_step,P._("Please enter a valid age."))}else a.validateComplete(a.second_step,P._("And your name is...?"))},validateComplete:function(a,b,c){if(!P.getQueryStringParams().email){var d;if(a===this.first_step)d=this.firstErrorTooltip;else{if(a!==this.second_step)throw"invalid step_no";d=this.secondErrorTooltip}this.triggerEvent("fadeOutFbButton",null,!0);var e=200;if(b)a===this.first_step&&this.step_1_div_top.fadeOut(e),d.text(b).delay(1.5*e).fadeIn(e);else if(a===this.first_step){var f=P.resourceFactory.create("EmailSignupReminderResource",{page:window.location.href,email:c});f.callCreate(),this.first_step_complete=!0,this.triggerEvent("transitionToSecondStep",null,!0);var g=this;this.step_1_div.fadeOut(e).next(".step2").delay(1.5*e).fadeIn(e,function(){g.$("input[name='full_name']").focus()})}}},toggleFbTimelinePermission:function(a){this.fbAccess=a;var b=this.$('input[name="facebook_timeline_enabled"]');b.prop("checked",a)},getFieldValues:function(){var a={first_name:this.$("#userFirstName").val(),last_name:this.$("#userLastName").val()},b=this.$("#userEmail").val();return b&&b.match("@")&&(a.email=b.replace(/@.*/,"@")),a},computeUsernameSuggestion:function(){if(!this.userModifiedUsername){var a=this.getFieldValues();if(!_.isEqual(this.fieldValues,a)){this.fieldValues=a;var b=_.extend({},this.fieldValues,{limit:1});null==this.usernameSuggestionResource&&(this.usernameSuggestionResource=P.resourceFactory.create("UsernameSuggestionResource",b));var c=this;this.usernameSuggestionResource.options=b,this.usernameSuggestionResource.callGet({success:function(a){c.currentUsernameSuggestion=a.resource_response.data[0]},error:P.NOOP})}}},onSuggestUsername:function(){if(!this.userModifiedUsername&&this.currentUsernameSuggestion){var a=this.$("#userUserName");a.val()!==this.currentUsernameSuggestion&&(a.val(this.currentUsernameSuggestion),this.form.validateField(a),this.addUsernameAsSuggestionMessage())}},onUsernameChanged:function(){var a=this.$("#userUserName");a.val().length?this.currentUsernameSuggestion!==a.val()&&(this.userModifiedUsername=!0,this.removeUsernameAsSuggestionMessage()):(this.userModifiedUsername=!1,this.computeUsernameSuggestion(),this.removeUsernameAsSuggestionMessage())},onAgeChanged:function(){var a=this.$("#userAge");this.$(".ageLabel .hiddenValue").text(a.val()),a.val().length?this.$(".ageLabel").addClass("active"):this.$(".ageLabel").removeClass("active")},addUsernameAsSuggestionMessage:function(){var a=this.$("#userUserName");if(0===a.nextAll(".formHelpMessage").length){var b=P._("Suggested username");a.after('<p class="formHelpMessage">'+b+"</p>")}},removeUsernameAsSuggestionMessage:function(){var a=this.$("#userUserName"),b=a.nextAll(".formHelpMessage");b.remove()},onCheckboxChanged:function(a){var b=$(a.target),c=this;if(b.prop("checked")&&!this.fbAccess){var d={success:function(){c.fbAccess=!0},error:function(){b.prop("checked",!1)}};P.FbUtil.fbLogin(d)}},populateForm:function(a){this.options.network_data=a;var b={first_name:a.first_name,last_name:a.last_name,email:a.email,social_username:a.username,limit:1};this.resource=P.resourceFactory.create("UsernameSuggestionResource",b);var c=this,d=function(){c.hideLoading()};this.render(d,d)},onSubmitValidated:function(a){if(!a.errors[0]){if(this.extraData.multi_step&&this.user_full_name_input&&""===this.user_full_name_input.val().trim())return;var b=this.getChildById("submitButton"),c=this,d=this.extraData&&this.extraData.networkCredentials||{},e=_.extend({skip_nux:this.options.skip_nux},this.getFormData(),d);P.UserRegistration.addExtraSocialParams(this.options.network,e).then(function(){c.options.network_data&&(e.social_username=c.options.network_data.username),b.showLoading(),P.UserRegistration.register(c.options.network,e).then(function(){c.redirect()},function(a){b.hideLoading(),a.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT&&c.redirect()})})}},redirect:function(){if(Cookie.get(P.CONST.COOKIE_REGISTER_RESTRICT))return void P.changeWindowLocation("/join/restricted/age/",!1);if(this.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0)){var a="/";this.options.auto_follow_interest&&(a=P.url.appendQueryString(a,{auto_follow_interest:this.options.auto_follow_interest})),P.navigateAfterLoginStatusChange(a)}},getFormData:function(){var a=this.$("form").serializeArray(),b={},c="";if(_.each(a,function(a){"full_name"===a.name?c=a.value.trim():b[a.name]="on"===a.value?!0:a.value}),c){var d=c.split(" ");""===d[0]&&d.shift(),d.length>0&&(b.first_name=d[0]||""),d.length>1&&(b.last_name=d[1]||"")}return b}}),goog.provide("P.modules.UserRegisterPageBase"),goog.require("P.Module"),P.modules.UserRegisterPageBase=P.Module.extend({}),goog.provide("P.modules.promo.PlacesBoardExamples"),goog.require("P.Module"),P.modules.promo.PlacesBoardExamples=P.Module.extend({}),goog.provide("P.modules.tutorials.StepBase"),goog.require("P.interfaces.TutorialStep"),goog.require("P.Module"),P.modules.tutorials.StepBase=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick);var a={};a[P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT]=function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,a),this.initializeStep(),this.isContextualExperience=!1},initializeStep:P.NOOP,onEnter:function(a){a&&a()},onShow:function(a){a&&a()},onRemoved:P.NOOP,onExit:function(a){a&&a()},onButtonClick:function(){},_onButtonClick:function(a){var b=a.target;b&&(this.onButtonClick(a),a.shouldPropagate()&&("previousButton"===b.id?(a.stopPropagation(),this.onPreviousButtonClicked()):"nextButton"===b.id&&(a.stopPropagation(),this.onNextButtonClicked())))},onPreviousButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0)},onNextButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0)},getExperienceId:function(){return null},getPlacementId:function(){return null},getPlacedExperienceId:function(){return this.isContextualExperience?P.ExperienceManager.instance().constructPlacedExperienceId(this.getPlacementId(),this.getExperienceId()):null},completePlacedExperience:function(a){var b=P.ExperienceManager.instance();this.getPlacedExperienceId()?b.completePlacedExperienceId(this.getPlacedExperienceId(),a):b.completePlacedExperience(this.getPlacementId(),this.getExperienceId(),a)},dismissPlacedExperience:function(a){var b=P.ExperienceManager.instance();this.getPlacedExperienceId()?b.dismissPlacedExperience(this.getPlacedExperienceId(),a):b.dismissPlacedExperience(this.getPlacementId(),this.getExperienceId(),a)},setExperienceViewed:function(){var a=P.ExperienceManager.instance();this.getPlacedExperienceId()?a.viewPlacedExperienceId(this.getPlacedExperienceId()):a.viewPlacedExperience(this.getPlacementId(),this.getExperienceId())}}),goog.provide("P.modules.ui.Checkbox"),goog.require("P.Module");var CLASS_ON="on",PROP_CHECKED="checked";P.modules.ui.Checkbox=P.Module.extend({onContentReady:function(){this.$input=this.$el,"fancyToggle"===this.options.view_type||"fancyCheckbox"===this.options.view_type?(this.$input=this.$("input"),this.$el.on("click",_.bindFn(this.onFancyToggleCheckboxClick,this))):this.$el.on("change",_.bindFn(this.toggle,this))},onFancyToggleCheckboxClick:function(a){var b=$(a.currentTarget).parent()[0].tagName,c="label"===b.toLowerCase(),d=!c||c&&$(a.target).is(":checkbox");d&&this.toggle()},toggle:function(){this.setChecked(!this.options.checked,!0)},setChecked:function(a,b){void 0===b&&(b=!0),a===this.options.checked||this.options.disabled||(this.options.checked=a,this.$el.toggleClass(CLASS_ON,a),this.$input.prop(PROP_CHECKED,a),b&&this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0))},isChecked:function(){return!!this.options.checked},getCheckboxName:function(){return this.options.name},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/Checkbox/Checkbox.nunjucks")}),goog.provide("P.modules.ui.CheckboxGroup"),goog.require("P.Module"),P.modules.ui.CheckboxGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onInputChange),this.checkboxModules=this.getChildrenByModuleName("ui.Checkbox");var a={};_.each(this.options.items,function(b){var c=b.name;a[c]={name:c,label:b.label}}),this._checkboxes=a},onInputChange:function(a){a.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getValue:function(){var a=[],b=this._checkboxes,c=0;return _.each(this.checkboxModules,function(d){var e=d.getCheckboxName();d.isChecked()&&(a[c++]={name:e,label:b[e].label})}),a}}),goog.provide("P.modules.ui.DateField"),goog.require("P.Module");var DF_ACTIVE_CLASS="active",DF_VALUE_CLASS="hasValue",DF_ERROR_FIELD_CLASS="errorField",DF_ERROR_CLASS="hasError";P.modules.ui.DateField=P.Module.extend({events:{click:"onFocus","click input":"onContentClick","click .dateSeparator":"onContentClick","focus .dateComponent":"onContentFocus","blur .dateComponent":"onContentBlur"},onContentReady:function(){this.$month=this.$(".mm"),this.$day=this.$(".dd"),this.$year=this.$(".yyyy")},onContentFocus:function(){this.$el.addClass(DF_ACTIVE_CLASS),this.triggerEvent("focus",null,!0),this.validate(!0)},onContentBlur:function(){this.$el.removeClass(DF_ACTIVE_CLASS),this.hasDate()?this.$el.addClass(DF_VALUE_CLASS):this.$el.removeClass(DF_VALUE_CLASS),this.validate(!1)},onContentClick:function(){return!1},onFocus:function(){this.$month.focus()},validate:function(a){var b,c,d,e;this.$month.removeClass(DF_ERROR_FIELD_CLASS),this.$day.removeClass(DF_ERROR_FIELD_CLASS),this.$year.removeClass(DF_ERROR_FIELD_CLASS),this.$el.removeClass(DF_ERROR_CLASS),(this.$month.val()||this.$day.val()||this.$year.val())&&(this.$month.val()?(c=parseInt(this.$month.val(),10),(!c||c<1||c>12)&&(b=!0,this.$month.addClass(DF_ERROR_FIELD_CLASS))):a||(b=!0),this.$day.val()?(e=parseInt(this.$day.val(),10),(!e||e<1||e>31)&&(b=!0,this.$day.addClass(DF_ERROR_FIELD_CLASS))):a||(b=!0),this.$year.val()?(d=parseInt(this.$year.val(),10),(!d||d<1900||d>(new Date).getFullYear())&&(b=!0,this.$year.addClass(DF_ERROR_FIELD_CLASS))):a||(b=!0)),b?(this.$el.addClass(DF_ERROR_CLASS),this.$(".selectedDate").val("error")):this.$(".selectedDate").val(this.getDateString())},hasDate:function(){return!!this.$month.val()||!!this.$day.val()||!!this.$year.val()},getTimeStamp:function(){var a=this.getDate();return a?Math.round(a/1e3):0},getDateString:function(){var a=this.getDate();return a?a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate():""},getDate:function(){if(!this.hasDate())return null;var a=this.$month.val()+"/"+this.$day.val()+"/"+this.$year.val(),b=Date.parse(a);return isNaN(b)===!1?new Date(b):null}}),goog.provide("P.modules.ui.DatePicker"),goog.require("P.Module");var PICKER_CONTAINER_CLASS=".pickerContainer";P.modules.ui.DatePicker=P.Module.extend({onContentReady:function(){this.minDate=this._normalizeDate(this.options.min_date,new Date(2012,10,1),!0),this.maxDate=this._normalizeDate(this.options.max_date,this.getYesterday(),!0),this.setupPicker(),this.setupQuickSelect()},_normalizeDate:function(a,b,c){if(a===!1)return null;if(c){if("today"===a)return this.getToday();if("tomorrow"===a)return this.getTomorrow()}var d;return a&&(d=new Date(a),d.getDate())?d:b},getDatePicker:function(){return this.$(PICKER_CONTAINER_CLASS)},setupQuickSelect:function(){var a={yesterday:this.onYesterdayClick,lastWeek:this.onWeekClick,lastTwoWeeks:this.onTwoWeekClick,lastMonth:this.onMonthClick},b=this;_.each(a,function(a,c){var d=b.getChildById(c);d&&b.listen(d,P.CONST.EVENT_BUTTON_CLICK,a)})},updateUsingQuickSelect:function(a,b){var c=this.getDatePicker();"single"===this.options.selection_mode&&2===a.length?c.DatePickerSetDate(a[0],!0):c.DatePickerSetDate(a,!0);var d=c.DatePickerGetDate(!0),e=c.DatePickerGetDate(!1);this.onChange(d,e,b)},onYesterdayClick:function(){this.updateUsingQuickSelect(this.getYesterday(),"yesterday")},onWeekClick:function(){var a=this.getYesterday(),b=this.getDaysAgo(7),c=[b,a];this.updateUsingQuickSelect(c,"lastWeek")},onTwoWeekClick:function(){var a=this.getYesterday(),b=this.getDaysAgo(14),c=[b,a];this.updateUsingQuickSelect(c,"lastTwoWeeks")},onMonthClick:function(){var a=this.getYesterday(),b=this.getDaysAgo(30),c=[b,a];this.updateUsingQuickSelect(c,"lastMonth")},getDaysAgo:function(a){var b=this.getToday();return b.setDate(b.getDate()-a),b},getYesterday:function(){return this.getDaysAgo(1)},getTomorrow:function(){return this.getDaysAgo(-1)},getToday:function(){return this.options.utc?P.date.UTCToday():P.date.today()},setupPicker:function(){var a=this;this.getDatePicker().DatePicker({flat:!0,date:this.options.selected_date||this.getYesterday(),calendars:1,mode:this.options.selection_mode||"range",starts:1,onChange:function(b,c){return a.onChange(b,c)},onRender:function(b){return a.onDateRender(b)}})},setSelectedDate:function(a){var b=this.getDatePicker(),c=this._normalizeDate(a);c?b.DatePickerSetDate(c,!0):b.DatePickerClear()},onDateRender:function(a){var b=!1;return this.maxDate&&(b=a.valueOf()>this.maxDate.valueOf()),!b&&this.minDate&&(b=a.valueOf()<this.minDate.valueOf()),{disabled:b}},onChange:function(a,b,c){var d={formatted:a,dates:b,quickSelectOption:c};this.triggerEvent(P.CONST.EVENT_DATEPICKER_DATE_SELECTED,d,!0),a.length>1&&a[0]!==a[1]&&this.triggerEvent(P.CONST.EVENT_DATEPICKER_RANGE_SELECTED,d,!0)},hidePicker:function(){this.parent.hide()}}),goog.provide("P.modules.ui.DateRangeButton"),goog.require("P.Module"),P.modules.ui.DateRangeButton=P.Module.extend({onContentReady:function(){this._button=this.getChildById("button"),this.childListen(P.CONST.EVENT_DATEPICKER_RANGE_SELECTED,this.onDatePickerRangeSelected)},onDatePickerRangeSelected:function(a){var b=a.data;if(b){var c=b.formatted;c&&this._button.setText(c[0]+" - "+c[1])}}}),goog.provide("P.modules.ui.ExpandableTable"),goog.require("P.Module"),P.modules.ui.ExpandableTable=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.currentTarget;if("showMoreButton"===b.id){var c=this.getChildById("uiTable");c.options.max_num_to_show=null,c.render().then(function(){b.hide()})}}}),goog.provide("P.modules.ui.Field"),goog.require("P.Module"),P.modules.ui.Field=P.Module.extend({events:{"focus input":"onInputFocus","blur input":"onInputBlur","keyup input":"onInputKeyup"},onContentReady:function(){this.$input=this.$("input"),this._value=this.options.value||"",this._field=this.getChildById("input"),this.options.currency_symbol&&this.format_as_currency()},onInputFocus:function(a){if(this.options.currency_symbol){var b=$(a.currentTarget);b.length&&b.val((this._value||"").toString())}},onInputBlur:function(){this.options.currency_symbol&&this.format_as_currency()},format_as_currency:function(){if(this.$input.length){var a=this.$input.val(),b=parseFloat(a),c=P.number.quantize(b,2);this._value=c,this.$input.val(c?c.toFixed(2):a)}},disable:function(){this.$input.attr({disabled:""})},enable:function(){this.$input.removeAttr("disabled")},isDisabled:function(){return this.$input.is(":disabled")},onInputKeyup:function(){},setValue:function(a){this._field.setValue(a),this.options.currency_symbol&&(this._value=a)},getValue:function(){return this.options.currency_symbol?this._value.toString()||"0":this._field.getValue()},setPlaceholder:function(a){this.$input.attr("placeholder",a)}}),goog.provide("P.modules.ui.FormItemGroup"),goog.require("P.Module"),P.modules.ui.FormItemGroup=P.Module.extend({}),goog.provide("P.modules.ui.Input"),goog.require("P.Module"),P.modules.ui.Input=P.Module.extend({events:{keyup:"_onKeyup"},_onKeyup:function(a){var b=a.keyCode;b===P.keyCode.ENTER&&this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,null,!0)},onContentReady:function(){this._value=this.options.value||"",this.options.placeholder&&this.$el.placeholder()},setValue:function(a){this.$el.val(a)},getValue:function(){return this.$el.val()},focus:function(){this.$el.focus()},clear:function(){this.setValue("")},clearPlaceholder:function(){this.options.placeholder&&(this.$el.attr("placeholder",""),this.$el.val(""))},restorePlaceholder:function(){this.options.placeholder&&this.$el.attr("placeholder",this.options.placeholder)},setCursorPosition:function(a){this.$el[0].setSelectionRange(a,a)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/Input/Input.nunjucks")}),goog.provide("P.modules.ui.Label"),goog.require("P.Module"),P.modules.ui.Label=P.Module.extend({moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/Label/Label.nunjucks")}),goog.provide("P.modules.ui.MetricControl"),goog.require("P.Module"),P.modules.ui.MetricControl=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange)},onChildChange:function(){}}),goog.provide("P.modules.ui.MetricPoint"),goog.require("P.Module"),P.modules.ui.MetricPoint=P.Module.extend({formatDate:function(a){var b=a.days[a.getUTCDay()],c=a.getMonthName(),d=c+" "+a.getUTCDate()+", "+a.getFullYear();return b+" "+d},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/MetricPoint/MetricPoint.nunjucks")}),goog.provide("P.modules.ui.MultipleSelectButton"),goog.require("P.Module"),P.modules.ui.MultipleSelectButton=P.Module.extend({onContentReady:function(){this._button=this.getChildById("button"),this.childListen(P.CONST.EVENT_CHANGE,this.onCheckboxChanged)
},onCheckboxChanged:function(a){var b=a.target,c=b.getValue(),d=[];_.each(c,function(a){d.push(a.label)}),this._button.setText(d.join(", ")),a.stopPropagation(),this.triggerEvent(P.CONST.EVENT_CHANGE,c,!0)}}),goog.provide("P.modules.ui.Pagination"),goog.require("P.Module"),P.modules.ui.Pagination=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},_onButtonClick:function(a){var b=a.target,c=b.options.page_number,d=this.options.current_page;if(c||("next"===b.id?c=Math.min(this.options.page_count,d+1):"prev"===b.id&&(c=Math.max(1,d-1))),c){var e={pageNumber:c};this.triggerEvent(P.CONST.EVENT_PAGE_NUMBER_CLICK,e,!0)}}}),goog.provide("P.modules.ui.PickerItemCreate"),goog.require("P.Module"),P.modules.ui.PickerItemCreate=P.Module.extend({setCreateName:function(a){this.$(".createName").text(a)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/PickerItemCreate/PickerItemCreate.nunjucks")}),goog.provide("P.modules.ui.Progress"),goog.require("P.Module");var PROGRESS_ACTIVE_CLASS="active";P.modules.ui.Progress=P.Module.extend({moveStep:function(a){this.setStep(this.options.current_step+a)},setStep:function(a){a<0||a>this.options.steps||(this.options.current_step=a,this._localRender(),a===this.options.steps&&this.triggerEvent(P.CONST.EVENT_PROGRESS_COMPLETED,null,!0))},setMiniStepProgress:function(a,b){var c=this.getChildrenByModuleName("ui.ProgressMinistep"),d=0;_.each(c,function(c){c.options.ministep_type===a&&(d<b?(c.setActive(),d++):c.setInactive())})},_localRender:function(){var a=this.$el.children("li"),b=this.options.current_step;$.each(a,function(a,c){$(c).toggleClass(PROGRESS_ACTIVE_CLASS,b>=a+1)})}}),goog.provide("P.modules.ui.ProgressMinistep"),goog.require("P.Module"),P.modules.ui.ProgressMinistep=P.Module.extend({setActive:function(){var a=this.$el.children("li");a.hasClass("active")||a.addClass("active")},setInactive:function(){var a=this.$el.children("li");a.hasClass("active")&&a.removeClass("active")}}),goog.provide("P.modules.ui.RadioButton"),goog.require("P.Module"),P.modules.ui.RadioButton=P.Module.extend({events:{click:"_onClick"},onContentReady:function(){this.$input=this.$("input"),this.input=this.$input[0],this.listen(this.$input,"change",this._onChange)},_onChange:function(a){this.triggerEvent(P.CONST.EVENT_CHANGE,a,!0),this.refreshLayout()},_onClick:function(a){a.target===this.el&&(this.input.checked=!0),this.triggerEvent(P.CONST.EVENT_CHANGE,a,!0),this.refreshLayout()},refreshLayout:function(){this.options.fancy&&this.$el.toggleClass("fancySelected",this.input.checked)}}),goog.provide("P.modules.ui.RadioGroup"),goog.require("P.Module"),P.modules.ui.RadioGroup=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_CHANGE,this.onChildChanged)},onChildChanged:function(a){a.stopPropagation();var b=this.getChildrenByModuleName("ui.RadioButton");_.each(b,function(a){a.refreshLayout()}),this.triggerEvent(P.CONST.EVENT_CHANGE,null,!0)},getCurrentLabel:function(){var a=this.getCheckedRadioButton();return a?a.parents("label").find(".labelContent").text():null},getCheckedRadioButton:function(){return this.$("input:checked")},val:function(){var a=this.getCheckedRadioButton();return a?a.attr("value"):void 0}}),goog.provide("P.modules.ui.SectionedTable"),goog.require("P.Module"),P.modules.ui.SectionedTable=P.Module.extend({events:{"click th.sortable":"onSortableHeadingClick"},onContentReady:function(){this.body=this.getChildById("body"),this.currentSortByKey=null,this.reverseSort=null},onSortableHeadingClick:function(a){var b=a.currentTarget.getAttribute("data-key");this.currentSortByKey!==b?(this.$(".sectionRow [data-column-key="+this.currentSortByKey+"]").removeClass("bold"),this.$(".sectionRow [data-column-key="+b+"]").addClass("bold"),this.currentSortByKey=b,this.reverseSort=!1):this.reverseSort=!this.reverseSort,this.body.sortByColumnKey(b,this.reverseSort),this.$(".sortable.active").removeClass("active"),this.$(".sortable[data-key="+b+"]").addClass("active").toggleClass("reversed",this.reverseSort)}}),goog.provide("P.modules.ui.SectionedTableBody"),goog.require("P.Module"),P.modules.ui.SectionedTableBody=P.Module.extend({events:{"click tr.sectionHeader":"onSectionHeaderClicked"},onSectionHeaderClicked:function(a){var b=a.currentTarget.getAttribute("data-section-index");this.$(a.target).find("em").toggleClass("collapsed"),this.$("tr.sectionRow[data-section-index="+b+"]").toggleClass("hidden")},sortByColumnKey:function(a,b){var c=this,d=_.groupBy(this.children,function(a){return a.options.section_index});_.each(this.$("tr.sectionHeader"),function(e){var f=e.getAttribute("data-section-index"),g=d[f]||[];_.each(g,function(a){a.remove()}),g=_.sortBy(g,function(b){var c=b.options.data[a];return"object"===typeof c?c.data:c}),b&&g.reverse();var h,i;for(h=g.length-1;h>=0;h--)i=g[h],c.insertChild(i,null,null,e)})}}),goog.provide("P.modules.ui.Select"),goog.require("P.Module"),P.modules.ui.Select=P.Module.extend({}),goog.provide("P.modules.ui.SelectButton"),goog.require("P.Module"),goog.require("P.modules.ui.RadioGroup"),P.modules.ui.SelectButton=P.Module.extend({onContentReady:function(){this.buttonModule=this.getChildById("button"),this.childListen(P.CONST.EVENT_CHANGE,this.onChange)},onChange:function(a){var b=a.target,c=b.getCurrentLabel()||this.options.text;this.buttonModule.setText(c)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/SelectButton/SelectButton.nunjucks")}),goog.provide("P.modules.ui.SelectList"),goog.require("P.Module"),goog.require("P.loader"),goog.require("P.dom"),P.modules.ui.SelectList=P.Module.extend({events:{"click .item":"_onClickItem","mouseenter .item":"_onHoverItemStart","mouseleave .item":"_onHoverItemEnd",keydown:"_onKeydown"},onCreated:function(){this._itemVisibilityFn=null},onContentReady:function(){var a=this._getSelectedItemElement();a.length>0&&this._selectItem(a)},appendItem:function(a,b){return this._appendItem(a,!!b)},hasVisibleItems:function(){return this.$(".item:not(.hidden)").length>0},highlightUp:function(){this._highlightDirection(!0)},highlightDown:function(){this._highlightDirection(!1)},getSelectedItemData:function(){var a=this._getSelectedItemElement();return a.length>0?this._getItemData(a):null},scrollSelectedItemElementIntoView:function(){var a=this._getSelectedItemElement();if(0!==a.length){var b=this.$el;P.dom.scrollIntoView(a,b)}},setItemVisibilityCallback:function(a){this._itemVisibilityFn=a,this._updateItemVisibility()},_appendItem:function(a,b){var c=this,d=this.options.item_module||{name:"ui.Label"},e=null;e="module"===a.type?a:{name:d.name,options:d.options,data:a},P.loadModule(e).then(function(a){a.renderExistingData().then(function(){var d=$('<li class="item"></li>');c.$(".item").last().after(d),c.insertChild(a,d),b&&c._selectItem(d),c._updateItemVisibility()})})},_getSelectedItemElement:function(){var a=this.$(".item.selected:not(.hidden)");return a},_getItemData:function(a){var b=this._getItemModule(a);return b?b.data:null},_getItemModule:function(a){var b=a.children()[0];return this.getChildByElement(b)},_highlightDirection:function(a){var b=this._getSelectedItemElement();if(0===b.length)this._selectFirstVisibleItem();else{var c=b;do if(c=a?c.prev():c.next(),c.is(".item:not(.hidden)")){this._selectItem(c);break}while(c.length>0)}},_onClickItem:function(a){a.stopPropagation();var b=$(a.currentTarget);this._selectItem(b);var c=this._getItemData(b);c&&this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,c,!0)},_onHoverItemStart:function(a){var b=$(a.currentTarget);this._selectItem(b)},_onHoverItemEnd:function(){this._selectItem(null)},_onKeydown:function(a){if(this.hasVisibleItems())switch(a.keyCode){case P.keyCode.UP:a.preventDefault(),a.stopPropagation(),this.highlightUp();break;case P.keyCode.DOWN:a.preventDefault(),a.stopPropagation(),this.highlightDown()}},_selectFirstVisibleItem:function(){var a=this.$(".item:not(.hidden)").first();a.length>0&&this._selectItem(a)},_selectItem:function(a){var b=this,c=this.$(".item.selected");a&&(c=c.add(a)),c.each(function(c,d){var e=a?d===a[0]:!1,f=$(d);f.toggleClass("selected",e);var g=b._getItemModule(f);g&&g.setSelectedState&&g.setSelectedState(e)}),this.scrollSelectedItemElementIntoView()},_updateItemVisibility:function(){if(this._itemVisibilityFn){for(var a=this._itemVisibilityFn(this.children),b=this.$(".item"),c=0;c<a.length;c++){var d=a[c],e=b.eq(c);e.toggleClass("hidden",!d)}this._selectFirstVisibleItem()}},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/SelectList/SelectList.nunjucks")}),goog.provide("P.modules.ui.Table"),goog.require("P.modules.ui.SectionedTable"),P.modules.ui.Table=P.modules.ui.SectionedTable.extend({}),goog.provide("P.modules.ui.TableHeader"),goog.require("P.Module"),P.modules.ui.TableHeader=P.Module.extend({}),goog.provide("P.modules.ui.TableLookalikePickerRow"),goog.require("P.Module"),P.modules.ui.TableLookalikePickerRow=P.Module.extend({moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/TableLookalikePickerRow/TableLookalikePickerRow.nunjucks")}),goog.provide("P.modules.ui.TableRow"),goog.require("P.Module"),P.modules.ui.TableRow=P.Module.extend({events:{click:"onRowClick"},onRowClick:function(a){this.triggerEvent(P.CONST.EVENT_ROW_CLICKED,null,!0),a.stopPropagation()}}),goog.provide("P.modules.ui.Tabs"),goog.require("P.Module"),P.modules.ui.Tabs=P.Module.extend({events:{"click .tab":"_onClick"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.modulePromises={};var a=this.getChildById("firstModule");a&&(this.modulePromises[0]=Promise.resolve(a),this.setSelectedTabIndex(0))},setSelectedTabIndex:function(a){var b=this;if(b.modulePromises[a])this._setNewIndex(a),this.modulePromises[this.currentIndex].then(function(a){a.show()});else{var c=this.options.tabs[a].content_module,d=P.loadModule(c);this.modulePromises[a]=d,d.then(function(c){b.insertChild(c,b.$(".content")),b._setNewIndex(a),c.showLoading(),c.render().then(function(){c.hideLoading(),a===b.currentIndex?c.show():c.hide()})})}},_setNewIndex:function(a){void 0!==this.currentIndex&&this.modulePromises[this.currentIndex].then(function(a){a.hide()}),this.currentIndex=a,this._setTabActive(this.currentIndex)},_onClick:function(a){var b=a.currentTarget.getAttribute("data-tab-index");this.setSelectedTabIndex(b)},_setTabActive:function(a){var b=this.$(".header > .tab > div");b.removeClass("active"),b.eq(a).addClass("active")}}),goog.provide("P.modules.ui.TextField"),goog.require("P.Module");var ACTIVE_CLASS="active",VALUE_CLASS="has-value",MENTION_TEMPLATE="<li data-value='${name}'><img src='${img}' /> ${name} <span>(${fullName})</span></li>";P.modules.ui.TextField=P.Module.extend({events:{click:"_onClick","focus .content":"_onContentFocus","blur .content":"_onContentBlur","input .content":"_onContentInput","keydown .content":"_onContentKeydown","keyup .content":"_onContentKeyup","paste .content":"_onContentPaste"},onContentReady:function(){this.options.mentions&&this.initAtMentions(),this._getContent().placeholder()},initAtMentions:function(){this.typeahead=new P.TypeaheadProvider({tags:"mentions",pin_id:this.options.pin_id}),this._getContent().atwho("@",{data:"/",tpl:MENTION_TEMPLATE,callbacks:{remote_filter:_.bindFn(this.onAtMentionFilter,this)}}),this.atwho=this._getContent().data("atwho")},onAtMentionFilter:function(a,b,c){if(a.q){var d=this;this.typeahead.search(a.q,function(a){var b=_.map(a.items,function(a){return{name:P.stripTags(a.username),fullName:P.stripTags(a.label),img:a.image}});c(b),d.atwho.settings["@"].data="/"})}},_getContent:function(){return this.$content||(this.$content=this.$(".content")),this.$content},getValue:function(){return this.log.debug("value:",$.trim(this._getContent().val()),this._getContent()),$.trim(this._getContent().val())},getUntrimmedValue:function(){return this._getContent().val()},setValue:function(a){this._getContent().val(a)},focus:function(){this._getContent().focus()},_onClick:function(){this.focus()},_onContentFocus:function(){this.$el.addClass(ACTIVE_CLASS),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},_onContentBlur:function(){var a=this.getValue().length;a?this.$el.addClass(VALUE_CLASS):this.$el.removeClass(VALUE_CLASS),this.$el.removeClass(ACTIVE_CLASS),this.triggerEvent(P.CONST.EVENT_BLUR,{hasValue:a},!0)},_onContentInput:function(){this.options.autogrow&&this._updateInputSize(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},_shouldListenToKeyup:function(){return"onpropertychange"in this.$el[0]&&!("oninput"in this.$el[0])},_onContentKeydown:function(a){var b=a.keyCode;b===P.keyCode.ENTER&&(this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,null,!0),this.options.prevent_default_on_enter&&(a.preventDefault(),this._onContentInput()))},_onContentKeyup:function(){this._shouldListenToKeyup()&&this._onContentInput()},_updateInputSize:function(){var a=this._estimateInputSize(),b=this._getContent();if(b.height()!==a){var c=this.options.maxheight;c&&c<a?(b.height(c),b.addClass("maxheight")):(b.removeClass("maxheight"),b.height(this._estimateInputSize())),this.triggerEvent(P.CONST.EVENT_TEXT_INPUT_RESIZED,null,!0)}},_estimateInputSize:function(){var a=this._getContent();if(!this.$_mirrorInput){var b='<div class="invisibleElemContainer"><textarea class="content invisibleElem"></textarea></div>';this.$el.append(b),this.$_mirrorInput=this.$(".invisibleElem"),this.$_mirrorInput.width(a.width()),a.attr("rows")&&this.$_mirrorInput.attr("rows",a.attr("rows")),this._initInputHeight=a.height()}var c=this._getContent().val();this.$_mirrorInput.val(c);var d=parseInt(a.css("padding-top"),10)||0,e=Math.max(this.$_mirrorInput[0].scrollHeight-2*d,this._initInputHeight);return this.$_mirrorInput.val(""),e},_onContentPaste:function(){this.triggerEvent(P.CONST.EVENT_PASTE,null,!0)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/TextField/TextField.nunjucks")}),goog.provide("P.modules.ui.Typeahead"),goog.require("P.Module");var DATA_MODEL_CID="cid",MODEL_ATTR_HIGHLIGHTED="highlighted",CLASS_SHOW_RECENT_QUERIES="showRecentQueries",CLASS_BUTTON_TEXT="buttonText",templateMap={search:"default_item",userSelect:"send_pin",map:"add_pin_to_map",place:"place",hint_no_city:"hint_no_city",hint_specific_city:"hint_specific_city",user_circle_avatar:"user_circle_avatar",interest:"interest",emailSelect:"send_to_email",socialConnect:"social_connect"},ItemView=Backbone.View.extend({tagName:"li",initialize:function(a){this.options=a,this.$el.attr("tabindex",this.options.tabIndex?1:!1);var b=this.options.template;this.templateName=b,this.model.bind("change",this.onChange,this)},appendToElement:function(a){this.render(),a.append(this.$el)},onChange:function(){return this.render(),this.model.attributes.type===P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER&&this.options.container.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RENDER_DONE,this.model.attributes.id,!0),this},_getTemplateFilePath:function(){return"app/common/modules/ui/Typeahead/"+this.templateName+".nunjucks"},render:function(){var a=this._getTemplateFilePath(),b=P.renderNunjucks(a,this.model.toJSON());return this.$el.html(b).toggleClass(P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED,!!this.model.get(MODEL_ATTR_HIGHLIGHTED)).data(DATA_MODEL_CID,this.model.cid),this}});P.modules.ui.Typeahead=P.Module.extend({events:{"click .results li":"onResultClick","click .results .remove":"onRemoveResult",mousedown:"onMousedown","mouseenter .results li":"onResultMouseEnter",mouseleave:"onMouseleave",onchange:"onChange"},_isOpen:!1,items:[],appendedStaticItems:[],prependedStaticItems:[],onCreated:function(){this.typeahead=new P.TypeaheadProvider(this.options),this.listen(this.typeahead,P.CONST.EVENT_DATA,this.onTypeaheadData),this.listen(this.typeahead,P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.showNewTypeahead="expanded"===this.options.view_type,this.showNewTypeahead&&this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},onChildButtonClick:function(a){var b=a.target;b&&b.isCancelButton()&&(a.stopPropagation(),this.hide())},onSearchStart:function(a){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,a,!0)},removeCacheForTerm:function(a){this.typeahead.removeCacheForTerm(a)},getResource:function(){return this.typeahead.getResource()},setPrependedStaticItems:function(a,b){this.prependedStaticItems=a,this._updateItemsToRender(),b&&this.renderResults()},resetPrependStaticItems:function(a){this.setPrependedStaticItems([],a)},setAppendedStaticItems:function(a,b){this.appendedStaticItems=a,this._updateItemsToRender(),b&&this.renderResults()},resetAppendedStaticItems:function(a){this.setAppendedStaticItems([],a)},onContentReady:function(){this.$results=this.$(".results"),this.showNewTypeahead&&(this.$leftColumn=this.$(".leftColumn"),this.$midColumn=this.$(".midColumn"),this.$rightColumn=this.$(".rightColumn"))},getItemCount:function(){return this.itemsToRender.count},highlightItemWithAttributeAndValue:function(a,b){var c=this,d=this.itemsToRender,e=_.find(d,function(c){return c.get(a)===b});e&&c.highlight(e)},focusHighlighted:function(){this.$("."+P.CONST.CLASS_TYPEAHEAD_HIGHLIGHTED).focus()},getHighlightedItem:function(){return this.highlightedItem},search:function(a){this.lastTerm=a,this.typeahead.search(a)},setAutocompleteScope:function(a){this.typeahead.setAutocompleteScope(a)},_getColumnIndexForItem:function(a){var b=a.attributes,c=b.type;switch(c){case"recent_query":return b.resultIndex%3;case"pin_search":case"query":return 0;case"board_search":case"board":return 1;case"people_search":case"user":return 2}return 0},separateColumns:function(){var a=this,b=[[],[],[]];return _.each(this.itemsToRender,function(c){var d=a._getColumnIndexForItem(c);b[d].push(a.createItemView(c))}),{type:this.itemsToRender[0].attributes.type,leftItemViews:b[0],midItemViews:b[1],rightItemViews:b[2]}},renderResults:function(){var a,b=this;if(this.showNewTypeahead){if(!this.itemsToRender.length)return void this.hide();a=this.separateColumns(),this.$leftColumn.empty(),this.$midColumn.empty(),this.$rightColumn.empty();var c="recent_query"===a.type;c?this.$el.addClass(CLASS_SHOW_RECENT_QUERIES):this.$el.removeClass(CLASS_SHOW_RECENT_QUERIES),_.each(a.leftItemViews,function(a){a.appendToElement(b.$leftColumn)}),_.each(a.midItemViews,function(a){a.appendToElement(b.$midColumn)}),_.each(a.rightItemViews,function(a){a.appendToElement(b.$rightColumn)})}else{if(a=_.map(this.itemsToRender,function(a){return b.createItemView(a)}),!a.length)return void this.hide();this.$results.empty(),_.each(a,function(a){a.appendToElement(b.$results)})}if(!this.options.bypass_maxheight){var d=P.Viewport.height-P.CONST.PIN_MARGIN-this.$results.offset().top;this.$results.css({"max-height":d,"overflow-y":"auto"})}this.show()},emptyResults:function(){this.itemsToRender=[],this.showNewTypeahead?(this.$leftColumn.empty(),this.$midColumn.empty(),this.$rightColumn.empty()):this.$results.empty()},createItemView:function(a){var b=this.options.template?templateMap[this.options.template]:templateMap.search,c=this.options.use_tab_index;a.attributes&&a.attributes.template&&(b=templateMap[a.attributes.template]);var d=new ItemView({model:a,container:this,template:b,tabIndex:c});return d},hide:function(){this._isOpen=!1,this.highlightedItem=null,this.select(null),this.$el.removeClass("open"),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HIDDEN,null,!0)},show:function(){this._isOpen=!0,this.$el.addClass("open"),this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_SHOWN,null,!0)},isOpen:function(){return this._isOpen},getLastTerm:function(){return this.lastTerm},selectElement:function(a){var b=this.getItemByElement(a);return this.select(b)},getSelectedItem:function(){return this.selectedItem},select:function(a){return a=a||this.highlightedItem,a&&a.get("selectable")===!1?null:(a&&this.triggerEvent(P.CONST.EVENT_ITEM_SELECTED,{item:a},!0),this.selectedItem=a,a)},highlightUp:function(){var a=this.highlightedItem,b=this.itemsToRender,c=a?_.indexOf(b,a)-1:b.length-1,d=b[c];return d&&d.get("selectable")===!1&&(--c,c<0&&(c=b.length-1)),this.highlight(b[c])},highlightDown:function(){var a,b=this.highlightedItem,c=this.itemsToRender;if(b){var d=_.indexOf(c,b);a=d===c.length-1?0:d+1}else a=0;var e=c[a];return e&&e.get("selectable")===!1&&++a,this.highlight(c[a])},highlightElement:function(a){var b=null;return a&&a[0]&&(b=this.getItemByElement(a)),this.highlight(b)},highlight:function(a){return a=a||null,a===this.highlightedItem?a:(this.highlightedItem&&this.highlightedItem.set(MODEL_ATTR_HIGHLIGHTED,!1),this.highlightedItem=a,a&&a.set(MODEL_ATTR_HIGHLIGHTED,!0),this.triggerEvent(P.CONST.EVENT_ITEM_HIGHLIGHTED,{item:a},!0),a)},getItemByElement:function(a){var b=a.data(DATA_MODEL_CID);return _.find(this.itemsToRender,function(a){return a.cid===b})},abortSearch:function(){this.typeahead.abortSearch()},prefetch:function(){this.typeahead.prefetch()},onMousedown:function(a){$(a.target).is("."+CLASS_BUTTON_TEXT)?a.stopPropagation():this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,null,!0)},onMouseleave:function(){this.isOpen()&&this.highlightElement()},onRemoveResult:function(a){a.stopPropagation(),a.preventDefault();var b=$(a.currentTarget),c=b.attr("data-query");if(c){var d=P.resourceFactory.create("TypeaheadClearRecentResource",{query:c});d.callDelete(),b.parents("li").remove(),this.items=_.reject(this.items,function(a){return a.query===c}),this._updateItemsToRender(),0===this.itemsToRender.length&&this.hide()}},onResultClick:function(a){this.selectElement($(a.currentTarget)),a.stopPropagation()},onResultMouseEnter:function(a){this.highlightElement($(a.currentTarget))},_updateItemsToRender:function(){var a=this.getLastTerm(),b=this.prependedStaticItems.concat(this.items,this.appendedStaticItems);this.itemsToRender=_.map(b,function(b,c){return b.tag=b.tag||"",b.resultIndex=c,b.enteredQuery=a,new Backbone.Model(b)})},onTypeaheadData:function(a){P.experiments.instance.inExperimentGroup("search_autocomplete","enabled"),this.items=a.items,this._updateItemsToRender();var b=a.hint;this.hint=b,this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_HINT,b,!0),this.renderResults(),this._triggerEvents()},_triggerEvents:function(){var a=this.getLastTerm(),b=0;a&&(b=a.length);var c=this.options.enable_recent_queries;if(0===this.itemsToRender.length||0===b){if(c)return void this.renderResults();this.hide(),this._triggerNoResultsReturned()}else this._triggerResultsReturned(),this.renderResults()},_renderEmptyState:function(){var a=[],b={},c=P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE;b[c]=!0,a.push(b),this.items=a,this._updateItemsToRender(),this._triggerEvents(),this.renderResults()},_triggerNoResultsReturned:function(a){this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,null,!0),a&&this._renderEmptyState()},_triggerResultsReturned:function(){var a={count:this.itemsToRender.length,items:this.itemsToRender};this.triggerEvent(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,a,!0)},focus:function(){},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/Typeahead/Typeahead.nunjucks")}),goog.provide("P.modules.AboutLinks"),goog.require("P.Module"),P.modules.AboutLinks=P.Module.extend({}),goog.provide("P.modules.AddInterestButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.AddInterestButton=P.modules.Button.extend({onContentReady:function(){$.data(this.$el,"grid-columns",1),$.data(this.$el,"grid-rows",1)}}),goog.provide("P.modules.AddPin"),goog.require("P.Module"),goog.require("P.modules.Button");var BUTTON_ID_UPLOAD="upload_button",BUTTON_ID_URL="url_button";P.modules.AddPin=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),Modernizr.fileinput||this.$(".pinUpload").remove()},onButtonClick:function(a){var b,c=this,d=a.target,e=d.id,f=!1,g=this.options.board_id;d.showLoading(),e===BUTTON_ID_UPLOAD?b={name:"PinUploader",options:{default_board_id:g}}:e===BUTTON_ID_URL&&(b={name:"AddPinURL",options:{show_title:!0}}),b&&P.loadModule(b,function(a){c.modal.setModule(a),f&&c.modal.setTransparentContent(!0)})}}),goog.provide("P.modules.AddPinRep"),goog.require("P.Module"),goog.require("P.modules.ModalTrigger"),P.modules.AddPinRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(){return this.showModal(),!1}}),goog.provide("P.modules.AddPinURL"),goog.require("P.Module"),P.modules.AddPinURL=P.Module.extend({onContentReady:function(){var a=this.$(".standardForm"),b={prevalidate:!0,message:P._("Where do you want to Pin from?")},c={url:[P.Validator.Required(b),P.Validator.URL()]};this.form=new P.Form(a,c,b),this.form.getField("url").placeholder(),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.form.getValue("url");this.navigate("/pin/find/?"+$.param({url:b}))}}}),goog.provide("P.modules.AdhocFeedIndexPage"),goog.require("P.Module"),P.modules.AdhocFeedIndexPage=P.Module.extend({}),goog.provide("P.modules.AdhocFeedPage"),goog.require("P.Module"),P.modules.AdhocFeedPage=P.Module.extend({}),goog.provide("P.modules.Analytics.Metric"),goog.require("P.Module"),P.modules.Analytics.Metric=P.Module.extend({}),goog.provide("P.modules.Analytics.MetricChange"),goog.require("P.Module"),P.modules.Analytics.MetricChange=P.Module.extend({}),goog.provide("P.modules.Analytics.MetricOverview"),goog.require("P.Module"),P.modules.Analytics.MetricOverview=P.Module.extend({}),goog.provide("P.modules.Analytics.MetricRecommendation"),goog.require("P.Module"),P.modules.Analytics.MetricRecommendation=P.Module.extend({events:{"click .recommendationWrapper":"onClick"},onClick:function(a){a.preventDefault();var b=parseInt($(a.target).attr("data-index"),10);return this.showModal(b),!1},showModal:function(a){var b=this;this.showLoading();var c={name:"Analytics.MetricTipModal",options:{tipIndex:a,tips:this.data}};P.loadModule(c,function(a){P.trackGAEvent("analytics_tips",P.CONST.GA_ACTION_OPEN_MODAL),b.hideLoading(),b.showInModal(a)})}}),goog.provide("P.modules.Analytics.MetricTipModal"),goog.require("P.Module"),P.modules.Analytics.MetricTipModal=P.Module.extend({events:{"click .nextTip":"nextTip","click .prevTip":"prevTip"},onContentReady:function(){this.currentTip=this.options.tipIndex,this.tips=this.$(".tipGroup"),this.showTip(this.currentTip)},showTip:function(a){if(!(a>=this.tips.length||a<0)){this.currentTip=a;var b=this;this.tips.each(function(c,d){var e=a===c;e?($(d).show(),b.$("h1").text($(d).attr("data-title"))):$(d).hide()}),this.updateButtons(a)}},updateButtons:function(a){var b=a<this.tips.length-1;this.toggleButton("nextTipButton",b);var c=a>0;this.toggleButton("prevTipButton",c)},toggleButton:function(a,b){b?this.getChildById(a).enable():this.getChildById(a).disable()},nextTip:function(){this.showTip(this.currentTip+1)},prevTip:function(){this.showTip(this.currentTip-1)}}),goog.provide("P.modules.Analytics.MetricTypeInfo"),goog.require("P.Module"),P.modules.Analytics.MetricTypeInfo=P.Module.extend({}),goog.provide("P.modules.AnimationPlaces"),goog.require("P.Module"),goog.require("P.modules.AnimationPlacesBase"),P.modules.AnimationPlaces=P.modules.AnimationPlacesBase.extend({events:{"mouseenter .balloonLayer":"activateBalloon","mouseleave .balloonLayer":"deactivateBalloon"},onContentReady:function(){this.$balloon=this.$(".balloon")},activateBalloon:function(){var a=this.$(".balloonAudio").get(0);a.play(),this.$balloon.hide()},deactivateBalloon:function(){this.$balloon.show()}}),goog.provide("P.modules.Answer"),goog.require("P.modules.AnswerBase"),P.modules.Answer=P.modules.AnswerBase.extend({onContentReady:function(){var a=this.data.id,b={};b[P.CONST.PUBSUB_TOPIC_ANSWER_DELETED]=this._onAnswerDeleted,b[P.CONST.PUBSUB_TOPIC_ANSWER_REPORTED]=this._onAnswerReported,b[P.CONST.PUBSUB_TOPIC_ANSWER_LIKED]=this._onAnswerLiked,b[P.CONST.PUBSUB_TOPIC_ANSWER_UNLIKED]=this._onAnswerUnliked,b[P.CONST.PUBSUB_TOPIC_ANSWER_UPDATED]=this._onAnswerUpdated,this.pubsubSubscribe(a,b),this._replyButtonClickListener&&this.removeListener(this._replyButtonClickListener);var c=this._getReplyButton();c&&(this._replyButtonClickListener=this.listen(c,P.CONST.EVENT_BUTTON_CLICK,this._onReplyButtonClick))},_onAnswerDeleted:function(){this.destroy()},_onAnswerReported:function(){this.destroy()},_onAnswerUpdated:function(){this.render()},_onReplyButtonClick:function(){if(!this._getReplies()){var a=new P.modules.Replies({id:"replies",options:{context_pin_id:this.options.context_pin_id,question_id:this.options.question_id,answer_id:this.data.id}});this.insertChild(a,this.$(".answerRepliesWrapper")),a.render()}}}),goog.provide("P.modules.AnswerCreate"),goog.require("P.Module"),P.modules.AnswerCreate=P.Module.extend({events:{"focus .content":"_onContentFocus"},onContentReady:function(){this.$form=this.$("form");var a={content:[P.Validator.Required()]},b={prevalidate:!0};this.form=new P.Form(this.$form,a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_START,this.showContentLoading),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.hideContentLoading),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_ERROR,this.hideContentLoading)},onSubmitValidated:function(a){a.errors[0]||this.saveAnswer()},_getSubmitButton:function(){return this.getChildById("submitButton")},saveAnswer:function(){var a=this,b=this.getChildById("answerTextField"),c=b.getContent(),d=this.options.question_id,e=this.options.context_pin_id,f=P.resourceFactory.create("AnswerResource",{question_id:d,content:c,context_pin_id:e,attached_url:b.getAttachmentUrl()}),g=this._getSubmitButton();g.showLoading(),f.callCreate({success:function(c){var e=c.resource_response.data;P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_QUESTION_ANSWER_CREATED,e),a.$form[0].reset(),a.$el.removeClass("expanded"),b.reset()},complete:function(){g.hideLoading()}})},_onContentFocus:function(){this.$el.addClass("expanded")},showContentLoading:function(){this.$(".loadingIcon").removeClass("hiddenElem")},hideContentLoading:function(){this.$(".loadingIcon").addClass("hiddenElem")}}),goog.provide("P.modules.AuthHomePage"),goog.require("P.Module"),P.modules.AuthHomePage=P.Module.extend({onContentReady:function(){this.extraData&&this.extraData.emailUpdated&&this.showUpdateEmailSuccess(),this._setUpFastFollow(),this.setRecentPinId()},showUpdateEmailSuccess:function(){if(Cookie.get(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED)){if(Cookie.unset(P.CONST.COOKIE_EMAIL_ADDRESS_UPDATED),!this.extraData||!this.extraData.email)return;var a=this,b=P.string.format(P._("You updated your address! Now you just need to confirm it. Look for the message we sent to {{ new_email }}."),{new_email:this.extraData.email}),c={name:"ConfirmDialog",options:{button_text:P._("Ok"),body_message:b,title:P._("Email updated"),template:"generic"}};return void P.loadModule(c,function(b){a.showInModal(b)})}},_setUpFastFollow:function(){},addTutorials:function(){var a=P.ExperienceManager.instance(),b=P.Experiences.Placement.WEB_HOME_TAKEOVER,c=a.getPlacedExperience(b);if(c){c.experience_id===P.Experiences.Experience.WEB_BLANK_SESSION&&a.viewPlacedExperience(b,P.Experiences.Experience.WEB_BLANK_SESSION);var d=P.ExperienceManager.Tutorials[c.experience_id];d&&(P.TutorialManager.instance().startTutorial(d),a.viewPlacedExperience(b,c.experience_id))}},onBoardInteraction:function(){this.render()},onAddedToDom:function(){this._setUpFastFollow(),this.setRecentPinId(),this.addTutorials()},onRemovedFromDom:function(){P.Updater.instance().setRecentPinId(null)},setRecentPinId:function(){P.Updater.instance().setRecentPinId(this.getRecentPinId())},getRecentPinId:function(){var a=this.getChildById("feedGrid");if(!a)return null;var b=a.getFirstGridItem("Pin");return b?b.getPinId():void 0},setUpBookmarkletDropdown:function(){if(this.extraData&&this.extraData.show_bookmarklet_dropdown){var a=this,b={name:"PinBookmarkletTooltip",options:{}};P.loadModule(b,function(b){var c={anchor:$(".bookmarkletAnchor"),class_name:"large",container_class:"pinBookmarkletTooltip",fixed:!0,mask_type:"transparent",position_point:"BOTTOM_RIGHT",position_mode:"ANCHORED"};
a.showInModal(b,c,a)})}}}),goog.provide("P.modules.BlendedCookieHomeFeedPage"),goog.require("P.Module"),P.modules.BlendedCookieHomeFeedPage=P.Module.extend({}),goog.provide("P.modules.BlendedHomeFeedPage"),goog.require("P.Module"),P.modules.BlendedHomeFeedPage=P.Module.extend({}),goog.provide("P.modules.BoardCollaborators"),goog.require("P.Module"),goog.require("P.modules.BoardCollaboratorInvitesBase"),P.modules.BoardCollaborators=P.modules.BoardCollaboratorInvitesBase.extend({onContentReady:function(){this.boardInviteForm=this.getChildById("boardInviteForm");var a=this.getBoardId();if(a){var b={};b[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.pubsubSubscribe(a,b)}},onBoardUpdated:function(){this.render()}}),goog.provide("P.modules.BoardCount"),goog.require("P.Module"),P.modules.BoardCount=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCountUpdate,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardCountUpdate,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardCountUpdate,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a),P.modules.NavigateButton.prototype.onContentReady.call(this)},onBoardCountUpdate:function(a,b,c){c.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.render()}}),goog.provide("P.modules.BoardCoverEditPage"),goog.require("P.Module"),P.modules.BoardCoverEditPage=P.Module.extend({events:{"click .save":"save","click .cancel":"cancel"},save:function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_SUBMIT);var a=this.getChildByModuleName("BoardCoverEdit"),b=a.getBoardCoverData(),c=this.getChildById("saveCover");c.showLoading();var d=this,e=_.extend(b,{board_id:this.extraData.boardId,url:d.$(".in").attr("src")}),f=P.resourceFactory.create("BoardResource",e),g=Math.round(b.nativeWidth*b.scale),h=Math.round(b.width),i=Math.round(b.nativeHeight*b.scale),j=Math.round(b.height);if(i!==j&&g!==h){var k=_.extend({},b,{userAgent:window.navigator.userAgent});this.log.error("Invalid cover data (crop box bound error)",k)}f.callUpdate({success:function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_SUCCESS),d.destroy(),P.pubsub.publish(d.extraData.boardId,P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED,e)},complete:function(){c.hideLoading()}})},cancel:function(){P.trackGAEvent("board_edit_cover",P.CONST.GA_ACTION_CLICK_CANCEL),this.destroy()}}),goog.provide("P.modules.BoardCreateRep"),goog.require("P.Module"),goog.require("P.modules.ModalTrigger"),P.modules.BoardCreateRep=P.modules.ModalTrigger.extend({events:{click:"onClick"},onClick:function(){return this.showModal(),!1}}),goog.provide("P.modules.BoardFollowers"),goog.require("P.Module"),P.modules.BoardFollowers=P.Module.extend({}),goog.provide("P.modules.BoardHeader"),goog.require("P.Module");var BOARD_INFO_BAR_MODULE_NAME="BoardInfoBar";P.modules.BoardHeader=P.Module.extend({showEditModal:function(){var a=this.getChildByModuleName(BOARD_INFO_BAR_MODULE_NAME);return a.showEditModal()}}),goog.provide("P.modules.BoardInfoBar"),goog.require("P.Module");var EDIT_BUTTON_ID="editButton";P.modules.BoardInfoBar=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_WRITE_ACCESS_UPDATED]=this.onWriteAccessChange,this.pubsubSubscribe(this.data.id,a)},onWriteAccessChange:function(){this.render()},showEditModal:function(){var a=this.getChildById(EDIT_BUTTON_ID);return a?(a.showModal(),!0):!1}}),goog.provide("P.modules.BoardInvite"),goog.require("P.Module"),goog.require("P.modules.BoardInviteBase"),P.modules.BoardInvite=P.modules.BoardInviteBase.extend({onClickRemove:function(){var a=this.options.view_type;"boardCreate"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"pinner",identifier:this.options.identifier},!0),this.destroy()):"email"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"email",identifier:this.options.identifier},!0),this.destroy()):"facebook"===a?(this.triggerEvent(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,{type:"facebook",identifier:this.options.identifier},!0),this.destroy()):this.getConfirmBoardInvite()?this.confirmDeleteBoardInvite():this.deleteBoardInvite()},confirmDeleteBoardInvite:function(){var a=this._getCurrentUserIsInvitedUser(),b=this._getInvitedUserFullName(),c=this,d={name:"RemoveUserFromBoardDialog",options:{template:"delete_board_invite",current_user_is_invited_user:a,invited_user_first_name:this.extraData.invitedUserFirstName,invited_user_full_name:b}};P.loadModule(d,function(a){c.showInModal(a),c.listen(a,P.CONST.EVENT_CONFIRM,c.deleteBoardInvite)})}}),goog.provide("P.modules.BoardPicker2"),goog.require("P.Module");var ENTER_INSTRUCTIONS_CLASS="enterInstructions",BOARD_ID_ATTR2="data-id",BOARD_LIST_ITEM_CLASS="boardListItem",BOARDS_SHORTLIST_CLASS="boardsShortlist",ALL_BOARDS_HEADER_CLASS="allBoardsHeader",ALL_BOARDS_LIST_CLASS="allBoardsList",CREATE_BOARD_CLASS="createBoard",BOARD_NAME_CLASS="boardName",HIDDEN_CLASS="hidden",HIGHLIGHTED_CLASS="highlighted";P.modules.BoardPicker2=P.Module.extend({events:{"click .boardListItem":"onBoardClick","mouseenter .boardListItem":"onBoardHoverStart","mouseleave .boardListItem":"onBoardHoverEnd","textchange .boardSelectorInput":"onBoardSelectorInput",keydown:"onBoardSelectorKeydown"},onCreated:function(){this._lastInputValue="",this._boardsShortlistVisible=!0,this._boardDivsVisible=null,this._selectedBoardIdx=null,this._selectedBoardId=null,this.$_selectedBoardDiv=null},onContentReady:function(){this.$boardSelectorInput=this.$(".boardSelectorInput"),this._syncBoardSelectorToInput(),this.options.autofocus_board&&this._autofocusBoardSelector()},_autofocusBoardSelector:function(){this.$(".boardSelectorInput[autofocus]:not(:focus)").eq(0).focus()},getSelectedBoardId:function(){return this._selectedBoardId},getSelectedBoardName:function(){return this.$_selectedBoardDiv?this._getBoardName(this.$_selectedBoardDiv,!1,!0):""},setSelectedBoardId:function(a){this._selectedBoardId=a,this.$_selectedBoardDiv.attr(BOARD_ID_ATTR2)||this.$_selectedBoardDiv.attr(BOARD_ID_ATTR2,a)},getLoadingSpinTarget:function(){return this.$_selectedBoardDiv},onBoardHoverStart:function(a){var b=$(a.currentTarget);this._selectBoard(b,!1)},onBoardHoverEnd:function(){this._selectBoard(null,!1)},onBoardClick:function(a){var b=$(a.currentTarget);this._selectBoard(b,!0),a.stopImmediatePropagation()},onBoardSelectorInput:function(){this._syncBoardSelectorToInput(),this._lastInputValue=this._getBoardSelectorInputValue()},onBoardSelectorKeydown:function(a){if(""===this._getBoardSelectorInputValue()&&""!==this._lastInputValue&&this._syncBoardSelectorToInput(),this._boardDivsVisible.length){var b=P.keyCode;switch(a.keyCode){case b.UP:this._boardSelectorHighlightUp(),a.preventDefault();break;case b.DOWN:this._boardSelectorHighlightDown(),a.preventDefault();break;case b.ENTER:case b.NUMPAD_ENTER:var c=this._boardDivsVisible[this._selectedBoardIdx];this._selectBoard(c,!0)}}},_resetSelectedBoard:function(){this._selectedBoardIdx=null,this._selectedBoardId=null,this.$_selectedBoardDiv=null},_selectBoard:function(a,b){if(this.$_selectedBoardDiv&&this.$_selectedBoardDiv.removeClass(HIGHLIGHTED_CLASS),!a)return this._resetSelectedBoard(),b&&this.triggerEvent(P.CONST.EVENT_BOARD_SELECTED,{boardId:null},!0),!1;this.$_selectedBoardDiv=a,this.$_selectedBoardDiv.addClass(HIGHLIGHTED_CLASS);var c=this._getIdxOfBoardDiv(a);this._setSelectedBoardIdx(c);var d=a.attr(BOARD_ID_ATTR2);if(this._selectedBoardId=d,b){var e={};e.boardId=d,d||(e.boardName=this._getBoardName(a,!1,!0)),this.triggerEvent(P.CONST.EVENT_BOARD_SELECTED,e,!0)}return!0},_getIdxOfBoardDiv:function(a){for(var b=0;b<this._boardDivsVisible.length;b++)if(a.get(0)===this._boardDivsVisible[b].get(0))return b;return-1},_getBoardName:function(a,b,c){if(b&&a.hasClass(CREATE_BOARD_CLASS))return"";var d=$.trim(a.find("."+BOARD_NAME_CLASS).text());return c||(d=d.toLowerCase()),d},_syncBoardSelectorToInput:function(){this._resetBoardSelector();var a=this._getBoardSelectorInputValue(),b=""===a,c=!b&&a.length<20;this._toggleEnterInstructions(c);var d=b;this._setBoardsShortlistVisibility(d),this._setCreateBoardName(this._getBoardSelectorInputValue(!0));var e=this._tokenizeString(a),f=this,g=function(b){var c=f._getBoardName(b,!0,!0);if(""===c)return!1;if(""===a)return b.find(".boardNameWrapper ."+BOARD_NAME_CLASS).text(c),!0;var d=f._tokenizeString(c),g=[],h=[];_.each(e,function(){h.push(!1)}),_.each(d,function(a){var b="";if(_.each(e,function(c,d){P.beginsWith(a.toLowerCase(),c.toLowerCase())&&(c.length>b&&(b=c),h[d]=!0)}),b){var c=_.escape(a.substr(0,b.length)),d=_.escape(a.substr(b.length));g.push('<span class="boardListItemTextMatch">'+c+"</span>"+d)}else g.push(_.escape(a))});var i=_.every(h,_.identity);return i&&b.find(".boardNameWrapper ."+BOARD_NAME_CLASS).html(g.join(" ")),i},h="."+BOARD_LIST_ITEM_CLASS;d||(h="."+ALL_BOARDS_LIST_CLASS+" "+h);var i=null;if(_.each(this.$(h),function(b){var c=$(b),d=g(c);c.toggleClass(HIDDEN_CLASS,!d),d&&(f._boardDivsVisible.push(c),i||f._getBoardName(c,!0,!1)!==a||(i=c))}),i)this._selectBoard(i,!1),this._setCreateBoardVisibility(!1);else{var j=!b;this._setCreateBoardVisibility(j)}var k=this._boardDivsVisible[0];this._selectBoard(k,!1)},_getBoardSelectorInputValue:function(a){var b=this.$boardSelectorInput.val();return a||(b=b.toLowerCase()),b},_toggleEnterInstructions:function(a){this.$("."+ENTER_INSTRUCTIONS_CLASS).toggleClass(HIDDEN_CLASS,!a)},_tokenizeString:function(a){return a.split(" ")},_resetBoardSelector:function(){if(null!==this.$_selectedBoardDiv&&this.$_selectedBoardDiv.removeClass(HIGHLIGHTED_CLASS),null!==this._selectedBoardIdx){var a=this._boardDivsVisible[this._selectedBoardIdx];a&&a.removeClass(HIGHLIGHTED_CLASS)}this._boardDivsVisible=[],this._selectBoard(null,!1)},_setBoardsShortlistVisibility:function(a){var b=this.$("."+BOARDS_SHORTLIST_CLASS+",."+ALL_BOARDS_HEADER_CLASS);b.toggleClass(HIDDEN_CLASS,!a),this._boardsShortlistVisible=a},_getCreateBoardDiv:function(){return this.$("."+CREATE_BOARD_CLASS)},_setCreateBoardVisibility:function(a){var b=this._getCreateBoardDiv();b.toggleClass(HIDDEN_CLASS,!a),this._boardDivsVisible.push(b)},_setCreateBoardName:function(a){this.$("."+CREATE_BOARD_CLASS+" ."+BOARD_NAME_CLASS).text(a)},_boardSelectorHighlightUp:function(){if(null!==this._selectedBoardIdx){var a=this._setSelectedBoardIdx(this._selectedBoardIdx-1),b=this._boardDivsVisible[a];this._selectBoard(b,!1),this._scrollSelectedBoardDivToView()}},_boardSelectorHighlightDown:function(){null===this._selectedBoardIdx&&(this._selectedBoardIdx=-1);var a=this._setSelectedBoardIdx(this._selectedBoardIdx+1),b=this._boardDivsVisible[a];this._selectBoard(b,!1),this._scrollSelectedBoardDivToView()},_setSelectedBoardIdx:function(a){return a<0?a=null:a>this._boardDivsVisible.length-1&&(a=this._boardDivsVisible.length-1),this._selectedBoardIdx=a,a},_scrollSelectedBoardDivToView:function(){if(null!==this._selectedBoardIdx){var a=this._boardDivsVisible[this._selectedBoardIdx],b=a.outerHeight(),c=b*this._selectedBoardIdx;if(this._boardsShortlistVisible){var d=this.$("."+BOARDS_SHORTLIST_CLASS+" ."+BOARD_LIST_ITEM_CLASS).length;this._selectedBoardIdx>=d&&(c+=this.$("."+ALL_BOARDS_HEADER_CLASS).outerHeight())}var e=this.$(".boardPickerListItems"),f=e.scrollTop();c<f?this._alignToViewTop(e,c):c+b>f+e.outerHeight()&&this._alignToViewBottom(e,c+b)}},_alignToViewTop:function(a,b){a.scrollTop(b)},_alignToViewBottom:function(a,b){a.scrollTop(b-a.outerHeight())}}),goog.provide("P.modules.BoardPickerOld"),goog.require("P.Module"),goog.require("P.modules.PositionModule");var BOARD_COLLAB_ATTR="data-collaborative",BOARD_PLACE_ATTR="data-place",BOARD_ID_ATTR="data-id",BOARD_PRIVACY_ATTR="data-privacy",BOARD_SUGGESTION_ATTR="data-suggestion",CLASS_ACTIVE="active",CLASS_VISIBLE="visible";P.modules.BoardPickerOld=P.Module.extend({events:{"click .boardPickerOuter":"onOuterClick","click .boardPickerItem":"onItemClick","keydown .createBoardName":"onCreateBoardKeydown","input .createBoardName":"onCreateBoardContentChange"},onCreateBoardKeydown:function(a){var b=P.keyCode;return a.keyCode===b.ENTER?(this.createBoard(),!1):void 0},onCreateBoardContentChange:function(){var a=this.getChildById("createBoard"),b=this.$(".createBoardName").val();b?a.enable():a.disable()},onButtonClick:function(a){var b=a.target;b&&"createBoard"===b.id&&this.createBoard()},onCreated:function(){this.$boardOuter=null,this.$boardMenuWrapper=null,this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onCreateBoardContentChange)},onItemClick:function(a){var b=$(a.target),c=b.attr(BOARD_SUGGESTION_ATTR);if(c)return this.createBoard(c),void a.stopImmediatePropagation();var d=b.attr(BOARD_ID_ATTR);if(!d)return void a.stopImmediatePropagation();this._selectedBoardId=d;var e=b.text(),f=b.attr(BOARD_PRIVACY_ATTR),g=!!b.attr(BOARD_COLLAB_ATTR),h="True"===b.attr(BOARD_PLACE_ATTR);this.setSelectedBoard(d,e,f,g,h),this.triggerEvent(P.CONST.EVENT_BOARD_SELECTED,{privacy:f},!0),this.closeMenu()},createBoard:function(a){function b(a){P.showError(a.message)}function c(a){if(a){var c=a.resource_response;if(c&&!c.error&&c.data&&c.data.url){var e=c.data;return d.options.default_board_id=e.id,d.render(),d.triggerEvent(P.CONST.EVENT_BOARD_SELECTED,null,!0),d.triggerEvent("boardCreated",e,!0),void P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,e)}}b(a)}var d=this,e=this.getChildById("createBoard"),f=a||this.$(".createBoardName").val(),g=P.resourceFactory.create("BoardResource",{name:f});e.showLoading(),g.callCreate({success:c,error:b,complete:function(){e.hideLoading()}})},getSelectedBoardName:function(){return this.$(".currentBoardName").text()},getPrivacy:function(){return this.$(".currentBoard").attr(BOARD_PRIVACY_ATTR)},getCollaborative:function(){return!!this.$(".currentBoard").attr(BOARD_COLLAB_ATTR)},getBoardCount:function(){return this.extraData.num_boards||0},setSelectedBoardAttributes:function(a,b,c){var d=this.$(".currentBoard",this.$boardOuter);d.attr(BOARD_PRIVACY_ATTR,a),d.attr(BOARD_COLLAB_ATTR,b),d.attr(BOARD_PLACE_ATTR,c)},setSelectedBoardIcons:function(a,b,c){var d=this.$(".currentBoard",this.$boardOuter),e=d.find(".secretIcon"),f=d.find(".collaborativeIcon"),g=d.find(".placeIcon"),h="hidden";e.toggleClass(h,!a),f.toggleClass(h,!b),g.toggleClass(h,!c)},setSelectedBoard:function(a,b,c,d,e){var f=this,g=this.$(".currentBoard",this.$boardOuter),h=d,i="secret"===c;this._selectedBoardId=a,this.setSelectedBoardAttributes(c,d,e),this.setSelectedBoardIcons(i,h,e),g.attr(BOARD_ID_ATTR,f._selectedBoardId),this.$(".currentBoardName",g).text(b)},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.$boardOuter=this.$(".boardPickerOuter"),this.$boardMenuWrapper=this.$(".boardPickerInnerWrapper"),this.$(".createBoardName").placeholder(),this._selectedBoardId=this.$boardOuter.attr(BOARD_ID_ATTR);var a=this;this.collection&&this.listenToOnce(this.collection,"change add remove",function(){P.setTimeout(function(){a.renderExistingData()},1)}),this.extraData&&this.extraData.no_boards&&P.deferDomManipulation(function(){var b=a.$(".tooltipAnchor");P.boardPickerUtil.showNoBoardsTooltip(a,b)})},onOuterClick:function(a){var b=this.getChildById("createBoard"),c=this.$(".createBoardName").val();this.options.disabled||(c||b.disable(),this._selectedBoardId=$(a.target).attr(BOARD_ID_ATTR),this.openMenu())},openMenu:function(){var a=this,b=$("<div></div>").addClass("boardPickerMask");this.$el.append(b);var c=this._selectedBoardId||this.$(".currentBoard").attr(BOARD_ID_ATTR),d=this.$(".boardPickerInner").find("["+BOARD_ID_ATTR+"="+c+"]");d.addClass(CLASS_ACTIVE),b.on("click.boardpicker",function(b){a.closeMenu(),b.stopPropagation(),b.stopImmediatePropagation()}),this.$boardMenuWrapper.addClass(CLASS_VISIBLE)},closeMenu:function(){var a=this.$(".boardPickerMask");a.off("click.boardpicker"),a.detach(),this.$(".boardPickerInner").find("."+CLASS_ACTIVE).removeClass(CLASS_ACTIVE),this.$boardMenuWrapper.removeClass(CLASS_VISIBLE)},getSelectedBoardId:function(){return $(".currentBoard",this.$boardOuter).attr(BOARD_ID_ATTR)},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/BoardPickerOld/BoardPickerOld.nunjucks")}),goog.provide("P.modules.BoardRecFeedHomePage"),goog.require("P.Module"),P.modules.BoardRecFeedHomePage=P.Module.extend({onContentReady:function(){var a=this.getChildById("grid"),b="none";a&&!a.hasItems()&&(a.remove(),b="block"),this.$(".noResults").css("display",b)}}),goog.provide("P.modules.BoardRecommendationsModule"),goog.require("P.Module"),P.modules.BoardRecommendationsModule=P.Module.extend({onContentReady:function(){this.destroyIfEmpty()},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedBoardsFeed");return!a||!a.hasItems()}}),goog.provide("P.modules.BusinessAccountConvert"),goog.require("P.Module"),goog.require("P.modules.BusinessAccountCreateBase"),P.modules.BusinessAccountConvert=P.modules.BusinessAccountCreateBase.extend({onContentReady:function(){P.currentUser.attributes.is_partner&&this.navigate("/business/getstarted/"),P.modules.BusinessAccountCreateBase.prototype.onContentReady.call(this)},save:function(){var a=this,b=this.getFormData();b.contact_name=b.first_name+" "+b.last_name;var c=this.getChildById("submitButton"),d=P.resourceFactory.create("PartnerResource",b),e=function(b){b&&!b.resource_response.error&&a.navigate("/business/getstarted/")};c.showLoading(),d.callUpdate({success:e,complete:function(){c.hideLoading()}})},onSubmitValidated:function(a){a.errors[0]||this.save()}}),goog.provide("P.modules.BusinessGetStartedCards"),goog.require("P.Module"),P.modules.BusinessGetStartedCards=P.Module.extend({events:{"click .dismiss":"onDismissClick"},onContentReady:function(){var a=window._fbq||(window._fbq=[]);if(!a.loaded){var b=document.createElement("script");b.async=!0,b.src="//connect.facebook.net/en_US/fbds.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),a.loaded=!0}window._fbq=window._fbq||[],window._fbq.push(["track","6013056087942",{value:"0.00",currency:"USD"}])},onDismissClick:function(a){var b=$(a.target),c=b.parents(".getStartedCard"),d=c.data("card-name"),e=P.resourceFactory.create("PartnerCardResource",{card_name:d});e.callDelete(),c.remove()}}),goog.provide("P.modules.BusinessGetStartedHeader"),goog.require("P.Module"),P.modules.BusinessGetStartedHeader=P.Module.extend({}),goog.provide("P.modules.CanonicalPin"),goog.require("P.Module"),P.modules.CanonicalPin=P.Module.extend({}),goog.provide("P.modules.CategoriesBar"),goog.require("P.Module"),P.modules.CategoriesBar=P.Module.extend({onContentReady:function(){this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched),this.selectedLabel=null,this.updateSelectedLabel()},onRouteMatched:function(a){var b=a.extraContent.show_categories_bar;b?(this.fadeIn(),this.$el.removeClass("hide"),this.triggerEvent(P.CONST.EVENT_CATEGORIES_BAR_SHOWN,null,!0)):(this.fadeOut(),this.$el.addClass("hide"),this.triggerEvent(P.CONST.EVENT_CATEGORIES_BAR_HIDDEN,null,!0)),this.updateSelectedLabel()},updateSelectedLabel:function(){var a=P.getCurrentUrl();if(!P.isOffsiteUrl(a)){var b=P.router.get().resolve(a);b&&(this.selectedLabel&&(this.selectedLabel.setActiveStyle(),this.selectedLabel=null),"HomePage"===b.module?this.selectedLabel=this.getChildById("home_feed"):"FeedPage"===b.module&&(this.selectedLabel=this.getChildById(b.options.feed)),this.selectedLabel&&this.selectedLabel.setActiveStyle())}}}),goog.provide("P.modules.CategoriesMenu"),goog.require("P.Module");var CLASS_SELECTED="selected";P.modules.CategoriesMenu=P.Module.extend({getItemByCategory:function(a){return this.$("a[data-category="+a+"]")},mixins:[P.Mixins.PreventScroll],onCategoryUpdated:function(a,b,c){if(this.$("a").removeClass(CLASS_SELECTED),c){var d=this.getItemByCategory(c);d.length?(d.addClass(CLASS_SELECTED),this.waitingMessage=null):this.waitingMessage=c}},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY]=this.onCategoryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.waitingMessage&&this.getItemByCategory(this.waitingMessage).addClass(CLASS_SELECTED)},getHeight:function(){var a=this.$(".categoriesWrapper").children(),b=0;_.each(a,function(a){var c=$(a).outerHeight();c>b&&(b=c)});var c=this.getChildByModuleName("AboutLinks");return c&&(b+=c.getHeight()),b}}),goog.provide("P.modules.CategoriesPage"),goog.require("P.Module"),P.modules.CategoriesPage=P.Module.extend({}),goog.provide("P.modules.Category"),goog.require("P.Module"),P.modules.Category=P.Module.extend({onContentReady:function(){this.listen(this,P.CONST.EVENT_NAVIGATE,this.onNavigate)},onNavigate:function(a){if(a.target===this){var b=this.triggerEvent("showAll",{title:this.data.name,category:this.data.key,resource:P.resourceFactory.create("BoardRecommendationsByCategoryFeedResource",{category:this.data.key})},!0);b||a.stopPropagation()}}}),goog.provide("P.modules.Close"),goog.require("P.Module"),P.modules.Close=P.Module.extend({onContentReady:function(){window.close()}}),goog.provide("P.modules.CloseupBottom"),goog.require("P.Module");var MODULE_ID_RELATED_PINS="relatedPins",MODULE_ID_RELATED_BOARDS="relatedBoards";P.modules.CloseupBottom=P.Module.extend({onChildRendered:function(a){var b,c,d=a.id===MODULE_ID_RELATED_PINS,e=a.id===MODULE_ID_RELATED_BOARDS;if(d&&(b=a.getChildByModuleName("Grid"),c=this.$(".relatedPinsWrapper")),e&&(b=a.getChildByModuleName("PagedGrid"),c=this.$(".relatedBoardsWrapper")),b&&c.length){var f=b.hasItems(),g=f?"visible":"hidden";c.css("visibility",g)}},setMinHeight:function(a){this.$el.css("min-height",null!==a?a:"")}}),goog.provide("P.modules.CloseupContent"),goog.require("P.Module");var TUTORIAL_SCROLL_OFFSET=200;P.modules.CloseupContent=P.Module.extend({getPin:function(){return this.getChildById("pin")},showEditModal:function(){var a=this.getPin();return a.showEditModal()},onContentReady:function(){if(this.data.id){var a={};a[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,this.pubsubSubscribe(this.data.id,a)}},onPinDeleted:function(){this.destroy()},getQuestions:function(){return this.getChildById("questions")},addTutorials:function(){if(this.extraData&&this.getPin()){var a=this.getPin().getFirstVisualObject()&&P.Viewport.numColumns>3,b=this.getQuestions();if(this.extraData.showQuestionNotificationTutorial&&b)b.showNotificationTutorial();else if(this.extraData.showQuestionsTutorial&&b)b.showQATutorial();else if(this.extraData.showVisualObjectSearchTutorial&&a){var c=P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED];c&&this.triggerEvent(P.CONST.EVENT_SCROLL_TO_ELEMENT,{$el:this.getPin().getFirstVisualObject(),callback:function(){P.TutorialManager.instance().startTutorial(c)},scrollOffset:TUTORIAL_SCROLL_OFFSET},!0)}}}}),goog.provide("P.modules.CloseupRelatedBoards"),goog.require("P.Module"),P.modules.CloseupRelatedBoards=P.Module.extend({onContentReady:function(){this.destroyIfEmpty();var a=this.getChildById("relatedBoardsFeed");a&&(a.resource.options.page_size=4)},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedBoardsFeed");return!a||!a.hasItems()}}),goog.provide("P.modules.CloseupRelatedPins"),goog.require("P.Module");var ANNOTATION_BUTTON_CLASS="annotationButton";P.modules.CloseupRelatedPins=P.Module.extend({onContentReady:function(){this.destroyIfEmpty(),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onTypeClick)},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedPinsFeed");return!a||!a.hasItems()},getGrid:function(){return this.getChildById("relatedPinsFeed")},hideGrid:function(){this.getGrid().hide()},showGrid:function(){this.getGrid().show()},onTypeClick:function(a){var b=a.target;if(b.options.class_name===ANNOTATION_BUTTON_CLASS&&!b.isActive()){_.each(this.getChildrenByModuleName("Button"),function(a){a.setStyles({active:a===b})}),b.showLoading();var c=_.bindFn(b.hideLoading,b);b.options.annotation?this.showAnnotatedPins(b.options.annotation,c):this.showRelatedPins(c)}},showRelatedPins:function(a){this.updateRelatedPinsGrid(P.resourceFactory.create("RelatedPinFeedResource",{pin:this.options.pin_id}),a)},showAnnotatedPins:function(a,b){this.updateRelatedPinsGrid(P.resourceFactory.create("InterestsFeedResource",{interest:a}),b)},updateRelatedPinsGrid:function(a,b){var c=this.getGrid(),d=this;this.$el.css("height",this.$el.height()),c.emptyItems(),c.setItemsResource(a);var e=function(){(b||P.NOOP)(),d.$el.css("height","auto")};c.renderItems(e,e)}}),goog.provide("P.modules.CloseupRichPinContent"),goog.require("P.Module"),goog.require("P.modules.CloseupRichPinContentBase"),P.modules.CloseupRichPinContent=P.modules.CloseupRichPinContentBase.extend({}),goog.provide("P.modules.Consumer"),goog.require("P.Module"),P.modules.Consumer=P.Module.extend({events:{"click .consumerSecretText":"consumerSecretTextClicked"},consumerSecretTextClicked:function(){this.showConfirmation(this.extraData["secret-key"])},showConfirmation:function(a){var b=this,c={name:"ConfirmDialog",options:{template:"api_secret",apiSecret:a}};P.loadModule(c,function(a){b.showInModal(a)})}}),goog.provide("P.modules.ConsumerManagePage"),goog.require("P.Module"),P.modules.ConsumerManagePage=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_CONSUMER_LIST_UPDATED]=this.onListUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},showNewDialog:function(){var a=this;P.loadModule({name:"ConsumerNewDialog"},function(b){a.showInModal(b,{})})},onListUpdated:function(){this.render()}}),goog.provide("P.modules.ConsumerNewDialog"),goog.require("P.Module"),P.modules.ConsumerNewDialog=P.Module.extend({onContentReady:function(){var a={name:[P.Validator.Required()],description:[P.Validator.Required()]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this.createConsumer()},getFormData:function(){var a=this.$("form").serializeArray(),b={};return _.each(a,function(a){b[a.name]=a.value}),b},getSaveResource:function(a){return P.resourceFactory.create("ConsumerResource",a)},createConsumer:function(){var a=this.getFormData(),b=this.getChildById("submitButton"),c=this;b.showLoading();var d=this.getSaveResource(a);d.callCreate({success:function(a){var d;b.hideLoading(),a.resource_response.error?a.resource_response.message&&(d={message:a.resource_response.message}):(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_CONSUMER_LIST_UPDATED),c.destroy())},error:function(a){P.showError(a.message)},complete:function(){b.hideLoading()}})}}),goog.provide("P.modules.CookieRecFeedHomePage"),goog.require("P.Module"),P.modules.CookieRecFeedHomePage=P.Module.extend({}),goog.provide("P.modules.CsrfErrorPage"),goog.require("P.Module"),P.modules.CsrfErrorPage=P.Module.extend({}),goog.provide("P.modules.Developer"),goog.require("P.Module"),P.modules.Developer=P.Module.extend({}),goog.provide("P.modules.Domain"),goog.require("P.Module"),P.modules.Domain=P.Module.extend({getLoggingObjectIdStr:function(){return this.data.id}}),goog.provide("P.modules.DomainAnalyticsPage"),goog.require("P.Module"),P.modules.DomainAnalyticsPage=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_DATEPICKER_DATE_SELECTED,this.onDateChanged),this.checkValidData()},checkValidData:function(){var a=!1;$.each(this.data,function(b,c){(c.PIN_REPIN||c.PIN_VIEW)&&(a=!0)}),a||(this.$(".noData").show(),this.$(".metricsContainer").hide())},onDateChanged:function(a){var b=a.data.formatted[0],c=a.data.formatted[1];if(b!==c){this.showLoading(!0),a.target.parent.hide();var d=window.location.pathname,e=$.param({start_date:b,end_date:c}),f=d+"?"+e;this.navigate(f)}}}),goog.provide("P.modules.DomainBoardRecommendationsPage"),goog.require("P.Module"),P.modules.DomainBoardRecommendationsPage=P.Module.extend({}),goog.provide("P.modules.DomainFeedPage"),goog.require("P.Module"),P.modules.DomainFeedPage=P.Module.extend({}),goog.provide("P.modules.DomainFeedPageContainer"),goog.require("P.Module"),P.modules.DomainFeedPageContainer=P.Module.extend({onContentReady:function(){this.checkGridContent(),this.childListen(P.CONST.EVENT_DATEPICKER_DATE_SELECTED,this.onDateChanged)},checkGridContent:function(){var a=this.getChildById("feedGrid");a.hasItems()||this.$(".noData").show()},changeDate:function(a){var b=(a.endDate-a.startDate)/6e8,c={end_date:a.formattedEndDate};b>=2?c.aggregation="biweekly":b>=1&&(c.aggregation="weekly");var d=window.location.pathname,e=$.param(c),f=d+"?"+e;this.navigate(f)},onDateChanged:function(a){this.showLoading(!0),a.target.hidePicker();var b=a.data.dates[0],c=a.data.dates[1],d=a.data.formatted[1];this.changeDate({startDate:b,endDate:c,formattedEndDate:d})}}),goog.provide("P.modules.DomainInfoBar"),goog.require("P.Module"),P.modules.DomainInfoBar=P.Module.extend({}),goog.provide("P.modules.DomainOwnerInfoBar"),goog.require("P.Module"),P.modules.DomainOwnerInfoBar=P.Module.extend({}),goog.provide("P.modules.DomainOwnerInfoTabsContainer"),goog.require("P.Module"),goog.require("P.url"),P.modules.DomainOwnerInfoTabsContainer=P.Module.extend({onContentReady:function(){var a=this.getChildById("export");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.exportClicked)},_buildUrl:function(a,b){return this.options.aggregation&&(b.aggregation=this.options.aggregation),P.url.buildRelativeUrl("/analytics/"+this.options.domain+"/export/"+a,b)},exportClicked:function(){var a=this.exportUrls[this.options.feed_item_type];a||(a=this.defaultExportMetricsUrl),P.downloadFile(a)},onCreated:function(){this.exportUrls={most_recent:this._buildUrl("recent/",{}),most_repinned:this._buildUrl("top/repins/",{end_date:this.options.end_date}),most_clicked:this._buildUrl("top/clicks",{end_date:this.options.end_date})},this.defaultExportMetricsUrl=this._buildUrl("",{end_date:this.options.end_date,start_date:this.options.start_date})}}),goog.provide("P.modules.DomainQuestion"),goog.require("P.Module"),P.modules.DomainQuestion=P.Module.extend({}),goog.provide("P.modules.DomainQuestionsPage"),goog.require("P.Module"),P.modules.DomainQuestionsPage=P.Module.extend({}),goog.provide("P.modules.DomainVerify"),goog.require("P.Module"),P.modules.DomainVerify=P.Module.extend({events:{"click .helpText a":"onClickType"},onCreated:function(){this.METATAG="metatag",this.FILENAME="filename",this.verificationType=this.FILENAME},onContentReady:function(){this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.downloadButton=this.getChildById("downloadButton"),this.downloadButton&&this.listen(this.downloadButton,P.CONST.EVENT_BUTTON_CLICK,this.onClickDownload)},onClickType:function(){this.swapVerificationType()},onClickDownload:function(){P.downloadFile("/website/verify/download/")},onSubmitValidated:function(a){a.errors[0]||this.verifyDomain()},swapVerificationType:function(){this.$(".filename, .metaTag").toggle(),this.verificationType=this.verificationType===this.METATAG?this.FILENAME:this.METATAG},showError:function(a){this.$(".errorReason").text(a),this.$(".errorSection").show()},hideError:function(){this.$(".errorSection").hide()},waitForVerification:function(a){var b=P._("Trouble verifying your domain. Please try again later."),c=P.currentUser.attributes.domain_url,d=P.resourceFactory.create("DomainResource",{field_set_key:"owner",domain:c}),e=this;a=a||3;var f=0,g=function(){return f>=a?void P.showError(b):(f+=1,void d.callGet({success:function(a){var c=a.resource_response;if(!c.error)if(null===c.data.official_user)P.setTimeout(g,200);else{if(c.data.official_user.id!==P.currentUser.attributes.id)return void P.showError(b);
e.isInModal()?(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_USER_UPDATED),P.pubsub.publish(P.currentUser.attributes.id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),e.destroy()):this.navigate("/")}},error:function(){P.showError(b)}}))};P.setTimeout(g,200)},verifyDomain:function(){var a=this.getChildById("submitButton");a.showLoading(),this.hideError();var b=this,c={type:this.verificationType},d=P.resourceFactory.create("DomainVerifyResource",c);d.callUpdate({success:function(c){var d;a.hideLoading(),c.resource_response.error?c.resource_response.message&&(d={message:c.resource_response.message}):b.waitForVerification()},error:function(a){P.showError(a.message)},complete:function(){a.hideLoading()}})}}),goog.provide("P.modules.DomainVerifyByLink"),goog.require("P.Module"),P.modules.DomainVerifyByLink=P.Module.extend({onContentReady:function(){var a,b="",c="",d="";null!==this.options.domain?(b=P.string.format(P._("Congratulations! Check out your analytics page to see how  popular your Pins are on Pinterest.")),c=P._("Go To Analytics"),d=P._("Website verified")):(b=P.string.format(P._("Oops! We weren't able to verify your website. Write to us at the help center for more information.")),c=P._("Go to the help center"),d=P._("Trouble verifying your website")),a={name:"ConfirmDialog",options:{body_message:b,button_text:c,template:"generic",title:d}};var e=this;P.loadModule(a,function(a){e.showInModal(a),e.listen(a,P.CONST.EVENT_CONFIRM,e.onConfirmClick)})},onConfirmClick:function(){var a="";a=null===this.options.domain?"/_/_/help/":"/source/"+this.options.domain+"/analytics/",this.navigate(a)}}),goog.provide("P.modules.EmailContact"),goog.require("P.Module"),P.modules.EmailContact=P.Module.extend({events:{"click .check":"_onClickCheck",click:"_onClick"},_onClickCheck:function(a){a.stopPropagation()},_onClick:function(){this.getChildById("check").setChecked(!this.isChecked(),!0)},setChecked:function(a){this.getChildById("check").setChecked(a,!1)},isChecked:function(){return this.getChildById("check").isChecked()},getEmail:function(){return this.options.email_contact.id}}),goog.provide("P.modules.Embed"),goog.require("P.Module"),P.modules.Embed=P.Module.extend({onContentReady:function(){$("head").append($("<script></script>").attr({async:!0,src:"//assets.pinterest.com/js/pinit.js"}));var a=this.$(".sampleCode textarea");a.focus(),a.select()}}),goog.provide("P.modules.EmbedBoard"),goog.require("P.modules.Embed"),P.modules.EmbedBoard=P.modules.Embed.extend({}),goog.provide("P.modules.EmbedPinner"),goog.require("P.modules.Embed"),P.modules.EmbedPinner=P.modules.Embed.extend({}),goog.provide("P.modules.EmptyConversations"),goog.require("P.Module"),P.modules.EmptyConversations=P.Module.extend({onContentReady:function(){var a=this,b=this.getChildrenByModuleName("ConversationHead");_.each(b,function(b){a.listen(b,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,a.onConversationHeadClick)}),(!this.data||this.data.length<3)&&this.triggerEvent(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,null,!0)},onConversationHeadClick:function(a){var b=this,c=a.target;c.showLoading();var d=c.getUserIds(),e=P.resourceFactory.create("ConversationsResource",{user_ids:d});e.callCreate().then(function(a){var d=a.resource_response.data,e=a.resource_response.error;e||(P.getConversationsManager().addConversation(d),c.hideLoading(),b.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),b.render())})},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/EmptyConversations/EmptyConversations.nunjucks")}),goog.provide("P.modules.EntityEdit"),goog.require("P.Module"),P.modules.EntityEdit=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var a=this.getFormValidationRules(),b=this.getFormValidationOptions();this.form=new P.Form(this.$form,a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},getFormValidationRules:function(){return{}},getFormValidationOptions:function(){return{}},getEditResource:function(){throw new Error("not implemented")},onEditSuccess:P.NOOP,getDeleteConfirmTemplate:function(){return""},getDeleteResource:function(){throw new Error("not implemented")},onDeleteSuccess:P.NOOP,_onButtonClick:function(a){var b=a.target;"deleteButton"===b.id&&this._showDeleteConfirmDialog()},_onSubmitValidated:function(a){a.errors[0]||this._saveEntity()},_saveEntity:function(){var a=this.getEditResource(),b=this,c=this.getChildById("submitButton");c.showLoading(),a.callUpdate({success:function(){b.onEditSuccess(),b.destroy()},complete:function(){c.hideLoading()}})},_showDeleteConfirmDialog:function(){var a=this.getDeleteConfirmTemplate();if(!a)return void this._deleteEntity();var b=this,c={name:"ConfirmDialog",options:{template:a}};P.loadModule(c,function(a){b.showInModal(a),b.listen(a,P.CONST.EVENT_CONFIRM,b._onDeleteConfirm)})},_onDeleteConfirm:function(){this._deleteEntity()},_deleteEntity:function(){var a=this.getDeleteResource(),b=this;this.showLoading(!0),a.callDelete({success:function(a){var c=a.resource_response;c&&!c.error&&(b.onDeleteSuccess(),b.destroy())},complete:function(){b.hideLoading()}})}}),goog.provide("P.modules.EntityReport"),goog.require("P.Module"),P.modules.EntityReport=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={reason:[P.Validator.Required()]},c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated),this.childListen(P.CONST.EVENT_REPORT_REASON_SELECTED,this._onReportReasonSelected);var d=this.getChildById("submitButton");d.disable()},_onSubmitValidated:function(a){a.errors[0]||this._reportEntity()},_onReportReasonSelected:function(a){var b=this.getChildById("submitButton");"harasses-category"===a.currentTarget._reason?b.disable():b.enable()},getReportResourceName:function(){throw new Error("not implemented")},getCustomReportResourceOptions:function(){return{}},onReportSuccess:P.NOOP,_reportEntity:function(){var a=this.getReportResourceName();if(a){var b=this.$("form :checked").attr("value");if(b&&"harasses-category"!==b){var c={reason:b};"other"===c.reason&&(c.explanation=this.$("textarea").val()),_.extend(c,this.getCustomReportResourceOptions());var d=this,e=this.getChildById("submitButton");e.showLoading();var f=P.resourceFactory.create(a,c);f.callCreate({success:function(){d.onReportSuccess(),d.destroy()},complete:function(){e.hideLoading()}})}}}}),goog.provide("P.modules.Explore"),goog.require("P.Module");var GRID_GUTTER=P.CONST.PIN_MARGIN,GRID_SIZE=136,MINIMUM_NUM_COLUMNS=2*P.CONST.MIN_COLUMNS;P.modules.Explore=P.Module.extend({onAddedToDom:function(){this._setContentWidth(),this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize)},onContentReady:function(){this.sections=[];var a=this.getChildById("exploreInterests");a&&this.sections.push(a);var b=this.getChildById("exploreRelatedInterests");b&&this.sections.push(b);var c=this.getChildById("exploreCategories");c&&this.sections.push(c),this._setContentWidth()},onResize:function(){this._setContentWidth()},_calculateNumColumns:function(){var a=this.getWidth(!1),b=GRID_SIZE+GRID_GUTTER,c=Math.floor(a/b);return c=Math.max(MINIMUM_NUM_COLUMNS,c),c%2!==0&&c--,c},_setContentWidth:function(){var a=this._calculateNumColumns(),b=a*(GRID_SIZE+GRID_GUTTER);_.each(this.sections,function(a){a.setContentWidth(b)})}}),goog.provide("P.modules.ExploreCategories"),goog.require("P.Module"),P.modules.ExploreCategories=P.Module.extend({setContentWidth:function(a){this.$(".content").css("width",a);var b=this.getChildById("categoriesGrid");b.onResize()}}),goog.provide("P.modules.ExploreInterests"),goog.require("P.Module"),P.modules.ExploreInterests=P.Module.extend({setContentWidth:function(a){this.$(".content").css("width",a);var b=this.getChildById("interestsGrid");b.onResize()}}),goog.provide("P.modules.ExploreRelatedInterest"),goog.require("P.Module"),P.modules.ExploreRelatedInterest=P.Module.extend({setContentWidth:function(a){this.$(".content").css("width",a);var b=this.getChildById("relatedInterestsGrid");b.onResize()}}),goog.provide("P.modules.ExploreRelatedInterests"),goog.require("P.Module"),P.modules.ExploreRelatedInterests=P.Module.extend({setContentWidth:function(a){this.$(".content").css("width",a),_.each(this.getChildrenByModuleName("ExploreRelatedInterest"),function(b){b.setContentWidth(a/2)})}}),goog.provide("P.modules.FacebookConnectButton"),goog.require("P.modules.Button"),P.modules.FacebookConnectButton=P.modules.Button.extend({onContentReady:function(){this.listen(this,P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){a.stopPropagation();var b=P.SocialConnect.instance(),c=this;P.trackRegisterAction("register_facebook_attempt"),this.showLoading(),b.connect("facebook",{success:function(a){c.hideLoading(),c.login({facebook_id:a.id,facebook_token:a.access_token})}})},login:function(a){var b=this,c=function(){b.onLoginSuccess(a)},d=function(){b.onLoginError(a)};P.currentUser.login(a,c,d,null)},onLoginSuccess:function(a){this.triggerEvent(P.CONST.FACEBOOK_LOGIN_SUCCESS,a,!0)&&window.location.reload()},onLoginError:function(a){this.triggerEvent(P.CONST.FACEBOOK_LOGIN_FAILURE,a,!0)}}),goog.provide("P.modules.FacebookContact"),goog.require("P.Module"),P.modules.FacebookContact=P.Module.extend({events:{click:"_onClick"},_onClick:function(){this.getChildById("invite").showLoading(),P.Invite.userInviteFacebook(this.options.facebook_contact.id,_.bindFn(this._onInvite,this))},_onInvite:function(a){this.getChildById("invite").hideLoading(),a&&this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)}}),goog.provide("P.modules.FacebookShareButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.FacebookShareButton=P.modules.Button.extend({onClick:function(){if(P.currentUser.isWriteBanned())P.writeban.showWriteBanned(this);else{var a=this.options.ga_category||"share_facebook";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK);var b=this.options.dialog_options||{},c=this;b.callback=function(){var a=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PIN_SHARE_FACEBOOK);c.options&&c.options.object_id&&a.setObjectIdStr(c.options.object_id),P.ContextLogger.getInstance().addEvent(a)},"sharer_php"===this.options.fb_sharer&&(b.type="sharer_php"),P.FacebookDialog.open(b),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)}return!1},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/FacebookShareButton/FacebookShareButton.nunjucks")}),goog.provide("P.modules.FastFollowHeader"),goog.require("P.Module");var FAST_FOLLOW_PROGRESS_ID="followPageProgress";P.modules.FastFollowHeader=P.Module.extend({stepProgress:function(a){var b=this.getChildById(FAST_FOLLOW_PROGRESS_ID);b&&b.moveStep(a)}}),goog.provide("P.modules.FastFollowSidebar"),goog.require("P.Module");var FAST_FOLLOW_SIDEBAR_SELECTED_CLASS="selected";P.modules.FastFollowSidebar=P.Module.extend({events:{"click .followPageSidebarCategory":"onCategoryClick"},onCreated:function(){var a={};a[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.toggleShowMoreCategories)},onContentReady:function(){Modernizr.touch||this.$(".followPageSidebarCategory").addClass("noTouch")},onCategoryClick:function(a){var b=$(a.currentTarget);if(b.length){var c=b.attr("data-category");c.length&&(this.highlightCategory(c),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,c,!0))}},onSearchQueryUpdated:function(a,b,c){var d=c||"";this.unhighlightCategory(),this.triggerEvent(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,d,!0)},unhighlightCategory:function(){this.$("."+FAST_FOLLOW_SIDEBAR_SELECTED_CLASS).removeClass(FAST_FOLLOW_SIDEBAR_SELECTED_CLASS)},highlightCategory:function(a){this.unhighlightCategory(),this.$("[data-category="+a+"]").addClass(FAST_FOLLOW_SIDEBAR_SELECTED_CLASS)},toggleShowMoreCategories:function(){return this.$el.toggleClass("expand"),!1}}),goog.provide("P.modules.FeedPage"),goog.require("P.Module"),P.modules.FeedPage=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,this.options.feed)},_resetCategory:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CURRENT_CATEGORY,null)},onRemoved:function(){this._resetCategory()},onEmpty:function(){this._resetCategory()}}),goog.provide("P.modules.FeedUsers"),goog.require("P.Module"),P.modules.FeedUsers=P.Module.extend({unusedPinfluencers:[],onContentReady:function(){var a=this.data?_.pluck(this.data,"id"):[],b=this.resource.options.num_featured_users;this.unusedPinfluencers=a.length>b?a.slice(b):[],this.destroyIfEmpty()||this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken)},onChildActionTaken:function(a){var b=a.target;this.dismissUser(b)},dismissUser:function(a){if(a){var b=this;a.fadeOut(function(){b.unusedPinfluencers.length?b.replaceUser(a):b.removeUser(a)})}},replaceUser:function(a){var b=this.unusedPinfluencers.pop(),c=this;if(b){var d=new P.modules.User({resource:{name:"UserResource",options:{field_set_key:"grid_item",user_id:b}}});d.render(function(){d.show(),c.removeChild(a),c.appendChild(d),d.fadeIn()})}},removeUser:function(a){this.removeChild(a);var b=this.getChildByModuleName("User");b||this.remove(),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}}),goog.provide("P.modules.FillHomeFeed"),goog.require("P.Module"),P.modules.FillHomeFeed=P.Module.extend({}),goog.provide("P.modules.FindFriends"),goog.require("P.Module"),P.modules.FindFriends=P.Module.extend({}),goog.provide("P.modules.FindFriendsInfoBar"),goog.require("P.Module"),P.modules.FindFriendsInfoBar=P.Module.extend({onContentReady:function(){"invite"===this.options.focus&&this.getChildById("inviteFriends").getDropdown().show()}}),goog.provide("P.modules.FindFriendsNotConnected"),goog.require("P.Module"),P.modules.FindFriendsNotConnected=P.Module.extend({}),goog.provide("P.modules.FindFriendsPage"),goog.require("P.Module"),P.modules.FindFriendsPage=P.Module.extend({}),goog.provide("P.modules.FindFriendsRep"),goog.require("P.Module"),P.modules.FindFriendsRep=P.Module.extend({}),goog.provide("P.modules.FindFriendsWhosHere"),goog.require("P.Module"),P.modules.FindFriendsWhosHere=P.Module.extend({}),goog.provide("P.modules.FlagComment"),goog.require("P.Module"),P.modules.FlagComment=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={reason:[P.Validator.Required()]},c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_REPORT_REASON_SELECTED,this._onReportReasonSelected);var d=this.getChildById("submitButton");d.disable()},onSubmitValidated:function(a){a.errors[0]||this.flagComment()},_onReportReasonSelected:function(){var a=this.getChildById("submitButton");a.enable()},flagComment:function(){var a=this,b=this.getChildById("submitButton");b.showLoading();var c={pin_id:this.options.pin_id,comment_id:this.options.comment_id,reason:this.$("form :checked").attr("value")};"other"===c.reason&&(c.explanation=this.$("textarea").val()),P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_CLICK_SUBMIT,"reason",c.reason);var d=P.resourceFactory.create("CommentFlagResource",c);d.callCreate({success:function(){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_SUCCESS),a.destroy()},error:function(a){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_ERROR),P.showError(a.message)},complete:function(){b.hideLoading()}})}}),goog.provide("P.modules.FlagContent"),goog.require("P.Module");var FLAG_CONTENT_ACTIVE_CLASS="active";P.modules.FlagContent=P.Module.extend({events:{"change input":"onChange"},onCreated:function(){this.listen(this,"change",this.checkIfOtherIsSelected)},onChange:function(a){var b=this,c=this.options,d=$(a.target),e=d.siblings("label");if(this._reason=d.attr("id"),this._reasonNoun=e.text(),this.checkIfOtherIsSelected(),this.triggerEvent("change",this,!0),"blockInput"===c.class_name&&this.updateLabel(d),c.reason=this._reason,c.reason_noun=this._reasonNoun,this.options.show_confirmation_on_change){var f={name:"FlagContentConfirm",options:c};P.loadModule(f,function(a){var d;"user"===c.object_flagged?d="user_flag":"pin"===c.object_flagged?d="pin_flag":"comment"===c.object_flagged&&(d="comment_flag"),d&&P.trackGAEvent(d,P.CONST.GA_ACTION_OPEN_MODAL,"reason",b._reason),b.hideLoading(),b.showInModal(a)})}},updateLabel:function(a){var b=$(a),c=b.siblings("label");this.$("."+FLAG_CONTENT_ACTIVE_CLASS).removeClass(FLAG_CONTENT_ACTIVE_CLASS),c.addClass(FLAG_CONTENT_ACTIVE_CLASS)},checkIfOtherIsSelected:function(){"harasses-category"===this._reason&&this.$(".reportCategoryItems").show(),"harasses-category"!==this._reason&&"harasses-mechildren"!==this._reason&&"harasses-someoneelse"!==this._reason&&"hateful-togroup"!==this._reason&&this.$(".reportCategoryItems").hide(),this.triggerEvent(P.CONST.EVENT_REPORT_REASON_SELECTED,this.$el,this._reason)}}),goog.provide("P.modules.FlagContentConfirm"),goog.require("P.Module");var GA_CATEGORY="user_flag";P.modules.FlagContentConfirm=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={};this.options.show_explanation&&(b={explanation:[P.Validator.Required(),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})]});var c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target;b&&("cancelButton"===b.id?P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_CLICK_CANCEL):"reportButton"===b.id&&P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_CLICK_SUBMIT))},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.options.object_flagged;"user"===b?this.reportUser():"conversation"===b&&this.reportConversation()}},onReportUserSuccess:function(){var a=this,b={name:"ConfirmDialog",options:{template:"flag_user_success"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.onFlagConfirm)})},onFlagConfirm:function(){this.destroy()},removeConversation:function(a){var b={conversation_id:a},c=P.resourceFactory.create("ConversationResource",b);c.callDelete({error:P.NOOP}).then(function(){P.getConversationsManager().scaleConversationDownAndRemove(a)})},reportConversation:function(){var a=this.options;a.conversation_id=a.conversation.id;var b=P.resourceFactory.create("ConversationReportResource",a),c=this;b.callCreate().then(function(){c.onReportUserSuccess(),c.removeConversation(a.conversation_id),P.getModalManager().removeAllModals(),c.destroy()},function(a){P.showError(a.message),P.getModalManager().removeAllModals(),c.destroy()})},reportUser:function(){var a=this,b=this.options.user_id,c={reported_user:b,reason:this.options.reason};this.options.show_explanation&&(c.explanation=this.$("textarea").val());var d=P.resourceFactory.create("UserReportResource",c);d.callCreate({success:function(){P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_SUCCESS),a.onReportUserSuccess()},error:function(a){P.showError(a.message),P.trackGAEvent(GA_CATEGORY,P.CONST.GA_ACTION_ERROR)},complete:function(){P.getModalManager().removeAllModals(),a.destroy()}})}}),goog.provide("P.modules.FlagConversation"),goog.require("P.Module"),P.modules.FlagConversation=P.Module.extend({}),goog.provide("P.modules.FlagPin"),goog.require("P.Module");var FLAG_PIN_GA_CATEGORY="pin_flag";P.modules.FlagPin=P.Module.extend({onContentReady:function(){var a=this.$("form"),b={reason:[P.Validator.Required()]},c={prevalidate:!0};this.form=new P.Form(a,b,c),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_REPORT_REASON_SELECTED,this._onReportReasonSelected);var d=this.getChildById("submitButton");d.disable()},onSubmitValidated:function(a){a.errors[0]||this.flagPin()},_onReportReasonSelected:function(){var a=this.getChildById("submitButton");a.enable()},flagPin:function(){var a=this,b=this.getChildById("submitButton");b.showLoading();var c="Unlabeled",d=null,e=null,f=P.app.backgroundModule,g=0,h="BoardPage";f&&(c=f.className,"SearchPage"===c?(d=f.options.scope,e=f.options.query):c===h?(d=f.options.tab,g=f.getNumPinsFlagged()):"FeedPage"===c?d=f.options.feed:"DomainFeedPage"===c&&(d=f.options.feed_item_type,e=f.options.domain));var i={pin_id:this.options.pin_id,reason:this.$("form :checked").attr("value"),source:c,sourceDetail1:d,sourceDetail2:e};"other"===i.reason&&(i.explanation=this.$("textarea").val());var j=3,k="flag_pin";g>=j&&(k="power_reporter_thanks");var l={name:"ConfirmDialog",options:{template:k}};P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_CLICK_SUBMIT,"reason",i.reason);var m=P.resourceFactory.create("PinFlagResource",i);m.callCreate({success:function(){P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_SUCCESS),P.loadModule(l,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.destroy)}),c===h&&P.pubsub.publish(a.options.board_id,P.CONST.PUBSUB_TOPIC_PIN_FLAGGED,{})},error:function(a){P.trackGAEvent(FLAG_PIN_GA_CATEGORY,P.CONST.GA_ACTION_ERROR),P.showError(a.message)},complete:function(){b.hideLoading()}})}}),goog.provide("P.modules.FlagUser"),goog.require("P.Module"),P.modules.FlagUser=P.Module.extend({}),goog.provide("P.modules.FollowerCount"),goog.require("P.Module"),P.modules.FollowerCount=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowerChange,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onFollowerChange,this.pubsubSubscribe(this.data.id,a),P.modules.NavigateButton.prototype.onContentReady.call(this)},onFollowerChange:function(){this.render()}}),goog.provide("P.modules.FramedSignup"),goog.require("P.Module"),P.modules.FramedSignup=P.Module.extend({postMessageEvents:{navigate:"onFrameNavigate",userRegister:"onFrameUserRegister",userLogin:"onFramedUserLogin",finishRegistration:"onFinishRegistration"},onContentReady:function(){this.$iframe=$("<iframe/>"),this.$iframe.attr({src:this.options.url+"?"+this.getIframeQueryString(),frameborder:"0",scrolling:"no"}),this.$el.append(this.$iframe),this.showLoading(!0),this.listen($(window),"message",this.onPostMessage),this.listen(this.$iframe,"load",this.onIframeLoaded)},getIframeQueryString:function(){var a=_.extend({},this.options);return $.param(a)},getIframeWindow:function(){return this.$iframe[0].contentWindow},onPostMessage:function(a){if(a.originalEvent.origin.split("://")[1]!==this.options.domain)return void this.log.warn("Received a message from a different origin.",a.originalEvent.origin);if(a.originalEvent.source!==this.getIframeWindow())return void this.log.warn("Ignoring data from different source.");var b=JSON.parse(a.originalEvent.data);if(!b)return void this.log.error("Inavlid post message data.");var c=this.postMessageEvents[b.event];return c&&this[c]?void this[c](b):void this.log.warn("No handler function for event type: '"+b.event+"'")},onFrameNavigate:function(a){P.changeWindowLocation(a.url,!0)},onFrameUserRegister:function(){this.options.skip_nux&&Cookie.set(P.CONST.COOKIE_SKIP_NUX,"1"),this.log.debug("User registered!"),this.onFramedUserLogin()},onFramedUserLogin:function(){window.location.reload()},onFinishRegistration:function(){P.navigate("/join/register/facebook/")},onIframeLoaded:function(){this.hideLoading()}}),goog.provide("P.modules.FriendCenter"),goog.require("P.Module"),P.modules.FriendCenter=P.Module.extend({}),goog.provide("P.modules.GroupBoardEmailSettings"),goog.require("P.Module"),P.modules.GroupBoardEmailSettings=P.Module.extend({onCreated:function(){this.childListen("change",this.onChildChange)},onSubmitValidated:function(){return this.save(),!1},save:function(){var a=this,b={},c=[];this.$form.find("input[name=collab_board_email]:checked").each(function(){c.push(this.value)}),b.email_collaborative_board_ids=c;var d=this.getChildById("submitButton"),e=P.resourceFactory.create("UserSettingsResource",b),f=function(a){a&&!a.resource_response.error};d.showLoading(),e.callUpdate({success:f,complete:function(){d.hideLoading(),a.destroy()}})},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a={};this.$form=this.$("form"),this.form=new P.Form(this.$form,a),this.listen(this.form,"submitValidated",this.onSubmitValidated)},onChildChange:function(a){var b=a.target;if("toggleAll"===b.id){var c;c=b.isChecked()?function(a){a.setChecked(!0)}:function(a){a.setChecked(!1)};var d=this.getChildrenByModuleName("ui.Checkbox");_.each(d,c)}}}),goog.provide("P.modules.HeroConvertToBusiness"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroConvertToBusiness=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HeroFriendsInvite"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_INVITE="invite";P.modules.HeroFriendsInvite=P.modules.HeroHelperBase.extend({onButtonClick:function(a){var b=a.target;if(b.id===BUTTON_ID_INVITE){var c={name:"MultiInviter"};P.loadModule(c,function(a){P.getModalManager().showInModal(a)})}}}),goog.provide("P.modules.HeroInstallApp"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_INSTALL_APP="install_app";P.modules.HeroInstallApp=P.modules.HeroHelperBase.extend({onContentReady:function(){this.formListener&&this.removeListener(this.formListener);var a;a={phoneNumber:[P.Validator.Required(),P.Validator.PhoneNumber()]},this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.installAppButton=this.getChildById(BUTTON_ID_INSTALL_APP),P.modules.HeroHelperBase.prototype.onContentReady.call(this)},onSubmitValidated:function(a){a.errors[0]||this.installAppSms()},onSuccess:function(){this.complete(),this.installAppButton.hideLoading(),this.installAppButton.setText(this.options.sent_text),this.installAppButton.disable()},onFailure:function(){this.installAppButton.hideLoading()},installAppSms:function(){var a=this.form.getValue("phoneNumber"),b=this.form.getValue("country"),c=P.resourceFactory.create("SmsAppInstall",{number:a,country:b});this.installAppButton.showLoading();var d=this;c.callCreate({error:P.NOOP}).then(function(){d.onSuccess()},function(){d.onFailure()})}}),goog.provide("P.modules.HeroLanguagePicker"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroLanguagePicker=P.modules.HeroHelperBase.extend({events:{"click .showEnglish":"showEnglish"},showEnglish:function(){this.options.show_english=!0,this.render()},_onButtonClick:function(a){var b=a.target,c=b.id;"switch"===c?this._switch():"close"===c&&this._close(!0)},_close:function(a){var b=a?"language_unchanged":"language_confirmation",c={name:"ConfirmDialog",options:{template:b,language_name:this.extraData.language_name}};P.modules.HeroHelperBase.prototype.dismiss.call(this,!0);var d=this;P.loadModule(c,function(b){d.showInModal(b),d.listen(b,P.CONST.EVENT_DESTROYED,_.bindFn(d.dismiss,d,!1,a))})},dismiss:function(a,b){b||window.location.reload(!0),this.destroy()},_switch:function(){var a={locale:this.resource.options.locale},b=P.resourceFactory.create("UserSettingsResource",a);b.callUpdate({success:_.bindFn(this._close,this,!1)})}}),goog.provide("P.modules.HeroPinItButton"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_PINIT_BUTTON="pinitButton";P.modules.HeroPinItButton=P.modules.HeroHelperBase.extend({onContentReady:function(){this.extraData.isChrome&&this.detectExtensionInstalled()&&this.dismiss(),P.modules.HeroHelperBase.prototype.onContentReady.call(this)},onButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_PINIT_BUTTON&&this.extraData.url&&(this.extraData.isChrome?this.handleChromeExtension():(P.changeWindowLocation(this.extraData.url,this.extraData.newWindow),this.complete(!0)))},handleChromeExtension:function(){this.detectExtensionInstalled()||(chrome.webstore.install(),this.complete(!0))},detectExtensionInstalled:function(){return"true"===$("body").attr("data-pinterest-extension-installed")}}),goog.provide("P.modules.HeroPinItWeb"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var BUTTON_ID_PINIT_BUTTON_WEB="pinitButton";P.modules.HeroPinItWeb=P.modules.HeroHelperBase.extend({onButtonClick:function(a){var b=a.target;b.id===BUTTON_ID_PINIT_BUTTON_WEB&&(P.changeWindowLocation(this.extraData.url,this.extraData.newWindow),this.complete(!0))}}),goog.provide("P.modules.HeroPlacePinsBoard"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase");var TRY_IT_BUTTON="tryItButton";P.modules.HeroPlacePinsBoard=P.modules.HeroHelperBase.extend({onButtonClick:function(a){var b=a.target;b.id===TRY_IT_BUTTON&&(this.changeBoardLayoutToPlaces(),this.complete())},changeBoardLayoutToPlaces:function(){var a=this.getChildById(TRY_IT_BUTTON),b=this.resource.options.board_id;a.showLoading(),this.resource.options.layout=P.CONST.BOARD_LAYOUT_PLACES,this.resource.callUpdate({success:function(a){var c=a.resource_response;P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,c.data)},complete:function(){a.hideLoading()}})}}),goog.provide("P.modules.HeroPlacePinsExamples"),goog.require("P.Module"),goog.require("P.modules.HeroPlacePinsExamplesBase"),P.modules.HeroPlacePinsExamples=P.modules.HeroPlacePinsExamplesBase.extend({}),goog.provide("P.modules.HeroPromoteAPin"),goog.require("P.modules.HeroHelperBase");var ID_BUTTON_GET_STARTED="get_started",URL_PROMOTE_A_PIN="";P.modules.HeroPromoteAPin=P.modules.HeroHelperBase.extend({onButtonClick:function(a){var b=a.target;b.id===ID_BUTTON_GET_STARTED&&(P.changeWindowLocation(URL_PROMOTE_A_PIN,!0),this.complete(!0))}}),goog.provide("P.modules.HeroVerifyWebsite"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroVerifyWebsite=P.modules.HeroHelperBase.extend({}),goog.provide("P.modules.HomePage"),goog.require("P.Module"),P.modules.HomePage=P.Module.extend({}),goog.provide("P.modules.IframeEmbed"),goog.require("P.Module"),P.modules.IframeEmbed=P.Module.extend({}),goog.provide("P.modules.ImagesFeedPage"),goog.require("P.Module"),P.modules.ImagesFeedPage=P.Module.extend({onContentReady:function(){var a=this.getChildById("domainPinsGrid");a&&0===a.children.length?a.destroy():this.$(".domainPinsHolder").css("visibility","visible")}}),goog.provide("P.modules.IncrementingNavigateButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton");var INCREMENTING_NAVIGATE_BUTTON_CLASS_HIDDEN="hidden";P.modules.IncrementingNavigateButton=P.modules.NavigateButton.extend({onContentReady:function(){this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.makeVisible),this.listen(this,P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.makeInvisible)},getValue:function(){if(this.extraData&&this.extraData.actionCount)return this.extraData.actionCount;var a=$.trim(this.$el.text()),b=parseInt(a,10);return b},setValue:function(a){this.extraData.actionCount=a,this.$el.text(a)},isHidden:function(){return this.$el.hasClass(INCREMENTING_NAVIGATE_BUTTON_CLASS_HIDDEN)},makeVisible:function(){var a=this.isHidden();a&&this.$el.removeClass(INCREMENTING_NAVIGATE_BUTTON_CLASS_HIDDEN)},makeInvisible:function(){var a=this.isHidden();a||this.$el.addClass(INCREMENTING_NAVIGATE_BUTTON_CLASS_HIDDEN)},increment:function(){var a=this,b=this.getValue();isNaN(b)&&(b=0),this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,a.options.siblingButtonId,!0),b+=1,this.setValue(b)},decrement:function(){var a=this,b=this.getValue();return b-=1,0===b?void this.triggerEvent(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,a.options.siblingButtonId,!0):void this.setValue(b)},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/IncrementingNavigateButton/IncrementingNavigateButton.nunjucks")}),goog.provide("P.modules.InfoBarBase"),goog.require("P.Module");var INFO_BAR_ACTIVE_CLASS="active";P.modules.InfoBarBase=P.Module.extend({onCreated:function(){this.listen(this,P.CONST.EVENT_NAVIGATE,this.onTabClick),this.childListen(P.CONST.EVENT_NAVIGATE,this.onTabClick)
},onTabClick:function(a){var b=a.data.url;b&&this.selectTab(b)},selectTab:function(a){this.$("a").each(function(){var b=$(this);b.attr("href")===a?b.addClass(INFO_BAR_ACTIVE_CLASS):b.removeClass(INFO_BAR_ACTIVE_CLASS)})}}),goog.provide("P.modules.InitiatePasswordReset"),goog.require("P.Module"),P.modules.InitiatePasswordReset=P.Module.extend({onContentReady:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{email:[P.Validator.Required(),P.Validator.Email()]},{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.form.getValue("email");this.resetPassword(b)}},resetPassword:function(a){var b={username_or_email:a},c=P.resourceFactory.create("UserResetPasswordResource",b),d=this.getChildById("resetPasswordButton"),e=this;d.showLoading(),c.callCreate({error:P.NOOP}).then(function(){e.onSuccess(a)}).fin(function(){d.hideLoading()})},onSuccess:function(a){this.$form.hide();var b=P.string.format(P._("We'll send a message to <strong>{{ email }}</strong> so you can pick your new password."),{email:a});this.$(".messageText").html(b),this.$(".successMessage").show()}}),goog.provide("P.modules.InlineHoverButton"),goog.require("P.Module"),P.modules.InlineHoverButton=P.Module.extend({}),goog.provide("P.modules.Interest"),goog.require("P.Module"),P.modules.Interest=P.Module.extend({events:{click:"onClick"},onClick:function(){this.triggerEvent(P.CONST.EVENT_ITEM_CLICK,this.data,!0),this.options.show_mask&&this.$(".wholeInterestMask").toggle(),this.options.checkable&&this.$(".selectCheck").toggleClass("checked")},onContentReady:function(){var a=parseInt(this.$el.attr("class").replace(/^.*size([0-9]+).*$/,"$1"),10).toString().split(""),b="N"===a[0]?1:parseFloat(a[0]);this.state=b,$.data(this.$el,"grid-columns",this.state),$.data(this.$el,"grid-rows",this.state)}}),goog.provide("P.modules.InterestFeedPage"),goog.require("P.Module"),P.modules.InterestFeedPage=P.Module.extend({_hexToRGB:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:{r:150,g:156,b:157}},onContentReady:function(){var a=this.$(".headerBackground");if(a.length){var b="left",c=a.attr("style").replace("background-color: ","");this.$(".headerBackground").hasClass("backwards")&&(b="right");var d=this._hexToRGB(c),e=d.r,f=d.g,g=d.b,h="rgba("+e+","+f+","+g+",1) 0%,",i=h+" rgba("+e+","+f+","+g+",0) 17%,",j=i+" rgba("+e+","+f+","+g+",0) 17%,",k=j+" rgba("+e+","+f+","+g+",1) 35%,",l=k+" rgba("+e+","+f+","+g+",1) 100%",m="background: linear-gradient(to "+b+", "+l+");";this.$(".bgGradient").attr("style","background-color: "+c+";"+m),this.$(".rightImage").delay(1e3).animate({opacity:.7},{duration:500})}}}),goog.provide("P.modules.InterestModal"),goog.require("P.Module"),P.modules.InterestModal=P.Module.extend({onContentReady:function(){$(".InterestPage").css({visibility:"hidden"}),$(".loading").fadeOut(400).remove(),this.parent.$(".closeModal").addClass("visible close")}}),goog.provide("P.modules.InterestPage"),goog.require("P.Module"),P.modules.InterestPage=P.Module.extend({onContentReady:function(){this.loadTutorial()},loadTutorial:function(){var a=P.ExperienceManager.instance(),b=P.Experiences.Placement.WEB_EXPLORE_TAKEOVER,c=a.getPlacedExperience(b);if(c){var d=P.ExperienceManager.Tutorials[c.experience_id];d&&(P.TutorialManager.instance().startTutorial(d),a.viewPlacedExperience(b,c.experience_id))}}}),goog.provide("P.modules.InterestRelatedPins"),goog.require("P.Module"),P.modules.InterestRelatedPins=P.Module.extend({onContentReady:function(){this.extraData.empty&&this.destroy()}}),goog.provide("P.modules.InterestsMenu"),goog.require("P.Module"),P.modules.InterestsMenu=P.Module.extend({onContentReady:function(){this.interestsSelector=this.getChildById("interestsSelector"),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_INTEREST_FOLLOW,this.onInterestFollow)},onButtonClick:function(a){var b=a.target.id;"addInterestButton"===b?this.switchToTypeahead():"searchClose"===b&&this.switchToSelector()},onInterestFollow:function(a){var b=a.target;if("interestsTypeaheadField"===b.id){var c=a.data.resource_response.data;if(c.is_followed)this.switchToSelector();else{var d=this;this.interestsSelector.prependInterest(c.key).then(function(){d.switchToSelector(),d.interestsSelector.redrawSelector()})}}},switchToTypeahead:function(){this.$(".interestsTypeahead").show(),this.interestsSelector.hide()},switchToSelector:function(){this.$(".interestsTypeahead").hide(),this.interestsSelector.show()}}),goog.provide("P.modules.InterestsSelector"),goog.require("P.Module");var INTEREST_SELECTOR_MIN_THRESHOLD=300;P.modules.InterestsSelector=P.Module.extend({onCreated:function(){this.onInterestGridScroll=_.bindFn(this.onInterestGridScroll,this),this.onInterestGridScroll=_.throttle(this.onInterestGridScroll,200)},onContentReady:function(){this.interestsPagedGrid=this.getChildById("interestsPagedGrid"),this.interestsGrid=this.interestsPagedGrid.getChildByModuleName("Grid"),this.scrollableElement=this.$(".interestsGridWrapper"),this._scrollListener=this.listen(this.scrollableElement,P.CONST.EVENT_SCROLL,this.onInterestGridScroll),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentChanged),this.childListen(P.CONST.EVENT_ITEMS_END,this.onItemsEnd)},onInterestGridScroll:function(){if(!this.rendering){var a=this.$(".interestsGrid"),b=a.height()+a.position().top-this.scrollableElement.height();b<=INTEREST_SELECTOR_MIN_THRESHOLD&&this.fetchMore()}},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);this.rendering=!0,this.interestsPagedGrid.requestMore()}},onContentChanged:function(a){var b=a.target.id;"items"===b&&(this.interestsPagedGrid.hideMoreItemsLoading(),this.redrawSelector(),this.rendering=!1)},onItemsEnd:function(){this.removeListener(this._scrollListener)},prependInterest:function(a){var b=this,c={name:"Interest",options:{view_type:"interestMenuGridItem"},resource:{name:"InterestResource",options:{interest:a}}};return P.loadModule(c).then(function(a){a.render().then(function(){b.interestsGrid.prependChildItem(a)})})},redrawSelector:function(){this.interestsGrid.onResize()}}),goog.provide("P.modules.InternationalSubdomains"),goog.require("P.Module"),P.modules.InternationalSubdomains=P.Module.extend({}),goog.provide("P.modules.InviteFriendsRep"),goog.require("P.Module"),P.modules.InviteFriendsRep=P.Module.extend({events:{click:"onClick"},onClick:function(){return"facebook"===this.options.network&&P.FacebookDialog.open({type:"send",name:this.extraData.name,description:this.extraData.description,path:"/",picture:this.extraData.picture}),!1}}),goog.provide("P.modules.InviteLanding"),goog.require("P.Module"),P.modules.InviteLanding=P.Module.extend({onContentReady:function(){if(P.trackRegisterAction("web_invite_landing"),P.Invite.trackInviteFunnelAction("invite_landing"),P.Invite.trackInviteFunnelAction("recipient_invite_landing",!0),this.options.show_invite_modal){var a={name:"InviteModal",resource:{name:"UserResource",options:{user_id:this.options.inviter_user_id}}};P.loadModule(a,function(a){P.getModalManager().showInModal(a,{can_dismiss:!1})})}}}),goog.provide("P.modules.InviteListBase"),goog.require("P.Module"),goog.require("P.typeaheadProvider");var MIN_SCROLL_THRESHOLD=2500,EMAIL_NETWORKS=["google","yahoo"];P.modules.InviteListBase=P.Module.extend({events:{"click .inviteAllLabel":"_onClickInviteAll",'textchange input[type="text"]':"_onTextChange"},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.scrollableElement=this.$(".inviteContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this._onInviteScroll),this.inviteList=this.getChildById("inviteList"),this.emptyResultsFooter=this.$(".emptyResults"),this.sendButton=this.getChildById("inviteButton"),this.options.checkable&&(this.inviteAllCheck=this.getChildById("inviteAllCheck")),this._reset()},_reset:function(){this.checkedContacts={},this.options.checkable&&(this.sendButton.setEnabled(!1),this.childListen(P.CONST.EVENT_CHANGE,this._onChange)),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick),this._onInviteScroll=_.bindFn(this._onInviteScroll,this),this._onInviteScroll=_.throttle(this._onInviteScroll,200);var a={name:"invite",tags:this.options.network,count:50};this.typeahead=new P.TypeaheadProvider(a),this.typeahead.prefetch(),this.listen(this.typeahead,P.CONST.EVENT_DATA,this._onTypeaheadData)},_onInviteScroll:function(){if(!this.rendering&&this._searchIsEmpty()){var a=this.$(".List");if(a.position()){var b=a.height()+a.position().top-this.scrollableElement.height();b<=MIN_SCROLL_THRESHOLD&&this._fetchMore()}return!1}},_onChange:function(a){var b=a.target;if("inviteAllCheck"===b.id)this._onToggleInviteAll(a);else{for(var c=0,d=0;d<this.inviteList.children.length;d++){var e=this.inviteList.children[d];this.checkedContacts[e.getEmail()]=e.isChecked(),c+=e.isChecked()?1:0}this._searchIsEmpty()&&this.inviteAllCheck.setChecked(c===this.inviteList.children.length,!1);var f=0;for(var g in this.checkedContacts)this.checkedContacts[g]&&f++;this.sendButton.setEnabled(f>0)}},_onClick:function(a){"inviteButton"===a.target.id&&this._onClickInvite(a)},_fetchMore:function(){var a=this;return this.inviteList.options.item_options.checkedAll=this.inviteAllChecked(),this.resource.atEnd()?void this.removeListener(this._scrollListener):(this.rendering=!0,void this.getChildById("inviteList").renderAdditional(P.ModuleRenderType.APPEND,function(){a.rendering=!1}))},_onTextChange:function(){this._filterResults()},_onTypeaheadData:function(a){var b=this;if(!this._searchIsEmpty()&&this._getSearchText()===a.term){var c=[];_.each(a.items,function(a){var d=$.extend({},a);$.inArray(b.options.network,EMAIL_NETWORKS)>=0&&(d.id_type="email"),b.options.checkable&&(b.checkedContacts[d.id]|=b.inviteAllChecked(),d.checked=b.checkedContacts[d.id]),c.push(d)}),this.inviteList.options.items=c,this.inviteList.resource=null,this.inviteList.render(),c.length?this.emptyResultsFooter.hide():this.emptyResultsFooter.show()}},_filterResults:function(a){var b=this;this._searchIsEmpty()?(this.inviteList.resource||this.inviteList.renderAbort(),this.emptyResultsFooter.hide(),this.inviteList.resource=this.resource,delete this.inviteList.options.items,this.inviteList.render().then(function(){b._searchIsEmpty()&&(b.options.checkable&&_.each(b.inviteList.children,function(a){a.setChecked(b.checkedContacts[a.getEmail()],!1)}),a&&a())})):this.typeahead.search(this._getSearchText(),function(){})},_getSearchText:function(){return this.$("input[type='text']").val().toLowerCase()},_searchIsEmpty:function(){var a=this._getSearchText();return!a||""===a},inviteAllChecked:function(){return this.options.checkable&&this.inviteAllCheck.isChecked()},_onClickInvite:function(){this.sendInvitesClicked()},_onToggleInviteAll:function(){var a=this;this._getSearchText()?(this.$("input[type='text']").val(""),this._filterResults(function(){a._toggleInviteAll()})):a._toggleInviteAll()},_onClickInviteAll:function(){this.inviteAllCheck.setChecked(!this.inviteAllChecked()),this._onToggleInviteAll()},_toggleInviteAll:function(){var a=this,b=this.inviteAllChecked();_.each(this.inviteList.children,function(c){a.checkedContacts[c.getEmail()]=b,c.setChecked(b)}),this.sendButton.setEnabled(b)},getCheckedContacts:function(){return this.checkedContacts},sendInvitesClicked:P.NOOP}),goog.provide("P.modules.InviteListEmail"),goog.require("P.Module"),goog.require("P.modules.InviteListBase"),P.modules.InviteListEmail=P.modules.InviteListBase.extend({sendInvitesClicked:function(){var a;if(this.inviteAllChecked())a=P.resourceFactory.create("BulkNetworkInviteResource",{network:this.options.network});else{var b=[],c=this.getCheckedContacts();for(var d in c)c[d]&&b.push(d);a=P.resourceFactory.create("UserMultiInviteResource",{emails:b})}this.sendButton.showLoading();var e=this;a.callCreate().then(function(){e.sendButton.hideLoading(),e.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)})}}),goog.provide("P.modules.InviteListFacebook"),goog.require("P.Module"),P.modules.InviteListFacebook=P.modules.InviteListBase.extend({onContentReady:function(){P.modules.InviteListBase.prototype.onContentReady.apply(this,arguments),P.fb.ensureInit(P.NOOP)}}),goog.provide("P.modules.InviteModal"),goog.require("P.Module"),P.modules.InviteModal=P.Module.extend({}),goog.provide("P.modules.JoinButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.JoinButton=P.modules.NavigateButton.extend({getNavigateUrl:function(){return P.getRegisterUrl({action:"join"})}}),goog.provide("P.modules.LanguageDropdown"),goog.require("P.Module"),P.modules.LanguageDropdown=P.Module.extend({events:{"click .language":"onClick"},onClick:function(a){var b=$(a.currentTarget),c=b.attr("data-url");return P.navigate(c),!1}}),goog.provide("P.modules.LanguageMenu"),goog.require("P.Module"),P.modules.LanguageMenu=P.Module.extend({}),goog.provide("P.modules.Login"),goog.require("P.Module"),goog.require("P.modules.LoginBase"),P.modules.Login=P.modules.LoginBase.extend({events:{"blur input[name=username_or_email]":"onBlurEmail","click .suggestionEmail":"onClickSuggestionEmail","click .forgotPassword":"onForgotPassword"},onBlurEmail:function(){if(this.extraData.showEmailSuggestion){var a=this.$inputEmail.val(),b=_.extend({},{email:a,email_filter:"allow_all"});null==this.emailSuggestionResource&&(this.emailSuggestionResource=P.resourceFactory.create("EmailSuggestionResource",b));var c=this;this.emailSuggestionResource.options=b,this.emailSuggestionResource.callGet({success:function(b){var d=b.resource_response.data;d.length>0?(c.$inputEmail.val(d[0]),c.$suggestionEmail.text(a),c.$suggestion.slideDown()):c.$suggestion.slideUp()},error:function(){c.$suggestion.slideUp()}})}},onClickSuggestionEmail:function(a){var b=this.$suggestionEmail.text();this.$inputEmail.val(b),this.$suggestion.slideUp(),a.preventDefault()},onContentReady:function(){var a={},b=this.options.invite_follow_board,c=this.options.invite_follow_user;return c&&(b?a.invite_follow_board=c+"/"+b:a.invite_follow_user=c,P.SessionStorage.setItem(P.CONST.SESSION_KEY_INVITE_FOLLOW,a)),P.currentUser.isAuthenticated()&&!P.currentUser.get("autologin")?void this.redirect(a):(P.modules.LoginBase.prototype.onContentReady.apply(this,arguments),this.$suggestion=this.$(".suggestion"),this.$suggestionEmail=this.$(".suggestionEmail"),void(this.$inputEmail=this.$("input[name=username_or_email]")))},onForgotPassword:function(a){window.location=$(a.target).attr("href")}}),goog.provide("P.modules.LoginButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.LoginButton=P.modules.NavigateButton.extend({getNavigateUrl:function(){return P.getLoginUrl({action:"login"})}}),goog.provide("P.modules.LoginPage"),goog.require("P.Module"),P.modules.LoginPage=P.Module.extend({onAddedToDom:function(){this.resizeWindow(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.resizeWindow(),this.extraData&&this.extraData.pinit_landing&&P.trackRegisterAction("unauth_pinit_landing")},resizeWindow:function(){this.contentReady&&this.inDom&&P.getWindowManager().contain(this.$el)}}),goog.provide("P.modules.LogoutAppUpsell"),goog.require("P.Module"),P.modules.LogoutAppUpsell=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)},onContentReady:function(){this.setupForm(),this.$("form input").first().focus()},setupForm:function(){var a={phone_or_email:[P.Validator.PhoneNumber()]};this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.sendButton=this.getChildById("submit_button")},onSubmitValidated:function(a){a.errors&&a.errors.length||this.installAppSms()},onFailure:function(){this.sendButton.hideLoading()},onSuccess:function(){this.$(".dialogInput").hide("fast"),this.$(".dialogSuccess").show("fast")},installAppSms:function(){var a=this.form.getValue("phone_or_email"),b=P.resourceFactory.create("SmsAppInstall",{number:a});this.sendButton.showLoading(),b.callCreate({error:P.NOOP}).then(_.bindFn(this.onSuccess,this),_.bindFn(this.onFailure,this))}}),goog.provide("P.modules.MoreDropdown"),goog.require("P.Module"),P.modules.MoreDropdown=P.Module.extend({}),goog.provide("P.modules.MultiInviter"),goog.require("P.Module"),P.modules.MultiInviter=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_INVITE_USER,this._onInviteSent)},_onInviteSent:function(){var a=this;this.$(".inviteConfirm").show(),P.setTimeout(function(){a.$(".inviteConfirm").hide()},2e3)}}),goog.provide("P.modules.NagBase"),goog.require("P.Module"),P.modules.NagBase=P.Module.extend({events:{"click .nagClose":"onCloseButtonClick"},clickHandler:function(){return null},onCloseButtonClick:function(){this.destroy(),P.trackGAEvent("nag",P.CONST.GA_ACTION_CLICK_CLOSE,"type",this.extraData.type)},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_NAG_UPDATED]=this.onActionSaved,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onActionSaved:function(a,b,c){this.updateNagMessage(c)},updateNagMessage:function(a){this.$(".message").text(a)},resourceCall:function(a,b,c){var d=c.success,e=c.error;this.xhr=$.ajax({cache:!1,url:a,data:{},dataType:"json",type:"get"===b?"get":"post",success:d,error:e})}}),goog.provide("P.modules.NagEmail"),goog.require("P.Module"),goog.require("P.modules.NagBase");var SUCCESS_MESSAGE=P._("Thanks! You should receive a confirmation email soon.");P.modules.NagEmail=P.modules.NagBase.extend({events:{"click .message a":"handleLinkClick"},handleLinkClick:function(a){switch(a.target.id){case"cancelEmailUpdate":this.cancelEmailUpdate();break;case"editEmail":this.updateEmail();break;case"removeBounce":this.removeBounce();break;case"resendEmail":this.resendConfirmEmail();break;case"resendEmailUpdate":this.resendUpdatedEmailAddressEmail()}return!1},removeBounce:function(){var a=P.resourceFactory.create("UserSettingsResource",{email_bounced:!1}),b=this;a.callUpdate().then(function(){var a=P._("Got it! Make sure your inbox isn't full so that our emails can find their way to you.");b.updateNagMessage(a)})},updateEmail:function(){var a=this;this.showLoading();var b={name:"UserEditEmail",resource:{name:"UserSettingsResource",options:{}}};P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)})},cancelEmailUpdate:function(){var a=P.resourceFactory.create("CancelEmailUpdateResource"),b=this;a.callCreate().then(function(){b.updateNagMessage(P._("Thanks! Your email address change was cancelled."))})},resendUpdatedEmailAddressEmail:function(){var a=P.resourceFactory.create("ResendEmailUpdateEmailResource"),b=this;a.callCreate().then(function(){b.updateNagMessage(SUCCESS_MESSAGE)})},resendConfirmEmail:function(){var a=P.resourceFactory.create("ResendVerificationEmailResource"),b=this;a.callCreate().then(function(){b.updateNagMessage(SUCCESS_MESSAGE)})}}),goog.provide("P.modules.NagNoScript"),goog.require("P.Module"),P.modules.NagNoScript=P.Module.extend({}),goog.provide("P.modules.NagPolicy"),goog.require("P.Module"),goog.require("P.modules.NagBase"),P.modules.NagPolicy=P.modules.NagBase.extend({events:{"click .policy":"clickHandler"},clickHandler:function(){var a=this,b={name:"ConfirmDialog",options:{template:"pin_policy"}};return P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,function(){a.savePolicyConfirmation()})}),!1},onActionSaved:function(){P.modules.NagBase.prototype.onActionSaved.apply(this,arguments);var a=this;P.setTimeout(function(){a.parent.render()},2e3)},savePolicyConfirmation:function(){var a=this,b=function(b){"success"===b.status?a.updateNagMessage("Thanks for confirming!"):a.log.debug(b)},c=function(b){a.log.debug(b)};this.resourceCall("/confirm_guidelines/","post",{success:b,error:c})}}),goog.provide("P.modules.NagSearch"),goog.require("P.Module"),P.modules.NagSearch=P.Module.extend({}),goog.provide("P.modules.NagSecurity"),goog.require("P.Module"),goog.require("P.modules.NagBase"),P.modules.NagSecurity=P.modules.NagBase.extend({onContentReady:function(){this.showWriteBanned()},events:{"click .resetPassword":"clickHandler"},clickHandler:function(){var a=this,b=function(){var b=P._("Thanks! You should receive a password reset email soon.");a.updateNagMessage(b)},c=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username});return c.callCreate({error:P.NOOP}).then(b),!1},showWriteBanned:function(){P.writeban.showWriteBanned(this)}}),goog.provide("P.modules.NagSwitchToMobile"),goog.require("P.Module"),P.modules.NagSwitchToMobile=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){"switchToMobileSite"===a.target.id&&(Cookie.unset(P.CONST.COOKIE_FORCE_DESKTOP),P.changeWindowLocation("/",!1))}}),goog.provide("P.modules.NagUnauth"),goog.require("P.Module"),P.modules.NagUnauth=P.modules.NagBase.extend({clearKeywords:function(){var a=this.getChildById("nag");a&&a.clearKeywords()}}),goog.provide("P.modules.NagUnauthBase"),goog.require("P.Module"),goog.require("P.fb"),P.modules.NagUnauthBase=P.modules.NagBase.extend({onContentReady:function(){var a=this;this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onNavigateButtonClick);var b={};b[P.CONST.PUBSUB_TOPIC_UNAUTH_NAG_TYPE]=this.onMessageTypeChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_UNAUTH_NAG,b),P.fb.ensureInit(function(b){b.getLoginStatus(function(b){a.showFacebookInfo(b)})}),P.trackRegisterAction("unauth_nag")},showFacebookInfo:function(a){var b=a.status;("connected"===b||"not_authorized"===b)&&(this.$el.removeClass("fbHidden subMessageHidden"),this.options&&this.$(".fbIframe").attr("src",this.options.fb_facepile_url))},onNavigateButtonClick:function(a){var b=a.target;"join"===b.id&&P.trackRegisterAction("register_from_nag")},onMessageTypeChange:function(a,b,c){return this.options.message_type===c?void this.log.debug("No need to re-render. Still message type: '"+c+"'"):(this.options.message_type=c,void this.render())},clearKeywords:function(){this.$el.hasClass("keywordsHidden")||(this.$el.addClass("keywordsHidden"),this.$el.hasClass("fbHidden")&&this.$el.addClass("subMessageHidden"),this.$(".keywords").remove())}}),goog.provide("P.modules.NagUnauthPersonal"),goog.require("P.Module"),P.modules.NagUnauthPersonal=P.modules.NagUnauthBase.extend({showFacebookInfo:function(a){return this.options&&"personalized"===this.options.type?(this.$el.removeClass("fbHidden"),void this.$(".fbIframe").attr("src",this.options.fb_facepile_url)):void P.modules.NagUnauthBase.prototype.showFacebookInfo.call(this,a)}}),goog.provide("P.modules.NagUnauthSimple"),goog.require("P.Module"),P.modules.NagUnauthSimple=P.modules.NagUnauthBase.extend({}),goog.provide("P.modules.Nags"),goog.require("P.Module"),P.modules.Nags=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_NAG_STATE]=this.onNagStateChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a);var b={};b[P.CONST.PUBSUB_TOPIC_MAIN_MODULE_NEW]=this.onMainModuleChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MAIN_MODULE,b)},onNagStateChange:function(a,b,c){this.$el.toggle(c)},onMainModuleChange:function(a,b,c){var d=c;this.options.main_module_name!==d.className&&(this.options.main_module_name=d.className,this.render()),this.options.main_module_options!==d.options&&(this.options.main_module_options=d.options,this.render())},clearKeywords:function(){var a=this.getChildById("unauthNag");a&&a.clearKeywords()}}),goog.provide("P.modules.NotificationItems"),goog.require("P.Module"),P.modules.NotificationItems=P.Module.extend({}),goog.provide("P.modules.NotificationSettings"),goog.require("P.Module"),P.modules.NotificationSettings=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var a=new P.Form(this.$form,[]);this.listen(a,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){var a=this,b={},c={};this.$(".pushNotifSettings input[type=checkbox]").each(function(){var a=$(this),b=a.attr("name");c[b.substr(5)]=a.is(":checked")?"anyone":"none"}),b.push_settings=JSON.stringify(c),b.filter_settings=this.$("input[name=filter_settings]:checked").val();var d=P.resourceFactory.create("NotificationSettingsResource",b);return this.showLoading(!0),d.callUpdate({complete:function(){a.hideLoading()},success:function(){a.destroy()}}),!1}}),goog.provide("P.modules.Notifications"),goog.require("P.Module");var ACTOR_ID_ATTR="data-actor-id",MIN_THRESHOLD=300;P.modules.Notifications=P.Module.extend({events:{"mouseover .notifMessage a":"onActorMouseover","click .notifItem":"onNotificationClick","click .notifSettings":"onSettingsClick"},mixins:[P.Mixins.PreventScroll],onCreated:function(){this.onNotificationsScroll=_.bindFn(this.onNotificationsScroll,this),this.onNotificationsScroll=_.throttle(this.onNotificationsScroll,200)},onContentReady:function(){this.scrollableElement=this.$(".notifContent"),this._scrollListener=this.listen(this.scrollableElement,"scroll",this.onNotificationsScroll),this.startPreventScroll(this.scrollableElement,this.$(".NotificationItems")),this.parent&&this.listen(this.parent,P.CONST.EVENT_DROPDOWN_HIDE,this.onHide)},onHide:function(){this.$(".unseen").removeClass("unseen")},onSettingsClick:function(){var a=this,b={name:"NotificationSettings",resource:{name:"NotificationSettingsResource",options:{}}};return P.loadModule(b,function(b){a.showInModal(b)}),!1},onActorMouseover:function(a){var b=$(a.target),c=b.attr(ACTOR_ID_ATTR);this.setActiveUser(c,b.parents(".notifItem"))},onNotificationClick:function(a){var b=$(a.target),c=$(a.currentTarget),d=c.attr("data-url");return b.is("a")?!0:void(d&&this.navigate(d))},onNotificationsScroll:function(){if(!this.rendering){var a=this.$(".NotificationItems"),b=a.height()+a.position().top-this.scrollableElement.height();return b<=MIN_THRESHOLD&&this.fetchMore(),!1}},fetchMore:function(){if(!this.rendering){if(this.resource.atEnd())return void this.removeListener(this._scrollListener);var a=this;this.rendering=!0,this.getChildById("items").renderAdditional(P.ModuleRenderType.APPEND,function(){a.rendering=!1})}},setActiveUser:function(a,b){b.find(".actorImage, .notifComment").each(function(){var b=$(this);b.toggleClass("active",b.attr(ACTOR_ID_ATTR)===a)})}}),goog.provide("P.modules.NuxImagesFeedPage"),goog.require("P.Module"),P.modules.NuxImagesFeedPage=P.Module.extend({}),goog.provide("P.modules.NuxPinCreate"),goog.require("P.Module"),P.modules.NuxPinCreate=P.Module.extend({}),goog.provide("P.modules.NuxTutorial"),goog.require("P.Module"),P.modules.NuxTutorial=P.Module.extend({}),goog.provide("P.modules.OAuthPage"),goog.require("P.modules.OAuthPageBase"),P.modules.OAuthPage=P.modules.OAuthPageBase.extend({events:{"click .authorizeApp":"onAuthorizeButtonClicked","click .joinButton":"onJoinButtonClicked"},onJoinButtonClicked:function(){P.navigate("/join/register/email/?next="+encodeURIComponent(P.getCurrentUrl()))}}),goog.provide("P.modules.PaddedPin"),goog.require("P.Module"),P.modules.PaddedPin=P.Module.extend({getLoggingObjectIdStr:function(){return this.resource.options.id},onAddedToDom:function(){this._setupClickIfReady()},onContentReady:function(){this._setupClickIfReady()},_setupClickIfReady:function(){if(this.contentReady&&this.inDom){var a=this;this.$(".visualSearchObjectTagClickTarget").click(function(){a.triggerEvent(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED,$(this).data("visualobjectid").toString(),!0)})}},getFirstVisualObject:function(){var a=this.$(".visualSearchObjectTagClickTarget");return a.length?a.first():null}}),goog.provide("P.modules.PasswordResetOneClick"),goog.require("P.Module"),P.modules.PasswordResetOneClick=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onResetPassword)},onSuccess:function(){this.$(".message").hide(),this.$(".successMessage").show()},onResetPassword:function(a){if("resetPasswordButton"===a.target.id){var b={username_or_email:this.options.username_or_email},c=P.resourceFactory.create("UserResetPasswordResource",b),d=this.getChildById("resetPasswordButton"),e=this;d.showLoading(),c.callCreate({error:P.NOOP}).then(function(){e.onSuccess()}).fin(function(){d.hideLoading()})}}}),goog.provide("P.modules.Pillow"),goog.require("P.Module"),P.modules.Pillow=P.Module.extend({}),goog.provide("P.modules.PinActionBar"),goog.require("P.Module"),goog.require("P.modules.IncrementingNavigateButton");var ACTION_LEFT_ROUNDED_CLASS="leftRounded",LIKES_BUTTON_ID="likesButton",REPINS_BUTTON_ID="repinsButton",PIN_IT_BUTTON_ID="pinItButton";P.modules.PinActionBar=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,b[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,b[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this.onPinRepinned,this.pubsubSubscribe(a,b)}this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_DESTROY,this.onCloseupIncrementButtonHide),this.childListen(P.CONST.EVENT_INCREMENT_BUTTON_CREATE,this.onCloseupIncrementButtonShow),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(a){a.data.contextualResource||(a.data.contextualResource=this.getContextualResource())}),this.extraData&&this.extraData.showPinTip&&this.showSavePinTooltip()},removeDropdowns:function(){var a=this.getDropdowns();_.each(a,function(a){a.hide()})},showSavePinTooltip:function(){var a=this.getChildById("pinItButton"),b={name:"Dropdown",options:{anchor:a.$el,class_name:"large",fixed:!1,position_point:"BOTTOM_LEFT",text:P._("<strong>Want to save this Pin for yourself?</strong> Go ahead and Pin It.")}},c=this;P.loadModule(b,function(a){a.render(function(){c.appendChild(a),a.positionModule(),a.fadeIn()})})},getDropdowns:function(){var a=this.getChildrenByModuleName("Dropdown")||[],b=this.getChildrenByModuleName("DropdownButton");return _.each(b,function(b){var c=b.getDropdown();a.push(c)}),a},getContextualResource:function(){return P.resourceFactory.create("PinResource",{id:this.options.pin_id})},showRepinModal:function(){var a=this.getChildById(PIN_IT_BUTTON_ID);a.showModal()},getLoadingSpinnerOptions:function(){return null},onPinRepinned:function(a,b,c){var d=this.getChildById(REPINS_BUTTON_ID);c.board&&"secret"!==c.board.privacy&&d&&d.increment()},onPinLiked:function(){var a=this.getChildById(LIKES_BUTTON_ID);a&&a.increment()},onPinUnliked:function(){var a=this.getChildById(LIKES_BUTTON_ID);a&&a.decrement()},onCloseupIncrementButtonHide:function(a){var b=a.data,c=this.getChildById(b);c.$el.removeClass(ACTION_LEFT_ROUNDED_CLASS)},onCloseupIncrementButtonShow:function(a){var b=a.data,c=this.getChildById(b);c.$el.addClass(ACTION_LEFT_ROUNDED_CLASS)},setDropdownsFixed:function(a){var b=this.getDropdowns();_.each(b,function(b){var c=_.clone(b.options);c.fixed=a,b.setOptions(c),b.positionModule()})},updateSticky:function(a){this._sticky||(this._sticky=new P.Sticky(this.$el,a),this.listen(this._sticky,P.CONST.EVENT_STICKY_FIXED,function(a){this.setDropdownsFixed(a)}))},unsticky:function(){this._sticky&&this._sticky.unSticky()},getLoggingObjectIdStr:function(){return this.options.pin_id},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/PinActionBar/PinActionBar.nunjucks")}),goog.provide("P.modules.PinBookmarklet"),goog.require("P.Module"),P.modules.PinBookmarklet=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onAddedToDom:function(){this._windowMessageListener=this.listen($(window),"message",_.bindFn(this.onWindowMessage,this))
},onRemovedFromDom:function(){this._windowMessageListener&&(this.removeListener(this._windowMessageListener),this._windowMessageListener=null)},_parseDataUri:function(a){var b=/^data:(.+\/.+);(.+),(.*)$/,c=a.match(b);return c?{contentType:c[1],encoding:c[2],payload:c[3]}:null},onWindowMessage:function(a){var b=a.originalEvent.data;if(b&&"pinImageData"===b.type){var c=b.dataUri;if(!c)return void P.showError(P._("Missing image data"));var d=this._parseDataUri(c);if(!d)return void P.showError(P._("Invalid image data uri"));if("base64"!==d.encoding)return void P.showError(P._("The image data URI uses an unsupported encoding"));var e=P.resourceFactory.create("ImagePreviewResource",{content_type:d.contentType,base64_payload:d.payload}),f=this;e.callCreate().then(function(a){var b=a.resource_response.data.image_url;f._setImage(b)})}},_setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinCreate");b.setImage(a)},onContentReady:function(){this.resizeWindowToFit();var a=this.options.image_url;!a&&window.opener&&window.opener.postMessage("pinterestReady","*")},onChildRemoved:function(){this.children.length?this.resizeWindowToFit():window.close()},onChildNavigate:function(a){var b=!0;P.changeWindowLocation(a.data.url,b),window.close()},resizeWindowToFit:function(){P.getWindowManager().shrinkWrap()}}),goog.provide("P.modules.PinBookmarkletTooltip"),goog.require("P.Module"),goog.require("P.Experiences");var PLACEMENT_ID=P.Experiences.Placement.WEB_TOOLTIP,EXPERIENCE_ID=P.Experiences.Experience.WEB_PINIT_BOOKMARKLET;P.modules.PinBookmarkletTooltip=P.Module.extend({events:{"drag .pinBookmarkletButton":"onPinBookmarkletDrag","click .pinBookmarkletButton":"onPinBookmarkletClick"},onPinBookmarkletDrag:function(){this.completeExperience()},onPinBookmarkletClick:function(){var a={name:"ConfirmDialog",options:{template:"pinit_bookmarklet_prompt"}};P.loadModule(a,function(a){P.getModalManager().showInModal(a,{can_dismiss:!1})})},onAddedToModal:function(a){this.listen(a,P.CONST.EVENT_DISMISS,this.dismissExperience)},onContentReady:function(){this.viewExperience()},viewExperience:function(){P.trackGAEvent("pin_bookmarklet_tooltip","viewed");var a=P.ExperienceManager.instance();a.viewPlacedExperience(PLACEMENT_ID,EXPERIENCE_ID)},completeExperience:function(){P.trackGAEvent("pin_bookmarklet_tooltip","completed");var a=P.ExperienceManager.instance();a.completePlacedExperience(PLACEMENT_ID,EXPERIENCE_ID)},dismissExperience:function(){P.trackGAEvent("pin_bookmarklet_tooltip","dismissed");var a=P.ExperienceManager.instance();a.dismissPlacedExperience(PLACEMENT_ID,EXPERIENCE_ID)}}),goog.provide("P.modules.PinCloseupSettings"),goog.require("P.Module"),P.modules.PinCloseupSettings=P.Module.extend({}),goog.provide("P.modules.PinComment"),goog.require("P.Module"),P.modules.PinComment=P.Module.extend({onCreated:function(){this.childListen("commentDeleteSuccess",this.onPinCommentDelete)},onPinCommentDelete:function(){var a=this;this.$el.slideUp(300,function(){a.destroy()})}}),goog.provide("P.modules.PinCommentList"),goog.require("P.Module"),goog.require("P.modules.PinCommentListBase"),P.modules.PinCommentList=P.modules.PinCommentListBase.extend({events:_.extend(P.modules.PinCommentListBase.prototype.events,{"mousedown .content":"onTextAreaMouseDown","keydown .content":"onTextAreaPossiblyResized","mouseup .content":"onTextAreaPossiblyResized"}),onTextAreaMouseDown:function(){this.commentContentHeight=this.$(".content").height()},onTextAreaPossiblyResized:function(){if(null!==this.commentContentHeight){var a=this.$(".content").height();this.commentContentHeight!==a&&(this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0),this.commentContentHeight=a)}}}),goog.provide("P.modules.PinCount"),goog.require("P.Module"),P.modules.PinCount=P.Module.extend({onContentReady:function(){if(this.options.can_update_count&&this.data.id){var a={};"UserResource"===this.resource.name&&(a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onCountUpdated),a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onCountUpdated,a[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onCountUpdated,this.pubsubSubscribe(this.data.id,a)}},onCountUpdated:function(a,b){var c=1e3;b===P.CONST.PUBSUB_TOPIC_PIN_DELETED&&(c=0),setTimeout(_.bindFn(this.render,this),c)}}),goog.provide("P.modules.PinCounts"),goog.require("P.Module");var PIN_COUNTS_CLASS_HIDDEN="hidden";P.modules.PinCounts=P.Module.extend({events:{"click .commentsIcon":"_onCommentsClick"},onContentReady:function(){this.pinId=this.options.pin_id,this.repinCount=this.data.repin_count,this.likeCount=this.data.like_count,this.commentCount=this.data.comment_count;var a={};a[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this._onPinCommentCreated,a[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED]=this._onPinCommentDeleted,a[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this._onPinLiked,a[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this._onPinUnliked,a[P.CONST.PUBSUB_TOPIC_PIN_REPINNED]=this._onPinRepinned,this.pubsubSubscribe(this.pinId,a)},_onCommentsClick:function(a){a.preventDefault(),this.triggerEvent(P.CONST.EVENT_PIN_COMMENTS_TOGGLED,null,!0)},_updateCountEl:function(a,b){a.text(b.toString());var c=a.parent();b?c.removeClass(PIN_COUNTS_CLASS_HIDDEN):c.addClass(PIN_COUNTS_CLASS_HIDDEN)},_setLikeCount:function(a){this.likeCount=a,this._updateCountEl(this.$(".likes"),a)},_setCommentCount:function(a){this.commentCount=a,this._updateCountEl(this.$(".comments"),a)},_setRepinCount:function(a){this.repinCount=a,this._updateCountEl(this.$(".repins"),a)},_onPinCommentCreated:function(){this._setCommentCount(this.commentCount+1)},_onPinCommentDeleted:function(){this._setCommentCount(this.commentCount-1)},_onPinLiked:function(){this._setLikeCount(this.likeCount+1)},_onPinUnliked:function(){this._setLikeCount(this.likeCount-1)},_onPinRepinned:function(a,b,c){c.board&&c.board.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this._setRepinCount(this.repinCount+1)}}),goog.provide("P.modules.PinCreate"),goog.require("P.Module");var PIN_CREATE_API_RESPONSE_CODE_SPAM_CONTENT=14;P.modules.PinCreate=P.Module.extend({setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinForm");b.setImage(a)},onButtonClick:function(a){var b=a.target;switch(b.id){case"submitButton":P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_CLICK_SUBMIT);break;case"cancelButton":P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_CLICK_CANCEL),this.modal||this.destroy()}},onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.GACategory=this.isRepin()?"repin_create":"pin_create",this.pinForm=this.getChildById("pinForm"),this.listen(this.pinForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen("boardCreated",this.onBoardCreate),this.boardPicker=this.pinForm.getChildById("boardPicker");var a=this.pinForm.form;this.listen(this.boardPicker,P.CONST.EVENT_BOARD_SELECTED,_.bindFn(a.enableSubmitButtons,a)),this.boardPicker.getSelectedBoardId()||a.disableSubmitButtons()},onSubmitValidated:function(a){var b=a.data;b.errors[0]||this.createPin()},isRepin:function(){return!(!this.data||!this.data.id)},getPinResource:function(){var a="PinResource",b=_.extend(this.pinForm.getData(),_.pick(this.options,"method","is_video"));return this.isRepin()&&(a="RepinResource",b.pin_id=this.data.id),P.resourceFactory.create(a,b)},createPin:function(){this.showLoading(!0);var a=this,b=this.getPinResource();b.callCreate({success:_.bindFn(this.onPinCreateSuccess,this),error:function(b){if(P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),"create"===a.options.action&&b.api_error_code===PIN_CREATE_API_RESPONSE_CODE_SPAM_CONTENT){var c={name:"ConfirmDialog",options:{fluid:!0,template:"blocked_source"}};P.loadModule(c,function(b){b.render(function(){a.parent.appendChild(b),a.destroy()})})}else P.showError(b.message)},complete:function(){a.hideLoading()}})},onBoardCreate:function(a){this.log.debug("Created a board",a.data,a.target.getBoardCount()),a.target.getBoardCount()>=1&&(this.lastCreatedBoard=a.data)},onPinCreateSuccess:function(a){P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS);var b=this,c=a.resource_response.data,d=c.board,e=d.url,f=this.options.action,g=d.name,h=d.privacy,i=d.is_collaborative,j={id:"pinSuccess",name:"PinCreateSuccess",options:{action:f,board:g,board_url:e,domain:c.domain,pin_id:c.id,is_collaborative:i,privacy:h,method:this.options.method},resource:P.Resource.NOOP_RESOURCE};"pin_create_ignition"===this.options.action?j.options.auto_close=!1:this.lastCreatedBoard&&this.lastCreatedBoard.id===d.id&&(j={id:"pinSuccess",name:"PinCreateSuccessBoardEdit",resource:{name:"BoardResource",options:{board_id:d.id,field_set_key:"basic"}},options:{pinCreateInfo:j}}),this.showLoading(),P.loadModule(j,function(a){b.modal?b.modal.setModule(a):"pin_create_ignition"===b.options.action?b.showInModal(a,{}):a.render(function(){b.parent.appendChild(a),b.destroy()})}),this.triggerEvent(P.CONST.EVENT_PIN_CREATE,c),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,c),P.pubsub.publish(c.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,c),P.pubsub.publish(P.currentUser.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,c),P.experiments.instance.inExperimentGroup("denzel_client_rendered_pin_create","enabled")&&P.resourceCache.instance.callGet(this.boardPicker.resource)}}),P.experiments.instance.inExperimentGroupActiveOrTriggerable("denzel_client_rendered_pin_create","enabled")&&(P.modules.PinCreate.prototype.moduleRenderer=new P.ModuleRendererLocal("app/desktop/modules/PinCreate/PinCreate.nunjucks")),goog.provide("P.modules.PinCreateSuccess"),goog.require("P.Module");var CLOSE_DELAY_DEFAULT=2e3,CLOSE_DELAY_WITH_RELATED_DATA=1e4,CLOSE_DELAY_AFTER_FOLLOW=1e3;P.modules.PinCreateSuccess=P.Module.extend({onContentReady:function(){var a=P.getQueryStringParams().guid;a&&P.logWidgetEvent({guid:a,pin_id:this.options.pin_id});var b=CLOSE_DELAY_DEFAULT,c=!1,d=this.getChildById("successBoard");if(d&&d.hasBoard()){b=CLOSE_DELAY_WITH_RELATED_DATA,c=!0;var e={};e[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onBoardFollow,this.pubsubSubscribe(d.getBoardId(),e)}c||this.$el.addClass("noBody"),P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)&&"bookmarklet"===this.options.method&&(b=CLOSE_DELAY_WITH_RELATED_DATA),this.options.auto_close!==!1&&this.closeOnDelay(b),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_PIN_CLOSEUP,P.Experiences.Experience.WEB_PIN_CLOSEUP_LITE)},closeOnDelay:function(a){this.closeTimer&&clearTimeout(this.closeTimer);var b=this;this.closeTimer=P.setTimeout(function(){b.closeTimer=null,b.destroy()},a)},onBoardFollow:function(){this.closeOnDelay(CLOSE_DELAY_AFTER_FOLLOW)},onDestroyed:function(){"pin_create_ignition"===this.options.action&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)}}),goog.provide("P.modules.PinCreateSuccessBoard"),goog.require("P.Module"),P.modules.PinCreateSuccessBoard=P.Module.extend({onContentReady:function(){this.hasBoard||this.hide()},hasBoard:function(){return!!this.getChildById("board")},getBoardId:function(){return this.extraData.boardId}}),goog.provide("P.modules.PinCreateSuccessExtensionNag"),goog.require("P.Module"),goog.require("P.Experiences"),P.modules.PinCreateSuccessExtensionNag=P.Module.extend({events:{"click .getNewPinItButton":"onGetNewPinItButtonClick"},onGetNewPinItButtonClick:function(){this._completeExperience()},onContentReady:function(){this._viewExperience()},_viewExperience:function(){P.trackGAEvent("web_pin_success_extension_upsell","viewed");var a=P.ExperienceManager.instance();a.viewPlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)},_completeExperience:function(){P.trackGAEvent("web_pin_success_extension_upsell","completed");var a=P.ExperienceManager.instance();a.completePlacedExperience(P.Experiences.Placement.WEB_PIN_SUCCESS,P.Experiences.Experience.WEB_PIN_SUCCESS_EXTENSION_UPSELL)}}),goog.provide("P.modules.PinCreateSuccessPins"),goog.require("P.Module"),P.modules.PinCreateSuccessPins=P.Module.extend({onContentReady:function(){this.isEmpty()&&this.hide()},isEmpty:function(){if(!this.contentReady)return!1;var a=this.getChildById("relatedPinsFeed");return!a||!a.hasItems()}}),goog.provide("P.modules.PinDeleteCommentButton"),goog.require("P.Module"),goog.require("P.modules.InlineHoverButton"),P.modules.PinDeleteCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showConfirmation:function(){var a=this,b={name:"ConfirmDialog",options:{template:"delete_comment"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.onDeleteConfirm)})},onDeleteConfirm:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_CLICK_SUBMIT);var a={pin_id:this.options.pin_id,comment_id:this.options.comment_id},b=P.resourceFactory.create("PinCommentResource",a),c=this;b.callDelete({success:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_SUCCESS),c.triggerEvent("commentDeleteSuccess",this,!0),P.pubsub.publish(c.options.pin_id,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED)},error:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_ERROR)}})},onClick:function(){P.trackGAEvent("comment_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()}}),goog.provide("P.modules.PinDupWarning"),goog.require("P.Module"),P.modules.PinDupWarning=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments);var a=this;this.model&&this.listenToOnce(this.model,"change:pinned_to_board",function(){a.renderExistingData()})},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/PinDupWarning/PinDupWarning.nunjucks")}),goog.provide("P.modules.PinEdit"),goog.require("P.Module"),goog.require("P.modules.PinEditBase"),P.modules.PinEdit=P.modules.PinEditBase.extend({onContentReady:function(){this.pinForm=this.getChildById("pinForm"),this.boardPicker=this.pinForm.getBoardPicker(),this.refreshOnSave=!1,this.listen(this.pinForm,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},onSubmitValidated:function(a){var b=a.data;b.errors[0]||(this.needConfirm()?this.showPrivacyChangeConfirmation():this.savePin())},needConfirm:function(){var a=this.boardPicker.getPrivacy();return"secret"===this.data.board.privacy&&"public"===a},removePlace:function(){var a=this.$(".placeWrapper");a.append('<input type="hidden" id="pinPlaceId" value="">'),a.fadeOut()},onButtonClick:function(a){var b=a.target;"removePlaceButton"===b.id&&this.removePlace()},showConfirmation:function(){var a=this,b={name:"ConfirmDialog",options:{template:"delete_pin",ga_category:P.CONST.GA_CATEGORY_PIN_DELETE}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.onDeleteConfirm)})},showPrivacyChangeConfirmation:function(){var a=this,b={name:"ConfirmDialog",options:{template:"change_pin_privacy"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,function(){P.trackGAEvent(P.CONST.GA_CATEGORY_PIN_EDIT,P.CONST.GA_ACTION_CLICK_CONFIRM),a.savePin()})})}}),goog.provide("P.modules.PinEmail"),goog.require("P.Module"),P.modules.PinEmail=P.Module.extend({onContentReady:function(){var a={pin:[P.Validator.Required()],email:[P.Validator.Required(),P.Validator.Email()],recipient_name:[P.Validator.Required()]};this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target;b&&("submitButton"===b.id?P.trackGAEvent("pin_email",P.CONST.GA_ACTION_CLICK_SUBMIT):"cancelButton"===b.id&&P.trackGAEvent("pin_email",P.CONST.GA_ACTION_CLICK_CANCEL))},onSubmitValidated:function(a){a.errors[0]||this.sendEmail()},sendEmail:function(){var a=this.$("form").serializeArray(),b={},c=this.getChildById("submitButton"),d=this;_.each(a,function(a){b[a.name]=a.value}),c.showLoading();var e={name:"ConfirmDialog",options:{template:"email_pin",recipient_name:b.recipient_name}},f=P.resourceFactory.create("EmailPinResource",b);f.callCreate({success:function(){P.trackGAEvent("pin_email",P.CONST.GA_ACTION_SUCCESS),P.loadModule(e,function(a){d.showInModal(a),d.listen(a,P.CONST.EVENT_CONFIRM,d.destroy)})},error:function(a){P.trackGAEvent("pin_email",P.CONST.GA_ACTION_ERROR),P.showError(a.message)},complete:function(){c.hideLoading()}})}}),goog.provide("P.modules.PinFlagCommentButton"),goog.require("P.Module"),goog.require("P.modules.InlineHoverButton"),P.modules.PinFlagCommentButton=P.modules.InlineHoverButton.extend({events:{click:"onClick"},showReasonModal:function(){var a=this,b={name:"FlagComment",options:{pin_id:this.options.pin_id,comment_id:this.options.comment_id}};P.loadModule(b,function(b){a.showInModal(b)})},onClick:function(){P.trackGAEvent("comment_flag",P.CONST.GA_ACTION_OPEN_MODAL),this.showReasonModal()}}),goog.provide("P.modules.PinShareButton"),goog.require("P.Module"),P.modules.PinShareButton=P.Module.extend({}),goog.provide("P.modules.PinUploader"),goog.require("P.Module");var PIN_UPLOADER_NEW_REPIN_FLOW=P.experiments.instance.inExperimentGroup("denzel_new_repin_flow2","enabled");P.modules.PinUploader=P.Module.extend({onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError)},onUploadSuccess:function(a){P.trackGAEvent("pin_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=a.data.image_url,this.ensurePinCreate()},onUploadError:function(a){P.trackGAEvent("pin_upload",P.CONST.GA_ACTION_ERROR),P.showError(a.data)},ensurePinCreate:function(){var a=this,b={image_url:this.imageUrl,action:"upload",method:"uploaded",transparent_modal:PIN_UPLOADER_NEW_REPIN_FLOW};this.options.default_board_id&&(b.default_board_id=this.options.default_board_id);var c=PIN_UPLOADER_NEW_REPIN_FLOW?"PinCreate2":"PinCreate",d={};PIN_UPLOADER_NEW_REPIN_FLOW&&(d.container_class="pinCreate2Modal");var e={name:c,options:b,id:"pinCreate"};this.showLoading(),P.loadModule(e,function(b){a.hideLoading(),a.showInModal(b,d),a.triggerEvent(P.CONST.EVENT_PIN_CREATE_OPENED,null,!0),a.destroy()})}}),goog.provide("P.modules.Pinnable"),goog.require("P.modules.PinnableBase");var CLASS_DISABLED="disabled",CLASS_SELECTED_ITEM="selected",ADD_TO_MAP_VIEWTYPE="add_to_map",PINNABLE_NEW_REPIN_FLOW=P.experiments.instance.inExperimentGroup("denzel_new_repin_flow2","enabled");P.modules.Pinnable=P.modules.PinnableBase.extend({events:{"click a.pinImageWrapper":"onClick",click:"onClick"},enable:function(){this.$el.removeClass(CLASS_DISABLED)},disable:function(){this.$el.addClass(CLASS_DISABLED)},select:function(){this._setSelected(!0)},_setSelected:function(a){this.$el.toggleClass(CLASS_SELECTED_ITEM,a)},deselect:function(){this._setSelected(!1)},onClick:function(){if(this.options.view_type!==ADD_TO_MAP_VIEWTYPE)return this.createPin(),!1;var a=this.$("img").attr("src");this.triggerEvent(P.CONST.EVENT_PLACE_IMAGE_SELECTED,a,!0),this.select()},createPin:function(){var a={image_url:this.options.url,action:"create",method:"scraped",link:this.options.link,transparent_modal:PINNABLE_NEW_REPIN_FLOW},b=PINNABLE_NEW_REPIN_FLOW?"PinCreate2":"PinCreate",c={};PINNABLE_NEW_REPIN_FLOW&&(c.container_class="pinCreate2Modal");var d={name:b,options:a,id:"pinCreate"},e=this;P.loadModule(d,function(a){e.showInModal(a,c)})}}),goog.provide("P.modules.PintreeEst"),goog.require("P.Module"),P.modules.PintreeEst=P.Module.extend({}),goog.provide("P.modules.PlaceBoardHeader"),goog.require("P.Module"),goog.require("P.modules.BoardHeader"),P.modules.PlaceBoardHeader=P.modules.BoardHeader.extend({}),goog.provide("P.modules.PlaceBoardInfoBar"),goog.require("P.Module"),goog.require("P.modules.BoardInfoBar"),P.modules.PlaceBoardInfoBar=P.modules.BoardInfoBar.extend({}),goog.provide("P.modules.PlaceSelector"),goog.require("P.Module"),P.modules.PlaceSelector=P.Module.extend({onContentReady:function(){this._placeChanged=!1,this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onHint)},onHint:function(a){this.hintData=a.data,this.options.show_hints&&this.determineHint()},determineHint:function(){if(this.hintData&&this.hintData.length){var a=this.getTypeaheadField();if(_.isEmpty(this.results))a.setPrependedStaticItems([{template:"hint_no_city",selectable:!1}]);else{var b=this.hintData[0].feature.name,c=b;-1!==b.indexOf(",")&&(c=b.split(",")[0]),a.setPrependedStaticItems([{template:"hint_specific_city",selectable:!1,locality:c,place:b}])}}},onNoResultsReturned:function(a){this.results=a.data;var b=this.getTypeaheadField();b.setPrependedStaticItems([]),this.hideTypeaheadLoading()},getTypeaheadField:function(){return this.getChildById("placeField")},onResultsReturned:function(a){this.results=a.data;var b=this.getTypeaheadField();b.setPrependedStaticItems([]),this.hideTypeaheadLoading()},onButtonClick:function(a){var b=a.target,c=b.id;if("removePlaceButton"===c){var d=this.getTypeaheadField();if(!d)return;d.reset(),this._placeChanged=!0,d.enableInput(),this.focusPlaceField(),b.hide()}},onSearchStart:function(){var a=this.getTypeaheadField();a.showLoading()},hideTypeaheadLoading:function(){var a=this.getTypeaheadField();a.hideLoading()},getSelectedPlace:function(){if(!this._placeChanged)return null;var a=this.getTypeaheadField();if(!a)return"0";var b=a.getTypeaheadSelectedItem();if(!b)return"0";var c=b.get("id");return c?c:"0"},focusPlaceField:function(){var a=this.getTypeaheadField();a.focus()},onItemSelected:function(a){if(this.options.in_repin){a.stopPropagation(),this._placeChanged=!0;var b=this.getTypeaheadField();b&&b.show()}},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/PlaceSelector/PlaceSelector.nunjucks")}),goog.provide("P.modules.Question"),goog.require("P.modules.QuestionBase"),P.modules.Question=P.modules.QuestionBase.extend({onContentReady:function(){var a=this.data.id,b={};b[P.CONST.PUBSUB_TOPIC_QUESTION_DELETED]=this._onQuestionDeleted,b[P.CONST.PUBSUB_TOPIC_QUESTION_REPORTED]=this._onQuestionReported,b[P.CONST.PUBSUB_TOPIC_QUESTION_LIKED]=this._onQuestionLiked,b[P.CONST.PUBSUB_TOPIC_QUESTION_UNLIKED]=this._onQuestionUnliked,b[P.CONST.PUBSUB_TOPIC_QUESTION_UPDATED]=this._onQuestionUpdated,this.pubsubSubscribe(a,b)},getQuestionUserName:function(){return this.data.created_by_user.full_name},_onQuestionDeleted:function(){this.destroy()},_onQuestionReported:function(){this.destroy()},_onQuestionUpdated:function(){this.render()}}),goog.provide("P.modules.QuestionCreate"),goog.require("P.Module"),P.modules.QuestionCreate=P.Module.extend({events:{"click .suggestions li":"_onSuggestionClick","focus .content":"_onContentFocus"},onContentReady:function(){this._titleFieldContentChangedListener&&this.removeListener(this._titleFieldContentChangedListener),this._titleFieldContentChangedListener=this.listen(this._getTitleField(),P.CONST.EVENT_CONTENT_CHANGED,this._onTitleFieldContentChanged),this.$form=this.$("form");var a={title:[P.Validator.Length({min:5,max:this.extraData.title_max_length})]},b={prevalidate:!0};this.form=new P.Form(this.$form,a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated)},_onDuplicateQuestionDialogConfirm:function(a){a.stopPropagation();var b={questionId:a.target.options.question_id};this.triggerEvent(P.CONST.EVENT_SEE_QUESTION,b,!0)},_onSubmitValidated:function(a){if(!a.errors[0]){var b=this._getTitleField().getValue();if(this._isTitleQuestion(b))return void this._validateExistingQuestionAndPost();var c={name:"ConfirmDialog",options:{template:"confirm_question_not_comment"}},d=this;P.loadModule(c,function(a){d.showInModal(a),d.listen(a,P.CONST.EVENT_DIALOG_BUTTON_CLICKED,function(a){var b=$(a.data);b.hasClass("dialogAskQuestion")?d._validateExistingQuestionAndPost():b.hasClass("dialogPostComment")&&d._postComment()})})}},_isTitleQuestion:function(a){return-1!==a.indexOf("?")},_validateExistingQuestionAndPost:function(){if(!this._hasValidCanonicalPinId())return void this._saveQuestion();var a=this._getSubmitButton();a.showLoading();var b={title:this._getTitleField().getValue(),canonical_pin_id:this._getCanonicalPinId()},c=P.resourceFactory.create("QuestionResource",b),d=this;c.callGet({error:P.NOOP}).then(function(a){var b=a.resource_response.data;if(b){var c={name:"ConfirmDialog",options:{question_id:b.id,template:"duplicate_question"}};P.loadModule(c,function(a){d.showInModal(a),d.listen(a,P.CONST.EVENT_CONFIRM,d._onDuplicateQuestionDialogConfirm)})}else d._saveQuestion()}).fin(function(){a.hideLoading()})},_onTitleFieldContentChanged:function(a){a.stopPropagation(),this._updateCharacterCount()},_getSubmitButton:function(){return this.getChildById("submitButton")},_getTitleField:function(){return this.getChildById("titleField")},_getCanonicalPinId:function(){return this.options.canonical_pin_id},_hasValidCanonicalPinId:function(){var a=this._getCanonicalPinId();return a&&"0"!==a},_saveQuestion:function(){var a=this._getSubmitButton();a.showLoading();var b={title:this._getTitleField().getValue(),context_pin_id:this.options.context_pin_id},c=P.resourceFactory.create("QuestionResource",b),d=this;c.callCreate().then(function(a){var c=a.resource_response.data;P.pubsub.publish(b.context_pin_id,P.CONST.PUBSUB_TOPIC_PIN_QUESTION_CREATED,c),d.$form[0].reset(),d.$el.removeClass("expanded"),d._updateCharacterCount()}).fin(function(){a.hideLoading()})},_postComment:function(){var a=this._getTitleField().getValue(),b=this.options.context_pin_id;P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_PIN_COMMENT_POPULATED,a),this.$form[0].reset(),this.form.validate(),this.getChildById("characterCounter").setCount(0)},_onContentFocus:function(){this.$el.addClass("expanded")},_onSuggestionClick:function(a){a.preventDefault();var b=$(a.target).text(),c=this._getTitleField();c.setValue(b),this._updateCharacterCount(),this.form.validate(),c.focus()},_updateCharacterCount:function(){var a=this._getTitleField(),b=a.getUntrimmedValue().length;this.getChildById("characterCounter").setCount(b)}}),goog.provide("P.modules.QuestionEdit"),goog.require("P.modules.EntityEdit"),P.modules.QuestionEdit=P.modules.EntityEdit.extend({getFormValidationRules:function(){return{title:[P.Validator.Length({min:5,max:140})]}},getFormValidationOptions:function(){return{prevalidate:!0}},getEditResource:function(){var a={question_id:this.data.id,title:this.getChildById("titleField").getValue()};return P.resourceFactory.create("QuestionResource",a)},onEditSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_QUESTION_UPDATED)},getDeleteConfirmTemplate:function(){return"delete_question"},getDeleteResource:function(){var a={question_id:this.data.id};return P.resourceFactory.create("QuestionResource",a)},onDeleteSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_QUESTION_DELETED)}}),goog.provide("P.modules.QuestionReport"),goog.require("P.modules.EntityReport"),P.modules.QuestionReport=P.modules.EntityReport.extend({getReportResourceName:function(){return"QuestionReportResource"},getCustomReportResourceOptions:function(){return{question_id:this.options.question_id,context_pin_id:this.options.context_pin_id}},onReportSuccess:function(){P.pubsub.publish(this.options.question_id,P.CONST.PUBSUB_TOPIC_QUESTION_REPORTED)}}),goog.provide("P.modules.Questions"),goog.require("P.modules.QuestionsBase");var QUESTION_TUTORIAL_WAIT=1e3;P.modules.Questions=P.modules.QuestionsBase.extend({initPubsub:function(){var a=this.options.context_pin_id,b={};b[P.CONST.PUBSUB_TOPIC_PIN_QUESTION_CREATED]=this._onPinQuestionCreated,this.pubsubSubscribe(a,b)},showNotificationTutorial:function(){this._showTutorial("qaNotificationIntro",QUESTION_TUTORIAL_WAIT);var a=P.ExperienceManager.instance().constructPlacedExperienceId(P.Experiences.Placement.WEB_PIN_CLOSEUP,P.Experiences.Experience.WEB_QA_CLOSEUP_NOTIFICATION_USER_ED);P.ExperienceManager.instance().viewPlacedExperienceId(a),P.ExperienceManager.instance().completePlacedExperienceId(a)},showQATutorial:function(){var a=this.getChildByModuleName("PagedList").getChildByModuleName("List").getChildByModuleName("Question"),b=null;if(a){var c=a.getChildByModuleName("Answers").getChildByModuleName("PagedList").getChildByModuleName("List").getChildrenByModuleName("Answer");b=_.find(c,function(a){return a._getLikeCount()>0})}if(b){this._getCreate().show(),this._showTutorial("qaAnswerIntro",QUESTION_TUTORIAL_WAIT);var d=P.ExperienceManager.instance().constructPlacedExperienceId(P.Experiences.Placement.WEB_PIN_CLOSEUP,P.Experiences.Experience.WEB_QA_CLOSEUP_USER_ED);P.ExperienceManager.instance().viewPlacedExperienceId(d),P.ExperienceManager.instance().completePlacedExperienceId(d)}},_showTutorial:function(a,b){var c=this;P.setTimeout(function(){c.scrollToQuestions(P.CONST.QA_TUTORIAL_SCROLL_OFFSET,function(){P.TutorialManager.instance().startTutorial(a)})},b||0)},_onSeeQuestion:function(a){a.stopPropagation();var b=a.data.questionId,c=this._getQuestionById(b),d={$el:c.getContent()};this.triggerEvent(P.CONST.EVENT_SCROLL_TO_ELEMENT,d,!0)},_onPinQuestionCreated:function(a,b,c){this._hasValidCanonicalPinId()||(this.options.canonical_pin_id=c.canonical_pin_id);var d=c,e=new P.modules.Question({options:{context_pin_id:this.options.context_pin_id},resource:{name:"QuestionResource",options:{question_id:d.id,field_set_key:"list_item"}}}),f=this.addItem(e),g=this,h={name:"Toast",options:{position_mode:"ANCHORED",position_point:"RIGHT_TOP",template:"create_question_success"}};P.loadModule(h,function(a){g.addChild(a);var b=a.render(),c=[f,b];Promise.all(c).then(function(){a.options.anchor=e.getContent(),a.positionModule()})})}}),goog.provide("P.modules.RecFeedHomePage"),goog.require("P.Module"),P.modules.RecFeedHomePage=P.Module.extend({onContentReady:function(){var a=this.getChildById("grid"),b="none";a&&!a.hasItems()&&(a.remove(),b="block"),this.$(".noResults").css("display",b)}}),goog.provide("P.modules.RecentContacts"),goog.require("P.Module"),P.modules.RecentContacts=P.Module.extend({}),goog.provide("P.modules.RelatedBoards"),goog.require("P.Module"),P.modules.RelatedBoards=P.Module.extend({events:{"click .relatedBoard":"_onBoardClicked"},_onBoardClicked:function(a){this._clickedBoardId=$(a.currentTarget).data("boardId")},getLoggingObjectIdStr:function(){return this._clickedBoardId}}),goog.provide("P.modules.RelatedInterests"),goog.require("P.Module"),P.modules.RelatedInterests=P.Module.extend({}),goog.provide("P.modules.RelatedRecipe"),goog.require("P.Module"),P.modules.RelatedRecipe=P.Module.extend({}),goog.provide("P.modules.RemoveUserFromBoardDialog"),goog.require("P.Module"),goog.require("P.modules.ConfirmDialog"),P.modules.RemoveUserFromBoardDialog=P.modules.ConfirmDialog.extend({events:{"click [name=ban]":"onBanClick"},onContentReady:function(){this.returnData=["ban"],P.modules.ConfirmDialog.prototype.onContentReady.call(this)},onBanClick:function(a){var b=$(a.target),c=P._(b.is(":checked")?"Block Pinner":"Remove Pinner");this.setPrimaryButtonText(c)}}),goog.provide("P.modules.Replies"),goog.require("P.modules.RepliesBase"),P.modules.Replies=P.modules.RepliesBase.extend({_onReplyCreated:function(a){var b=new P.modules.Reply({resource:{name:"ReplyResource",options:{reply_id:a.id,field_set_key:"list_item"}}});this.addItem(b)}}),goog.provide("P.modules.Reply"),goog.require("P.modules.ReplyBase"),P.modules.Reply=P.modules.ReplyBase.extend({onContentReady:function(){var a=this.data.id,b={};
b[P.CONST.PUBSUB_TOPIC_REPLY_DELETED]=this._onReplyDeleted,b[P.CONST.PUBSUB_TOPIC_REPLY_REPORTED]=this._onReplyReported,b[P.CONST.PUBSUB_TOPIC_REPLY_UPDATED]=this._onReplyUpdated,this.pubsubSubscribe(a,b)},_onReplyDeleted:function(){this.destroy()},_onReplyReported:function(){this.destroy()},_onReplyUpdated:function(){this.render()}}),goog.provide("P.modules.ReplyCreate"),goog.require("P.Module"),P.modules.ReplyCreate=P.Module.extend({events:{"focus .content":"_onContentFocus"},onContentReady:function(){this.$form=this.$("form");var a={content:[P.Validator.Required()]},b={prevalidate:!0};this.form=new P.Form(this.$form,a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this._saveReply()},_getSubmitButton:function(){return this.getChildById("submitButton")},_saveReply:function(){var a=this,b=this.getChildById("contentField").getValue(),c=this.options.context_pin_id,d=this.options.question_id,e=this.options.answer_id,f={content:b,context_pin_id:c,question_id:d};e&&(f.answer_id=e);var g=P.resourceFactory.create("ReplyResource",f),h=this._getSubmitButton();h.showLoading(),g.callCreate({success:function(b){var c=b.resource_response.data;e?P.pubsub.publish(e,P.CONST.PUBSUB_TOPIC_ANSWER_REPLY_CREATED,c):P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_QUESTION_REPLY_CREATED,c),a.$form[0].reset(),a.$el.removeClass("expanded")},complete:function(){h.hideLoading()}})},_onContentFocus:function(){this.$el.addClass("expanded")}}),goog.provide("P.modules.ReplyEdit"),goog.require("P.modules.EntityEdit"),P.modules.ReplyEdit=P.modules.EntityEdit.extend({getFormValidationRules:function(){return{content:[P.Validator.Required()]}},getFormValidationOptions:function(){return{prevalidate:!0}},getEditResource:function(){var a={reply_id:this.data.id,content:this.getChildById("contentField").getValue()};return P.resourceFactory.create("ReplyResource",a)},onEditSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_REPLY_UPDATED)},getDeleteConfirmTemplate:function(){return"delete_reply"},getDeleteResource:function(){var a={reply_id:this.data.id};return P.resourceFactory.create("ReplyResource",a)},onDeleteSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_REPLY_DELETED)}}),goog.provide("P.modules.ReplyReport"),goog.require("P.modules.EntityReport"),P.modules.ReplyReport=P.modules.EntityReport.extend({getReportResourceName:function(){return"ReplyReportResource"},getCustomReportResourceOptions:function(){return{reply_id:this.options.reply_id,context_pin_id:this.options.context_pin_id}},onReportSuccess:function(){P.pubsub.publish(this.options.reply_id,P.CONST.PUBSUB_TOPIC_REPLY_REPORTED)}}),goog.provide("P.modules.ReportBug"),goog.require("P.Module");var INPUT_METADATA_SELECTOR='[name="metadata"]';P.modules.ReportBug=P.Module.extend({getMetadata:function(){return this.$(INPUT_METADATA_SELECTOR).val()},onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError),this.imageUrl=null;var b={title:[P.Validator.Required()],description:[P.Validator.Required()]};this.setMetadata(),this.form=new P.Form(this.$("form"),b),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(){this.reportBug()},setMetadata:function(){var a=window.navigator.userAgent,b=P.getCurrentUrl(),c=P.experiments.instance.getDebugInfo();this.$(INPUT_METADATA_SELECTOR).val("\n\n\n\n----------------------------------\nuserAgent: "+a+"\ncurrentURL: "+b+"\nexperiments: "+c+"\nusername: "+P.currentUser.get("username")+"\n\n")},reportBug:function(){var a=this,b=this.$("form").serializeArray(),c=this.getChildById("submitButton"),d={};_.each(b,function(a){d[a.name]=a.value}),d.description=d.description+this.getMetadata(),this.imageUrl&&(d.image_url=this.imageUrl),c.showLoading();var e=P.resourceFactory.create("ReportErrorResource",d);e.callCreate({success:function(b){var c=b.resource_response.data,d={name:"ConfirmDialog",options:{template:"report_bug",task_url:c,class_name:"reportBug"}};P.loadModule(d,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.destroy)})},error:function(a){P.showError(a.message)},complete:function(){c.hideLoading()}})},onUploadSuccess:function(a){this.imageUrl=a.data.image_url},onUploadError:function(){P.showError(P.string.common.defaultErrorMessage)}}),goog.provide("P.modules.RichPinDebugger"),goog.require("P.Module");var HIDDEN="hidden",SELECTED="selected";P.modules.RichPinDebugger=P.Module.extend({events:{"click .menu .main":"onShowMain","click .menu .scraped":"onShowScraped","click .menu .parsed":"onShowParsed"},onContentReady:function(){this.$form=this.$("form"),this.$main=this.$(".section.main"),this.$menus=this.$(".menu a"),this.$scraped=this.$(".section.scraped"),this.$sections=this.$(".section"),this.$parsed=this.$(".section.parsed"),this.form=new P.Form(this.$form,[]),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.retrieve)},retrieve:function(){var a=this,b=this.$form.serializeArray(),c=b[0].value,d={link:c},e=this.getChildById("submitButton"),f=P.resourceFactory.create("RichPinReindexResource",d),g=function(b){var d=encodeURIComponent(c);if(b&&!b.resource_response.error&&b.resource_response.data){var e=b.resource_response.data;d=encodeURIComponent(e.url)}a.navigate("?link="+d)};e.showLoading(),f.callCreate({success:g,complete:function(){e.hideLoading()}})},onShowMain:function(a){return this.hideAllMenus(),this.$main.removeClass(HIDDEN),$(a.target).addClass(SELECTED),!1},onShowParsed:function(a){return this.hideAllMenus(),this.$parsed.removeClass(HIDDEN),$(a.target).addClass(SELECTED),!1},onShowScraped:function(a){return this.hideAllMenus(),this.$scraped.removeClass(HIDDEN),$(a.target).addClass(SELECTED),!1},hideAllMenus:function(){this.$sections.addClass(HIDDEN),this.$menus.removeClass(SELECTED)}}),goog.provide("P.modules.RichPinDebuggerItem"),goog.require("P.Module"),P.modules.RichPinDebuggerItem=P.Module.extend({}),goog.provide("P.modules.RichPinHeading"),goog.require("P.Module"),P.modules.RichPinHeading=P.Module.extend({}),goog.provide("P.modules.RichTextField"),goog.require("P.Module");var FOCUS_CLASS="focused",LOAD_PREVIEW_WAIT=2e3,PREVIEW_MAX_RETRY=5,EMBEDED_IMG_SIZE="136x136";P.modules.RichTextField=P.Module.extend({_hasEmbeddedContent:!1,_firstUrl:null,_queryEmbeddedContentRetry:0,onAddedToDom:function(){this.childListen(P.CONST.EVENT_PASTE,this.onInputPaste),this.childListen(P.CONST.EVENT_FOCUS,this.onInputFocus),this.childListen(P.CONST.EVENT_BLUR,this.onInputBlur),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.removeEmbeddedContent)},onContentReady:function(){this.options.attached_url&&(this._firstUrl=this.options.attached_url,this._hasEmbeddedContent=!0,this.$(".textFieldAttachment").show())},onInputPaste:function(){P.setTimeout(_.bindFn(this.checkForUrlInput,this),10)},checkForUrlInput:function(){if(!this._hasEmbeddedContent&&!this._firstUrl){var a=this.getContent(),b=this._extractUrls(a);b&&(this._firstUrl=b[0],this.scheduleUrlScraping(this._firstUrl))}},_extractUrls:function(a){var b=/(https?:\/\/[^\s]+)/g,c=/(www\.\w[^@\s]+\.\w[^\s]+)/g;return a.match(b)||a.match(c)},scheduleUrlScraping:function(a){var b=this.getUrlSummaryResource(a),c=this;b.callCreate({error:c.reset}).then(function(a){var b=a.resource_response.data.url;b&&(c._firstUrl=b,c.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_START,null,!0),c.loadEmbedDataForLink(b))})},waitToLoadEmbedData:function(a){P.setTimeout(_.bindFn(this.loadEmbedDataForLink,this,a),LOAD_PREVIEW_WAIT)},loadEmbedDataForLink:function(a){if(this._queryEmbeddedContentRetry<PREVIEW_MAX_RETRY){var b=this.getUrlSummaryResource(a),c=this;b.callGet({error:function(){c.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_ERROR,null,!0),c.reset()}}).then(function(b){var d=b.resource_response.data;d.title&&d.site_name?(c.renderEmbedContent(d),c.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,null,!0)):c.waitToLoadEmbedData(a)}),this._queryEmbeddedContentRetry+=1}else this.triggerEvent(P.CONST.EVENT_ITEMS_REQUEST_ERROR,null,!0),this.reset()},renderEmbedContent:function(a){a.imgsrc=a.images[EMBEDED_IMG_SIZE].url;var b={name:"UrlPreview",id:"attachmentContent",data:a},c=this;P.loadModule(b,function(a){var b=c.$(".textFieldAttachment");c.insertChild(a,b),a.renderExistingData(),b.show(),c._hasEmbeddedContent=!0})},getUrlSummaryResource:function(a){return P.resourceFactory.create("UrlSummaryResource",{url:a,field_set_key:"preview"})},onInputFocus:function(){this._getContainer().addClass(FOCUS_CLASS)},onInputBlur:function(){this._getContainer().removeClass(FOCUS_CLASS)},getContent:function(){return this.getChildById("contentField").getValue()},_getContainer:function(){return this.$container||(this.$container=this.$(".fieldContainer")),this.$container},_getAttachment:function(){return this.attachment||(this.attachment=this.getChildById("attachmentContent")),this.attachment},removeEmbeddedContent:function(a){"cancelButton"===a.target.id&&this.reset()},reset:function(){this._getAttachment()&&this.removeChild(this.attachment),this.attachment=null,this._hasEmbeddedContent=!1,this._firstUrl=null,this._queryEmbeddedContentRetry=0,this.$(".textFieldAttachment").hide()},getAttachmentUrl:function(){return this._firstUrl}}),goog.provide("P.modules.RightHeader"),goog.require("P.Module"),P.modules.RightHeader=P.Module.extend({}),goog.provide("P.modules.ScrollToTop"),goog.require("P.Module");var VISIBLE_CLASS="visible",PADDING_PX=500;P.modules.ScrollToTop=P.Module.extend({events:{click:"onScrollToTopClick"},onCreated:function(){this.visible=!1,this.$scroller=null},setScroller:function(a){this.scrollListener&&(this.removeListener(this.scrollListener),this.scrollListener=null),this.$scroller=a,this.$scroller.length>0&&(this.updateButtonVisibility(),this.scrollListener=this.listen(this.$scroller,"scroll",this.updateButtonVisibility))},updateButtonVisibility:function(){var a=this.$scroller.scrollTop();a>PADDING_PX?this.showButton():this.hideButton()},onScrollToTopClick:function(){this.triggerEvent(P.CONST.EVENT_SCROLL_TO_TOP,{},!0),P.trackGAEvent("scroll_to_top",P.CONST.GA_ACTION_CLICK)},animateButtonIn:function(){var a=this;P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_VISIBLE,null),P.deferDomManipulation(function(){a.$el.addClass(VISIBLE_CLASS)})},animateButtonOut:function(){var a=this;P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_HIDDEN,null),P.deferDomManipulation(function(){a.$el.removeClass(VISIBLE_CLASS)})},showButton:function(){this.visible||(this.visible=!0,this.animateButtonIn())},hideButton:function(){this.visible&&(this.visible=!1,this.animateButtonOut())}}),goog.provide("P.modules.SearchGuidesBar"),goog.require("P.Module");var GUIDE_WIDTH=125,NUM_GUIDES_SLIDE_WINDOW=3,NUM_GUIDES_PER_COLUMN=2;P.modules.SearchGuidesBar=P.Module.extend({events:{"click .guidesSlider li":"onGuideClick","click .navigator.left em":"onLeftNavigatorClick","click .navigator.right em":"onRightNavigatorClick"},onCreated:function(){this.$slider=this.$(".guidesSlider"),this.currentGuideIndex=0,this.totalGuides=this.options.num_guides;var a=this.totalGuides*GUIDE_WIDTH;this.$slider.css("width",a+"px"),this.$leftNav=this.$(".navigator.left"),this.$rightNav=this.$(".navigator.right"),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,_.bindFn(this.onBodyColumnChange,this))},onBodyColumnChange:function(){this.updateNavigators()},onContentReady:function(){this.isReady()&&this.updateNavigators()},onAddedToDom:function(){this.isReady()&&this.updateNavigators()},isReady:function(){return this.inDom&&this.contentReady},onGuideClick:function(a){var b=$(a.currentTarget),c=b.children().first(),d=c.attr("data-term"),e=c.attr("data-term-position"),f=c.attr("data-dominant-color"),g=c.attr("data-guide-index");P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED,{term:d,position:e,color:f,index:g})},onLeftNavigatorClick:function(){if(this.currentGuideIndex>0){var a=this.currentGuideIndex-NUM_GUIDES_SLIDE_WINDOW<0?0:this.currentGuideIndex-NUM_GUIDES_SLIDE_WINDOW;this.slideTo(a)}},onRightNavigatorClick:function(){var a=P.Viewport.numColumns*NUM_GUIDES_PER_COLUMN;if(this.totalGuides-this.currentGuideIndex>a){var b=this.currentGuideIndex+NUM_GUIDES_SLIDE_WINDOW;this.slideTo(b)}},updateNavigators:function(){0===this.currentGuideIndex?this.hideLeftNavigator():this.showLeftNavigator();var a=P.Viewport.numColumns*NUM_GUIDES_PER_COLUMN;this.totalGuides-this.currentGuideIndex>a?this.showRightNavigator():this.hideRightNavigator()},slideFinish:function(a){this.currentGuideIndex=a,this.updateNavigators()},slideTo:function(a){var b=this,c=this.currentGuideIndex-a,d=this.$(".guidesSlider"),e=-1*b.currentGuideIndex*GUIDE_WIDTH+c*GUIDE_WIDTH+"px";d.css("left",e),this.slideFinish(a)},hideLeftNavigator:function(){this.$leftNav.hide()},showLeftNavigator:function(){this.$leftNav.show()},hideRightNavigator:function(){this.$rightNav.hide()},showRightNavigator:function(){this.$rightNav.show()}}),goog.provide("P.modules.SearchInfoBar"),goog.require("P.Module"),goog.require("P.modules.InfoBarBase"),P.modules.SearchInfoBar=P.modules.InfoBarBase.extend({}),goog.provide("P.modules.SearchInputToken"),goog.require("P.modules.Token");var RgbColor;P.modules.SearchInputToken=P.modules.Token.extend({events:{"click .remove":"onRemoveClick"},onContentReady:function(){var a;a=this.options.color?this.clampColorBrightness(this.options.color):this.getRandomColor(),this.$(".tokenContainer").css("background-color",a)},onRemoveClick:function(a){this._logContextEvent(a),this.triggerEvent(P.CONST.EVENT_REMOVE_TOKEN,this,!0),a.stopPropagation()},getTokenData:function(){var a=this.options.term,b=this.options.position;return{text:a,priority:b}},clampColorBrightness:function(a){return this._isBright(a)?this._darken(a,.2):a},_isBright:function(a){var b=this.hexToRgb(a);if(b){var c=Math.sqrt(b.r*b.r*.241+b.g*b.g*.691+b.b*b.b*.068);return c>200}return!1},_darken:function(a,b){var c=this.hexToRgb(a),d=Math.round(c.r*(1-b)),e=Math.round(c.g*(1-b)),f=Math.round(c.b*(1-b));return d=Math.min(Math.max(0,d),255),e=Math.min(Math.max(0,e),255),f=Math.min(Math.max(0,f),255),"#"+d.toString(16)+e.toString(16)+f.toString(16)},hexToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/,c=a.match(b);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},getRandomColor:function(){var a=_.random(1,360),b=_.random(20,90),c=_.random(20,75);return"hsl("+a+","+b+"%,"+c+"%)"},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/SearchInputToken/SearchInputToken.nunjucks")}),goog.provide("P.modules.SearchPage"),goog.require("P.Module"),P.modules.SearchPage=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},_updateSearchOptions:function(){this.searchOptions=_.pick(this.options,"query","scope","boost")},onChildNavigate:function(a){var b=a.data.url;if(!P.isOffsiteUrl(b)){var c=P.router.get().resolve(b);if(c&&"SearchPage"===c.module){var d=P.router.get().resolve(a.data.url).options;return this.setOptions(d),this.publishSearchChange(),void(a.data.handled=!0)}}},onContentReady:function(){this.publishSearchChange()},publishSearchChange:function(){this._updateSearchOptions();var a=this.searchOptions||{};P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,a.query||""),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED,a.scope||""),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED,a.boost||"")}}),goog.provide("P.modules.SearchScopeSelector"),goog.require("P.Module"),P.modules.SearchScopeSelector=P.Module.extend({events:{'change input[name="scope"]':"onScopeChange"},queryStringWithoutFacets:function(){var a=window.location.search;return a=a.replace(/&fc=[^&]*/,""),a=a.replace(/\?fc=[^&]*&?/,"?")},navigateToScope:function(a){var b=this.queryStringWithoutFacets();P.currentUser.isAuthenticated()||"my_pins"!==a||this.navigate("/join/"),this.navigate("/search/"+a+"/"+b)},navigateToFacet:function(a,b){var c=this.queryStringWithoutFacets();b&&(c+=(""===c?"?":"&")+"fc="+b),this.navigate("/search/"+a+"/"+c)},onScopeChange:function(a){var b=$(a.currentTarget),c=b.val();if(c!==this.options.scope){var d=b.attr("data-url")||c;this.navigateToScope(d)}}}),goog.provide("P.modules.SentPin"),goog.require("P.Module"),P.modules.SentPin=P.Module.extend({onContentReady:function(){P.Module.prototype.onContentReady.apply(this,arguments),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this._onScroll),this.hasShownModal=!1,this.childListen(P.CONST.EVENT_PIN_MASK_CLICKED,this._onPinClicked),P.trackRegisterAction("send_pin_landing"),this.scrollThreshold=this.$(".gridContainer").offset().top+200,this.$(".morePins").fixedsticky(),this.getChildById("relatedPins").hasItems()||this.$(".morePins").hide()},_onScroll:function(){var a=this.getScrollableElement().scrollTop();a>this.scrollThreshold&&!this.hasShownModal&&this._showRegisterModal(this.data.id)},_onPinClicked:function(a){var b=a.data.module;this._showRegisterModal(b.getPinId())},_showRegisterModal:function(a){this.hasShownModal=!0;var b={name:"SentPinRegistration",resource:{name:"PinResource",options:{id:a}}};P.loadModule(b,function(a){P.getModalManager().showInModal(a,{can_scroll:!0})}),P.trackRegisterAction("send_pin_landing_show_modal")}}),goog.provide("P.modules.SentPinRegistration"),goog.require("P.Module"),P.modules.SentPinRegistration=P.Module.extend({}),goog.provide("P.modules.SentPinSender"),goog.require("P.Module"),P.modules.SentPinSender=P.Module.extend({}),goog.provide("P.modules.SmartFeedPage"),goog.require("P.Module"),P.modules.SmartFeedPage=P.Module.extend({}),goog.provide("P.modules.SocialNetworkSettingsBase"),goog.require("P.Module");var FIND_FRIENDS_TRY_AGAIN_POLL_INTERVAL=1e3,FIND_FRIENDS_TRY_AGAIN_API_ERROR_CODE=110;P.modules.SocialNetworkSettingsBase=P.Module.extend({handleConnect:function(a,b,c){var d=this;if(b){var e={success:function(e){var f={network:a,data:e};d._internalConnectNetwork(b,f,c)},error:function(){P.showError(P.string.common.connectError),c.error&&c.error(),c.complete&&c.complete()}};this._externalConnectNetwork(a,b,e)}else{var f={network:a};this._internalConnectNetwork(b,f,c)}},_getResourceNameForNetworkFriends:function(a){var b=null;switch(a){case P.SocialConnect.FACEBOOK:b="UserFacebookFriendsResource";break;case P.SocialConnect.TWITTER:b="UserTwitterFriendsResource";break;case P.SocialConnect.GOOGLE:b="UserGmailFriendsResource";break;case P.SocialConnect.YAHOO:b="UserYahooFriendsResource";break;default:return}return b},pollForFriends:function(a,b){b=b||{};var c=b.resourceOptions||{},d=this._getResourceNameForNetworkFriends(a);if(d){var e=P.resourceFactory.create(d,c),f=this;e.callGet({success:function(){var a=b.success;a&&a(e)},error:function(c){if(c.api_error_code===FIND_FRIENDS_TRY_AGAIN_API_ERROR_CODE)P.setTimeout(function(){f.pollForFriends(a,b)},FIND_FRIENDS_TRY_AGAIN_POLL_INTERVAL);else{var d=b.error;d&&d()}}})}},_externalConnectNetwork:function(a,b,c){if(!b)return void(c.success&&c.success());var d=P.SocialConnect.instance();d.connect(a,c)},_internalConnectNetwork:function(a,b,c){var d=a?"create":"delete",e=P.resourceFactory.create("UserSocialNetworkResource",b),f=c.error;_.extend(c,{error:function(a){P.showError(a.message),f()}}),e.call(d,c)}}),goog.provide("P.modules.TextContainer"),goog.require("P.Module"),P.modules.TextContainer=P.Module.extend({}),goog.provide("P.modules.Toast"),goog.require("P.modules.PositionModule"),P.modules.Toast=P.modules.PositionModule.extend({render:function(a,b){return $(document.body).append(this.$el),this.triggerEvent(P.CONST.EVENT_TOAST_RENDER,null,!0),P.Module.prototype.render.call(this,a,b)},onContentReady:function(){this.fadeIn();var a=this;P.setTimeout(function(){a.fadeOut(function(){a.destroy()})},4e3)}}),goog.provide("P.modules.TrademarkForm"),goog.require("P.Module");var SELECTOR_AGENT_FIELDS=".agentFields",SELECTOR_TRANSFER_FIELD=".transferField";P.modules.TrademarkForm=P.Module.extend({onCreated:function(){this.onComplainantTypeChange=_.bindFn(this.onComplainantTypeChange,this),this.onTrademarkClaimSuccess=_.bindFn(this.onTrademarkClaimSuccess,this),this.onAddURLButtonClick=_.bindFn(this.onAddURLButtonClick,this)},onContentReady:function(){if(_.contains(["username","content","goods"],this.options.claim_type)){this.$("[name=complainant_type]").on("change",this.onComplainantTypeChange),this.$("[name=course_of_action]").on("change",this.onClaimTypeChange);var a=this.getChildById("addURL");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onAddURLButtonClick),this.complainantType=null,this.claimType=null;var b=new Date;this.$("#trademarkSignatureDate").val(b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()),this.setupForm()}},setupForm:function(){var a=this.$("form"),b={};this.form=new P.Form(a,b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onComplainantTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.complainantType=c,"agent"===c?this.showAgentFields():this.hideAgentFields()}},onClaimTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.claimType=c,"transfer"===c?$(SELECTOR_TRANSFER_FIELD).show():$(SELECTOR_TRANSFER_FIELD).hide()}},onSubmitValidated:function(a){if(!a.errors[0]){var b=this.createResourceOptions(),c=this.getChildById("submitBtn");c.showLoading();var d=P.resourceFactory.create("TrademarkClaimResource",b);d.callCreate({success:this.onTrademarkClaimSuccess,complete:function(){c.hideLoading()}})}},onTrademarkClaimSuccess:function(a){var b=a.resource_response.data,c={name:"ConfirmDialog",options:{claim_id:b,template:"trademark_claim_success"}},d=this;P.loadModule(c,function(a){d.showInModal(a),d.listen(a,P.CONST.EVENT_DESTROYED,function(){this.navigate("/")})})},onAddURLButtonClick:function(){var a=this.$(".infringingURLs"),b=a.children().first().clone();b.find("input").removeAttr("id"),a.append(b)},showAgentFields:function(){this.$(SELECTOR_AGENT_FIELDS).show()},hideAgentFields:function(){this.$(SELECTOR_AGENT_FIELDS).hide()},createResourceOptions:function(){var a=_.omit(this.form.getData(),"complainant_type");a.claim_type=this.options.claim_type,a.is_owner="owner"===this.complainantType;var b=["infringing_content_urls","infringing_goods_urls"];return _.each(b,function(b){var c=a[b];_.isArray(c)&&(c=_.map(c,function(a){return $.trim(a)}),c=_.reject(c,function(a){return""===a}),a[b]=c.join(","))}),a}}),goog.provide("P.modules.TrademarkFormSelector"),goog.require("P.Module"),P.modules.TrademarkFormSelector=P.Module.extend({onContentReady:function(){this.$("[name=claim_type]").on("change",_.bindFn(this.onClaimTypeChange,this))},onClaimTypeChange:function(a){var b=$(a.target);if(b.is(":checked")){var c=b.val();this.navigate("/about/trademark/form/"+c+"/")}}}),goog.provide("P.modules.TweetButton"),goog.require("P.Module"),goog.require("P.modules.Button"),P.modules.TweetButton=P.modules.Button.extend({onClick:function(){var a=this.options.ga_category||"share_twitter";P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.openWebIntent(),this.triggerEvent(P.CONST.EVENT_BUTTON_CLICK,null,!0)},openWebIntent:function(){var a=this.getWindowUrl(),b=550,c=420;return P.getWindowManager().open(a,null,b,c)},getWindowUrl:function(){var a="https://twitter.com/intent/tweet?via=pinterest",b={};return this.options.tweet_path&&(b.url=encodeURIComponent(P.absolutify(this.options.tweet_path))),this.options.tweet_text&&(b.text=encodeURIComponent(this.options.tweet_text)),_.reduce(b,function(a,b,c){return a+"&"+c+"="+b},a)}}),goog.provide("P.modules.UnauthBanner"),goog.require("P.Module"),P.modules.UnauthBanner=P.Module.extend({onContentReady:function(){P.trackRegisterAction("unauth_banner")}}),goog.provide("P.modules.UnauthDiscoveryHomePage"),goog.require("P.Module"),P.modules.UnauthDiscoveryHomePage=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HEADER_ALT_STATE,!0),this.searchForm&&this.searchForm.focus()},onContentReady:function(){P.isPlaceholderSupported&&(this.searchForm=this.getChildById("searchForm"),this.searchForm.focus()),P.trackRegisterAction("unauth_home")},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HEADER_ALT_STATE,!1),P.Viewport.updateBodyColumns()}}),goog.provide("P.modules.UnauthFeedHomePage"),goog.require("P.Module"),P.modules.UnauthFeedHomePage=P.Module.extend({onContentReady:function(){this.options.blended_feed&&this.loadUnauthHomePageModal(),P.trackRegisterAction("unauth_home")},loadUnauthHomePageModal:function(){var a=this,b={name:"UnauthHomePage"};P.loadModule(b,function(b){var c={fixed:!0,position_point:"TOP_CENTER",can_dismiss:!1,mask_type:"dark"};a.showInModal(b,c)})}}),goog.provide("P.modules.UnauthHomePage"),goog.require("P.Module"),goog.require("P.modules.UnauthHomePageBase"),P.modules.UnauthHomePage=P.modules.UnauthHomePageBase.extend({}),goog.provide("P.modules.UnauthSignupHomePage"),goog.require("P.Module"),goog.require("P.modules.UnauthHomePage"),P.modules.UnauthSignupHomePage=P.modules.UnauthHomePage.extend({}),goog.provide("P.modules.UnblockButton"),goog.require("P.Module"),P.modules.UnblockButton=P.Module.extend({events:{click:"onClick"},onUserUnblockSuccess:function(){var a=this,b={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:a.options.full_name,action:"unblocked"}};_.extend(b.options,a.options.dialog_options),P.loadModule(b,function(b){a.showInModal(b,{can_dismiss:!1}),a.listen(b,P.CONST.EVENT_CONFIRM,a.onUnblockConfirm)})},onUnblockConfirm:function(){this.destroy()},onClick:function(){P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_CLICK);var a=this,b=this.options.user_id;this.showLoading();var c={blocked_user_id:this.options.user_id},d=P.resourceFactory.create("UserBlockResource",c);d.callDelete({success:function(){P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(b,P.CONST.PUBSUB_TOPIC_USER_UNBLOCKED),a.onUserUnblockSuccess()},error:function(a){P.showError(a.message),P.trackGAEvent("user_unblock",P.CONST.GA_ACTION_ERROR)},complete:function(){a.hideLoading()}})}}),goog.provide("P.modules.UrlPreview"),goog.require("P.Module"),P.modules.UrlPreview=P.Module.extend({moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/UrlPreview/UrlPreview.nunjucks")}),goog.provide("P.modules.User"),goog.require("P.Module");var VIEW_TYPE_FOLLOW_FRIENDS_ITEM="followFriendsItem";P.modules.User=P.Module.extend({events:{"click .dismiss":"onDismissClick",click:"onClick"},getLoadingSpinnerOptions:function(){var a=P.Module.prototype.getLoadingSpinnerOptions.call(this);return this.options.view_type===VIEW_TYPE_FOLLOW_FRIENDS_ITEM?_.extend(a,{size:P.Spinner.Size.SMALL}):a},getProfileImage:function(){var a;switch(this.options&&this.options.view_type){case"userSelect":a=this.$(".profileImage");break;default:return}return a.attr("src")},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onUserFollow;var b=this.getUserId();this.pubsubSubscribe(b,a)},onUserFollow:function(){this.options.view_type===VIEW_TYPE_FOLLOW_FRIENDS_ITEM&&this.$el.addClass("contactConfirmed"),this.triggerEvent(P.CONST.EVENT_USER_FOLLOW,null,!0)},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.data&&this.data.id},onClick:function(){if("userSelect"===this.options.view_type&&this.triggerEvent(P.CONST.EVENT_USER_CLICK,null,!0),"userCheckableSelectView"===this.options.view_type){this.$(".selectCheck").toggleClass("checked");var a={user_id:this.getUserId(),is_following:this.$(".selectCheck").hasClass("checked")};this.triggerEvent(P.CONST.EVENT_USER_CLICK,a,!0)}}}),goog.provide("P.modules.UserAppSettings"),goog.require("P.Module");var CLASS_RESTORE_BUTTON="restoreButton";P.modules.UserAppSettings=P.Module.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.deleteTimers={}},onButtonClick:function(a){var b=a.target.id;if(-1!==b.indexOf("revokeButton")){var c=this.getChildById(b),d=$(c.el);if(this.deleteTimers[b])return clearTimeout(this.deleteTimers[b]),this.deleteTimers[b]=void 0,c.setText(P._("Revoke Access")),void d.removeClass(CLASS_RESTORE_BUTTON);var e=b.replace("revokeButton",""),f=P.resourceFactory.create("OAuthUserAuthorizationsResource",{consumer_id:e});c.setText(P._("Restore Access")),d.addClass(CLASS_RESTORE_BUTTON);var g=this,h=setTimeout(function(){c.showLoading(),f.callDelete().then(function(){g.render()}).fin(function(){c.hideLoading()})},1e4);g.deleteTimers[b]=h}}}),goog.provide("P.modules.UserBadge"),goog.require("P.Module"),P.modules.UserBadge=P.Module.extend({}),goog.provide("P.modules.UserBlock"),goog.require("P.Module"),P.modules.UserBlock=P.Module.extend({events:{"click .cancelButton":"onCancelButtonClick"},onContentReady:function(){this.form=new P.Form(this.$("form"),[]),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){var b=a.target;if(b){var c=this.options.blocked_by_me?"user_unblock":"user_block";"cancelButton"===b.id?P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_CANCEL):"submitButton"===b.id&&P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_SUBMIT)}},onSubmitValidated:function(a){a.errors[0]||this.blockUser()},onUserBlockSuccess:function(){var a=this,b={name:"ConfirmDialog",options:{template:"block_unblock_user_success",name:a.options.full_name,action:"blocked"}};P.loadModule(b,function(b){a.showInModal(b,{can_dismiss:!1}),a.listen(b,P.CONST.EVENT_CONFIRM,a.onBlockConfirm)})},onBlockConfirm:function(){P.getModalManager().removeAllModals();var a=P.getCurrentUrl().split("/")||[];a[1]&&a[1]===this.options.username&&this.navigate("/")},blockUser:function(){var a=this,b=this.getChildById("submitButton"),c=this.options.user_id;b.showLoading();var d={blocked_user_id:c},e=this.options.blocked_by_me?"delete":"create",f=P.resourceFactory.create("UserBlockResource",d),g=this.options.blocked_by_me?"user_unblock":"user_block";f.call(e,{success:function(){P.trackGAEvent(g,P.CONST.GA_ACTION_SUCCESS),P.pubsub.publish(a.options.user_id,P.CONST.PUBSUB_TOPIC_USER_BLOCKED),a.onUserBlockSuccess()},error:function(a){P.showError(a.message),P.trackGAEvent(g,P.CONST.GA_ACTION_ERROR)},complete:function(){b.hideLoading()}})},onCancelButtonClick:function(){this.destroy()}}),goog.provide("P.modules.UserBoardInvites"),goog.require("P.Module"),P.modules.UserBoardInvites=P.Module.extend({onContentReady:function(){this.destroyIfEmpty(),this.pagedGrid=this.getChildById("pagedGrid"),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onChildContentChanged)},onChildRemoved:function(){this.destroyIfEmpty()},onChildContentChanged:function(){this.pagedGrid.hasItems()||this.pagedGrid.destroy()},isEmpty:function(){return!this.children.length}}),goog.provide("P.modules.UserChangePassword"),goog.require("P.Module");var changePasswordSubmitButtonId="changePasswordSubmit";P.modules.UserChangePassword=P.Module.extend({onContentReady:function(){this.$form=this.$("form");var a={"new":[P.Validator.Required(),P.Validator.ContainsOnlyAscii({message:P.string.common.asciiPasswordError}),P.Validator.Password()],new_confirm:[P.Validator.Required(),P.Validator.EqualTo({targetFieldName:"new",message:P._("Passwords don't match")})]};this.extraData.has_password&&(a.old=[P.Validator.Required()]),this.form=new P.Form(this.$form,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var b=this.getChildById("forgotPasswordButton");b&&this.listen(b,P.CONST.EVENT_BUTTON_CLICK,this.onForgotPasswordClick)},onSubmitValidated:function(a){var b=this.getChildById(changePasswordSubmitButtonId);
a.errors[0]||(b.showLoading(!0),this.changePassword())},changePassword:function(){var a=this;this.hideLoading(!0);var b=function(){var b=a.getChildById(changePasswordSubmitButtonId);b.hideLoading()},c=function(){if(a.isInModal()){var b={name:"ConfirmDialog",options:{template:"change_password_success"}},c=function(){a.triggerEvent("success",a),a.destroy(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD,a.extraData.render_social_networks)};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,c)})}else a.navigate("/")},d=$("form",this.$el),e={"new":d.find("[name=new]").val(),new_confirm:d.find("[name=new_confirm]").val()};this.extraData.has_password&&(e.old=d.find("[name=old]").val());var f=P.resourceFactory.create("UserPasswordResource",e);f.callUpdate({success:c,complete:b})},onForgotPasswordClick:function(){var a=this;P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_CLICK),this.showLoading();var b=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username}),c=function(){P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_SUCCESS);var b={name:"ConfirmDialog",options:{template:"change_password"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.destroy)})},d=function(){a.hideLoading()},e=function(){P.trackGAEvent("forgot_password",P.CONST.GA_ACTION_ERROR)};b.callCreate({success:c,complete:d,error:e})}}),goog.provide("P.modules.UserContact"),goog.require("P.Module"),P.modules.UserContact=P.Module.extend({events:{"click .dismiss":"onDismissClick","click .contactWrapper":"onAction"},onDismissClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},getUserId:function(){return this.user.hash_id},onContentReady:function(){this.user=this.options.contact_info},onInviteSuccess:function(a){a&&(this.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0),this.$el.addClass("contactConfirmed"))},onAction:function(){return"facebook"===this.user.network?P.Invite.userInviteFacebook(this.user.id,_.bindFn(this.onInviteSuccess,this)):"email"===this.user.id_type&&P.Invite.userInviteEmail(this.user.id,_.bindFn(this.onInviteSuccess,this)),!1}}),goog.provide("P.modules.UserDropdown"),goog.require("P.Module"),P.modules.UserDropdown=P.Module.extend({events:{"click .reportBug":"openReportBugModal","click .reportUser":"openReportUserModal","click .sendProfile":"sendProfile","click .sendProfile2":"sendProfileConversations","click .userMenuFindBoards":"openFindBoards","click .userMenuCreateBoard":"openCreateBoard","click .userMenuAddPin":"openAddPin","click .userMenuUploadPin":"openUploadPin","click .userMenuEditProfile":"openEditProfile","click .userMenuMakeAWidget":"openMakeAWidget","click .settings":"onSettingsClick","click .userMenuMakeABoardWidget":"openMakeABoardWidget","click .sendBoard":"sendBoard","click .sendBoard2":"sendBoardConversations"},onSettingsClick:function(a){if(a.preventDefault(),"True"===Cookie.get(P.CONST.COOKIE_DUMMY_SECURE))return this.navigate("/settings/"),!1;var b=this,c=P._("To get to your settings, please take a second to confirm it's really you."),d={name:"ConfirmDialog",options:{button_text:P._("Log in to continue"),body_message:c,title:P._("Password, please!"),template:"generic"}};return P.loadModule(d,function(a){b.showInModal(a),b.listen(a,P.CONST.EVENT_CONFIRM,function(){b.navigate("/settings/")})}),!1},getFindFriendsElement:function(){return this.$(".userMenuFindFriends").parent().eq(0)},getMyBoardsElement:function(){return this.$(".myBoards").parent().eq(0)},getFindBoardsElement:function(){return this.$(".userMenuFindBoards").parent().eq(0)},openFindBoards:function(){var a=this,b={name:"FastFollow",resource:{name:"UserResource",options:{username:P.currentUser.get("username"),field_set_key:"fast_follow"}},options:{post_orientation:!0}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b,{can_dismiss:!0,container_class:"fastFollowContainer"})}),!1},openReportBugModal:function(a){a.preventDefault();var b=this,c={name:"ReportBug",options:{shrinkToFit:!0}};return this.showLoading(),P.loadModule(c,function(a){b.hideLoading(),b.showInModal(a)}),!1},openReportUserModal:function(a){a.preventDefault();var b=this,c=this.options.user,d={name:"FlagUser",options:{full_name:c.full_name,first_name:c.first_name,blocked_by_me:c.blocked_by_me,user_id:c.id,username:c.username,hide_other_field:!0}};return this.showLoading(),P.loadModule(d,function(a){b.hideLoading(),b.showInModal(a)}),!1},sendProfileConversations:function(a){a.preventDefault();var b=this,c=this.options.user,d={name:"SendPinner2",options:{class_name:"newBoardHeaderStyle",object_id:c.id,object_image_url:c.image_large_url,object_description:c.bio,object_url:"/"+c.username},resource:{name:"RecentContactsResource",options:{field_set_key:"default"}}};return this.showLoading(),P.loadModule(d,function(a){b.hideLoading(),b.showInModal(a)}),!1},sendProfile:function(a){a.preventDefault();var b=this,c=this.options.user,d={name:"SendPinner",options:{class_name:"modal",object_id:c.id,object_image_url:c.image_large_url,object_description:c.bio,object_url:"/"+c.username}};return this.showLoading(),P.loadModule(d,function(a){b.hideLoading(),b.showInModal(a)}),!1},openCreateBoard:function(){var a=this,b={name:"BoardCreate",options:{}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},openAddPin:function(){var a=this,b={name:"AddPinURL",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},openUploadPin:function(){var a=this,b={name:"PinUploader",options:{shrinkToFit:!0,show_title:!0}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},openEditProfile:function(){var a=this,b={name:"UserEdit",resource:{name:"UserSettingsResource",options:{}},options:{user_id:this.options.user_id}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},openMakeAWidget:function(){var a=this,b={name:"EmbedPinner",options:{user:this.options.user,view_type:"guided"}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},openMakeABoardWidget:function(){var a=this,b={name:"EmbedBoard",options:{board:this.options.board,view_type:"guided",class_name:"v2"}};return this.showLoading(),P.loadModule(b,function(b){a.hideLoading(),a.showInModal(b)}),!1},sendBoardConversations:function(a){a.preventDefault();var b=this,c=this.options.board,d={name:"SendBoard2",options:{class_name:"newBoardHeaderStyle",object_id:c.id,object_image_url:c.image_cover_url,object_description:c.description,object_url:c.url},resource:{name:"RecentContactsResource",options:{field_set_key:"default"}}};return this.showLoading(),P.loadModule(d,function(a){b.hideLoading(),b.showInModal(a)}),!1},sendBoard:function(a){a.preventDefault();var b=this,c=this.options.board,d={name:"SendBoard",options:{class_name:"modal",object_id:c.id,object_image_url:c.image_cover_url,object_description:c.description,object_url:c.url}};return this.showLoading(),P.loadModule(d,function(a){b.hideLoading(),b.showInModal(a)}),!1}}),goog.provide("P.modules.UserEdit"),goog.require("P.Module"),P.modules.UserEdit=P.Module.extend({onContentReady:function(){var a={first_name:[P.Validator.Required()],username:[P.Validator.Required()],about:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})]};this.data.is_partner&&(a.business_name=[P.Validator.Required()]),this.formListener&&this.removeListener(this.formListener),this.form=new P.Form(this.$("form"),a),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated);var b={};b[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onImageUploaded,this.pubsubSubscribe(this.options.user_id,b)},onImageUploaded:function(a,b,c){if(c&&c.data&&c.data.profile_image_url){var d=this.$(".profileImage");d.attr("src",c.data.profile_image_url),d.on("load",function(){d.toggleClass("restrictWidth",d.height()>d.width())})}},onSubmitValidated:function(a){a.errors[0]||this.saveProfile()},getFormData:function(){var a=this.$("form").serializeArray(),b={};return _.each(a,function(a){b[a.name]=a.value}),b},getSaveResource:function(a){return P.resourceFactory.create("UserSettingsResource",a)},saveProfile:function(){var a=this.getFormData(),b=this.getChildById("submitButton"),c=this,d=this.extraData.currentUsername,e=a.username&&d!==a.username;b.showLoading();var f=this.getSaveResource(a);f.callUpdate({success:function(d){var f;if(b.hideLoading(),d.resource_response.error)d.resource_response.message&&(f={message:d.resource_response.message});else{var g=c.isInModal()&&!e;if(g)P.pubsub.publish(c.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),c.destroy();else{var h="/"+a.username+"/";c.navigate(h)}}},error:function(a){P.showError(a.message)},complete:function(){b.hideLoading()}})}}),goog.provide("P.modules.UserEditEmail"),goog.require("P.Module"),P.modules.UserEditEmail=P.Module.extend({onContentReady:function(){this.$form=this.$("form"),this.form=new P.Form(this.$form,{email:[P.Validator.Required()]}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onSubmitValidated:function(a){a.errors[0]||this.updateEmail()},updateEmail:function(){var a=this,b=function(b){if(b){var c=b.resource_response;if(c&&!c.error){if(a.isInModal()){var d;d=P._(c.data.email_changing_to?"Thanks! Your email update is pending. You should receive a confirmation email soon.":"Thanks! Your email has been updated. You should receive a confirmation email soon."),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_NAG_UPDATED,d),a.destroy()}return}}},c={},d=this.form.getValue("email");this.data.email.trim()!==d.trim()?c.email=d:c.email_bounced=!1;var e=P.resourceFactory.create("UserSettingsResource",c);e.callUpdate({success:b})}}),goog.provide("P.modules.UserEditVerifyWebsite"),goog.require("P.Module"),P.modules.UserEditVerifyWebsite=P.Module.extend({events:{'keyup input[name="website_url"]':"onInput",'input input[name="website_url"]':"onInput"},onContentReady:function(){this.originalWebsite=this.data.website_url;var a={};a[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a);var b=this.getChildById("verifyWebsite");this.listen(b,P.CONST.EVENT_BUTTON_CLICK,this.onClick)},onUserUpdated:function(){this.render()},onInput:function(a){var b=$(a.target).val(),c=this.getChildById("verifyWebsite"),d=this.options.domain_verified&&b===this.originalWebsite;this.$(".verifiedDomainContainer").toggleClass("hidden",!d),this.$(".verifyButton").toggleClass("hidden",d),b?c.enable():c.disable()},showModal:function(){this.showLoading();var a=this,b={name:"DomainVerify",resource:{name:"DomainVerifyResource",options:{}}};P.loadModule(b,function(b){a.hideLoading();var c={show_api_error:!0};a.showInModal(b,c)})},onClick:function(){var a=this.$('input[name="website_url"]').val();if(a===this.originalWebsite)return void this.showModal(a);var b=this,c=this.getChildById("verifyWebsite");c.showLoading();var d=P.resourceFactory.create("UserSettingsResource",{website_url:a});d.callUpdate({success:function(){P.pubsub.publish(b.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED),b.showModal(a)},error:function(a){P.showError(a.message)},complete:function(){c.hideLoading()}})}}),goog.provide("P.modules.UserInfoBar"),goog.require("P.Module"),goog.require("P.modules.InfoBarBase"),P.modules.UserInfoBar=P.modules.InfoBarBase.extend({}),goog.provide("P.modules.UserNavigateButton"),goog.require("P.Module"),goog.require("P.modules.NavigateButton"),P.modules.UserNavigateButton=P.modules.NavigateButton.extend({}),goog.provide("P.modules.UserProfileContent"),goog.require("P.Module");var BOARDS_TAB="boards",PINS_TAB="pins";P.modules.UserProfileContent=P.Module.extend({onCreated:function(){var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},addTutorials:function(){if(this.options.tab===BOARDS_TAB&&this.extraData.isOwnProfile){var a=P.ExperienceManager.instance(),b=P.Experiences.Placement.WEB_USER_PROFILE_TAKEOVER,c=a.getPlacedExperience(b);if(c){var d=P.ExperienceManager.Tutorials[c.experience_id];d&&(P.TutorialManager.instance().startTutorial(d),a.viewPlacedExperience(b,c.experience_id))}}},onContentReady:function(){if(!this.data.board_count&&!this.data.secret_board_count){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onFirstBoardCreated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)}this.addTutorials()},onFirstBoardCreated:function(){this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED),this.render()},onPinAdded:function(a,b,c){if(this.options.tab===PINS_TAB&&c.board.privacy!==P.CONST.BOARD_PRIVACY_SECRET&&this.extraData.isOwnProfile){var d=this.getChildById("userPins");d?d.prependNewItems(1):this.render()}}}),goog.provide("P.modules.UserProfileFollow"),goog.require("P.Module");var CLOSE_DELAY=7e3;P.modules.UserProfileFollow=P.Module.extend({onContentReady:function(){var a=this.getChildById("followButton");a&&this.listen(a,"toggleFollow",function(){this.$(".userProfileOnEntry").addClass("hidden"),a.getState()?(this.$(".UserProfileFollowPins").addClass("followed"),this.$(".userProfileFollowButton").addClass("hidden"),this.$(".postUnFollow").addClass("hidden"),this.$(".postFollow").removeClass("hidden"),P.setTimeout(function(){window.close()},CLOSE_DELAY)):this.$(".postUnFollow").removeClass("hidden")})}}),goog.provide("P.modules.UserProfileFollowPins"),goog.require("P.Module"),P.modules.UserProfileFollowPins=P.Module.extend({onContentReady:function(){for(var a=this.$(".pinSlot"),b=a.length,c=0,d=function(){$(this).parent().addClass("visible")},e=0;e<this.data.length;e+=1)if(this.data[e].images){var f=document.createElement("IMG");c<b&&(f.onload=d),f.src=this.data[e].images["236x"].url,a[c%b].appendChild(f),c+=1}}}),goog.provide("P.modules.UserProfileHeader"),goog.require("P.Module"),P.modules.UserProfileHeader=P.Module.extend({onCreated:function(){this._resized=!1},_resizeTextIfReady:function(){!this._resized&&this.inDom&&this.contentReady&&this.$(".userProfileHeaderBio").overflowingText()},onContentReady:function(){if(this._resizeTextIfReady(),this.options.user_id){var a={};a[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.options.user_id,a)}if(this.options.report_user_spam&&!this.data.blocked_by_me){P.getModalManager().removeAllModals();var b={name:"FlagUser",options:{full_name:this.data.full_name,first_name:this.data.first_name,blocked_by_me:this.data.blocked_by_me,user_id:this.data.id,username:this.data.username,hide_other_field:!0}},c=this;P.loadModule(b,function(a){c.showInModal(a)})}},onAddedToDom:function(){this._resizeTextIfReady()},onUserUpdated:function(){this.render()}}),goog.provide("P.modules.UserProfileImageUploader"),goog.require("P.Module"),P.modules.UserProfileImageUploader=P.Module.extend({onCreated:function(){this.onUpdateSuccess=_.bindFn(this.onUpdateSuccess,this)},onContentReady:function(){var a=this.getChildById("uploader");this.listen(a,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.listen(a,P.CONST.EVENT_UPLOAD_ERROR,this.onUploadError)},onUploadSuccess:function(a){P.trackGAEvent("user_profile_image_upload",P.CONST.GA_ACTION_SUCCESS),this.imageUrl=a.data.image_url,this.updateUserProfileImage()},onUploadError:function(a){P.trackGAEvent("user_profile_image_upload",P.CONST.GA_ACTION_ERROR);var b=a.data;P.showError(b)},getUserSettingsResource:function(){return P.resourceFactory.create("UserSettingsResource",{profile_image_url:this.imageUrl})},updateUserProfileImage:function(){var a=this.getUserSettingsResource();a.callUpdate({success:this.onUpdateSuccess})},onUpdateSuccess:function(a){var b=a.resource_response;b.data.profile_image_url=this.imageUrl,P.pubsub.publish(this.options.user_id,P.CONST.PUBSUB_TOPIC_USER_UPDATED,b),this.destroy()}}),goog.provide("P.modules.UserRecentActivity"),goog.require("P.Module"),P.modules.UserRecentActivity=P.Module.extend({events:{"mouseenter .username":"onUsernameMouseEnter","mouseout .username":"onUsernameMouseOut"},onContentReady:function(){this.destroyIfEmpty()},onAddedToDom:function(){_.each(this.$(".recentActivityRow"),function(a){var b=$(a),c=b.attr("href"),d=b.data("link_url");c!==d&&b.attr("href",d)}),this.destroyIfEmpty()},isEmpty:function(){return this.contentReady&&this.inDom&&!this.$(".recentActivityRow:visible").length},onUsernameMouseEnter:function(a){var b=$(a.target).parents("a");this._originalUrl=b.attr("href");var c=$(a.target),d=c.data("username");if(d){var e="/"+d+"/";b.attr("href",e)}},onUsernameMouseOut:function(a){var b=this,c=$(a.target).parents("a");c.attr("href",b._originalUrl)}}),goog.provide("P.modules.UserRegister"),goog.require("P.Module"),goog.require("P.modules.UserRegisterBase"),P.modules.UserRegister=P.modules.UserRegisterBase.extend({}),goog.provide("P.modules.UserRegisterPage"),goog.require("P.Module"),goog.require("P.modules.UserRegisterPageBase"),P.modules.UserRegisterPage=P.modules.UserRegisterPageBase.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),goog.provide("P.modules.UserRegisterRestricted"),goog.require("P.Module"),P.modules.UserRegisterRestricted=P.Module.extend({onAddedToDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!1)},onRemovedFromDom:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAG_STATE,!0)}}),goog.provide("P.modules.UserSettingsPage"),goog.require("P.Module"),goog.require("P.modules.Button");var CLASS_EMAIL_DISABLED="emailDisabled",CLASS_EMAIL_SETTINGS="emailSettings",CLASS_TOC_SELECTED="selected",FLOW=["confirm","delete"],MODULE_ID_EMAIL_GLOBAL_TOGGLE="emailGlobalToggle",SCROLL_MARGIN_OF_ERROR=2;P.modules.UserSettingsPage=P.Module.extend({events:{"click .toc li":"onTOCClick"},onContentReady:function(){var a={email:[P.Validator.Email()],first_name:[P.Validator.Required()],username:[P.Validator.Required()],about:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_USER_DESCRIPTION})]};this.data.is_partner&&(a.contact_name=[P.Validator.Required()],a.business_name=[P.Validator.Required()]),this.$form=this.$("form"),this.form=new P.Form(this.$form,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange);var b={};b[P.CONST.PUBSUB_TOPIC_USER_CHANGED_PASSWORD]=this.onPasswordChanged,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b),this.resizeListener=this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize),this.onResize(),this.scrollListener=this.listen(this.getScrollableElement(),P.CONST.EVENT_SCROLL,this.onScroll),this.$(".formFooter").fixedsticky()},onPasswordChanged:function(a,b,c){var d=this.getChildById("userChangePasswordButton");if(d.options.submodule.options.has_password=!0,d.options.text=this.extraData.change_password_text,d.render(),c){var e=this.getChildById("userSocialNetworkSettings");e.render()}},onButtonClick:function(a){var b=a.target,c=b.id;switch(c){case"deleteAccount":this.step=0,this.deleteAccountFlow();break;case"clearRecentSearches":this.clearRecentSearches(a);break;case"clearSendPinHistory":this.clearRecentSentPinContacts(a)}},onChildChange:function(a){var b=a.target;b.id===MODULE_ID_EMAIL_GLOBAL_TOGGLE&&(b.isChecked()?this.enableEmails():this.confirmDisableEmails())},clearRecentSearches:function(a){var b=a.target;b.disable();var c=P.resourceFactory.create("TypeaheadClearRecentResource");c.callDelete({error:function(){b.enable()}})},clearRecentSentPinContacts:function(a){var b=a.target;b.disable();var c=P.resourceFactory.create("RecentContactsResource");c.callDelete({error:function(){b.enable()}})},deleteAccountFlow:function(){var a=FLOW[this.step];"delete"===a?this.deleteAccount():(this.showDeleteAccountStep(a),this.step++)},onSubmitValidated:function(a){a.errors[0]||this.save()},navigateToUserProfilePage:function(a){var b="/"+a+"/";this.navigate(b)},navigateToSettingsPage:function(){var a="/settings";this.navigate(a,!0)},save:function(){var a=this,b=this.$form.serializeArray(),c={};_.each(b,function(a){c[a.name]="on"===a.value||"off"===a.value?"on"===a.value:a.value}),this.$form.find("input[type=checkbox]").each(function(){var a=$(this);c[a.attr("name")]=a.is(":checked")});var d=this.getChildById("submitButton"),e=P.resourceFactory.create("UserSettingsResource",c),f=function(b){if(b&&!b.resource_response.error){var d=b.resource_response.data;if(a.data.email===c.email||!d.email_changing_to)return a.navigateToSettingsPage();a.showPendingEmailChange()}};d.showLoading(),e.callUpdate({success:f,complete:function(){d.hideLoading()}})},showPendingEmailChange:function(){var a=this,b=P.string.format(P._("To finish updating your address, look for the confirmation email we sent to {{ current_email }}."),{current_email:this.data.email}),c={name:"ConfirmDialog",options:{button_text:P._("Ok"),body_message:b,title:P._("You're almost done!"),template:"generic"}};P.loadModule(c,function(b){a.showInModal(b,{can_dismiss:!1}),a.listen(b,P.CONST.EVENT_CLOSE,a.navigateToSettingsPage),a.listen(b,P.CONST.EVENT_CONFIRM,a.navigateToSettingsPage)})},showDeleteAccountStep:function(a){var b=this,c="delete_account_"+a,d={name:"ConfirmDialog",options:{template:c,view_type:"wide"}};P.loadModule(d,function(a){b.showInModal(a),b.listen(a,P.CONST.EVENT_CONFIRM,b.deleteAccountFlow)})},deleteAccount:function(){var a=this;this.xhr=$.ajax({cache:!1,url:"/delete_user/",dataType:"json",type:"delete"}).then(function(b){"success"===b.status?a.showDeleteAccountStep("success"):P.showError(P.string.common.defaultErrorMessage)},function(){P.showError(P.string.common.defaultErrorMessage)})},confirmDisableEmails:function(){var a=this,b={name:"ConfirmDialog",options:{template:"disable_emails_confirm"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,function(){a.disableEmails(),a.removeListener(c)});var c=a.listen(b,P.CONST.EVENT_DESTROYED,function(){var a=this.getChildById(MODULE_ID_EMAIL_GLOBAL_TOGGLE);a.setChecked(!0)})})},disableEmails:function(){this.setEmailsEnabled(!1)},enableEmails:function(){this.setEmailsEnabled(!0)},setEmailsEnabled:function(a){var b=P.resourceFactory.create("UserSettingsResource",{email_enabled:a}),c=this.$("."+CLASS_EMAIL_SETTINGS);c.toggleClass(CLASS_EMAIL_DISABLED,!a),b.callUpdate()},onTOCClick:function(a){var b=this,c=$(a.currentTarget).find("a").attr("href"),d=$(c).position().top;return this.$(".toc li").removeClass(CLASS_TOC_SELECTED),$(a.currentTarget).addClass(CLASS_TOC_SELECTED),this.tocClicked=!0,P.scrollToTop({newScrollOffset:d,duration:800,callback:function(){b.tocClicked=!1}}),a.stopPropagation(),!1},onResize:function(){var a=this.$(".standardForm").offset(),b=20;this.$(".toc").css({left:a.left-this.$(".toc").width()-b,top:a.top}),this.negativeSpaceAdded=0},addNegativeSpace:function(){if(0===this.negativeSpaceAdded){var a=this.$(".standardForm");a.height("100%");var b=this.$("#apps").position().top,c=$(document).height()-this.getScrollableElement().height(),d=b-c;if(d>0){var e=a.height();a.height(e+d),this.negativeSpaceAdded=d}}},onScroll:function(){var a=this.getScrollableElement().scrollTop();if(!(a<0)){if(!this.tocClicked){for(var b=null,c=0,d=this.$(".sectionTitle"),e=0;e<d.length;e++){var f=d[e],g=$(f).position().top;a>=g-SCROLL_MARGIN_OF_ERROR&&(!b||c<g)&&(b=f,c=g)}this.$(".toc li").removeClass(CLASS_TOC_SELECTED),this.$('.toc a[href="#'+$(b).attr("id")+'"]').parent("li").addClass(CLASS_TOC_SELECTED)}this.addNegativeSpace()}}}),goog.provide("P.modules.UserSocialNetworkSettings"),goog.require("P.Module"),goog.require("P.modules.SocialNetworkSettingsBase"),P.modules.UserSocialNetworkSettings=P.modules.SocialNetworkSettingsBase.extend({FB_PUBLISH_ACTIONS_PERMISSION:"publish_actions",onCreated:function(){P.modules.SocialNetworkSettingsBase.prototype.onCreated.apply(this,arguments),this.childListen("change",this.onChildChange)},disconnectFromSocial:function(a,b,c){this.showLoading(!0);var d=this,e={success:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED),d.render()},error:function(){a.toggle()},complete:function(){d.hideLoading()}};c||"facebookTimelineToggle"!==a.id?this.handleConnect(c,b,e):(e.success=function(){},P.FbUtil.maybeRequestFbTimelinePermission(e,this.extraData.facebookId))},onChildChange:function(a){var b=a.target,c=b.isChecked&&b.isChecked(),d=null;switch(b.id){case"facebookToggle":if(!(c&&!this.extraData.facebookUrl||!c&&this.extraData.facebookUrl))return;d=P.SocialConnect.FACEBOOK,c||this.getChildById("facebookTimelineToggle").setChecked(!1);break;case"facebookTimelineToggle":var e={};e.facebook_timeline_enabled=c;var f=P.resourceFactory.create("UserSettingsResource",e);if(f.callUpdate({}),!c||this.extraData.facebookTimelineEnabled)return void(this.extraData.facebookTimelineEnabled=!this.extraData.facebookTimelineEnabled);d=null;break;case"twitterToggle":if(!(c&&!this.extraData.twitterUrl||!c&&this.extraData.twitterUrl))return;d=P.SocialConnect.TWITTER;break;case"gplusToggle":if(!(c&&!this.extraData.gplusUrl||!c&&this.extraData.gplusUrl))return;d=P.SocialConnect.GPLUS;break;case"googleToggle":if(!(c&&!this.extraData.connected_to_google||!c&&this.extraData.connected_to_google))return;d=P.SocialConnect.GOOGLE;break;case"yahooToggle":if(!(c&&!this.extraData.connected_to_yahoo||!c&&this.extraData.connected_to_yahoo))return;d=P.SocialConnect.YAHOO;break;case"rakutenToggle":if(!(c&&!this.extraData.connected_to_rakuten||!c&&this.extraData.connected_to_rakuten))return;d=P.SocialConnect.RAKUTEN;break;default:return}if(c||this.extraData.has_password)this.disconnectFromSocial(b,c,d);else{var g=this,h={name:"UserChangePassword",options:{has_password:!1,render_social_networks:!1}},i=!1;P.loadModule(h,function(a){g.showInModal(a),g.listen(a,"destroyed",function(){i?g.disconnectFromSocial(b,c,d):(P.showError(P._("A password must be set before unlinking.")),b.toggle())}),g.listen(a,"success",function(){i=!0})})}}}),goog.provide("P.modules.VerifyWebsite"),goog.require("P.Module"),P.modules.VerifyWebsite=P.Module.extend({}),goog.provide("P.modules.VisualSearchPage"),goog.require("P.Module"),P.modules.VisualSearchPage=P.Module.extend({onContentReady:function(){this._fadeOutBoxesIfReady()},onAddedToDom:function(){this._fadeOutBoxesIfReady()},_fadeOutBoxesIfReady:function(){this.inDom&&this.contentReady&&setTimeout(function(){this.$(".visualSearchOverlayInnerWrapper>img").fadeTo(1500,1)},1e3)}}),goog.provide("P.modules.VisualSearchPageQueryItem"),goog.require("P.Module"),P.modules.VisualSearchPageQueryItem=P.Module.extend({}),goog.provide("P.modules.VisualSearchSelector"),goog.require("P.Module"),P.modules.VisualSearchSelector=P.Module.extend({events:{"click label":"_onPinTypeLabelClick"},navigateToPinType:function(a){this.navigate("/search/"+a+"/"+this.options.pin_id+"/")},_onPinTypeLabelClick:function(a){var b=$(a.currentTarget),c=b.find("input"),d=c.val();if(d!==this.options.pin_type){var e=c.attr("data-url")||d;return this.navigateToPinType(e),!1}}}),goog.provide("P.modules.VisuallySimilar"),goog.require("P.Module"),P.modules.VisuallySimilar=P.Module.extend({events:{"change .queryType":"onButtonClick"},onButtonClick:function(a){console.log("Change to",a.target.value),this.resource.options.query_type=a.target.value;var b=this;this.render(function(){b.fadeIn()})}}),goog.provide("P.modules.YourWebsiteDropdown"),goog.require("P.Module"),P.modules.YourWebsiteDropdown=P.Module.extend({}),goog.provide("P.modules.reg.ContextualSignup"),goog.require("P.Module");var CONTEXTUAL_TYPE_TO_KEY={pin:"pin_to_create",board:"board_to_follow",user:"user_to_follow"},STEPS=["wallStep","optionsStep","signupStep"],ALL_STEPS=STEPS.join(" ");P.modules.reg.ContextualSignup=P.Module.extend({onContentReady:function(){this.loginButton=this.getChildById("loginButton"),this.joinButton=this.getChildById("joinButton"),this.skipButton=this.getChildById("skipButton"),this.facebookConnectButton=this.getChildById("facebookConnectButton"),this.emailButton=this.getChildById("emailButton"),this.$signupForm=this.$(".csSignupForm"),this.options.starting_step&&this.setStep(this.options.starting_step),this.listen(this.joinButton,P.CONST.EVENT_BUTTON_CLICK,this.onJoinClick),this.listen(this.emailButton,P.CONST.EVENT_BUTTON_CLICK,this.onEmailClick),this.listen(this.facebookConnectButton,P.CONST.FACEBOOK_LOGIN_FAILURE,this.onFacebookLoginFailure),this.childListen(P.CONST.EVENT_USER_REGISTER,this.onRegisterSuccess),this.skipButton&&this.listen(this.skipButton,P.CONST.EVENT_BUTTON_CLICK,this.onSkipClick),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onChildNavigate),P.trackRegisterAction(this.data&&this.data.type?"contextual_signup_"+this.data.type:"contextual_signup_no_context"),P.trackRegisterAction("register_landing")},onRegisterSuccess:function(a){this.options.open_new_window_on_success&&(a.stopPropagation(),P.changeWindowLocation("/",!0),window.close()),this.options.next&&"/"===this.options.next.charAt(0)&&(a.stopPropagation(),window.location=this.options.next)},onChildNavigate:function(a){if(this.options.next&&a.data&&-1!==a.data.url.indexOf("/login/")){var b=P.getQueryStringParams();b.next=this.options.next,a.data.url="/login/?"+$.param(b)}},setStep:function(a){this.$el.removeClass(ALL_STEPS),this.$el.addClass(a)},onJoinClick:function(a){if(a.stopPropagation(),this.options.redirect_to_signup){var b=P.absolutify("/join/","https:");return this.options.auto_follow_interest&&(b=P.url.appendQueryString(b,{auto_follow_interest:this.options.auto_follow_interest})),void P.changeWindowLocation(b,!1)}this.setStep("optionsStep"),P.trackRegisterAction("contextual_signup_join")},onSkipClick:function(){this.destroy()},onEmailClick:function(a){a.stopPropagation(),this.showSignupForm({}),P.trackRegisterAction("contextual_signup_join_email")},getContextualItem:function(){if(!this.data)return{};if("pinnable"===this.data.type)return{pin_to_create_url:this.data.link,pin_to_create_image_url:this.data.url};var a={},b=CONTEXTUAL_TYPE_TO_KEY[this.data.type];return b&&(a[b]=this.data.id),a},onFacebookLoginFailure:function(a){var b=this,c=a.data;a.stopPropagation(),P.trackRegisterAction("contextual_signup_join_facebook"),this.facebookConnectButton.showLoading(),P.UserRegistration.fetchNetworkData(P.SocialConnect.FACEBOOK).then(function(a){b.log.debug("FB data:",a),b.facebookConnectButton.hideLoading();var d={image_url:a.image_url,first_name:a.first_name,last_name:a.last_name,gender:a.gender,email:a.email,social_username:a.username,facebook_id:c.facebook_id,facebook_token:c.facebook_token};b.showSignupForm({form:d,network:P.SocialConnect.FACEBOOK,show_username:!1,show_email:!1,show_name:!1,show_password:!1,show_country:!1,show_gender:!1,show_facebook:!0})})},showSignupForm:function(a,b){a.contextualItem=this.getContextualItem();var c=this,d=function(){c.signupForm.setOptions(a),c.signupForm.render(b||P.NOOP)};if(this.signupForm)d();else{var e={name:"reg.SignupForm",options:a};P.loadModule(e,function(a){c.signupForm=a,c.insertChild(a,c.$signupForm),c.setStep("signupStep"),c.$signupForm.show(),d()})}}}),goog.provide("P.modules.reg.ContextualSignupSenderInfo"),goog.require("P.Module"),P.modules.reg.ContextualSignupSenderInfo=P.Module.extend({}),goog.provide("P.modules.reg.SignupForm"),goog.require("P.Module"),P.modules.reg.SignupForm=P.Module.extend({onContentReady:function(){this.setupForm()},onAddedToDom:function(){this.$("form input").first().focus()},setupForm:function(){if(!this.form){var a={first_name:[P.Validator.Required()],email:[P.Validator.Required(),P.Validator.Email()],gender:[P.Validator.Required()]};
this.options.show_password!==!1&&(a.password=[P.Validator.Password()]),this.form=new P.Form(this.$("form"),a,{insertErrorsBefore:!0}),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.submitButton=this.getChildById("submitButton"),this.options.network||this.submitButton.disable()}},showFields:function(a){_.each(a,function(a){var b=this.$("form input[name="+a+"]");b.parents(".hidden").removeClass("hidden")})},onSubmitValidated:function(a){if(!a.errors||!a.errors.length){var b=this,c=_.extend({},this.options.form,this.options.contextualItem,this.form.getData());this.submitButton.showLoading(),P.UserRegistration.register(this.options.network,c).then(function(a){b.log.debug("Signup success:",a),b.triggerEvent(P.CONST.EVENT_USER_REGISTER,{},!0)&&(window.location="/")},function(){b.showFields(["email"]),b.submitButton.hideLoading()})}}}),goog.provide("P.modules.ui.ImageCrop"),goog.require("P.Module"),P.modules.ui.ImageCrop=P.Module.extend({events:{"mousedown .drag":"onStartDrag","touchstart .drag":"onStartDrag"},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){_.defaults(this.options,{size:{width:222,height:150},padding:60}),this.$holder=this.$(".holder"),this.$bg=this.$(".bg"),this.$help=this.$(".help"),this.$frame=this.$(".frame"),this.$mask=this.$(".mask"),this.$spinner=this.$(".spinner"),this.$holder.show().css("height",this.options.size.height+2*this.options.padding),this.options.help_text&&this.$help.html(this.options.help_text),this._positionIfReady()},_positionIfReady:function(){if(!this._positioned&&this.inDom&&this.contentReady){this._positioned=!0;var a=this._frameBounds={left:this.$holder.width()/2-this.options.size.width/2,width:this.options.size.width,top:this.options.padding,height:this.options.size.height};a.ratio=a.height/a.width,this.$frame.css(a);var b=this.$mask.children();b.eq(0).css({top:0,left:0,right:0,height:a.top}),b.eq(1).css({top:a.top,left:a.left+a.width,right:0,height:a.height}),b.eq(2).css({top:a.top+a.height,left:0,right:0,bottom:0}),b.eq(3).css({top:a.top,left:0,width:a.left,height:a.height}),this.options.image_url&&this.setImage(this.options.image_url)}},initImage:function(){if(!this.$img.height()||!this.$img.width())return void _.delay(_.bindFn(this.initImage,this),200);var a=this._imageBounds={nativeWidth:this.$img.width(),nativeHeight:this.$img.height()};a.ratio=a.nativeHeight/a.nativeWidth,this.$img.addClass("in"),this._fitImage(),this._centerImage(),this._hideSpinner()},onStartDrag:function(a){var b="touchstart"===a.type;this._mousePosition=b?{x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}:{x:a.pageX,y:a.pageY},this._startPosition={x:parseInt(this.$bg.css("left"),10),y:parseInt(this.$bg.css("top"),10)},$("body").on({"mousemove.ui-ImageCrop touchmove.ui-ImageCrop":_.bindFn(this.onDragging,this),"mouseup.ui-ImageCrop touchend.ui-ImageCrop":this.onStopDragging}),a.preventDefault()},onDragging:function(a){a.preventDefault();var b="touchmove"===a.type,c=b?a.originalEvent.changedTouches[0]:a,d=c.pageX-this._mousePosition.x,e=c.pageY-this._mousePosition.y,f={top:this._startPosition.y+e,left:this._startPosition.x+d};this._clampValues(f),this.$bg.css(f)},onStopDragging:function(){$("body").off("mousemove.ui-ImageCrop mouseup.ui-ImageCrop touchmove.ui-ImageCrop touchend.ui-ImageCrop")},_clampValues:function(a){a.top=Math.min(a.top,this._frameBounds.top),a.left=Math.min(a.left,this._frameBounds.left),a.top+this._imageBounds.height<this._frameBounds.top+this._frameBounds.height&&(a.top=this._frameBounds.top+this._frameBounds.height-this._imageBounds.height+1),a.left+this._imageBounds.width<this._frameBounds.left+this._frameBounds.width&&(a.left=this._frameBounds.left+this._frameBounds.width-this._imageBounds.width+1)},setImage:function(a){this._showSpinner();var b=this.$img=$("<img>",{src:a});this.$bg.empty().append(b),this.initImage()},_fitImage:function(){var a;a=this._imageBounds.ratio>=this._frameBounds.ratio?this._frameBounds.width/this._imageBounds.nativeWidth:this._frameBounds.height/this._imageBounds.nativeHeight,this._scaleImage(a)},_centerImage:function(){var a=this.$holder.height(),b=this.$holder.width();this.$bg.css({top:a/2-this.$bg.height()/2+1,left:b/2-this.$bg.width()/2+1})},_scaleImage:function(a){var b=this._imageBounds.width=this._imageBounds.nativeWidth*a,c=this._imageBounds.height=this._imageBounds.nativeHeight*a;this.$img.css({width:b,height:c})},_showSpinner:function(){this.$spinner.show()},_hideSpinner:function(){this.$spinner.hide()},getCropData:function(){var a={x:-1*(parseInt(this.$bg.css("left"),10)-this._frameBounds.left),y:-1*(parseInt(this.$bg.css("top"),10)-this._frameBounds.top)},b=this.$img.width()/this._imageBounds.nativeWidth,c={crop_x:a.x,crop_y:a.y,nativeHeight:this._imageBounds.nativeHeight,nativeWidth:this._imageBounds.nativeWidth,height:this.options.size.height,width:this.options.size.width,scale:b};return c}}),goog.provide("P.modules.ui.ImageUploader"),goog.require("P.Module");var IMAGE_UPLOADER_CLASS_SELECTED="selected";P.modules.ui.ImageUploader=P.Module.extend({onCreated:function(){this.onUploaderSubmit=_.bindFn(this.onUploaderSubmit,this),this.onUploaderComplete=_.bindFn(this.onUploaderComplete,this),this.onUploaderProgress=_.bindFn(this.onUploaderProgress,this),this.onUploaderError=_.bindFn(this.onUploaderError,this)},enable:function(){this.getButton().enable()},disable:function(){this.getButton().disable()},select:function(){this._setSelected(!0)},_setSelected:function(a){this.$el.toggleClass(IMAGE_UPLOADER_CLASS_SELECTED,a)},deselect:function(){this._setSelected(!1)},onContentReady:function(){this.ensureUploader()},getUploadUrl:function(){return P.absolutify("/upload-image/")},getFileNameElement:function(){return this.$fileName||(this.$fileName=this.$(".uploaderProgress").find("span")),this.$fileName},getButton:function(){return this.getChildById("upload")},ensureUploader:function(){if(this.uploader)return this.uploader;var a=this;return this.uploader=new qq.FineUploaderBasic({debug:P.DEBUG,button:this.getButton().$el.get(0),multiple:!1,request:{endpoint:this.getUploadUrl(),inputName:"img",forceMultipart:!0,customHeaders:{"X-CSRFToken":P.csrf.getCSRFToken()}},callbacks:{onUpload:this.onUploaderSubmit,onComplete:this.onUploaderComplete,onProgress:this.onUploaderProgress,onError:this.onUploaderError,showAlert:function(b){a.log.debug(b)}}}),this.uploader},onUploaderSubmit:function(){this.getButton().showLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_START),this.log.debug("UploaderSubmit",arguments)},onUploaderComplete:function(a,b,c){c.success&&(this.getButton().hideLoading(),this.getButton().setStyles({primary:!1}),this.triggerEvent(P.CONST.EVENT_UPLOAD_SUCCESS,c,!0),this.getFileNameElement().text(c.filename),this.log.debug("UploaderComplete",arguments))},onUploaderProgress:function(a,b,c,d){var e=Math.round(c/d*100);this.triggerEvent(P.CONST.EVENT_UPLOAD_PROGRESS,{loaded:c,total:d,percent:e}),this.getFileNameElement().text(e+"%"),this.log.debug("UploaderProgress",arguments)},resetFileNameElement:function(){this.getFileNameElement().text("")},onUploaderError:function(a,b,c){this.getButton().hideLoading(),this.triggerEvent(P.CONST.EVENT_UPLOAD_ERROR,c),this.log.debug("UploaderError",arguments),P.showError(c),this.resetFileNameElement()}}),goog.provide("P.modules.ui.PinPreview"),goog.require("P.Module"),P.modules.ui.PinPreview=P.Module.extend({setImage:function(a){this.options.image_url=a;var b=this;this.showLoading(!0);var c=function(){b.hideLoading()},d=this.$("img").get(0);d&&(d.onerror=d.onload=c,d.src=a)},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/ui/PinPreview/PinPreview.nunjucks")}),goog.provide("P.modules.ui.SearchForm"),goog.require("P.Module"),goog.require("P.modules.SearchInputToken");var CLASS_FIELD_FOCUS="focus";P.modules.ui.SearchForm=P.Module.extend({events:{"submit > form":"onSubmit",click:"onClick"},onChildItemSelected:function(a){var b=a.data.item,c=b.get("query")||"";this.showGuidedSearch&&this.updateSearchTokens(c,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,c);var d=b.get("url");if(d){if(this.options.navigate_on_search){if(this.showGuidedSearch){var e=b.get("type");this.updateQueryStates(c,e,b.get("resultIndex")),"board"!==e&&"user"!==e&&(d+=this.constructQueryStatesParams())}this.navigate(d)}return this.typeaheadField.blur(),!1}},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_SCOPE_UPDATED]=this.onSearchScopeUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_BOOST_UPDATED]=this.onSearchBoostUpdated,a[P.CONST.PUBSUB_TOPIC_SEARCH_GUIDE_SELECTED]=this.onSearchGuideSelected,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.typeaheadField=this.getChildById("searchField"),this.showGuidedSearch=this.options.support_guided_search,this.showNewTypeahead=this.options.support_advanced_typeahead,this.showGuidedSearch&&(this.tokenizedInput=this.typeaheadField.getChildById("tokenizedInput"),this.queryStates=[],this.queryStatesChange=null),this.selectedListener=this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_TOKEN_REMOVED_BY_USER,this.onTokenRemovedByUser),this.childListen(P.CONST.EVENT_FOCUS,this.onTypeaheadFieldFocus),this.childListen(P.CONST.EVENT_BLUR,this.onTypeaheadFieldBlur),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden)},onTokenRemovedByUser:function(a){if(this.showGuidedSearch&&a.data){var b=a.data.text;this.updateQueryStates(b,"remove_refine")}this.navigateWithTokens()},onTypeaheadFieldFocus:function(){this.$el.addClass(CLASS_FIELD_FOCUS),this.showGuidedSearch&&this.tokenizedInput.setEditingTokenText()},onTypeaheadFieldBlur:function(){if(this.$el.removeClass(CLASS_FIELD_FOCUS),this.showGuidedSearch&&!this.showNewTypeahead){var a=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(a,!1)}},onTypeaheadHidden:function(){if(this.showGuidedSearch&&this.showNewTypeahead){var a=this.typeaheadField.getValue();this.tokenizedInput.setInputValue(""),this.updateSearchTokens(a,!1)}},navigateWithTokens:function(){var a=this.typeaheadField.getValue(),b=encodeURIComponent(a),c="/",d=this.currentScope||this.options.scope||"pins";b&&(c="/search/"+d+"/?q="+b,c+=this.constructQueryStatesParams()),this.options.navigate_on_search&&this.navigate(c)},tokenizeQuery:function(a){var b=a.split(/\s+/),c=_.find(b,function(a){return _.contains(P.CONST.SEARCH_FILTER_CONJUNCTIONS,a)});return c?[a]:b},updateSearchTokens:function(a,b){var c;if(b?(this.clearTypeaheadField(),c=a):c=this.tokenizedInput.setTokenValue(a),c){var d=this.tokenizeQuery(c),e=_.map(d,function(a){return{term:a,position:"1"}});this.addSearchInputTokens(e)}},onSearchQueryUpdated:function(a,b,c){var d=c||"";this.showGuidedSearch?this.typeaheadField.isFocussed()||(this.tokenizedInput.setInputValue(""),this.updateSearchTokens(d,!1)):this.setTypeaheadValue(d)},onSearchScopeUpdated:function(a,b,c){var d=c||"pins";this.currentScope=d,this.typeaheadField.setAutocompleteScope(d)},onSearchBoostUpdated:function(a,b,c){var d=c||"";this.currentBoost=d},onSearchGuideSelected:function(a,b,c){var d=c.term||"",e=c.position,f=c.color,g=c.index;if(d){var h=[{term:d,position:e,color:f}];this.addSearchInputTokens(h),this.updateQueryStates(d,"add_refine",g)}this.navigateWithTokens()},removeSearchInputToken:function(a){this.tokenizedInput.removeToken(a)},addSearchInputTokens:function(a){var b=_.map(a,function(a){return new P.modules.SearchInputToken({options:{term:a.term,position:a.position,color:a.color}})});this.tokenizedInput.addTokensAndUpdateInputView(b)},setTypeaheadValue:function(a){this.typeaheadField.setValue(a)},clearTypeaheadField:function(){this.typeaheadField.clear()},_getTypeaheadHighlightedItem:function(){return this.typeaheadField.getTypeaheadHighlightedItem()},focus:function(){this.typeaheadField.focus()},onSubmit:function(){var a=this._getTypeaheadHighlightedItem();if(a)return!1;var b=this.typeaheadField.getValue();if(""===$.trim(b))return P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED_WITH_EMPTY_QUERY,b),!1;this.showGuidedSearch&&(this.updateSearchTokens(b,!0),this.typeaheadField.abortSearch(),this.typeaheadField.blur());var c=encodeURIComponent(b),d=this.currentScope||this.options.scope||"pins";if(this.typeaheadField.setAutocompleteScope(d),this.options.navigate_on_search){var e="/search/"+d+"/?q="+c;"recent_week"===this.currentBoost&&(e="/search/pins/recent/?q="+c),this.showGuidedSearch&&(this.updateQueryStates(b,"typed"),e+=this.constructQueryStatesParams()),this.navigate(e)}return P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED,b),this.typeaheadField.blur(),this.typeaheadField.abortSearch(),!1},constructSingleQueryStateParam:function(a){var b="";return"typed"===a.type?b+=a.term+"|"+a.type:"recentsearch"===a.type||"autocomplete"===a.type?b+=a.term+"|"+a.type+"|"+a.index:"guide"===a.type&&(b+=a.term+"|"+a.type+"|"+a.filter_type+"|"+a.index),b},constructQueryStatesParams:function(){var a="",b=this;if(this.queryStates.length>0){var c=[];_.each(this.queryStates,function(a){c.push(b.constructSingleQueryStateParam(a))});var d={term_meta:c};this.queryStatesChange&&(d[this.queryStatesChange.action]=this.constructSingleQueryStateParam(this.queryStatesChange),this.queryStatesChange=null),a="&"+$.param(d)}return a},updateQueryStates:function(a,b,c){var d,e=this;if("typed"===b)this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){e.queryStates.push({term:a,type:b})});else if("recent_query"===b)this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){e.queryStates.push({term:a,type:"recentsearch",index:c})});else if(_.contains(["query","pin_search","board_search","people_search"],b))this.queryStates=[],d=this.tokenizeQuery(a),_.each(d,function(a){e.queryStates.push({term:a,type:"autocomplete",index:c})});else if("add_refine"===b)this.queryStates.push({term:a,type:"guide",filter_type:"word",index:c}),this.queryStatesChange={action:"add_refine",term:a,type:"guide",filter_type:"word",index:c};else if("remove_refine"===b){var f=_.find(this.queryStates,function(b){return b.term===a});f&&(this.queryStates.splice(_.indexOf(this.queryStates,f),1),f.action="remove_refine",this.queryStatesChange=f)}},onClick:function(){this.focus()}}),goog.provide("P.modules.AnswerLikeButton"),goog.require("P.Module"),goog.require("P.modules.QALikeButton"),P.modules.AnswerLikeButton=P.modules.QALikeButton.extend({getLikeResource:function(a){var b={answer_id:this.options.answer_id};return a&&(b.context_pin_id=this.options.context_pin_id),P.resourceFactory.create("AnswerLikeResource",b)},onToggleSuccess:function(a){var b=a?P.CONST.PUBSUB_TOPIC_ANSWER_LIKED:P.CONST.PUBSUB_TOPIC_ANSWER_UNLIKED;P.pubsub.publish(this.options.answer_id,b)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/AnswerLikeButton/AnswerLikeButton.nunjucks")}),goog.provide("P.modules.AnswersBase"),goog.require("P.modules.QAList"),P.modules.AnswersBase=P.modules.QAList.extend({_onQuestionAnswerCreated:function(){}}),goog.provide("P.modules.BoardInvites"),goog.require("P.Module"),goog.require("P.modules.BoardInvite"),P.modules.BoardInvites=P.Module.extend({onContentReady:function(){if(!this.options.pending){var a=this.resource.options.board_id,b={};b[P.CONST.PUBSUB_TOPIC_BOARD_APPROVED_COLLABORATOR_INVITE]=this.onApprovedCollaboratorInvite,this.pubsubSubscribe(a,b)}this.childListen(P.CONST.EVENT_BOARD_CREATE_USER_REMOVED,this.onInviteeRemoved),this.boardCreateInvitees=[]},onApprovedCollaboratorInvite:function(a,b,c){this.addInvitee({type:"pinner",userId:c.userId})},onInviteeRemoved:function(a){var b=a.data.type,c=a.data.identifier;this.boardCreateInvitees=_.filter(this.boardCreateInvitees,function(a){return b!==a.type||c!==a.identifier})},getSelectedInvitees:function(a){var b=_.filter(this.boardCreateInvitees,function(b){return a===b.type});return _.pluck(b,"identifier")},hasSelectedInvitee:function(a){var b=!1;return _.each(this.boardCreateInvitees,function(c){c.type===a.type&&c.identifier===a.identifier&&(b=!0)}),b},_createPinnerBoardEditInvite:function(a){var b=a.identifier,c={resource:{name:"BoardInviteResource",options:{board_id:this.resource.options.board_id,invited_user_id:b,field_set_key:"boardEdit"}}};return new P.modules.BoardInvite(c)},_createPinnerBoardCreateInvite:function(a){var b=a.identifier,c={resource:{name:"UserResource",options:{user_id:b,field_set_key:"board_invite"}},options:{view_type:"boardCreate",identifier:b}};return new P.modules.BoardInvite(c)},_createEmailBoardCreateInvite:function(a){var b=a.identifier;return new P.modules.BoardInvite({options:{view_type:"email",identifier:b}})},_createFacebookBoardCreateInvite:function(a){var b=a.attributes,c=a.identifier,d=b.name,e=b.send_pin_image;return new P.modules.BoardInvite({options:{view_type:"facebook",identifier:c,name:d,image:e}})},addInvitee:function(a){var b,c=this.options.view_type,d=this.getChildById("boardInvitesPagedGrid"),e=a.type,f=this;if(this.hasSelectedInvitee(a)){var g={name:"ConfirmDialog",options:{message:P._("That user has already been invited to add Pins on this board!")}};P.loadModule(g,function(a){f.showInModal(a)})}else"boardCreate"===c?(b="email"===e?this._createEmailBoardCreateInvite(a):"facebook"===e?this._createFacebookBoardCreateInvite(a):this._createPinnerBoardCreateInvite(a),this.boardCreateInvitees.push({type:e,identifier:a.identifier})):b=this._createPinnerBoardEditInvite(a);b&&b.render(function(){d.prependChildItem(b)})}}),goog.provide("P.modules.BusinessAccountCreate"),goog.require("P.Module"),goog.require("P.modules.BusinessAccountCreateBase"),P.modules.BusinessAccountCreate=P.modules.BusinessAccountCreateBase.extend({onContentReady:function(){if(P.currentUser.isAuthenticated())if(P.currentUser.attributes.is_partner)this.navigate("/business/getstarted/");else{var a={name:"ConfirmDialog",options:{template:"confirm_create_a_business"}},b=this;P.loadModule(a,function(a){b.showInModal(a),b.listen(a,P.CONST.EVENT_DIALOG_BUTTON_CLICKED,b.onConfirmClick)})}P.modules.BusinessAccountCreateBase.prototype.onContentReady.call(this)},onConfirmClick:function(a){var b=$(a.data),c="";b.hasClass("cancelConvert")?c="/":b.hasClass("continueConvert")&&(c="/logout/?next=/business/create/"),this.navigate(c)}}),goog.provide("P.modules.ConversationHead"),goog.require("P.modules.Token"),P.modules.ConversationHead=P.modules.Token.extend({events:{"click .headWrapper":"onClick"},onContentReady:function(){this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_READY,null,!0)},getBadgeCount:function(){return this.options.badge_count},setBadgeCount:function(a){this.options.badge_count=a,this.render()},getUsers:function(){return this.options.users||[]},toggleDroppableHover:function(a){this.$el.toggleClass(P.CONST.CLASS_DROPPABLE_HOVER,a)},getUserIds:function(){return _.pluck(this.getUsers(),"id")},getExternalEmails:function(){return this.options.emails||[]},getAllUserIds:function(){return this.getUserIds().concat(this.getExternalEmails())},getFirstUserId:function(){return this.getAllUserIds()[0]},onClick:function(){this.setBadgeCount(0),this.triggerEvent(P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,null,!1)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationHead/ConversationHead.nunjucks")}),goog.provide("P.modules.CreateConversationGroup"),goog.require("P.conversationsUtil"),goog.require("P.Module"),goog.require("P.modules.ConversationHead"),P.modules.CreateConversationGroup=P.Module.extend({mixins:[P.Mixins.PreventScroll,P.Mixins.SocialConnectInTypeahead],events:{"click .tokenized":"onTokenizedAreaClick"},focus:function(){var a=this.getTypeaheadField();a.focus()},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClicked),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentChanged),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onTypeaheadHint),this.childListen(P.CONST.EVENT_TOKEN_REMOVED,this.onTokenRemoved),this.childListen(P.CONST.EVENT_TOKEN_ADDED,this.onTokenAdded),this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClicked),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.userIds=[],this.emails=[],this.initSocialConnectItems()},getTokenizedInput:function(){return this.getTypeaheadField().getChildById("tokenizedInput")},onContentChanged:function(a){var b=this.getMessageValue(),c=a.target,d=c.id;"textField"===d&&this.setSendButtonEnabled(this._getTotalUsersCount()&&b.length?!0:!1)},onTypeaheadHint:function(){this.updateTypeaheadStaticItems(this.getTypeaheadField(),!0)},getTypeaheadField:function(){return this.getChildById("searchField")},onTokenizedAreaClick:function(){this.focus()},onTokenAdded:function(a){var b=a.data,c=b.getUsers(),d=b.getFirstUserId();c.length>0?this.userIds.push(d):this.emails.push(d),this._setListItemWithUserId(d,!0),this.focus()},onTokenRemoved:function(a){var b=a.data,c=b.getFirstUserId(),d=_.indexOf(this.userIds,c),e=_.indexOf(this.emails,c);-1!==d?this.userIds.splice(d,1):-1!==e&&this.emails.splice(e,1),this._setListItemWithUserId(c,!1),this._getTotalUsersCount()||this.setSendButtonEnabled(!1),this.focus()},_getTotalUsersCount:function(){return this.userIds.length+this.emails.length},_setListItemWithUserId:function(a,b){this._getConversationsList().setListItemWithUserId(a,b)},_getConversationsList:function(){return this.getChildById("convosList")},onContentReady:function(){this._setup(),this.focus(),this.startPreventingScroll()},adjustTokenizedInputWidth:function(){var a=this.getTypeaheadField(),b=this.getWidth(),c=10,d=this.$(".placeholder").width();a.getContent().width(b-2*c-d)},onTypeaheadItemSelected:function(a){a.stopPropagation();var b=a.target;b.parent.reset();var c,d=a.data.item.attributes,e=d.email,f=d.network;return f?void this.connectToNetwork(f,_.bindFn(this.markNetworkConnected,this,this.getTypeaheadField())):(c=e?{id:e}:{id:d.id,username:d.username,image_large_url:d.image_medium_url},void this._addConversationHeadAsToken(c))},_addConversationHeadAsToken:function(a){var b=this,c=this.getTokenizedInput(),d=c.getTokens(),e=_.find(d,function(b){return b.getFirstUserId()===a.id});if(!e){var f={size:"small",users:[],emails:[]};a.username?f.users=[a]:f.emails=[a.id];var g=new P.modules.ConversationHead({options:f});g.render().then(function(){b.setSendButtonEnabled(!0),c.addTokensAndUpdateInputView([g])})}this.focus()},_setup:function(){this.inDom&&this.contentReady&&(this.adjustTokenizedInputWidth(),this.focus())},setSendButtonEnabled:function(a){var b=this.getChildById("sendToGroupButton"),c=this.getMessageValue();c.length?b&&(a?b.enable():b.disable()):b.disable()},_removeHeadForUser:function(a){var b=this.getTokenizedInput(),c=b.getTokens();_.each(c,function(c){a.id===c.getFirstUserId()&&b.removeToken(c)})},_addUserAsToken:function(a){this._addConversationHeadAsToken(a)},onListItemClicked:function(a){a.stopPropagation();var b=a.target,c=b.getFirstUser();b.isActive()?this._removeHeadForUser(c):(b.setActive(!0),this._addUserAsToken(c))},onAddedToDom:function(){this._setup()},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList"),this.$(".List"))},getMessageValue:function(){return this.getChildById("textField").getValue()},onButtonClicked:function(a){var b=a.target.id;"sendToGroupButton"===b&&this.triggerEvent(P.CONST.EVENT_SEND_OBJECT_TO_USERS,{user_ids:this.userIds,emails:this.emails,text:this.getMessageValue()},!0)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/CreateConversationGroup/CreateConversationGroup.nunjucks")}),goog.provide("P.modules.DefamationForm"),goog.require("P.Module"),goog.require("P.modules.TakedownFormBase"),P.modules.DefamationForm=P.modules.TakedownFormBase.extend({}),goog.provide("P.modules.DmcaLinkForm"),goog.require("P.Module"),goog.require("P.modules.TakedownFormBase"),P.modules.DmcaLinkForm=P.modules.TakedownFormBase.extend({}),goog.provide("P.modules.DmcaPinForm"),goog.require("P.Module"),goog.require("P.modules.TakedownFormBase"),P.modules.DmcaPinForm=P.modules.TakedownFormBase.extend({}),goog.provide("P.modules.Dropdown"),goog.require("P.modules.PositionModule");var CLASS_DROPDOWN_ACTIVE="active",DROPDOWN_CONTAINER_CLASS="dropdownContainer";P.modules.Dropdown=P.modules.PositionModule.extend({events:{keyup:"_onKeyUp"},_onKeyUp:function(a){switch(a.keyCode){case P.keyCode.ESCAPE:a.stopPropagation(),a.stopImmediatePropagation(),this.hide()}},onCreated:function(){P.modules.PositionModule.prototype.onCreated.apply(this,arguments),this.showing=!1,this.childListen(P.CONST.EVENT_DISMISS,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.hide),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE_NOT_PROPAGATE,this.hideWithoutTriggering),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY_WITHOUT_FRIENDS,this.onIsEmptyWithoutFriends),this.childListen(P.CONST.EVENT_CONVERSATIONS_IS_EMPTY,this.onIsEmpty),this.options.persist_through_navigate||this.childListen(P.CONST.EVENT_NAVIGATE,this.hide),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.hide),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.positionModule),this.childListen(P.CONST.EVENT_CHANGE,this.positionModule)},onAddClassForChild:function(a){var b=a.data;this.$el.addClass(b)},onIsEmpty:function(){this.$el.addClass("isEmpty")},onIsEmptyWithoutFriends:function(){this.$el.addClass("isEmptyWithoutFriends")},_positionIfReady:function(){this.inDom&&this.contentReady&&(this.positionModule(),this.ensureHoverIntent(),this.getPositionAnchor().initHovering())},onAdded:function(){this.options.prefetch&&(this.options.prefetch=!1,this.render())},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},getLoadingSpinnerOptions:function(){return _.extend(P.modules.PositionModule.prototype.getLoadingSpinnerOptions.call(this),{size:P.Spinner.Size.SMALL})},render:function(a){this.renderContainer();var b=this.$el;this.options.append_to_closeup?$(".Closeup").append(b):$("body").append(b);var c=_.bindFn(function(){this.contentReady=!0,this.onContentReady(),a&&a()},this),d=this.getPositionElement();this.options.title&&d.append('<h2 class="dropdownTitle">'+this.options.title+"</h2>"),this.options.text&&d.append('<p class="dropdownText">'+this.options.text+"</p>"),this.options.module?P.loadModule(this.options.module,_.bindFn(function(a){this.setContentModule(a);var b=a.data?a.renderExistingData():a.render();b.then(c),this.options.display_while_loading&&c()},this)):c(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0)},setSticky:function(a){var b=_.clone(this.options);b.sticky=a,this.setOptions(b)},ensureHoverIntent:function(){var a=this;this.parent.isClickButton&&!this.parent.isClickButton()&&(this._hoverIntent||this.options.manually_close||(this._hoverIntent=new P.HoverIntent(this.$el,{exitDelay:500}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){a.getPositionAnchor().isHovering()||a.hide()})))},_hide:function(){this.showing=!1,this.$el.removeClass(CLASS_DROPDOWN_ACTIVE),this._bodyListener&&(this.removeListener(this._bodyListener),this._bodyListener=null)},hideWithoutTriggering:function(){this._hide()},hide:function(){if(this._hide(),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),this.children.length){var a=this.children[0];a.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_HIDDEN,null)}},ensureModule:function(a){var b=this;return a=a||P.NOOP,this.rendering||this.getContentModule()?a():(this.rendering=!0,void this.render(function(){return b.rendering=!1,a()}))},ensureOpenListeners:function(){this.options.sticky||(this._bodyListener=this.listen($(document),"mousedown",function(a){$(a.target).closest(this.$el).length>0||$(a.target).closest(this.options.anchor).length>0||this.options.preserve_dropdown_on_body_mousedown||this.hide()}))},isShowing:function(){return this.showing},updateMaxHeight:function(){if(this.children.length){var a=this.children[0];if(this.options.constrain_height){var b=a.getHeight(!0),c=parseInt(this.$el.css("top"),10)||0,d=Math.max(P.Viewport.height-c-P.CONST.PIN_MARGIN,0);b>d&&a.getContent().css({"max-height":d,"overflow-y":"auto"})}}},show:function(a){this.showing=!0;var b=this;this.ensureOpenListeners(),this.ensureModule(function(){if(b.showing){if(b.$el.addClass(CLASS_DROPDOWN_ACTIVE),b.positionModule(),b.updateMaxHeight(),b.children.length){var c=b.children[0];c.trigger(P.CONST.EVENT_DROPDOWN_CONTAINER_SHOWN,null),c.focus()}a&&a()}b.triggerEvent(P.CONST.EVENT_DROPDOWN_SHOW,null,!0)})},reposition:function(a){this.showing&&(this.$el.addClass(CLASS_DROPDOWN_ACTIVE),this.positionModule(),this.updateMaxHeight(),a&&a())},fadeIn:function(a,b){var c=this;this.show(function(){c.$el.addClass("fadeIn"),b&&b()})},getDropdown:function(){return this.$("."+DROPDOWN_CONTAINER_CLASS)},isVisible:function(){return this.$el.hasClass(CLASS_DROPDOWN_ACTIVE)},setVisible:function(a){return this.$el.toggleClass(CLASS_DROPDOWN_ACTIVE,a)},isHovering:function(){return this.$el.isHovering()},initHovering:function(){this.$el.initHovering()},getContentModule:function(){return this.children[0]},setContentModule:function(a){var b=this.getContentModule();b&&b.destroy(),this.insertChild(a,this.getPositionElement())},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/Dropdown/Dropdown.nunjucks")}),goog.provide("P.modules.DropdownButton"),goog.require("P.Module"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown");var TUTORIAL_DROPDOWN="tutorialDropdown",CLICK="click",HOVER="hover",OPEN_STRATEGY={};OPEN_STRATEGY[CLICK]=CLICK,OPEN_STRATEGY[HOVER]=HOVER,P.modules.DropdownButton=P.modules.Button.extend({onClick:function(a){var b=!1;if(this.options.check_write_banned&&P.currentUser.isWriteBanned()&&(b=!0),b)P.writeban.showWriteBanned(this);else{if(this.openStrategy===HOVER)return!1;this._ensureDropdown();var c=this._dropdown.isVisible();c?this.hideDropdown():this.showDropdown()}this._logContextEvent(a),a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault()},setHighlight:function(a){this.$el.toggleClass(P.CONST.CLASS_BUTTON_HIGHLIGHTED,a)},onCreated:function(){this._dropdown=null,this.openStrategy=this.options.show_dropdown_on_hover?OPEN_STRATEGY[HOVER]:OPEN_STRATEGY[CLICK]},getDropdown:function(){return this._ensureDropdown(),this._dropdown},getDropdownOptions:function(){return this.options.dropdown_options||{}},getContentModuleLoadOptions:function(){return this.options.module},_ensureDropdown:function(){if(!this._dropdown){var a,b=this.options.anchor_selector;b&&(a="."+b);var c={anchor:a?a:this.$el,module:this.getContentModuleLoadOptions()};_.extend(c,this.getDropdownOptions()),this._dropdown=new P.modules.Dropdown({id:"dropdown",options:c}),this._dropdown.initHovering(),this.listen(this._dropdown,P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.addChild(this._dropdown)}},onMouseEnterComplete:function(){this.isHoverEnabled()&&this.$el.isHovering()&&this.showDropdown()},showDropdown:function(a){this.setActiveStyle(!0),this.hideTutorial(),this._ensureDropdown(),this._dropdown.show(a)},hideDropdown:function(){this.setActiveStyle(!1),this._ensureDropdown(),this._dropdown.hide()},isDropdownVisible:function(){return this._ensureDropdown(),this._dropdown.isVisible()},onMouseOutComplete:function(){this._ensureDropdown(),this._dropdown.isHovering()||this.hideDropdown()},initListeners:function(){var a=this;this.openStrategy!==CLICK&&(!this._hoverIntent||this._hoverIntent.isElement(this.$el))&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:5,exitDelay:200}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,function(){a.onMouseEnterComplete()}),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,function(){a.onMouseOutComplete()}))},onButtonClick:function(a){a.stopPropagation()},onContentReady:function(){var a=!!this.getDropdownOptions().prefetch;
a&&this._ensureDropdown(),this.$el.initHovering(),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_TUTORIAL_SHOW,this.showTutorial),this.initListeners(),this.options.tutorial&&this.options.tutorial.topic&&this.options.tutorial.show&&this.showTutorial()},onDropdownHide:function(){this.setActiveStyle(!1)},ensureTutorialDropdown:function(){if(!this.getChildById(TUTORIAL_DROPDOWN)){var a=_.extend({},this.options.dropdown_options,{title:this.options.tutorial.title,text:this.options.tutorial.text,anchor:this.$el,class_name:"tutorial",largeCaret:!1}),b=new P.modules.Dropdown({id:TUTORIAL_DROPDOWN,options:a});this.appendChild(b)}return this.getChildById(TUTORIAL_DROPDOWN)},onShowTutorial:function(){this.showTutorial()},isClickButton:function(){return this.openStrategy===CLICK},showTutorial:function(){if(this.options.tutorial){var a=this.ensureTutorialDropdown();a.fadeIn(1e3),this.setExperienceViewed()}},hideTutorial:function(){if(this.options.tutorial){var a=this.getChildById(TUTORIAL_DROPDOWN);a&&a.destroy(),this.setExperienceCompleted()}},setExperienceViewed:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var a=P.ExperienceManager.instance();a.viewPlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},setExperienceCompleted:function(){if(this.options.tutorial.experienceId&&this.options.tutorial.placementId){var a=P.ExperienceManager.instance();a.completePlacedExperience(this.options.tutorial.placementId,this.options.tutorial.experienceId)}},isHoverEnabled:function(){return this.options.disabled!==!0&&this.openStrategy!==CLICK},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/DropdownButton/DropdownButton.nunjucks")}),goog.provide("P.modules.Grid"),goog.require("P.Module"),goog.require("P.modules.GridFooter"),goog.require("P.modules.GridItems");var ERROR_CLASS="hasError";P.modules.Grid=P.Module.extend({DRAGGING_ENABLED:"draggingEnabled",DRAGGING_DISABLED:"draggingDisabled",onContentReady:function(){this.options.show_grid_footer&&(this.childListen(P.CONST.EVENT_ERROR,this.onError),this.childListen(P.CONST.EVENT_ERROR_RESOLVED,this.onErrorResolved),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_START,this.onItemsRequestStart),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onItemsRequestSuccess),this.childListen(P.CONST.EVENT_ITEMS_END,this.onItemsEnd),this.items=this.getChildByModuleName("GridItems"),this.footer=this.getChildByModuleName("GridFooter"),this._initializeDragManagerIfPossible(),this.footer&&this.hasItems()&&this.footer.show()},onResize:function(){this.items.onResize()},hasItems:function(){return this.items.hasItems()},hasItemsOfType:function(a){return!!this.items.getChildrenByModuleName(a).length},hasMoreItems:function(){return this.items.hasMoreItems()},getGridItemsChildren:function(){var a=this.getGridItems();return a.getChildren()},requestMoreItems:function(){this.items.requestMoreItems()},emptyItems:function(){this.items.empty()},renderItems:function(a,b){this.items.render(a,b)},setPageSize:function(a){this.items.setPageSize(a)},getItemsResource:function(){return this.items.resource},setItemsResource:function(a){this.setResource(a),this.items&&this.items.setResource(a)},onError:function(){this.hasError=!0,this.$el.addClass(ERROR_CLASS),this.footer&&(this.footer.showError(),this.footer.hideGridLoading())},onErrorResolved:function(){this.hasError&&(this.hasError=!1,this.$el.removeClass(ERROR_CLASS))},onButtonClick:function(a){return"gridFooter"===a.target.id&&this.requestMoreItems(),!1},onItemsRequestStart:function(){this.footer&&this.footer.showGridLoading()},_initializeDragManagerIfPossible:function(){P.experiments.instance.inExperimentGroup("conversations","employees")&&(this.items.initializeDragManager({}),this.dragState&&this.setDragState(this.dragState,!0))},setDragState:function(a,b){(this.dragState!==a||b)&&(this.dragState=a,this.dragState===this.DRAGGING_DISABLED?this.items.disableDragging():this.items.enableDragging())},onItemsRequestSuccess:function(){this._initializeDragManagerIfPossible(),this.footer&&this.footer.hideError()},onItemsEnd:function(){this.footer&&this.footer.hideGridLoading()},prependChildItem:function(a){this.getGridItems().prependChildItem(a)},prependNewItems:function(a,b){return this.getGridItems().prependNewItems(a,b)},getGridItems:function(){return this.items},getFirstGridItem:function(a){return this.getGridItems().getChildByModuleName(a)}}),goog.provide("P.modules.HeroBasic"),goog.require("P.Module"),goog.require("P.modules.HeroHelperBase"),P.modules.HeroBasic=P.modules.HeroHelperBase.extend({onContentReady:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.placementId=Number(this.extraData&&this.extraData.placement_id),this.experienceId=Number(this.extraData&&this.extraData.experience_id),this.placedExperienceId=this.extraData&&this.extraData.placed_experience_id,this.options.type=P.Experiences.ExperienceReverse[String(this.experienceId)],this.setExperienceViewed()},onButtonClick:function(a){var b=a.target;if("close"===b.id)return void this.dismiss();if(b.options)switch(b.options.action){case P.Experiences.ExperienceCompleteAction.COMPLETE:this.complete();break;case P.Experiences.ExperienceCompleteAction.COMPLETE_AND_SHOW:this.complete(!0);break;case P.Experiences.ExperienceCompleteAction.DONT_COMPLETE_AND_HIDE:this.hide();break;case P.Experiences.ExperienceCompleteAction.DONT_COMPLETE_AND_SHOW:break;default:this.hide()}}}),goog.provide("P.modules.Modal"),goog.require("P.interfaces.Modal"),goog.require("P.modules.PositionModule"),goog.require("P.ModalPresentationTypes"),goog.require("P.Module");var SHOW_CLASS="show",DURATION=300;P.modules.Modal=P.modules.PositionModule.extend({events:{"click .modalScroller":"onModalScrollerClick","click .modalContainer":"onModalContainerClick","click .closeModal":"onCloseModalClick"},positionMode:P.CONST.PositionMode.VIEWPORT_MIDDLE,onCreated:function(){P.modules.PositionModule.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onChildButtonClick)},_defineAnimations:function(){if("undefined"!==typeof Modernizr&&Modernizr.csstransforms3d){var a=this.getModule(),b="-"+a.getContent().css("width");$.keyframe.define([{name:"enter","0%":{transform:"translateX("+b+")",visibility:"visible"},"70%":{transform:"translateX(20px)",visibility:"visible"},"100%":{transform:"translateX(0px)",visibility:"visible"}}]),$.keyframe.define([{name:"dismiss","0%":{transform:"translateX(0px)",visibility:"visible"},"30%":{transform:"translateX(20px)",visibility:"visible"},"100%":{transform:"translateX("+b+")",visibility:"visible"}}])}},render:function(a){this.empty();var b=this.options.mask_type||"",c=this.options.container_class||"";this.$el.append('<div class="modalMask '+b+'"></div><div class="modalScroller"><div class="modalContainer '+c+'"><span class="positionModuleCaret"></span><div class="modalContent"><div class="modalModule"></div></div></div></div>'),this.getCanDismiss()&&this.$(".modalContent").append('<button class="Button closeModal inModal cancelButton borderless"><em></em>&nbsp;</button>');var d=this.getModule();return d&&(this.addModuleToContainer(d),d.options.transparent_modal&&this.setTransparentContent()),a&&a.call(this),Promise.resolve(void 0)},addModuleToContainer:function(a){var b=this;a.id="modalModule",a.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.insertChild(a,this.getModuleContainer()),a.contentReady?this.setupModule(a):(a.render(function(){b.setupModule(a)}),this.listen(a,P.CONST.EVENT_ERROR,function(a){var c=P.string.common.defaultErrorMessage;b.options.show_api_error&&a.data.message&&(c=a.data.message),P.showError(c),b.hide()}))},onChildRendered:function(a){this.setupModule(a)},setupModule:function(a){a.setModal(this),this._defineAnimations(),this.onRendered(),this.onContentReady()},_setPositionMode:function(a){switch(a){case P.ModalPresentationTypes.PANEL:this.positionMode=P.CONST.PositionMode.MANUAL;var b=_.invert(P.ModalPresentationTypes)[a].toLowerCase();this.$el.addClass(b)}},_showMask:function(){var a=this.getMask();P.dom.deferWrite().then(function(){a.addClass(SHOW_CLASS)})},show:function(){var a=this;this._setPositionMode(this.options.presentation_type||P.ModalPresentationTypes.FORM_SHEET),this.render(function(){a.log.debug("success")})},hide:function(){if(this._isPanel()){var a=this.getModuleContainer(),b=_.bindFn(function(){var b=this.getModule();b.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_END,null,!1),P.dom.deferWrite().then(function(){a.removeClass(SHOW_CLASS)}),this.destroy()},this),c=this.getModule(),d=this.getMask();P.dom.deferWrite().then(function(){d.removeClass(SHOW_CLASS)}),c.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,null,!1),a.playAnimationIfSupported({name:"dismiss",duration:DURATION},b)}else this.destroy()},onAddedToDom:function(){var a=this.options.can_scroll?!0:!1;P.Body.pushScrolling(a)},onRemovedFromDom:function(){P.Body.pop()},getModule:function(){return this.options.module},setTransparentContent:function(a){this.getContent().toggleClass("transparent",a);var b=this.options.show_close_button;b&&(a=!1),this.$(".closeModal").toggle(!a)},getContent:function(){return this.$(".modalContent")},getModuleContainer:function(){return this.$(".modalModule")},getMask:function(){return this.$(".modalMask")},getModalScroller:function(){return this.$(".modalScroller")},getFullName:function(){var a=P.Module.prototype.getFullName.call(this);return this.moduleOpener&&(a=this.moduleOpener.getFullName()+"#"+a),a},getPositionElement:function(){return this.$(".modalContainer")},setModule:function(a){var b=this.getChildById("modalModule");b&&(b.id="",b.remove()),this.options.module=a,b=this.$(".modalModule"),b.empty(),this.addModuleToContainer(a)},onChildRemoved:function(){this.getChildById("modalModule")||this.hide()},onChildButtonClick:function(a){var b=a.target;if(b&&b.isCancelButton()){var c=this.options.module,d=c.GACategory;d||(d=c.options.ga_category),d&&P.trackGAEvent(d,P.CONST.GA_ACTION_CLICK_CANCEL),a.stopPropagation(),this.hide()}},onModalScrollerClick:function(a){a.target===a.currentTarget&&(a.stopPropagation(),this.getCanDismiss()&&(this.hide(),this.getModule().triggerEvent(P.CONST.EVENT_DISMISS,null,!1)))},_isPanel:function(){return this.options.presentation_type===P.ModalPresentationTypes.PANEL},onModalContainerClick:function(a){a.target===a.currentTarget&&(a.stopPropagation(),this.onModalScrollerClick(a))},onCloseModalClick:function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.getModule().triggerEvent(P.CONST.EVENT_DISMISS,null,!1),this.destroy()},animatePanelIn:function(){var a=this,b=a.getModule(),c=_.bindFn(function(){P.dom.deferWrite().then(function(){a.getPositionElement().addClass(SHOW_CLASS),b.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,null,!1)})},a),d=a.getModuleContainer();this._showMask(),b.triggerEvent(P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,null,!1),d.playAnimationIfSupported({name:"enter",duration:DURATION},c)},onRendered:function(){P.modules.PositionModule.prototype.onRendered();var a=this.$el;this.positionModule(),this._isPanel()?this.animatePanelIn():P.dom.deferWrite().then(function(){a.addClass(SHOW_CLASS)}),this.options.transparent&&this.setTransparentContent(!0)},getCanDismiss:function(){var a=this.options.can_dismiss;return this._isPanel()&&(a=!1),void 0===a||a}}),goog.provide("P.modules.OAuthAuthorizationPage"),goog.require("P.modules.OAuthPageBase"),P.modules.OAuthAuthorizationPage=P.modules.OAuthPageBase.extend({onContentReady:function(){this.tryRedirect(this.data),this.form=new P.Form(this.$("form"),{}),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.authorizeConsumer),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},onButtonClick:function(a){return"cancelButton"===a.target.id?this.cancelAuthorization():void 0},authorizeConsumer:function(){var a=this.getChildById("submitButton");a.showLoading(),this.makeAuthorizationDecision(!0,a)},cancelAuthorization:function(){var a=this.getChildById("cancelButton");a.showLoading(),this.makeAuthorizationDecision(!1,a)}}),goog.provide("P.modules.PublicityRightsForm"),goog.require("P.Module"),goog.require("P.modules.TakedownFormBase"),P.modules.PublicityRightsForm=P.modules.TakedownFormBase.extend({}),goog.provide("P.modules.tutorials.ModalStepBase"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.Module"),goog.require("P.modules.tutorials.StepBase");var CLASS_TUTORIAL_HIGHLIGHT="tutorialHighlight",CLASS_TUTORIAL_HIGHLIGHT_MASK="tutorialHighlightMask",LINK_HREF_ATTR="href";P.modules.tutorials.ModalStepBase=P.modules.tutorials.StepBase.extend({highlightedElements:{},initializeStep:function(){this.listen(P.Viewport,P.CONST.EVENT_RESIZE,_.bindFn(this.onResize,this))},disableCloneLinks:function(a){var b=a.find("a");_.each(b,function(a){var b=$(a),c=b.attr(LINK_HREF_ATTR);b.attr("data-href",c).removeAttr(LINK_HREF_ATTR)})},disableButtonCloneLinks:function(a){a.removeAttr(LINK_HREF_ATTR)},setModalPosition:function(a,b,c,d){var e="VIEWPORT_MIDDLE";a&&b&&(e="ANCHORED",this.modal.options.position_point=a,this.modal.options.anchor=b),this.modal.options.position_mode=e,void 0!==d&&(this.modal.options.fixed=d),this.modal.options.caret=!0,c&&this.modal.positionModule()},setCloneInteractions:function(a){var b=$("body"),c=$('<div class="'+CLASS_TUTORIAL_HIGHLIGHT_MASK+'"/>');c.addClass(CLASS_TUTORIAL_HIGHLIGHT),b.append(c),a.$mask=c,this.disableCloneLinks(a)},setCloneDimensions:function(a,b){var c=b.outerWidth()+1,d=b.outerHeight()+1;a.css({width:c,height:d,"box-sizing":"border-box"})},ensurePath:function(a){window.location.pathname!==a&&this.navigate(a)},cleanHighlightedElements:function(){$("."+CLASS_TUTORIAL_HIGHLIGHT).remove(),this.highlightedElements={}},_getModuleChildById:function(a,b){var c=a._childrenIdMap[b];if(c)return c;for(var d,e=0,f=a.children.length;e<f;e++)if(d=a.children[e],c=this._getModuleChildById(d,b))return c},_getModuleChildrenByModuleName:function(a,b){var c=[],d=this;return _.each(a.children,function(a){a.className===b&&c.push(a),c=c.concat(d._getModuleChildrenByModuleName(a,b))}),c},_highlightModule:function(a,b){return this._highlightElement(a.cid,a.$el,b)},_highlightElement:function(a,b,c){var d;if(c){d=b.clone(),d.$origin=b,d.attr("id",a),d.addClass(CLASS_TUTORIAL_HIGHLIGHT),this.highlightedElements[a]=d;var e=$("body");e.append(d),this.setCloneInteractions(d),this.setCloneDimensions(d,b),this.positionClone(d)}else d=this.highlightedElements[a],d&&(d.remove(),delete this.highlightedElements[a]);return d},positionClone:function(a){var b=a.$origin.parents().addBack();b.css("animation-duration","0s"),_.defer(_.bindFn(function(){var c=a.$origin.offset();c={top:c.top,left:c.left};var d=c.top-$(window).scrollTop();d>0&&(c.top=d),a.css(c),a.$mask&&(a.$mask.css(c),a.$mask.css({height:a.outerHeight(),width:a.outerWidth()})),this.modal&&this.modal.positionModule(),b.css("animation-duration","")},this))},onResize:function(){_.each(this.highlightedElements,_.bindFn(this.positionClone,this))},onRemoved:function(){this.cleanHighlightedElements()}}),goog.provide("P.modules.tutorials.NewUserStepBase"),goog.require("P.Module"),goog.require("P.modules.tutorials.StepBase"),goog.require("P.modules.NuxProgress"),P.modules.tutorials.NewUserStepBase=P.modules.tutorials.StepBase.extend({onContentReady:function(){this.nuxProgress=P.app.getChildByModuleName("NuxProgress"),this.nuxProgress.initializeProgress({module:this})},hideStepHeader:function(){var a=this.$(".newUserStepHeader");a.addClass("hidden")}}),goog.provide("P.modules.ui.DatePickerField"),goog.require("P.modules.ui.Field"),P.modules.ui.DatePickerField=P.modules.ui.Field.extend({onContentReady:function(){P.modules.ui.Field.prototype.onContentReady.apply(this),this.childListen(P.CONST.EVENT_DATEPICKER_DATE_SELECTED,this.onDateSelected);var a={module:{name:"ui.DatePicker",options:{selection_mode:"single",utc:this.options.utc,min_date:this.options.min_date,max_date:this.options.max_date}},anchor:this.$el,display_while_loading:!0,position_point:this.options.position_point||"BOTTOM_CENTER"};this._dropdown=new P.modules.Dropdown({options:a}),this.addChild(this._dropdown)},onDateSelected:function(a){var b=a.data||{},c=b.dates;c&&(this.setValue(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()),this._dropdown.hide())},syncDatePickerWithInputField:function(){var a=$.trim(this._field.getValue()).toLowerCase(),b=this._dropdown.getContentModule();b&&b.setSelectedDate(a)},onInputFocus:function(){this._dropdown.show(_.bindFn(this.syncDatePickerWithInputField,this)),this.el.scrollIntoView(!0)},onInputBlur:function(){},onInputKeyup:function(){this.syncDatePickerWithInputField()}}),goog.provide("P.modules.ui.FollowButton"),goog.require("P.modules.Button"),goog.require("P.modules.Dropdown");var UNFOLLOW_CLASS="dim",FOLLOW_CLASS="primary",MEMO_DROPDOWN="memoDropdown";P.modules.ui.FollowButton=P.modules.Button.extend({getResourceId:function(){return null},getFollowResource:function(){return null},getFollowClass:function(){return FOLLOW_CLASS},getUnfollowClass:function(){return UNFOLLOW_CLASS},toggleState:function(){this.setState(!this.options.followed),this.trigger("toggleFollow"),this.getResourceId()&&P.pubsub.publish(this.getResourceId(),this.options.followed?P.CONST.PUBSUB_TOPIC_USER_FOLLOW:P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW,!0)},setState:function(a){this.$el.addClass(a?this.getUnfollowClass():this.getFollowClass()),this.$el.removeClass(a?this.getFollowClass():this.getUnfollowClass()),this.$el.text(this.options[a?"unfollow_text":"follow_text"]),this.options.followed=a},getState:function(){return this.options.followed},toggleFollow:function(){var a=this.getFollowResource(),b=this.options.followed?"delete":"create";if(!a)return void this.log.error("No resource returned in `getFollowResource()`");this.showLoading();var c=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category,d=this;a.call(b,{success:function(){c&&P.trackGAEvent(c,P.CONST.GA_ACTION_SUCCESS),d.toggleState()},error:function(a){P.showError(a.message),c&&P.trackGAEvent(c,P.CONST.GA_ACTION_ERROR)},complete:function(){d.hideLoading()}})},onClick:function(){if(this.ensureAuthentication()&&!this.options.is_me){var a=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;return a&&P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.toggleFollow(),!1}},getAuthRedirectUrl:function(){return P.getRegisterUrl({action:"follow"})},hideMemo:function(){if(this.options.memo){var a=this.getChildById(MEMO_DROPDOWN);a&&a.fadeOut(function(){a.destroy()})}},showMemo:function(){var a=this.options.memo&&this.options.memo.show;if(a&&!this.getChildById(MEMO_DROPDOWN)){this.isClickButton=function(){return!1};var b={title:this.options.memo.title,anchor:this.$el,position_point:"RIGHT_CENTER",class_name:"autoFollowMemo",largeCaret:!1},c=new P.modules.Dropdown({id:MEMO_DROPDOWN,options:b});this.appendChild(c);var d=this;c.fadeIn(10,function(){P.setTimeout(function(){d.hideMemo()},2e3)})}}}),goog.provide("P.modules.ui.MetricGraph"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),goog.require("P.modules.ui.MetricPoint");var COLOR_SCHEMES={"default":["#367cbd","#c06506","#009e83"],"dark audience":["#8e498a","#bd82ba"],"dark domain":["#76c5d3","#a3eaf7"],"dark profile":["#acce6f","#d7ecb2"]};P.modules.ui.MetricGraph=P.Module.extend({events:{"click .legendColorBox":"onClickLegend","click .legendLabel":"onClickLegend",resize:"onResize"},graphContainer:function(){return this.$(".graphPlaceholder",this.el)},onCreated:function(){this.placeholder=void 0,this.disabledSeries={},this.resetCurrentHover()},onAddedToDom:function(){this._addedToDom=!0,this.trySetupGraph()},onContentReady:function(){this._contentReady=!0,this.trySetupGraph()},onRemoved:function(){this.hideDropdown()},render:function(){return this.disabledSeries={},P.Module.prototype.render.apply(this,arguments)},resizeGraph:function(){this.updateGraph()},trySetupGraph:function(){this._addedToDom&&this._contentReady&&(this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,this.resizeGraph),this._metricPointDropdown=null,this.updateGraph(),this.setupGraphClicks(),this.anchor=$("<em></em>").appendTo(this.$el))},onClickLegend:function(a){var b=$(a.target).attr("data-index");this.toggleSeries(b)},toggleSeries:function(a){this.disabledSeries[a]=!this.disabledSeries[a],this.updateGraph()},extractMetricSeries:function(a){var b=this.data.rows||this.data;return $.map(b,function(b){var c=1e3*b.timestamp,d=b[a]||0;return[[c,d]]})},_getMetricColor:function(a){var b=this.options.metric_group[a],c=this.options.metric_type_map[b];if(c&&c.graph_color)return c.graph_color;var d=COLOR_SCHEMES[this.options.color_scheme||"default"];return d[a%d.length]},_getMetricFormat:function(a){var b=this.options.metric_group[a],c=this.options.metric_type_map[b];return c&&c.format?c.format:null},buildTimeSeries:function(){var a=[];this.metricKeys=[];for(var b=0;b<this.options.metric_group.length;b++){var c=this.options.metric_group[b],d=[];this.metricKeys.push(this.options.metric_type_map[c].graph_name),this.disabledSeries[b]!==!0&&(d=this.extractMetricSeries(c)),a.push({data:d,label:this.options.metric_type_map[c].graph_name,color:this._getMetricColor(b)})}return a},updateGraph:function(){var a=this.buildTimeSeries();this.drawGraph(a)},tickGenerator:function(a){for(var b=a.max,c=a.gridHeight,d=Number(((b-c)/4).toPrecision(1)),e=Number((Math.round(c/d)+1)*d),f=[];e<b;)f.push(e),e+=d;return f},tickFormatterY:function(a,b){return a<0||a<b.min||a>b.max?"":b.max<1e6?a.toFixed(b.tickDecimals):(a/=1e6,a.toFixed(1)+"m")},timeFormatter:function(a,b,c){if(a<b.datamin||a>b.datamax)return"";var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=new Date(a),f=String(e.getUTCDate());return c||1===e.getUTCDate()?d[e.getUTCMonth()]+" "+f:f},seriesMinMax:function(a,b){for(var c=0,d=Number.MAX_VALUE,e=0;e<a.length;e++)for(var f=a[e].data,g=0;g<f.length;g++){var h=f[g][b];c=c>h?c:h,d=d<h?d:h}return{min:d,max:c}},seriesMinMaxY:function(a){var b=this.seriesMinMax(a,1),c=b.max-b.min;return 0===c?(b.min=0,b.max=1.2*b.max,c=b.max):(b.min-=.25*c,b.max+=.2*c),b.gridHeight=b.min+.15*c,b},seriesMinMaxX:function(a){var b=864e5,c=this.seriesMinMax(a,0),d=c.max-c.min,e=.08*d;return c.max+=Math.max(b,e),c.min-=Math.max(b,e),c},drawGraph:function(a){var b=this.graphContainer(),c=this.seriesMinMaxX(a),d=this.seriesMinMaxY(a),e=this.tickGenerator(d),f={series:{shadowSize:0,highlightColor:"rgb(230, 230, 230)",lines:{show:!0}},legend:{margin:[140,10],noColumns:3,backgroundOpacity:0,labelBoxBorderColor:"rgba(0,0,0,0)"},grid:{aboveData:!0,autoHighlight:!1,axisMargin:0,backgroundColor:"rgb(255, 255, 255)",borderColor:"rgb(230, 230, 230)",borderWidth:0,clickable:!0,hoverable:!0,labelMargin:0,markings:[{xaxis:{from:c.min,to:c.max},yaxis:{from:d.gridHeight,to:d.gridHeight},color:"rgb(129, 129, 129)"},{xaxis:{from:-1,to:-1},yaxis:{from:d.gridHeight,to:d.max},color:"rgb(214, 214, 214)"}],minBorderMargin:0},yaxis:{max:d.max,min:d.min,reserveSpace:!0,tickColor:"rgb(230, 230, 230)",tickFormatter:this.tickFormatterY,ticks:e},xaxis:{labelHeight:5,max:c.max,min:c.min,mode:"time",tickColor:"rgb(129, 129, 129)",tickFormatter:this.timeFormatter,tickLength:0},multihighlight:{mode:"x"}},g=$.plot(b,a,f);this.plotData=g.getData()},checkAndSetNewHover:function(a){var b,c=a.x,d=0,e=_.find(this.plotData,function(a){return a.data.length>0});if(!e)return null;for(b=0;b<e.data.length&&!(null==e.data[b]||e.data[b][0]>c);b++);if(0===b||b===e.data.length)return this.hideDropdown(),null;var f=e.data[b-1],g=e.data[b],h=c-f[0],i=g[0]-c;if(d=h<i?b-1:b,d===this.currentHover)return null;this.currentHover=d;var j=[];return _.each(this.plotData,function(a){j.push(a.data[d]||null)}),j},_ensureDropdown:function(){this._metricPointDropdown||(this._metricPoint=new P.modules.ui.MetricPoint,this._metricPointDropdown=new P.modules.Dropdown({options:{position_point:"RIGHT_CENTER"}}),this._metricPointDropdown.setContentModule(this._metricPoint),this.appendChild(this._metricPointDropdown))},onPointHovered:function(a){var b=this.checkAndSetNewHover(a);if(b){this._ensureDropdown();for(var c,d=0,e=1,f=this.plotData[0].xaxis.p2c,g=this.plotData[0].yaxis.p2c,h=this.graphContainer().offset(),i=0,j=0,k=0;k<b.length;k++)b[k]&&(c=b[k],i+=g(c[e]),++j);if(0!==j){var l=i/j,m=h.left+f(c[d])+20,n=m+this._metricPointDropdown.getWidth(),o=h.left+this.graphContainer().width();n>o?(this.anchor.css({top:h.top+l,left:m-40}),this._metricPointDropdown.options.position_point="LEFT_CENTER"):(this.anchor.css({top:h.top+l,left:m}),this._metricPointDropdown.options.position_point="RIGHT_CENTER"),this._metricPointDropdown.options.anchor=$(this.anchor),this._metricPointDropdown.show();var p=[];for(k=0;k<b.length;k++)b[k]&&p.push({metric:this.metricKeys[k],value:this.formatValue(b[k][e],this._getMetricFormat(k)),value_color:this._getMetricColor(k)});this._metricPoint.options={date:this._metricPoint.formatDate(new Date(c[d])),metric_values:p},this._metricPoint.render()}}},formatValue:function(a,b){return b&&"USD"===b?"$"+P.number.formatUSD(a):a},onPointUnhovered:function(){this.hideDropdown()},hideDropdown:function(){this._metricPointDropdown&&this._metricPointDropdown.hide(),this.resetCurrentHover()},resetCurrentHover:function(){this.currentHover={}},setupGraphClicks:function(){var a=this,b=this.graphContainer();b.bind("plothover",function(b,c){a.onPointHovered(c)}),b.bind("mouseout",function(){a.onPointUnhovered()})}}),goog.provide("P.modules.ui.Picker"),goog.require("P.Module"),goog.require("P.modules.ui.SelectList"),P.modules.ui.Picker=P.Module.extend({events:{keydown:"_onKeydown","textchange .name":"_onNameTextChange"},onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onChildButtonClick),this.childListen(P.CONST.EVENT_ITEM_CLICK,this._onChildItemClick),this._list=null,this._addedCreateItem=!1},onContentReady:function(){this._list=this.getChildById("list"),this._addedCreateItem=!1},focus:function(){this.$(".name").focusWithoutScrolling(),this._list.scrollSelectedItemElementIntoView()},_create:function(){return Promise.reject(new Error("subclasses must override this"))},_createAndSubmit:function(a){var b=this;this.showLoading(),this._create(a).then(function(a){return b._submit(a),b.options.skip_append_created_item?void 0:b._list.appendItem(a,!0)}).fin(function(){b.hideLoading()})},_createFromInputNameAndSubmit:function(){var a=this._getNameInputText();this._createAndSubmit(a)},_getNameInputText:function(){return $.trim(this.$(".name").val())},_handleChoice:function(a){if(a.is_create)this._createFromInputNameAndSubmit();else if(a.is_create_suggestion){var b=a.name;this._createAndSubmit(b)}else this._submit(a)},_onChildButtonClick:function(a){var b=a.target;b&&"createButton"===b.id&&this._createFromInputNameAndSubmit()},_onChildItemClick:function(a){var b=a.target;if(b&&"list"===b.id){var c=a.data;this._handleChoice(c)}},_onKeydown:function(a){if(this._list.hasVisibleItems())switch(a.keyCode){case P.keyCode.UP:a.preventDefault(),a.stopPropagation(),this._list.highlightUp();break;case P.keyCode.DOWN:a.preventDefault(),a.stopPropagation(),this._list.highlightDown();break;case P.keyCode.ENTER:case P.keyCode.NUMPAD_ENTER:a.preventDefault(),a.stopPropagation();var b=this._list.getSelectedItemData();this._handleChoice(b?b:{name:this._getNameInputText(),is_create:!0})}},_onNameTextChange:function(){var a=void 0!==this.options.allow_create?this.options.allow_create:!0;if(a&&!this._addedCreateItem){var b={};this.options.create_item_label&&(b.create_item_label=this.options.create_item_label),this._list.appendItem({type:"module",name:"ui.PickerItemCreate",options:b,data:{is_create:!0}}),this._addedCreateItem=!0}var c=this._getNameInputText(),d=function(a){var b=_.map(a,function(a){return a.data.name}),d=P.filter.match(c,b),e=_.map(d.itemMatched,function(b,e){var f=a[e],g=f.data;if(g.is_create){var h=!!c&&!d.hasExactMatch,i=f;return i.setCreateName(c),h}return b});return e};this._list.setItemVisibilityCallback(d)},_submit:function(a){this.triggerEvent(P.CONST.EVENT_CHANGE,a,!0)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/Picker/Picker.nunjucks")}),goog.provide("P.modules.ui.TableLookalikePicker"),goog.require("P.modules.ui.Picker"),P.modules.ui.TableLookalikePicker=P.modules.ui.Picker.extend({moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/TableLookalikePicker/TableLookalikePicker.nunjucks")}),goog.provide("P.modules.ui.TypeaheadField"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),P.modules.ui.TypeaheadField=P.Module.extend({events:{"input .field":"onFieldInput","blur .field":"onFieldBlur","focus .field":"onFieldFocus","keyup .field":"onFieldKeyup","keydown .field":"onFieldKeydown","textchange .field":"onFieldTextChange"},onCreated:function(){this.valueFromHighlight=!1,this.showNewTypeahead=!!this.options.support_advanced_typeahead,this.showGuidedSearch=!!this.options.support_guided_search},_getTypeahead:function(){return this.showNewTypeahead?this.getChildById("typeaheadDropdown").getContentModule():this.getChildById("typeahead")},onFieldTextChange:function(){this.search()},initTypeahead:function(){this.showNewTypeahead?(this.initTypeaheadDropdown(),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown)):(this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onChildItemHighlighted),this.childListen(P.CONST.EVENT_TYPEAHEAD_MOUSEDOWN,this.onTypeaheadMousedown),this.options.show_caret&&(this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_HIDDEN,this.onTypeaheadHidden),this.childListen(P.CONST.EVENT_TYPEAHEAD_SHOWN,this.onTypeaheadShown)))},initTypeaheadDropdown:function(){this.typeaheadDropdown=new P.modules.Dropdown({id:"typeaheadDropdown",options:{class_name:"typeaheadDropdown",fixed:!0,hide_caret:!0,position_mode:P.CONST.PositionMode.MANUAL,prefetch:!0,preserve_dropdown_on_body_mousedown:!0,module:{name:"ui.Typeahead",options:{bypass_lru_cache:this.options.bypass_lru_cache,bypass_maxheight:!0,class_name:"centeredWithinWrapper",enable_recent_queries:this.options.enable_recent_queries,exclude_non_followers:this.options.exclude_non_followers,minimum_term_character_length:this.options.minimum_term_character_length,num_places:this.options.num_places,resource_name:this.options.resource_name,should_geocode:this.options.should_geocode,tags:this.options.tags,template:this.options.template,use_tab_index:this.options.use_tab_index,view_type:"expanded"}}}}),this.addChild(this.typeaheadDropdown)},hideTypeaheadUnlessPreserved:function(){this.options.preserve_typeahead||this._getTypeahead().hide()},enableInput:function(){this._setInputEnabled(!0)},_setInputEnabled:function(a){var b="disabled";this.$field.toggleClass(b,!a),a?this.$field.removeAttr(b):this.$field.attr(b,b)},disableInput:function(){this._setInputEnabled(!1)},onChildItemSelected:function(a){var b=a.data.item,c=b&&!b.get("ignoreLabel")?b.get("label"):this.getValue(),d=this.options.set_input_value_on_selection;void 0===d&&(d=!0),c&&d&&(this.valueFromHighlight=!1,this.setValue(c)),this.blur()},onChildItemHighlighted:function(a){var b=a.data.item,c=b&&!b.get("ignoreLabel")?b.get("label"):this._getTypeahead().getLastTerm();this.options.populate_on_result_highlight&&(this.valueFromHighlight=!!b,this.setValue(c))
},onTypeaheadResultsReturned:function(){this.showCaret()},onTypeaheadHidden:function(){this.hideCaret(),this.typeaheadDropdown&&this.typeaheadDropdown.hide()},onTypeaheadShown:function(){this.showCaret(),this.typeaheadDropdown&&!this.typeaheadDropdown.isShowing()&&this.typeaheadDropdown.show()},onTypeaheadNoResultsReturned:function(){this.hideCaret()},showCaret:function(){this._setCaretVisible(!0)},hideCaret:function(){this._setCaretVisible(!1)},_setCaretVisible:function(a){this.$(".typeaheadCaret").toggleClass("visible",a)},highlightTypehaeadUp:function(){this._getTypeahead().highlightUp()},highlightTypeaheadDown:function(){this._getTypeahead().highlightDown()},onContentReady:function(){this.initTypeahead(),this.$field=this.$(".field"),this.$field.placeholder()},onFieldInput:function(){this.search()},_focusHighlightedIfNeeded:function(){this.options.use_tab_index&&(this._getTypeahead().focusHighlighted(),this.focus())},onFieldKeydown:function(a){var b=this._getTypeahead(),c=P.keyCode;if(b.isOpen())switch(a.keyCode){case c.ENTER:if(this.valueFromHighlight&&(this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1},500)),this.options.prevent_default_on_enter){a.preventDefault();break}}},focus:function(){this.getField().focusWithoutScrolling()},onFieldKeyup:function(a){var b=this._getTypeahead(),c=P.keyCode;if(b.isOpen())switch(a.keyCode){case c.UP:b.highlightUp(),this._focusHighlightedIfNeeded(),a.preventDefault();break;case c.DOWN:b.highlightDown(),this._focusHighlightedIfNeeded(),a.preventDefault();break;case c.ENTER:case c.NUMPAD_ENTER:case c.TAB:var d={};if(b.highlightedItem){var e="pins",f=b.highlightedItem.get("type");"pin_search"===f&&(f="query"),"board_search"===f&&(e="boards",f="query"),"people_search"===f&&(e="users",f="query"),d={entered_query:b.getLastTerm(),selected_query:b.highlightedItem.get("label"),result_index:b.highlightedItem.get("resultIndex"),autocomplete_type:f,search_mode:e}}var g=b.select();this._logCustomContextEvent(P.ContextLogging.EventType.CLICK,P.ContextLogging.ElementType.AUTOCOMPLETE_SUGGESTION,P.ContextLogging.ComponentType.TYPEAHEAD_SUGGESTIONS,d),g&&(this.abortSearch(),a.preventDefault());break;case c.ESCAPE:this.blur(),a.preventDefault();break;default:this.valueFromHighlight=!1}else switch(a.keyCode){case c.ENTER:case c.NUMPAD_ENTER:this.abortSearch(),this.triggerEvent(P.CONST.EVENT_ENTER_PRESSED,{},!0)}},getTypeaheadItemsToRender:function(){return this._getTypeahead().itemsToRender},getTypeaheadHighlightedItem:function(){return this.valueFromHighlight?this._getTypeahead().getHighlightedItem():null},getTypeaheadSelectedItem:function(){return this._getTypeahead().getSelectedItem()},removeCacheForTerm:function(a){this._getTypeahead().removeCacheForTerm(a)},removeCacheForCurrentTerm:function(){var a=this.getValue();this.removeCacheForTerm(a)},closeTypeahead:function(){this.abortSearch(),this._getTypeahead().hide()},onFieldBlur:function(){return this.cancelBlur?void(this.cancelBlur=!1):(this.valueFromHighlight?(this.valueFromHighlight=!1,this.reset()):this.showGuidedSearch&&this.reset(),this.hideTypeaheadUnlessPreserved(),void this.triggerEvent(P.CONST.EVENT_BLUR,null,!0))},onFieldFocus:function(){this.$field.trigger("mousedown"),this.options.search_on_focus&&this.search(),this.options.prefetch_on_focus&&this._getTypeahead().prefetch(),this.triggerEvent(P.CONST.EVENT_FOCUS,null,!0)},onTypeaheadMousedown:function(){this.cancelBlur=!0,window.setTimeout(function(){this.cancelBlur=!1},300)},getValue:function(){if("tokenized"===this.options.type){var a=this.getChildById("tokenizedInput");return this.showGuidedSearch?a.getTokenInputValue():a.getInputValue()}return this.$field.val()},getField:function(){return this.$field},reset:function(){this.abortSearch(),this.setValue(""),this._getTypeahead().emptyResults(),this._getTypeahead().hide()},setValue:function(a){if("tokenized"===this.options.type){var b=this.getChildById("tokenizedInput");b.setInputValue(a)}else this.$field.val(a);this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,{value:a},!0)},getTypeaheadResultCount:function(){return this._getTypeahead().getItemCount()},setAutocompleteScope:function(a){this._getTypeahead().setAutocompleteScope(a)},clear:function(){if("tokenized"===this.options.type){var a=this.getChildById("tokenizedInput");a.clearTokens(),a.clearSavedTokens()}this.setValue("")},abortSearch:function(){this.searchTimer&&window.clearTimeout(this.searchTimer),this._getTypeahead().abortSearch()},setResourceOptionForTypeahead:function(a,b){var c=this._getTypeahead().getResource();c.set(a,b)},setPrependedStaticItems:function(a){this._getTypeahead().setPrependedStaticItems(a)},setAppendedStaticItems:function(a){this._getTypeahead().setAppendedStaticItems(a)},resetPrependedStaticItems:function(){this._getTypeahead().resetPrependedStaticItems()},resetAppendedStaticItems:function(){this._getTypeahead().resetAppendedStaticItems()},search:function(a){var b=this,c=a;c||(c=b.getValue()),this.searchTimer&&window.clearTimeout(this.searchTimer);var d=function(){b._getTypeahead().search(c)},e=this.options.search_delay;e?this.searchTimer=window.setTimeout(d,e):d()},blur:function(){this.$field.blur()},isFocussed:function(){return this.$field.is(":focus")},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ui/TypeaheadField/TypeaheadField.nunjucks")}),goog.provide("P.modules.AddAPlace"),goog.require("P.Module"),goog.require("P.modules.Pinnable"),goog.require("P.modules.GridItems");var PINIT_BUTTON_ID="pinitButton";P.modules.AddAPlace=P.Module.extend({events:{"keyup .description":"onDescriptionKeyup"},onDescriptionKeyup:function(){this._enableIfReady()},onContentReady:function(){if(this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_PLACE_IMAGE_SELECTED,this.onPlaceImageSelected),P.scrollbarWidth()>0){var a=this.getChildById("images");if(a){var b=a.getGridItems();b&&b.setHasScroll(!0)}}},setPlace:function(a){this.place=a},onUploadSuccess:function(a){var b=this,c=a.data.image_url;this.setImage(c);var d={name:"Pinnable",options:{url:c,view_type:"add_to_map"}};P.loadModule(d).then(function(a){var c=a;a.render(function(){var d=b.getGridItems();d.prependChildItem(a);var e=b.getImages();_.each(e,function(a){a.deselect()}),c.select(),b._enableIfReady()})})},getGridItems:function(){var a=this.getChildById("images").getGridItems();return a},setImage:function(a){this._image=a},onButtonClick:function(a){var b=a.target;if(b.id===PINIT_BUTTON_ID){a.stopPropagation();var c=this._image;if(!c)return void P.showError(P._("Please pick an image for this pin."));this._enableIfReady()&&(b.showLoading(),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,c,!0))}},_enableIfReady:function(){var a=this.getChildById(PINIT_BUTTON_ID),b=this.hasValidDescription();return b?(this.removeErrorState(),this._image?(this.removeErrorState(),a.enable(),!0):!1):(this.addErrorState(),!1)},onPlaceImageSelected:function(a){var b=this.getImages();_.each(b,function(a){a.deselect()});var c=a.data;this._image=c,this._enableIfReady(),this.focus()},onAddedToDom:function(){this.focus()},focus:function(){this.$(".description").focus()},addErrorState:function(){this._setDescriptionError(!0),this.focus()},_setDescriptionError:function(a){this.$(".description").toggleClass("hasError",a),this.$(".descriptionLabel").toggleClass("error",a),this.$(".required").toggleClass("visible",a)},removeErrorState:function(){this._setDescriptionError(!1)},getImages:function(){var a=this.getChildById("images").getGridItems(),b=a.children;return b},hasValidDescription:function(){var a=this.$(".description");return!!a.val().length}}),goog.provide("P.modules.AnswerEdit"),goog.require("P.modules.EntityEdit"),P.modules.AnswerEdit=P.modules.EntityEdit.extend({getFormValidationRules:function(){return{content:[P.Validator.Required()]}},getFormValidationOptions:function(){return{prevalidate:!0}},getEditResource:function(){var a={answer_id:this.data.id,content:this.getChildById("contentField").getContent(),attached_url:this.getChildById("contentField").getAttachmentUrl()};return P.resourceFactory.create("AnswerResource",a)},onEditSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_ANSWER_UPDATED)},getDeleteConfirmTemplate:function(){return"delete_answer"},getDeleteResource:function(){var a={answer_id:this.data.id};return P.resourceFactory.create("AnswerResource",a)},onDeleteSuccess:function(){P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_ANSWER_DELETED)}}),goog.provide("P.modules.AnswerReport"),goog.require("P.modules.EntityReport"),P.modules.AnswerReport=P.modules.EntityReport.extend({getReportResourceName:function(){return"AnswerReportResource"},getCustomReportResourceOptions:function(){return{answer_id:this.options.answer_id,context_pin_id:this.options.context_pin_id}},onReportSuccess:function(){P.pubsub.publish(this.options.answer_id,P.CONST.PUBSUB_TOPIC_ANSWER_REPORTED)}}),goog.provide("P.modules.Answers"),goog.require("P.modules.AnswersBase"),P.modules.Answers=P.modules.AnswersBase.extend({initPubsub:function(){var a={};a[P.CONST.PUBSUB_TOPIC_QUESTION_ANSWER_CREATED]=this._onQuestionAnswerCreated,this.pubsubSubscribe(this.options.question_id,a)},_onQuestionAnswerCreated:function(a,b,c){var d=c,e=new P.modules.Answer({options:{context_pin_id:this.options.context_pin_id},resource:{name:"AnswerResource",options:{answer_id:d.id,field_set_key:"list_item"}}}),f=this.addItem(e),g=this,h={name:"Toast",options:{position_mode:"ANCHORED",position_point:"RIGHT_TOP",template:"create_answer_success"}};P.loadModule(h,function(a){g.addChild(a);var b=a.render();Promise.all([f,b]).then(function(){a.options.anchor=e.getContent(),a.positionModule()})})}}),goog.provide("P.modules.Board"),goog.require("P.Module"),goog.require("P.modules.BoardBase"),goog.require("P.modules.Dropdown");var CLASS_NO_SHADOW="noShadow",VIEW_TYPE_FOLLOW="follow_view",VIEW_TYPE_BOARD_PINS_GRID="boardPinsGrid",VIEW_TYPE_BOARD_COVER_IMAGE="boardCoverImage";P.modules.Board=P.modules.BoardBase.extend({events:{"click .dismiss":"onDismissClick"},getOwnedScrollables:function(){return this.$(".pinGridWrapper")},onContentReady:function(){var a=this.getId();if(a){var b={};b[P.CONST.PUBSUB_TOPIC_BOARD_COVER_UPDATED]=this.onBoardCoverUpdated,b[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,b[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,this.pubsubSubscribe(a,b)}if(this.options.view_type===VIEW_TYPE_BOARD_PINS_GRID){var c=this,d=this.getChildById("pinGrid");this.listen(d,P.CONST.EVENT_CONTENT_CHANGED,function(){var a=c.$el.css("max-height")||"0";a=a.replace(/[^0-9]/g,""),this.$el.outerHeight()<a&&this.$el.addClass(CLASS_NO_SHADOW)})}this.options.view_type===VIEW_TYPE_FOLLOW&&this.initHoverListeners()},onDismissClick:function(){this.dismissed=!0,this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},onBoardHoverEnter:function(){this.$el.isHovering()&&this._dropdown.show()},onBoardHoverExit:function(){this._dropdown.isHovering()||this._dropdown.hide()},onPinDeleted:function(){this.options.view_type===VIEW_TYPE_BOARD_COVER_IMAGE&&this.onBoardUpdated()},onBoardCoverUpdated:function(a,b,c){this.setBoardCover(c)},positionBoardPinsGrid:function(){var a=this.getChildById("pinGrid");a.$(".activeItem").focus()},toggleFollow:function(){this.getChildByModuleName("BoardFollowButton").toggleFollow()},initHoverListeners:function(){!this._hoverIntent&&this.options.use_flyout&&(this._hoverIntent=new P.HoverIntent(this.$el,{enterDelay:500,exitDelay:200}),this.listen(this,P.CONST.EVENT_NAVIGATE,this.onBoardHoverExit),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_ENTER_COMPLETE,this.onBoardHoverEnter),this.listen(this._hoverIntent,P.CONST.EVENT_HOVERINTENT_OUT_COMPLETE,this.onBoardHoverExit),this.isClickButton=function(){return!1},this._dropdown=new P.modules.Dropdown({options:{anchor:this.$el,class_name:"followViewHover underneathHeader",position_point:"RIGHT_TOP",module:{name:"Board",options:{view_type:"boardPinsGrid",scrollable:!0,prevent_default_scroll:!0,board_follow_button_options:{board_id:this.resource.options.board_id}},resource:{name:"BoardResource",options:{board_id:this.resource.options.board_id}}}}}),this.appendChild(this._dropdown),this.$el.initHovering(),this._dropdown.initHovering())},setBoardCover:function(a){var b=a.url,c=a.crop_x,d=a.crop_y,e=a.nativeHeight,f=a.nativeWidth,g=a.scale,h=this.$(".boardCoverWrapper img");h.attr("src",b).css({height:e*g,left:-c,"max-width":"none",position:"absolute",top:-d,width:f*g});var i=this.getChildById("boardCoverEditButton"),j=i.options.submodule.options;j.board_cover_edit_options.cover_pin_id=a.pin_id},disabledButtons:[],disable:function(){this.$el.find(".hoverMask").addClass("notNavigatable"),this.disabledButtons=[];var a=this;_.each(this.getChildrenByModuleName("ShowModalButton"),function(b){b.isDisabled()||(b.disable(),a.disabledButtons.push(b))})},enable:function(){this.$el.find(".hoverMask").removeClass("notNavigatable"),_.each(this.disabledButtons,function(a){a.enable()})},setFollowButtonState:function(a){var b=this.getChildByModuleName("BoardFollowButton");b&&b.setState(a)}}),goog.provide("P.modules.BoardCoverEdit"),goog.require("P.Module"),goog.require("P.modules.ui.ImageCrop"),P.modules.BoardCoverEdit=P.Module.extend({pins:null,index:null,prefetchBuffer:10,events:{"click .previous":"previous","click .next":"next"},onCreated:function(){this.imageCrop=null,this.onKeyup=_.bindFn(this.onKeyup,this),this.next=_.bindFn(this.next,this),this.previous=_.bindFn(this.previous,this),this.$img=$("<img>")},_positionIfReady:function(){!this._positioned&&this.inDom&&this.contentReady&&(this._positioned=!0,this.imageCrop=this.getChildByModuleName("ui.ImageCrop"),this.listen($("body"),"keyup",this.onKeyup),this.coverPinId=this.options.cover_pin_id,this._initializePins(!0))},_initializePins:function(a){if(a&&null!==this.coverPinId){var b={id:this.coverPinId,field_set_key:"board_cover_picker"},c=P.resourceFactory.create("PinResource",b),d=this;c.callGet({success:function(a){d._appendPinsFromData([a.resource_response.data]),d._initializePins()},error:function(){d.coverPinId=null,d._initializePins()}})}else this._appendPinsFromData(this.data),this.setIndex(0),this.updateButtons()},_appendPinsFromData:function(a){this.pins||(this.pins=[]);var b=this;_.each(a,function(a){var c={id:a.id,url:a.images["236x"].url};c.id===b.coverPinId&&b.pins.length||b.pins.push(c)})},onAddedToDom:function(){this._positionIfReady()},onContentReady:function(){this._positionIfReady()},onKeyup:function(a){null!==this.index&&(a.keyCode===P.keyCode.LEFT?this.previous():a.keyCode===P.keyCode.RIGHT&&this.next())},requestMoreIfNeeded:function(){if(!(this.index+this.prefetchBuffer<this.pins.length)&&!this.resource.atEnd()){var a=this;this.resource.callGet({options:this.options,success:function(b){a.data=b.resource_response.data,a._appendPinsFromData(a.data)},error:function(){a.data=[]}})}},next:function(){if(this.requestMoreIfNeeded(),this.index===this.pins.length-1)return!1;var a=this.index+1;return this.setIndex(a),!1},previous:function(){var a=this.index-1;return this.setIndex(a),!1},setIndex:function(a){var b=this.pins[a];b&&(this.imageCrop.setImage(b.url),this.index=a,this.preload([this.index-2,this.index-1,this.index+1,this.index+2]),this.updateButtons())},preload:function(a){var b=this;_.each(a,function(a){var c=b.pins[a];c&&P.preloadImage(c.url)})},updateButtons:function(){var a=0<this.index;this.$(".previous").toggle(a);var b=this.index<this.pins.length-1||!this.resource.atEnd();this.$(".next").toggle(b)},getBoardCoverData:function(){var a=this.pins[this.index].id,b=this.pins[this.index].url,c=_.extend({},{pin_id:a,pin_image_url:b},this.imageCrop.getCropData());return c}}),goog.provide("P.modules.BoardFollowButton"),goog.require("P.Module"),goog.require("P.modules.ui.FollowButton"),P.modules.BoardFollowButton=P.modules.ui.FollowButton.extend({getResourceId:function(){return this.options.board_id},getFollowResource:function(){return P.resourceFactory.create("BoardFollowResource",{board_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},getContextualResource:function(){return P.resourceFactory.create("BoardResource",{board_id:this.getResourceId(),field_set_key:"grid_item"})},onContentReady:function(){if(this.options.user_id){var a={};a[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this.onFollowUser,a[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this.onUnfollowUser,this.pubsubSubscribe(this.options.user_id,a)}var b={};b[P.CONST.PUBSUB_TOPIC_USER_FOLLOW]=this._onFollow,b[P.CONST.PUBSUB_TOPIC_USER_UNFOLLOW]=this._onUnfollow,this.pubsubSubscribe(this.getResourceId(),b),this.showMemo()},_onFollow:function(){var a={board_id:this.getResourceId()};this.triggerEvent(P.CONST.EVENT_BOARD_FOLLOW,a,!0)},_onUnfollow:function(){var a={board_id:this.getResourceId()};this.triggerEvent(P.CONST.EVENT_BOARD_UNFOLLOW,a,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UNFOLLOW,!0)},onFollowUser:function(){this.setState(!0)},onUnfollowUser:function(){this.setState(!1)}}),goog.provide("P.modules.BoardsToFollow"),goog.require("P.Module"),goog.require("P.modules.Board"),goog.require("P.modules.Dropdown");var NUM_BOARDS_IN_LIST=3,BOARDS_TO_FOLLOW_VIEW_TYPE_FOLLOW="follow_view";P.modules.BoardsToFollow=P.Module.extend({boardsUsed:[],boardsUnused:[],boardsToReplace:[],onCreated:function(){this.childListen(P.CONST.EVENT_DISMISS,this.onChildDismiss),this.childListen(P.CONST.EVENT_BOARD_FOLLOW,this.onChildBoardFollow)},onContentReady:function(){var a=this;this.boardsUnused=this.extraData.boardsUnused,this.list=a.getChildByModuleName("List"),a.requestMoreBoardsIfNeeded(),a.replaceBoardsWithUnused()},onChildDismiss:function(a){var b=a.target;this.dismissBoard(b)},onChildBoardFollow:function(a){var b=a.target.parent,c=this;b.options.view_type===BOARDS_TO_FOLLOW_VIEW_TYPE_FOLLOW&&window.setTimeout(function(){c.dismissBoard(b)},500)},getEditFeedButtonElement:function(){return this.$(".memoTitle")},requestMoreBoardsIfNeeded:function(){var a=this;a.boardsUnused.length>NUM_BOARDS_IN_LIST||this.resource.xhr||this.resource.callGet({success:function(b){var c=b.resource_response.data;a.boardsUnused=a.boardsUnused.concat(c),a.replaceBoardsWithUnused()}})},dismissBoard:function(a){if(a&&!a.dismissing){var b=this;a.dismissing=!0,b.requestMoreBoardsIfNeeded(),a.fadeOut(function(){b.replaceBoard(a)})}},getBoard:function(a){var b=new P.modules.Board({options:{show_board_context:!0,view_type:BOARDS_TO_FOLLOW_VIEW_TYPE_FOLLOW,size:"small"},resource:{name:"BoardResource",options:{board_id:a,field_set_key:"boards_to_follow"}}});return b},hideBoard:function(a){a&&(a._dropDown&&a._dropDown.hide(),a.destroy())},replaceBoardsWithUnused:function(){for(var a=this;a.boardsToReplace.length&&a.boardsUnused.length;){var b=a.boardsToReplace.shift();a.replaceBoard(b)}},replaceBoard:function(a){var b=this,c=this.boardsUnused.pop();if(c){var d=b.getBoard(c.id);d.render(function(){var c=$("<li></li>").appendTo(b.list.$el);b.list.insertChild(d,c),b.list.insertChild(d,c),b.hideBoard(a),d.show(),d.fadeIn()},function(){b.hideBoard(a),b.replaceBoard(d)}),this.boardsUsed.push(c)}}}),goog.provide("P.modules.CloseupSidebar"),goog.require("P.Module"),goog.require("P.modules.Board"),P.modules.CloseupSidebar=P.Module.extend({onContentReady:function(){if(this.data.id){var a={};a[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,this.pubsubSubscribe(this.data.id,a)}var b=this.getChildByModuleName("Board");b.positionBoardPinsGrid()},onPinUpdated:function(){this.render()},updateVisuallySimilar:function(a){if(this.$(".visuallySimilarContainer")){var b=this.getChildById("visuallySimilar"),c=this.$(".nonVisuallySimilarContainer");if(!a)return void(b&&b.fadeOut(function(){b.destroy(),c.fadeIn()}));var d={pin_id:a.pinId,obj_id:a.objId},e=this;if(b)b.resource.setOptions(d),b.fadeOut(),this.showLoading(),b.render(function(){e.hideLoading(),b.fadeIn()});else{var f={name:"VisuallySimilar",id:"visuallySimilar",resource:{name:"VisualSearchResource",options:d}};c.fadeOut(),this.showLoading(),P.loadModule(f,function(a){a.render(function(){_.each(e.getChildrenByModuleName("VisuallySimilar"),function(a){e.removeChild(a)}),e.hideLoading(),e.insertChild(a,e.$(".visuallySimilarContainer")),a.fadeIn()})})}}},updateDomain:function(a){var b=this.getChildById("domain");if(!a)return void(b&&(b.destroy(),this.$(".domainContainerTitle").hide()));if(!b&&a){var c={name:"Domain",id:"domain",resource:{name:"DomainResource",options:{domain:a}}},d=this;return void P.loadModule(c,function(a){a.render(function(){d.$(".domainContainerTitle").show(),d.insertChild(a,d.$("#domainContainer"))})})}b.resource.set("domain",a),b.render(function(){b.fadeIn()})},updateRelatedRecipes:function(a){if(this.$(".relatedRecipeContainer")){var b=this.getChildById("relatedRecipe");if(!a||0===a.length)return void(b&&b.destroy());if(!b&&a){var c={name:"RelatedRecipe",id:"relatedRecipe",options:{ingredients:a},resource:{name:"NoopResource",options:{}}},d=this;return void P.loadModule(c,function(a){a.render(function(){d.insertChild(a,d.$(".relatedRecipeContainer"))})})}b.options={ingredients:a},b.render(function(){b.fadeIn()})}}}),goog.provide("P.modules.FastFollow"),goog.require("P.Module"),goog.require("P.modules.Grid");var FAST_FOLLOW_CONTENT_CLASS="fastFollowContent",FAST_FOLLOW_HEADER_ID="fastFollowHeader",FAST_FOLLOW_GRID_ID="categoryBoardsGrid",FAST_FOLLOW_BOARD_MASK="wholeBoardMask",FAST_FOLLOW_MIN_HEIGHT=355,FAST_FOLLOW_MODAL_TOP_PADDING=102,FAST_FOLLOW_MODAL_BOTTOM_PADDING=56,NUM_REQUIRED_BOARDS=5,FastFollowSidebarActions={CATEGORY:0,SEARCH_TERM:1};P.modules.FastFollow=P.Module.extend({_boardsFollowed:[],_modalDisplayed:!1,_cachedGrids:{},_currentAction:FastFollowSidebarActions.CATEGORY,getOwnedScrollables:function(){return this.$(".fastFollowGridContainer")},_getBoardIdFromEvent:function(a){var b=a.data||{};return b.board_id},_onBoardFollow:function(a){var b=this._getBoardIdFromEvent(a),c=$.inArray(b,this._boardsFollowed);b&&-1===c&&(this._boardsFollowed.push(b),this._updateFollowedBoards(1),this._updateFollowedBoardMask(a,!0))},_onBoardUnfollow:function(a){var b=this._getBoardIdFromEvent(a);if(b){var c=$.inArray(b,this._boardsFollowed);-1!==c&&(this._boardsFollowed.splice(c,1),this._updateFollowedBoards(-1)),this._updateFollowedBoardMask(a,!1),this._boardsFollowed.length===NUM_REQUIRED_BOARDS-1&&this._setProgressCompletion(!1)}},_updateFollowedBoardMask:function(a,b){var c=this._getBoardIdFromEvent(a);if(c){var d=this.$("."+FAST_FOLLOW_BOARD_MASK+".mask"+c);b?d.show():d.hide()}},_onCategoryUpdate:function(a){var b=a.data,c={name:"CategoryBoardsResource",options:{category:b}};this._currentAction=FastFollowSidebarActions.CATEGORY,this._updateGridFromResource(c,b,b)},_onSearchQueryUpdate:function(a){var b=a.data,c={name:"SearchResource",options:{query:b,scope:"boards",search_context:"fast_follow"}};this._currentAction=FastFollowSidebarActions.SEARCH_TERM,this._updateGridFromResource(c,null,b)},_updateGridFromResource:function(a,b){this._currentGrid||(this._currentGrid=this.getChildById(FAST_FOLLOW_GRID_ID),this._cachedGrids[this._currentGrid.resource.options.category]=this._currentGrid),this._currentGrid.remove();var c=this._cachedGrids[b];c||(c=new P.modules.Grid({id:FAST_FOLLOW_GRID_ID,options:{centered:!1,layout:"fixed_height",show_grid_footer:!1,scrollable:!0,item_options:{allow_click_thru:!1,board_click_mask:!0}},resource:a}),c.render(),b&&(this._cachedGrids[b]=c));var d=this.$(".fastFollowGridContainer");this.$("."+FAST_FOLLOW_CONTENT_CLASS).scrollTop(0),this.insertChild(c,d),this._currentGrid=c},_updateBoardHeading:function(a){this.$(".heading").hide(),this._currentAction===FastFollowSidebarActions.CATEGORY?(a=this.$(".followPageSidebarCategory[data-category="+a+"]"),a=a?a.text():null,this.$(".categoryHeading").show()):this.$(".searchHeading").show();var b=this.$(".categoryOrQuery");b&&b.length&&a&&b.text(a)},_onProgressCompletion:function(){this._userRegisterTrackActionOrientationComplete(),this._setProgressCompletion(!0)},_onFastFollowCompletion:function(a){var b=a.target;b&&"tryOutYourFeedButton"===b.id&&(this.hide(),this.navigate("/",null,!0))},_userRegisterTrackActionOrientationComplete:function(){P.trackRegisterAction("orientation_complete")},_setProgressCompletion:function(a){var b=this.getChildById(FAST_FOLLOW_HEADER_ID);b&&(b.options.progress_completed=a,a?b.render():(b.options.num_boards_followed=this._boardsFollowed.length,b.render()))},_updateFollowedBoards:function(a){if(!this._modalDisplayed){var b=this.getChildById(FAST_FOLLOW_HEADER_ID);b&&b.stepProgress(a)}},onContentReady:function(){var a=this;_.each(this.extraData.followed_boards,function(b){a._boardsFollowed.push(b.id)}),this.childListen(P.CONST.EVENT_FAST_FOLLOW_CATEGORY_SELECTED,this._onCategoryUpdate),this.childListen(P.CONST.EVENT_FAST_FOLLOW_SEARCH_QUERY_UPDATED,this._onSearchQueryUpdate),this.childListen(P.CONST.EVENT_PROGRESS_COMPLETED,this._onProgressCompletion),this.childListen(P.CONST.EVENT_BOARD_FOLLOW,this._onBoardFollow,this),this.childListen(P.CONST.EVENT_BOARD_UNFOLLOW,this._onBoardUnfollow,this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onFastFollowCompletion),this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.position),this.position()},position:function(){if(this.inDom&&this.contentReady){this.fastFollowHeaderHeight||(this.fastFollowHeaderHeight=this.$(".FastFollowHeader").outerHeight(!0));var a=FAST_FOLLOW_MODAL_TOP_PADDING+FAST_FOLLOW_MODAL_BOTTOM_PADDING,b=P.Viewport.height,c=b-a-this.fastFollowHeaderHeight,d=Math.max(FAST_FOLLOW_MIN_HEIGHT,c);this.$(".fastFollowContent").height(d)}},onDestroyed:function(){_.each(_.values(this._cachedGrids),function(a){a.destroy()})}}),goog.provide("P.modules.FindFriendsContent"),goog.require("P.Module"),goog.require("P.modules.SocialNetworkSettingsBase"),P.modules.FindFriendsContent=P.modules.SocialNetworkSettingsBase.extend({onContentReady:function(){this.options.auto_connect&&this.options.tab&&this.startNetworkConnect(this.options.tab)},onCreated:function(){P.modules.SocialNetworkSettingsBase.prototype.onCreated.apply(this,arguments),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),P.ExperienceManager.instance().refreshPlacedExperiences()},onButtonClick:function(a){var b=a.target,c=null;switch(b.id){case"facebookConnectButton":c=P.SocialConnect.FACEBOOK;break;case"twitterConnectButton":c=P.SocialConnect.TWITTER;break;default:return}this.startNetworkConnect(c)},startNetworkConnect:function(a){var b;switch(a){case P.SocialConnect.FACEBOOK:b=this.getChildById("facebookConnectButton");break;case P.SocialConnect.TWITTER:b=this.getChildById("twitterConnectButton");break;default:return}b.showLoading();var c=this,d={success:function(){var d={username:c.options.username},e={success:function(d){b.hideLoading(),c.resource=d,c.render(),c.triggerEvent(P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,{network:a},!0)},error:function(){b.hideLoading(),c.hideLoading(),c.render()},resourceOptions:d};c.pollForFriends(a,e)},error:function(){b.hideLoading(),c.hideLoading()}};this.handleConnect(a,!0,d)}}),goog.provide("P.modules.FramedSignupContent"),goog.require("P.Module"),goog.require("P.modules.UnauthHomePage"),P.modules.FramedSignupContent=P.modules.UnauthHomePage.extend({events:{},onContentReady:function(){this.container=window.parent,this.childListen(P.CONST.EVENT_USER_REGISTER,this.onRegisterComplete),P.modules.UnauthHomePage.prototype.onContentReady.call(this)},onNavigateEvent:function(a){a.stopPropagation(),P.modules.UnauthHomePage.prototype.onNavigateEvent.call(this,a),this.postMessage({event:"navigate",url:a.data.url})},onRegisterComplete:function(a){a.stopPropagation(),this.postMessage({event:"userRegister"})},onFastTrackSuccess:function(){this.log.debug("onFastTrackSuccess"),this.postMessage({event:"userRegister"})},onLoginSuccess:function(){this.log.debug("onLoginSuccess"),this.postMessage({event:"userLogin"})},onFastTrackError:function(){this.log.debug("onFastTrackError"),this.postMessage({event:"finishRegistration"})},trackRegisterAction:function(){P.trackRegisterAction(this.options.track_key||"framed_signup")},getExtraFastTrackSocialRegistrationOptions:function(){return{skip_nux:this.options.skip_nux}},postMessage:function(a){return this.container.postMessage?void this.container.postMessage(JSON.stringify(a),"http://"+this.options.domain):void this.log.error("Browser doesn't support postMessage!")}}),goog.provide("P.modules.FriendsToFollow"),goog.require("P.Module"),goog.require("P.modules.User"),P.modules.FriendsToFollow=P.Module.extend({friendIdsUsed:[],friendsUnused:[],usersToReplace:[],usersDismissing:[],onContentReady:function(){this.friendIdsUsed=this.extraData.friendIdsUsed,this.invite_mode="invites"===this.options.mode,this.list=this.getChildByModuleName("List"),this.destroyIfEmpty()||(this.childListen(P.CONST.EVENT_DISMISS,this.onChildDismiss),this.childListen(P.CONST.EVENT_USER_FOLLOW,this.onChildActionTaken),this.childListen(P.CONST.EVENT_INVITE_USER,this.onChildActionTaken)),this.invite_mode&&P.fb.ensureInit(P.NOOP)},onChildDismiss:function(a){var b,c=a.target;this.invite_mode?(b=P.resourceFactory.create("UserInviteSuggestionResource",{}),b.set("hash_id",c.getUserId())):(b=P.resourceFactory.create("UserFriendSuggestionResource",{}),b.set("user_id",c.getUserId())),b.callDelete(),this.dismissUser(c)},onChildActionTaken:function(a){var b=a.target,c=this;window.setTimeout(function(){if(c.dismissUser(b),c.invite_mode){var a=P.resourceFactory.create("UserInviteSuggestionResource",{});a.set("hash_id",b.getUserId()),a.callDelete()}},500)},requestMoreFriendsIfNeeded:function(){var a=this.friendsUnused,b=this.usersDismissing.length+this.usersToReplace.length;if(!(a.length>=b||this.resource.xhr)){var c=this;this.resource.resetBookmark(),this.invite_mode?this.resource.options.excluded_hash_ids=this.friendIdsUsed:this.resource.options.excluded_user_ids=this.friendIdsUsed,this.resource.callGet({success:function(a){var b=a.resource_response.data;for(c.friendsUnused=b;c.usersToReplace.length;){var d=c.usersToReplace.shift();c.replaceUser(d)}}})}},dismissUser:function(a){if(a){var b=this;this.usersDismissing.push(a),a.fadeOut(function(){b.usersDismissing=_.without(b.usersDismissing,a),b.friendsUnused.length?b.replaceUser(a):(b.usersToReplace.push(a),b.requestMoreFriendsIfNeeded())})}},getHeaderElement:function(){return this.$(".memoTitle")},replaceUser:function(a){var b=a.$el.parent(),c=this.friendsUnused.pop(),d=this;return c?(this.invite_mode?(a.options.contact_info=c,this.friendIdsUsed.push(c.hash_id)):(a.resource.options.user_id=c.id,this.friendIdsUsed.push(c.id)),void a.render(function(){a.show(),d.list.removeChild(a),b.remove(),d.list.$el.append(b),d.list.insertChild(a,b),a.fadeIn()})):(d.list.removeChild(a),void b.remove())}}),goog.provide("P.modules.GeoFeatureList"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),P.modules.GeoFeatureList=P.Module.extend({events:{"click .dropdownTarget":"onTargetClick"},onListItemClick:function(a){var b=this,c=$(a.data).attr("data-index"),d=this.options.features[c];this.options.active_feature=d,this.hideDropdown(),this.render(function(){b.triggerEvent(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,d,!0)})},onContentReady:function(){var a={module:this.getContentModuleLoadOptions(),anchor:this.$(".dropdownTarget"),class_name:"aboveModal geoFeatureDropdown",prefetch:!0,position_point:"BOTTOM_LEFT"};this.options.active_feature=null,this._dropdown=new P.modules.Dropdown({options:a,id:"dropdown"})},updateFeatures:function(a){this.options.active_feature=null,this.options.features=a,this.render()},getContentModuleLoadOptions:function(){return{name:"List",options:{items:this.options.features}}},hideDropdown:function(){this._dropdown.hide()},onTargetClick:function(){if(this._dropdown.isShowing())this.hideDropdown();else{this._dropdown.show();
var a=this._dropdown.getChildByModuleName("List");this.listen(a,P.CONST.EVENT_LIST_ITEM_CLICK,this.onListItemClick)}},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/GeoFeatureList/GeoFeatureList.nunjucks")}),goog.provide("P.modules.Header"),goog.require("P.Module"),goog.require("P.modules.ui.SearchForm"),goog.require("P.router"),P.modules.Header=P.Module.extend({events:{},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_HEADER_ALT_STATE]=this.onHeaderAltStateChange,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.listen(P.router.get(),P.CONST.EVENT_ROUTE_MATCHED,this.onRouteMatched)},onRouteMatched:function(a){var b=a.navigateData.currentModule||{},c=["SearchPage","Closeup"];if(!_.contains(c,a.module)&&_.contains(c,b.className)){var d=this.getChildById("mainSearchTextbox");d.clearTypeaheadField()}},onHeaderAltStateChange:function(a,b,c){this.$el.toggleClass("alt",c)},getHeight:function(){return this.$(".headerBackground").height()},getUserMenu:function(){return this.getChildById("userMenu")},getHomeElement:function(){return this.$(".logo")},show:function(){this.$el.show(),this.$el.removeClass("hidden")}}),goog.provide("P.modules.MultiInviterEmail"),goog.require("P.Module"),goog.require("P.modules.SocialNetworkSettingsBase"),P.modules.MultiInviterEmail=P.modules.SocialNetworkSettingsBase.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onButtonClick)},onContentReady:function(){if(P.Module.prototype.onContentReady.apply(this,arguments),!this.options.network){this.gmailConnect=this.getChildById("gmailConnect"),this.yahooConnect=this.getChildById("yahooConnect");var a={email:[P.Validator.Required(),P.Validator.Email()]};this.form=new P.Form(this.$("form"),a),this.formListener&&this.removeListener(this.formListener),this.formListener=this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this._onSubmitValidated),this.emailInviteButton=this.getChildById("invite"),this.$(".emailInput").focus()}},_onSubmitValidated:function(a){if(!a.errors[0]){this.emailInviteButton.showLoading();var b=this.form.getValue("email");this.$(".emailInput").val("");var c=this;P.Invite.userInviteEmail(b,function(){c.emailInviteButton.hideLoading(),c.triggerEvent(P.CONST.EVENT_INVITE_USER,null,!0)})}},_onButtonClick:function(a){var b=a.target,c=null;switch(b.id){case"gmailConnect":c=P.SocialConnect.GOOGLE;break;case"yahooConnect":c=P.SocialConnect.YAHOO;break;default:return}b.showLoading(!0);var d=this,e={success:function(){var a={username:P.currentUser.attributes.username,filter:"not_on_pinterest"},e={success:function(){d.render()},error:function(){b.hideLoading()},resourceOptions:a};d.pollForFriends(c,e)},error:function(){b.hideLoading()}};this.handleConnect(c,!0,e)}}),goog.provide("P.modules.MultiInviterFacebook"),goog.require("P.Module"),goog.require("P.modules.SocialNetworkSettingsBase"),P.modules.MultiInviterFacebook=P.modules.SocialNetworkSettingsBase.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this._onClick)},_onClick:function(a){var b=a.target;if("connectFacebook"===b.id){var c=this,d=this.getChildById("connectFacebook"),e={success:function(){var a={username:P.currentUser.attributes.username,filter:"not_on_pinterest"},b={success:function(){c.render()},error:function(){d.hideLoading()},resourceOptions:a};c.pollForFriends("facebook",b)},error:function(){d.hideLoading()}};d.showLoading(),this.handleConnect("facebook",!0,e)}}}),goog.provide("P.modules.NotificationsButton"),goog.require("P.modules.DropdownButton"),P.modules.NotificationsButton=P.modules.DropdownButton.extend({getContentModuleLoadOptions:function(){return this.getNotificationsModule()},getNotificationsModule:function(){var a=Math.max(this.unseenCount||10,20);return{name:"Notifications",resource:{name:"NotificationsResource",options:{count:a}}}},onContentReady:function(){var a=this;P.modules.DropdownButton.prototype.onContentReady.call(this),this.unseenCount=0,this.data&&(this.unseenCount=this.data,this.setBadgeCount(this.data)),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.listen(P.Updater.instance(),"notifications_count",function(b){a.unseenCount=b,a.setBadgeCount(b),b>0&&a.clearDropdown()})},onDropdownHide:function(){if(this.shouldClearDropdown){var a=this.getDropdown();a&&a.empty()}this.shouldClearDropdown=!1,this.setActiveStyle(!1)},onDropdownShow:function(){this.clearBadge()},clearDropdown:function(){var a=this.getDropdown();a&&(a.isVisible()?this.shouldClearDropdown=!0:a.empty())}}),goog.provide("P.modules.NotificationsConversationsButton"),goog.require("P.modules.DropdownButton"),P.modules.NotificationsConversationsButton=P.modules.DropdownButton.extend({getContentModuleLoadOptions:function(){return this.getDropdownModule()},onCreated:function(){P.modules.DropdownButton.prototype.onCreated.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT]=this.onConversationUnreadCount,a[P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE]=this.onConversationUnreadCountDecrease,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UNREAD_CONVERSATION_LIST_ITEM_CLICK,this.onUnreadConversationListItemClick)},onConversationUnreadCountDecrease:function(a,b,c){this._decrementButtonByCount(c)},_decrementButtonByCount:function(a){var b=this.getBadgeCount(),c=Math.max(b-a,0);this.setBadgeCount(c),0===c&&P.getConversationsManager().deleteConversationBadgeCount(),!this._dropdown.isShowing()&&this._dropdown.getContentModule()&&this._dropdown.getContentModule().render()},onButtonClick:function(a){var b=a.target;if(b.isSegmentedControlButton()){var c=b.id;"notifications"===c?(this.unseenNotificationsCount=0,this.clearNotificationsSegmentButtonBadge(),this.updateBadgeCount()):"conversations"===c&&this.clearAndUpdateConversationsBadge()}},clearAndUpdateConversationsBadge:function(){this.unseenConversationsCount=0,P.getConversationsManager().deleteConversationBadgeCount(),this.clearConversationsSegmentButtonBadge(),this.updateBadgeCount()},clearAndUpdateNotificationsBadge:function(){this.unseenNotificationsCount=0,this.clearNotificationsSegmentButtonBadge(),this.updateBadgeCount()},getDropdownModule:function(){return{name:"NotificationsConversationsDropdown",options:{}}},onUnreadConversationListItemClick:function(){var a=this.getBadgeCount();a-=1,this.setBadgeCount(a),0===a&&P.getConversationsManager().deleteConversationBadgeCount()},getNotificationsSegmentButton:function(){var a,b=this.getDropdown();if(b.children.length){var c=b.getContentModule();a=c.getNotificationsSegmentedButton()}return a},getConversationsSegmentButton:function(){var a,b=this.getDropdown();if(b.children.length){var c=b.getContentModule();a=c.getConversationsSegmentedButton()}return a},clearConversationsSegmentButtonBadge:function(){var a=this.getConversationsSegmentButton();a&&a.clearBadge()},clearNotificationsSegmentButtonBadge:function(){var a=this.getNotificationsSegmentButton();a&&a.clearBadge()},setNotificationsSegmentButtonBadgeCount:function(a){var b=this.getNotificationsSegmentButton();b&&b.setBadge(a)},setConversationsSegmentButtonBadgeCount:function(a){var b=this.getConversationsSegmentButton();b&&b.setBadge(a)},onConversationUnreadCount:function(a,b,c){this.unseenConversationsCount=c,0===c?this.clearConversationsSegmentButtonBadge():this.setConversationsSegmentButtonBadgeCount(c),this.updateBadgeCount()},onContentReady:function(){var a=this;P.modules.DropdownButton.prototype.onContentReady.call(this),this.unseenNotificationsCount=0,this.unseenConversationsCount=0,this.data&&(this.unseenNotificationsCount=this.data,this.setBadgeCount(this.unseenNotificationsCount)),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.listen(P.Updater.instance(),"notifications_count",function(b){if(b)if(a.getDropdown().isShowing()){var c=a.getDropdown(),d=c.getContentModule();d.setNotificationsActiveSegment(),a.clearAndUpdateNotificationsBadge()}else a.unseenNotificationsCount=b,a.setNotificationsSegmentButtonBadgeCount(b);else a.clearNotificationsSegmentButtonBadge();a.updateBadgeCount()})},onDropdownHide:function(){var a=this.getDropdown();this.setActiveStyle(!1);var b=a.getContentModule();b.removeCreateConversationGroup()},onDropdownShow:function(a){var b=!0;this.unseenNotificationsCount&&(b=!1);var c=a.target,d=c.getContentModule();b?(this.clearAndUpdateConversationsBadge(),d.setConversationsActiveSegment()):(this.clearAndUpdateNotificationsBadge(),d.setNotificationsActiveSegment())},updateBadgeCount:function(){var a=this.unseenNotificationsCount+this.unseenConversationsCount;this.setBadgeCount(a),P.Title.instance().setPrefixCount(a)}}),goog.provide("P.modules.NotificationsConversationsDropdown"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup");var CLASS_CONVERSATIONS_SHOWING="conversationsShowing";P.modules.NotificationsConversationsDropdown=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_SEND_OBJECT_TO_USERS,this.onCreateConversationWithUsers),this.showingConversationGroup=!1},onButtonClick:function(a){var b=a.target;if(b.isCancelButton())return void this.removeCreateConversationGroup();switch(b.id){case"conversations":this.$el.addClass("conversationsShowing");break;case"notifications":this.$el.removeClass("conversationsShowing");break;case"newMessage":this.showCreateConversationGroup()}},onCreateConversationWithUsers:function(a){var b=this,c={user_ids:a.data.user_ids,emails:a.data.emails};a.data.text&&(c.text=a.data.text);var d=P.resourceFactory.create("ConversationsResource",c);d.callCreate().then(function(a){var c=a.resource_response.data;c&&!a.resource_response.error&&(P.getConversationsManager().addConversation(c),b.triggerEvent(P.CONST.EVENT_DISMISS,null,!0),b.render())})},showCreateConversationGroup:function(){if(!this.showingConversationGroup){var a=this;this.createConversationGroup=new P.modules.CreateConversationGroup({}),this.createConversationGroup.renderExistingData().then(function(){a.appendChild(a.createConversationGroup)})}this.showingConversationGroup=!0},removeCreateConversationGroup:function(){(this.showingConversationGroup||this.createConversationGroup)&&(this.createConversationGroup.destroy(),this.createConversationGroup=null),this.showingConversationGroup=!1},getConversationsSegmentedButton:function(){var a=this._getSegmentedController();return a?a.getChildById("conversations"):void 0},getNotificationsSegmentedButton:function(){var a=this._getSegmentedController();return a?a.getChildById("notifications"):void 0},setConversationsActiveSegment:function(){var a=this._getSegmentedController();this.$el.addClass(CLASS_CONVERSATIONS_SHOWING),a.makeActiveModuleFromIndex(1)},_getSegmentedController:function(){return this.getChildById("segmentedController")},setNotificationsActiveSegment:function(){var a=this._getSegmentedController();this.$el.removeClass(CLASS_CONVERSATIONS_SHOWING),a.makeActiveModuleFromIndex(0)},getNotificationsSegment:function(){var a,b=this._getSegmentedController();return b&&(a=b.getChildByModuleName("notifications")),a}}),goog.provide("P.modules.Pin"),goog.require("P.modules.PinBase"),goog.require("P.modules.PinCommentList");var PIN_EDIT_BUTTON_ID="editButton",PIN_CLASS_VISIBLE="visible",SCOPED_EVENT_NAME="mapPage",MOUSEENTER_EVENT_NAME="mouseenter."+SCOPED_EVENT_NAME,MOUSELEAVE_EVENT_NAME="mouseleave."+SCOPED_EVENT_NAME,VIEW_TYPES={DETAILED:"detailed",SUMMARY:"summary"},GRID_ACTION_BUTTON_WRAPPERS=[".likeEditButtonWrapper",".repinSendButtonWrapper"];P.modules.Pin=P.modules.PinBase.extend({events:{"mouseleave .pinImageSourceWrapper":"onPinMouseout","click .playIndicatorPill.gifType":"onGifClick","click .richPinMeta.hasMapButton":"onRichPinMetaWithMapClick","click .pinMask":"onPinMaskClicked"},onPinMouseout:function(){var a=this.getChildById("sendPinButton");if(a){var b=a.getDropdown();b&&b.isVisible()&&this.toggleActionButtons(!0)}},toggleActionButtons:function(a){this.$(GRID_ACTION_BUTTON_WRAPPERS.join(", ")).toggleClass(PIN_CLASS_VISIBLE,a)},onRichPinMetaWithMapClick:function(){var a=this.getPinId();this._forceSeeOnMap=!0,this.getPlaceData()&&this.triggerEvent(P.CONST.EVENT_PIN_PLACE_CLICK,a,!0)},onButtonClick:function(a){var b=a.target,c=b.id;switch(c){case"expandGiraffe":this.onExpandGiraffeClick(a),b.destroy();break;case"addToMap":this.triggerEvent(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this,!0);break;case"seeOnMap":b.setHighlight(!0);break;case"pinItToMapButton":var d=this.extraData.image;this.showLoading(!0),this.triggerEvent(P.CONST.EVENT_PINIT_BUTTON_CLICKED,d,!0)}},getId:function(){return this.options.pin_id},onExpandGiraffeClick:function(){this.$(".pinImageWrapper").removeClass("collapsed"),this.triggerEvent(P.CONST.EVENT_DIMS_CHANGED,null,!0)},getSummaryImageUrl:function(){return this.data.images["236x"].url},getLink:function(){return this.data.link||null},showEditModal:function(){var a=this.getChildById(PIN_EDIT_BUTTON_ID);return a?(a.showModal(),!0):!1},getPinMedia:function(){var a=this._getViewType();switch(a){case"detailed":return this.$(this.isEmbed()&&!this.isGif()?"iframe":".PaddedPin img.pinImage");case"boardPinsGrid":return this.$("img");case"summary":return this.$(".pinHolder .pinImg");default:return this.log.error("requesting pin media for unsupported view_type:"+a),null}},isEmbed:function(){return this.data.embed&&this.data.embed.src},isGif:function(){return this.data.embed&&"gif"===this.data.embed.type},isVideo:function(){return this.data.is_video},getDominantColor:function(){return this.data.dominant_color||"#eee"},getDetailedImageDimensions:function(){var a={width:736,height:370},b={youtube:a,vimeo:a,vevo:a,soundcloud:{width:553,height:166}};if(this.data.is_playable&&(this.data.is_video||this.data.attribution&&this.data.attribution.embed)){if(this.data.attribution){var c=b[this.data.attribution.provider_name];if(c)return c}if(this.data.embed)return this.data.embed}return this.data.images["736x"]},_getViewType:function(){return this.options.view_type?this.options.view_type:VIEW_TYPES.SUMMARY},onContentReady:function(){P.modules.PinBase.prototype.onContentReady.call(this);var a=this.options.pin_id;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_CREATED]=this.onPinCommentCreated,b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_DELETED]=this.onPinCommentDeleted,b[P.CONST.PUBSUB_TOPIC_PIN_COMMENT_POPULATED]=this.onPinCommentPopulated,b[P.CONST.PUBSUB_TOPIC_PIN_DELETED]=this.onPinDeleted,b[P.CONST.PUBSUB_TOPIC_PIN_LIKED]=this.onPinLiked,b[P.CONST.PUBSUB_TOPIC_PIN_UNLIKED]=this.onPinUnliked,b[P.CONST.PUBSUB_TOPIC_PIN_UPDATED]=this.onPinUpdated,this.pubsubSubscribe(a,b)}this.listen(this,P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_NAVIGATE,this.onNavigate),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.childListen(P.CONST.EVENT_DROPDOWN_HIDE,this.onDropdownHide),this.childListen(P.CONST.EVENT_LAZY_IMAGE_COMPLETE,this.onImageLoaded),this.childListen(P.CONST.EVENT_PIN_COMMENTS_TOGGLED,this.onPinCommentsToggled),this.childListen(P.CONST.EVENT_REQUIRES_AUTHENTICATION,function(a){a.data.contextualResource||(a.data.contextualResource=this.getContextualResource())}),this.listen(this,P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER,this.addHoverListenerForMapMarker),this.listen(this,P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER,this.removeHoverListenerForMapMarker),this._commentList=this.getChildById("comment_list")},closeAddToMapModalIfNeeded:function(){var a=this.getChildById("addToMap");a&&P.getModalManager().removeTopModal()},getContextualResource:function(){return P.resourceFactory.create("PinResource",{id:this.getId()})},onGifClick:function(a){a.preventDefault(),this.originalSrc||(this.originalSrc=this.$(".pinImg").attr("src"));var b=this.$(".playIndicatorPill.gifType");return this.isPlaying?(this.$(".pinImg").attr("src",this.originalSrc),b.removeClass("playing")):(this.$(".pinImg").attr("src",this.data.embed.src),b.addClass("playing")),this.isPlaying=!this.isPlaying,!1},addHoverListenerForMapMarker:function(){var a=this,b=this.$el,c=this.getId(),d=this.getChildById("seeOnMap");this.removeHoverListenerForMapMarker(),b.on(MOUSEENTER_EVENT_NAME,function(){a.triggerEvent(P.CONST.EVENT_PIN_MOUSE_IN,c,!0),d&&d.setHighlight(!0)}),b.on(MOUSELEAVE_EVENT_NAME,function(){a._forceSeeOnMap||(a.triggerEvent(P.CONST.EVENT_PIN_MOUSE_OUT,c,!0),d&&d.setHighlight(!1))})},removeHoverListenerForMapMarker:function(){var a=this.$el;a.off(MOUSEENTER_EVENT_NAME+" "+MOUSELEAVE_EVENT_NAME)},onDropdownShow:function(a){var b=a.target.options.view_type;"pickedForYou"===b?P.logFrontEndEvent("pickedForYouHoverShow"):this.toggleActionButtons(!0)},onDropdownHide:function(){this.toggleActionButtons(!1)},onImageLoaded:function(a){a.stopPropagation();var b=this.$(".fadeContainer");if(b.length>0){var c=P.overlap.isOverlappingViewport(b,0);P.deferDomManipulation(function(){b.addClass("loaded"),c&&b.addClass("fade")})}},onNavigate:function(a){P.isOffsiteUrl(a.data.url)&&(a.data.pinId=this.options.pin_id),this.hideDropdowns()},hideDropdowns:function(){var a=this.getChildrenByModuleName("DropdownButton");_.each(a,function(a){a.getDropdown().hide()})},onPinCommentCreated:function(){this._getViewType()===VIEW_TYPES.SUMMARY&&this.render()},onPinCommentDeleted:function(){this._getViewType()===VIEW_TYPES.SUMMARY&&this.render()},onPinCommentPopulated:function(a,b,c){this.showPinComments(c)},onPinLiked:function(){this.triggerEvent(P.CONST.EVENT_PIN_LIKED,null,!0);var a=this.getChildById("likeButton");a&&a.setState(!0)},onPinUnliked:function(){this.triggerEvent(P.CONST.EVENT_PIN_UNLIKED,null,!0);var a=this.getChildById("likeButton");a&&a.setState(!1)},onPinUpdated:function(a,b,c){this.triggerEvent(P.CONST.EVENT_PIN_UPDATED,c,!0),this.render()},onPinDeleted:function(){this.triggerEvent(P.CONST.EVENT_PIN_DELETED,this,!0),this.destroy()},onPinCommentsToggled:function(){this._commentList?this._commentList.toggle():this.showPinComments()},onPinMaskClicked:function(){this.triggerEvent(P.CONST.EVENT_PIN_MASK_CLICKED,{module:this},!0)},showPinComments:function(a){if(this._commentList)this._commentList.show(),this._commentList.populateComment(a);else{var b=this.data,c=b.id,d=b.comment_count,e=P.resourceFactory.create("PinCommentListResource",{field_set_key:"pin_detailed",pin_id:c,page_size:50}),f=new P.modules.PinCommentList({id:"comment_list",options:{pin_id:c,count:d,image_size:"medium",show_actions:!0,max_num_to_show:50,view_type:"detailed",pre_populate:a},resource:e});f.render(),this._commentList=f;var g=this.$(".pinComments");this.insertChild(f,g)}},getSourceUrl:function(){return this.data.link||""},getFirstVisualObject:function(){var a=this.getChildByModuleName("PaddedPin");return a?a.getFirstVisualObject():null}}),goog.provide("P.modules.PinCreate2"),goog.require("P.Module"),goog.require("P.modules.UserSocialNetworkSettings");var API_RESPONSE_CODE_SPAM_CONTENT=14;P.modules.PinCreate2=P.modules.UserSocialNetworkSettings.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged"},onCreated:function(){this.onPinCreateSuccess=_.bindFn(this.onPinCreateSuccess,this),P.modules.UserSocialNetworkSettings.prototype.onCreated.apply(this,arguments),this.networkToSelectorMap={},this.networkToSelectorMap[P.SocialConnect.FACEBOOK]='[name="share_facebook"]',this.networkToSelectorMap[P.SocialConnect.TWITTER]='[name="share_twitter"]'},onContentReady:function(){this.requestPending=!1,this.GACategory=this.isRepin()?"repin_create":"pin_create";var a={};this.$pinPreviewImg=this.$(".pinPreviewImg"),this.$pinDescription=this.$(".pinDescription"),a={description:[P.Validator.Required(),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})],boardName:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})]},this.form=new P.Form(this.$("form"),a),this.boardPicker=this.getChildById("boardPicker2"),this.childListen(P.CONST.EVENT_BOARD_SELECTED,this._onChildBoardSelected),this.isRepin()||this._autofocusDescription()},_autofocusDescription:function(){this.$(".content[autofocus]:not(:focus)").eq(0).focus()},_onChildBoardSelected:function(a){var b=a.data.boardId,c=a.data.boardName;if(b||c){var d=this;this.form.validate(function(){b?d.createPin(b):d.createBoardAndPin(c)})}},onFacebookCheckboxChanged:function(){var a=this.getNetworkChecked(P.SocialConnect.FACEBOOK);if(a){var b=this;P.FbUtil.maybeRequestFbTimelinePermission({error:function(){b.setNetworkChecked(P.SocialConnect.FACEBOOK,!a)}})}},isRepin:function(){return!(!this.data||!this.data.id)},getDescription:function(){var a=this.getChildById("pinDescriptionField");return a.getValue()},setNetworkChecked:function(a,b){var c=this.networkToSelectorMap[a];c&&(this.$(c).prop("checked",b),this.$(c).trigger("click"))},getNetworkChecked:function(a){var b=this.networkToSelectorMap[a];if(b){var c=this.$(b);return c.length?c.is(":checked"):""}},createBoardAndPin:function(a){var b=this.boardPicker.getLoadingSpinTarget();this.showLoading(!1,b);var c=this;this.createBoard(a,{success:function(a){c.createPin(a)},complete:function(){c.hideLoading()}})},createBoard:function(a,b){b=b||{};var c=P.resourceFactory.create("BoardResource",{name:a}),d=this,e=function(a){if(a){var c=a.resource_response,e=c.data.id;d.boardPicker.setSelectedBoardId(e),b.success&&b.success(e)}else b.error&&b.error()},f=function(a){P.showError(a.message),b.error&&b.error()},g=function(){b.complete&&b.complete()};c.callCreate({success:e,error:f,complete:g})},getPinResource:function(){var a="PinResource",b={};this.extraData&&(b.link=this.extraData.link,b.is_video=this.extraData.isVideo,b.image_url=this.extraData.imageUrl),b=_.extend(b,_.pick(this.options,"method")),this.isRepin()&&(a="RepinResource",b.pin_id=this.data.id),b.description=this.getDescription();var c=this.getNetworkChecked(P.SocialConnect.TWITTER);""!==c&&(b.share_twitter=c);var d=this.getNetworkChecked(P.SocialConnect.FACEBOOK);return""!==d&&(b.share_facebook=d),P.resourceFactory.create(a,b)},createPin:function(a){if(!this.requestPending&&(!this.form||!this.form.hasErrors())&&(a=a||this.boardPicker.getSelectedBoardName())){var b=this.boardPicker.getLoadingSpinTarget();this.showLoading(!1,b);var c=this,d=this.getPinResource();d.options.board_id=a,this.requestPending=!0,d.callCreate({success:this.onPinCreateSuccess,error:function(a){if(P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_ERROR),"create"===c.options.action&&a.api_error_code===API_RESPONSE_CODE_SPAM_CONTENT){var b={name:"ConfirmDialog",options:{fluid:!0,template:"blocked_source"}};P.loadModule(b,function(a){a.render(function(){c.parent.appendChild(a),c.destroy()})})}else P.showError(a.message)},complete:function(){c.requestPending=!1,c.hideLoading()}})}},onPinCreateSuccess:function(a){P.trackGAEvent(this.GACategory,P.CONST.GA_ACTION_SUCCESS);var b=this,c=a.resource_response.data,d=c.board,e=d.url,f=this.options.action,g=d.name,h=d.privacy,i=d.is_collaborative,j={id:"pinSuccess",name:"PinCreateSuccess",options:{action:f,board:g,board_url:e,pin_id:c.id,domain:c.domain,is_collaborative:i,privacy:h},resource:P.Resource.NOOP_RESOURCE};P.loadModule(j,function(a){var c=b.modal;c?(c.setTransparentContent(!1),c.setModule(a)):a.render(function(){b.parent.appendChild(a),b.destroy()})}),this.triggerEvent(P.CONST.EVENT_PIN_CREATE,c),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED,c),P.pubsub.publish(c.board.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED,c),P.pubsub.publish(P.currentUser.id,P.CONST.PUBSUB_TOPIC_PIN_CREATED),this.isRepin()&&P.pubsub.publish(this.data.id,P.CONST.PUBSUB_TOPIC_PIN_REPINNED,c)}}),goog.provide("P.modules.PinForm"),goog.require("P.Module"),goog.require("P.modules.UserSocialNetworkSettings");var FB_KEY=P.SocialConnect.FACEBOOK,TW_KEY=P.SocialConnect.TWITTER,BOARD_PRIVACY_SECRET="secret",SHARE_SOCIAL_WRAPPER_SELECT=".socialShareWrapper";P.modules.PinForm=P.modules.UserSocialNetworkSettings.extend({events:{'change [name="share_facebook"]':"onFacebookCheckboxChanged",click:"_onClick"},setImage:function(a){this.options.image_url=a;var b=this.getChildById("pinPreview");b.setImage(a)},_onClick:function(){var a=this.getChildByModuleName("PlaceSelector");if(a){var b=a.getTypeaheadField(),c=b.typeahead;c.isOpen()&&c.hide()}},onCreated:function(){P.modules.UserSocialNetworkSettings.prototype.onCreated.apply(this,arguments),this.networkToSelectorMap={},this.networkToSelectorMap[FB_KEY]='[name="share_facebook"]',this.networkToSelectorMap[TW_KEY]='[name="share_twitter"]'},onFacebookCheckboxChanged:function(){var a=this.getNetworkChecked(P.SocialConnect.FACEBOOK);if(a){var b=this;P.FbUtil.maybeRequestFbTimelinePermission({error:function(){b.setNetworkChecked(P.SocialConnect.FACEBOOK,!a)}})}},onContentReady:function(){var a={message:P._("Don't forget a description!")},b={description:[P.Validator.Required(a),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]};this.form=new P.Form(this.$("form"),b),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated),this.childListen(P.CONST.EVENT_CHANGE,this._onChildChange),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this._boardPicker=this.getBoardPicker(),this._boardPicker.getPrivacy()===BOARD_PRIVACY_SECRET&&this.hideSocialExplicitSharing();var c=this.getChildById("uploader");c&&this.listen(c,P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess)},onButtonClick:function(a){var b=a.target,c=b.id;if("addPlaceButton"===c){var d=this.$(".fields");a.target.hide(),d.removeClass("hidden"),d.find("input").focus()}},_onChildChange:function(a){if("boardPicker"===a.target.id){var b=a.data;b.privacy===BOARD_PRIVACY_SECRET?this.hideSocialExplicitSharing():this.showSocialExplicitSharing()}},hideSocialExplicitSharing:function(){this.$(SHARE_SOCIAL_WRAPPER_SELECT).hide()},showSocialExplicitSharing:function(){this.$(SHARE_SOCIAL_WRAPPER_SELECT).show()},onSubmitValidated:function(a){this.triggerEvent(P.CONST.EVENT_SUBMIT_VALIDATED,a,!0)},onUploadSuccess:function(a){var b=a.data.image_url,c=this.getChildById("pinPreview");c.setImage(b),this.options.image_url=b},getBoardPicker:function(){return this.getChildById("boardPicker")},getBoardId:function(){return this._boardPicker.getSelectedBoardId()},getDescription:function(){return this.getChildById("pinDescriptionField").getValue()},setNetworkChecked:function(a,b){var c=this.networkToSelectorMap[a];c&&this.$(c).prop("checked",b)},getNetworkChecked:function(a){var b=this.networkToSelectorMap[a];if(b){var c=this.$(b);return c.length?c.is(":checked"):""}},getImageUrl:function(){return this.options.image_url},getLink:function(){return this.$("#pinFormLink").val()||""},getData:function(){var a={board_id:this.getBoardId(),description:this.getDescription(),link:this.getLink()},b=this.getNetworkChecked(P.SocialConnect.TWITTER);""!==b&&(a.share_twitter=b),b=this.getNetworkChecked(P.SocialConnect.FACEBOOK),""!==b&&(a.share_facebook=b);var c=this.getImageUrl();if(c&&(a.image_url=c,P.beginsWith(c,"//"))){var d=document.referrer;if(d){var e;P.beginsWith(d,"http://")?e="http:":P.beginsWith(d,"https://")&&(e="https:"),e&&(a.image_url=e+a.image_url)}}var f=this.$("#pinPlaceId");return f.length&&(a.place=f.val()),a},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/PinForm/PinForm.nunjucks")}),goog.provide("P.modules.PresenterButton"),goog.require("P.modules.DropdownButton"),P.modules.PresenterButton=P.modules.DropdownButton.extend({}),goog.provide("P.modules.SendObject2Base"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup"),goog.require("P.modules.ConversationsList"),goog.require("P.conversationsUtil"),P.modules.SendObject2Base=P.Module.extend({_OBJECT_ID_NAME:"",_SEND_RESOURCE_NAME:"ConversationsResource",mixins:[P.Mixins.PreventScroll,P.Mixins.SocialConnectInTypeahead],onContentReady:function(){this.childListen(P.CONST.EVENT_CONVERSATION_LIST_ITEM_CLICKED,this.onListItemClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onItemSelected),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onTypeaheadHint),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoResultsReturned),this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentChanged),this.listen(this.parent,P.CONST.EVENT_DROPDOWN_SHOW,this.onShow),this.startPreventingScroll(),this._setup()},onSearchStart:function(){this.$(".spinner").addClass("visible"),this.hideConversationsList()},onShow:function(){this._focusTypeahead()},onTypeaheadHint:function(){this.updateTypeaheadStaticItems(this._getTypeaheadField(),!0)},_getTypeaheadField:function(){return this.getChildById("typeaheadField")},_focusTypeahead:function(){var a=this._getTypeaheadField();window.setTimeout(function(){a.focus()},100)},onContentChanged:function(){this.startPreventingScroll()},onNoResultsReturned:function(){this.$(".spinner").removeClass("visible");var a=this._getTypeaheadField();$.trim(a.getValue()).length||this.showConversationsList()},onResultsReturned:function(){this.$(".spinner").removeClass("visible")},hideConversationsList:function(){var a=this._getConversationsList();a.fadeOut()},showConversationsList:function(){var a=this._getConversationsList();a.fadeIn()},_getConversationsList:function(){return this.getChildById("conversationsList")},_setup:function(){this._setMaxHeight(),this.initSocialConnectItems()},_setMaxHeight:function(){this.$el.css("maxHeight",this.$el.height())},startPreventingScroll:function(){this.startPreventScroll(this.$(".ConversationsList").last(),this.$(".List").last())},onItemSelected:function(a){var b=a.data.item,c=b.attributes,d=c.network;if(d)return void this.connectToNetwork(d,_.bindFn(this.markNetworkConnected,this,this._getTypeaheadField()));var e=c.username?[c.id]:[],f=c.email?[c.email]:[];this._sendToUsers(e,f),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},reset:function(){this.render()},onListItemClick:function(a){var b=a.target;this._sendToUsers(b.getUserIds(),b.getEmails()),this.triggerEvent(P.CONST.EVENT_DISMISS,null,!0)},_getMessageEl:function(){return this.$(".message")},getMessageValue:function(){return $.trim(this._getMessageEl().val())},clearMessageValue:function(){this._getMessageEl().val("")},_sendToUsers:function(a,b){if(b||(b=[]),a.length+b.length!==0){var c={user_ids:a,emails:b};c[this._OBJECT_ID_NAME]=this.options.object_id;var d=this.getMessageValue();d&&(c.text=d);var e=this,f=P.resourceFactory.create(this._SEND_RESOURCE_NAME,c);f.call("create").then(function(a){var b=a.resource_response.data,c=b.users,d=[];e.clearMessageValue(),_.each(c,function(a){d.push(a.id)});var f=_.indexOf(d,P.currentUser.get("id"));f>=0&&c.splice(f,1),P.getConversationsManager().addConversation(b,!0,!0);var g=b.id;P.pubsub.publish(g,P.CONST.PUBSUB_TOPIC_OBJECT_SENT,!0),e.resetTypeaheadField()})}},resetTypeaheadField:function(){var a=this._getTypeaheadField();a.reset(),a.clear()},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/SendObject2Base/SendObject2Base.nunjucks")}),goog.provide("P.modules.SendPin2"),goog.require("P.Module"),goog.require("P.modules.SendObject2Base"),P.modules.SendPin2=P.modules.SendObject2Base.extend({_OBJECT_ID_NAME:"pin",moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/SendPin2/SendPin2.nunjucks")}),goog.provide("P.modules.SendPinner2"),goog.require("P.Module"),goog.require("P.modules.SendObject2Base"),P.modules.SendPinner2=P.modules.SendObject2Base.extend({_OBJECT_ID_NAME:"user",moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/SendPinner2/SendPinner2.nunjucks")}),goog.provide("P.modules.UserFollowButton"),goog.require("P.Module"),goog.require("P.modules.ui.FollowButton"),P.modules.UserFollowButton=P.modules.ui.FollowButton.extend({getResourceId:function(){return this.options.user_id
},getFollowResource:function(){return P.resourceFactory.create("UserFollowResource",{user_id:this.getResourceId()})},getFollowClass:function(){return this.options.follow_class},onContentReady:function(){this.showMemo()},getContextualResource:function(){return P.resourceFactory.create("UserResource",{user_id:this.getResourceId(),field_set_key:"grid_item"})}}),goog.provide("P.modules.UserMenu"),goog.require("P.Module"),goog.require("P.modules.DropdownButton"),P.modules.UserMenu=P.modules.DropdownButton.extend({onContentReady:function(){var a=this.extraData.userId;if(a){var b={};b[P.CONST.PUBSUB_TOPIC_USER_UPDATED]=this.onUserUpdated,this.pubsubSubscribe(this.extraData.userId,b)}P.modules.DropdownButton.prototype.onContentReady.apply(this,arguments)},onUserUpdated:function(){this.render()},setSticky:function(a){this.getDropdown().setSticky(a)},moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/UserMenu/UserMenu.nunjucks")}),goog.provide("P.modules.UserNews"),goog.require("P.Module"),goog.require("P.modules.FriendsToFollow"),P.modules.UserNews=P.Module.extend({events:{"click .sendInvite":"showBulkInviteBox"},onContentReady:function(){this.destroyIfEmpty()},onChildRemoved:function(){this.destroyIfEmpty()||this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)},getEditFeedButton:function(){var a=this.getChildByModuleName("BoardsToFollow");return a.getEditFeedButtonElement()},getFriendsToFollowButton:function(){var a=this.getChildByModuleName("FriendsToFollow");return a.getHeaderElement()},showBulkInviteBox:function(){var a={name:"MultiInviter"};P.loadModule(a,function(a){P.getModalManager().showInModal(a)})}}),goog.provide("P.modules.UserSelectBase"),goog.require("P.Module"),goog.require("P.modules.ui.TypeaheadField"),goog.require("P.modules.UserSocialNetworkSettings");var USER_SELECT_BASE_CLASS_ACTIVE="active",USER_SELECT_BASE_CLASS_ANIMATE="animate",USER_SELECT_BASE_CLASS_HIDDEN="hidden",SEND_DELAY=2600,CONNECT_SUCCESS_DELAY=2600,ACTIVATE_DELAY=400;P.modules.UserSelectBase=P.modules.UserSocialNetworkSettings.extend({events:{"click .undoUserSelect":"hideFakeSuccess","click .userSelectEmailConnect":"onEmailUserPress","keyup .field":"onFieldKeyup"},sendDelay:SEND_DELAY,onCreated:function(){P.modules.UserSocialNetworkSettings.prototype.onCreated.apply(this,arguments),this._selectedItem=null},getSelectedItem:function(){return this._selectedItem},clearSelectedItem:function(){this._selectedItem=null},onAddedToDom:function(){this._messageShowing=!1,this._hasQueriedTypeahead=!1,this._gplusButtonLoaded=!1},onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_SEARCH_QUERY_UPDATED]=this.onSearchQueryUpdated,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,a),this.$staticResults=this.$(".staticResults"),this.$message=this.$('input[name="message"]'),this.$beforeSend=this.$(".userSelectBeforeSend"),this.$afterSend=this.$(".userSelectAfterSend"),this.$afterConnect=this.$(".userSelectAfterConnect"),this.$userSelectMessageWrapper=this.$(".userSelectMessageWrapper"),this.$emailButtonWrapper=this.$(".emailButtonWrapper"),this.$gmailButtonWrapper=this.$(".gmailButtonWrapper"),this.$facebookButtonWrapper=this.$(".facebookButtonWrapper"),this.$yahooButtonWrapper=this.$(".yahooButtonWrapper"),this.$findFriend=this.$('input[name="userSelectFriendSearch"]'),this.$gplusButtonWrapper=this.$(".gplusButtonWrapper"),this.sendEmailButton=this.getChildById("sendEmail"),this.gplusButton=this.$(".userSelectGplusConnect")[0],this.typeaheadField=this.getChildById("userSelectField"),this.childListen("enterPressed",this.onChildEnterPressed),this.listen(this.parent,P.CONST.EVENT_DROPDOWN_SHOW,this.onEventDropdownShow),"modal"===this.options.class_name?this.listen(this,P.CONST.EVENT_DISMISS,this.onHide):this.listen(this.parent,P.CONST.EVENT_DROPDOWN_HIDE,this.onHide),this.buttonListener&&this.removeListener(this.buttonListener),this.buttonListener=this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onChildItemSelected),this.childListen(P.CONST.EVENT_USER_CLICK,this.onUserClick),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onNoTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_RENDER_DONE,this.onTypeaheadRenderDone),this.$message.placeholder(),this.$findFriend.placeholder(),this.loadGplusButton()},onChildEnterPressed:function(){this.onEmailUserPress()},onTypeaheadRenderDone:function(){},enableGplusShareButton:function(a,b,c){var d=this.$("."+a)[0],e=this;P.gapi.get(function(f){var g={contenturl:b,clientid:e.extraData.gplusClientId,cookiepolicy:"single_host_origin",prefilltext:P._("Join me on Pinterest!"),calltoactionurl:b,recipients:a,calltoactionlabel:c};f.interactivepost.render(d,g)})},onEventDropdownShow:function(){this.focusFriendTypeahead()},onNoTypeaheadResultsReturned:function(){this.showStaticResults(),this.showStaticSocialOptions(),this.showSendEmailButton(),this.focusFriendTypeahead()},onTypeaheadResultsReturned:function(a){var b=a.data.count;this._hasQueriedTypeahead=!0,b?(this.showStaticResults(),this.showSendEmailButton(),this.hideStaticSocialOptions()):this.showStaticSocialOptions()},loadGplusButton:function(){var a=this;P.gapi.get(function(b){this._gplusButtonLoaded||(this._gplusButtonLoaded=!0,b.signin.render(this.gplusButton,{clientid:a.extraData.gplusClientId,accesstype:"offline",cookiepolicy:"single_host_origin",scope:"https://www.googleapis.com/auth/userinfo.email",apppackagename:"com.pinterest",callback:function(b){a.onGplusAuth(b)}}))})},onGplusAuth:function(a){if(a.code&&"none"!==a.prompt){var b={},c={};c.one_time_code=a.code,b.data=c,b.network="gplus";var d=P.resourceFactory.create("UserSocialNetworkResource",b),e=this;d.callCreate().then(function(){e.showConnectSuccess("gplus"),P.trackGAEvent("user_connect_gplus",P.CONST.GA_ACTION_SUCCESS)})}},showGplusConnectButton:function(){this.loadGplusButton(),this.$gplusButtonWrapper.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideGplusConnectButton:function(){this.$gplusButtonWrapper.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideGmailConnectButton:function(){this.$gmailButtonWrapper.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},showGmailConnectButton:function(){this.$gmailButtonWrapper.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideFacebookConnectButton:function(){this.$facebookButtonWrapper.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},showFacebookConnectButton:function(){this.$facebookButtonWrapper.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideYahooConnectButton:function(){this.$yahooButtonWrapper.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},showYahooConnectButton:function(){this.$yahooButtonWrapper.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideSendEmailButton:function(){this.$emailButtonWrapper.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},showSendEmailButton:function(){this.$emailButtonWrapper.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},hideStaticSocialOptions:function(){this.hideFacebookConnectButton(),this.hideGplusConnectButton(),this.hideGmailConnectButton(),this.hideYahooConnectButton()},showStaticSocialOptions:function(){this.showSendEmailButton(),this.showFacebookConnectButton(),this.showGplusConnectButton(),this.showGmailConnectButton(),this.showYahooConnectButton()},hideStaticResults:function(){this.$staticResults.addClass(USER_SELECT_BASE_CLASS_HIDDEN)},showStaticResults:function(){this.$staticResults.removeClass(USER_SELECT_BASE_CLASS_HIDDEN)},focusAddMessageField:function(){this.$message.focusWithoutScrolling()},focusFriendTypeahead:function(){this.$findFriend.focusWithoutScrolling()},setEmailButtonText:function(a,b){var c=P._("Email to {{ email_address }}"),d=P.string.format(c,{email_address:a});this.sendEmailButton.setText(d);var e=!b;this.$(".sendEmailError").text(b).toggleClass("hidden",e)},onHide:function(){var a=this;this._timeout&&this._selectedItem&&(this.onSendAction(),this.reset(),clearTimeout(a._timeout))},onFieldKeyup:function(a){var b=P.keyCode;if(a.keyCode!==b.ENTER&&a.keyCode!==b.NUMPAD_ENTER)if(this.$findFriend.val().length>0){this.sendEmailButton.show();var c=this.$findFriend.val();this.setEmailButtonText(c,"")}else this.sendEmailButton.hide()},onEmailUserPress:function(){var a=this,b=new P.Validator(this.$findFriend,[P.Validator.Length({min:1}),P.Validator.Email()]);b.validate(function(b){if(b.errors.length>0){var c=a.$findFriend.val(),d=b.errors[0];a.setEmailButtonText(c,d)}else a._selectedItem={full_name:a.$findFriend.val(),email:a.$findFriend.val(),type:"emailtypeahead"},a.showSuccess()})},removeMessageContent:function(){this.$message.val("")},onUserClick:function(a){var b=a.target.data,c=a.target;b&&(this._selectedItem=b,b.image_medium_url||(this._selectedItem.image_medium_url=c.getProfileImage()),this.showSuccess())},onButtonClick:function(a){var b=a.target;if(b){var c,d=b.id;switch(d){case"connectFacebook":c=P.SocialConnect.FACEBOOK;break;case"connectGmail":c=P.SocialConnect.GOOGLE;break;case"connectGplus":c=P.SocialConnect.GPLUS;break;case"connectYahoo":c=P.SocialConnect.YAHOO;break;default:return}this.connectToNetwork(c)}},isEmailType:function(a){return"emailcontact"===a||"emailtypeahead"===a||"email"===a},connectToNetwork:function(a){if(a!==P.SocialConnect.GPLUS){var b=this;this.handleConnect(a,!0,{success:function(){b.showConnectSuccess(a),P.trackGAEvent("user_connect_"+a,P.CONST.GA_ACTION_SUCCESS)}})}},hideNetworkConnectButton:function(a){switch(a){case P.SocialConnect.FACEBOOK:this.hideFacebookConnectButton();break;case P.SocialConnect.GPLUS:this.hideGplusConnectButton();break;case P.SocialConnect.YAHOO:this.hideYahooConnectButton()}},showAndHideItem:function(a,b){b.addClass(USER_SELECT_BASE_CLASS_ANIMATE),P.supportCSSTransitions()?window.setTimeout(function(){a.addClass(USER_SELECT_BASE_CLASS_ACTIVE)},ACTIVATE_DELAY):a.addClass(USER_SELECT_BASE_CLASS_ACTIVE)},showConnectSuccess:function(a){var b=this;this.showAndHideItem(this.$afterConnect,this.$beforeSend);var c,d={facebook:"Facebook",google:"Gmail",gplus:"Google+",yahoo:"Yahoo"};a in d?c=d[a]:(P.Logger.getLogger("UserSelectBase").error("Unknown network "+a),c=a),this.$(".userConnectedNetworkName").text(c),this.$(".userSelectConnectSuccessMug").addClass(a+"ConnectSuccessMug"),this._timeout=P.setTimeout(function(){b.resetUserSelect()},CONNECT_SUCCESS_DELAY)},resetUserSelect:function(){this.showAndHideItem(this.$beforeSend,this.$afterConnect),this.reset(),this.render(),this.focusFriendTypeahead(),clearTimeout(this._timeout)},showSuccess:function(){var a=this,b=this._selectedItem,c=b.full_name||b.first_name,d=b.image_medium_url;this.showAndHideItem(this.$afterSend,this.$beforeSend),this.$(".receiverName").text(c),this.$(".userSelectSuccessMug").attr("src",d),this._timeout=P.setTimeout(function(){"modal"===a.options.class_name?a.triggerEvent(P.CONST.EVENT_DISMISS,null,!0):a.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0)},SEND_DELAY)},reset:function(){this.hideFakeSuccess(),this.setMessageValue(""),this.typeaheadField.clear(),this.typeaheadField.closeTypeahead(),this.hideSendEmailButton()},hideFakeSuccess:function(){var a=this;this.$beforeSend.removeClass(USER_SELECT_BASE_CLASS_HIDDEN+" "+USER_SELECT_BASE_CLASS_ANIMATE),this.$afterSend.removeClass(USER_SELECT_BASE_CLASS_ACTIVE+" "+USER_SELECT_BASE_CLASS_ANIMATE),clearTimeout(a._timeout),this._timeout=null},getMessageValue:function(){return $.trim(this.$(".message").val())},setMessageValue:function(a){return $.trim(this.$(".message").val(a))},showTypeaheadResults:function(){var a=this.getChildByModuleName("ui.Typeahead");a.show()},isValidItemType:function(a){return"user"===a||"email"===a||"emailcontact"===a},onChildItemSelected:function(a){a.stopPropagation();var b=a.data.item.attributes;if(this.isValidItemType(b.type))return this._selectedItem=b,this.showSuccess(),!1},onSearchQueryUpdated:function(a,b,c){var d=c||"";this.typeaheadField.setValue(d)},onSendAction:function(){}}),goog.provide("P.modules.UserSelectFriendsInvite"),goog.require("P.Module"),goog.require("P.modules.UserSelectBase");var CLASS_HIDDEN="hidden";P.modules.UserSelectFriendsInvite=P.modules.UserSelectBase.extend({onContentReady:function(){P.modules.UserSelectBase.prototype.onContentReady.call(this),P.fb.ensureInit(P.NOOP)},onChildItemSelected:function(a){a.stopPropagation();var b=a.data.item.attributes;return b.type===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER?(P.Invite.userInviteFacebook(b.id),void this.resetForNextInvite()):b.type===P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER?(P.Invite.trackInvite("gplus",!0),void this.resetForNextInvite()):void P.modules.UserSelectBase.prototype.onChildItemSelected.call(this,a)},onSendAction:function(){var a=this.getSelectedItem();"user"===a.type?this.userFollow(a):this.isEmailType(a.type)?P.Invite.userInviteEmail(a.email):P.showError(P.string.common.defaultErrorMessage),this.resetForNextInvite()},onTypeaheadRenderDone:function(a){var b=P.absolutify("/"+P.currentUser.get("username"));this.enableGplusShareButton(a.data,b,"VISIT")},userFollow:function(a){var b=P.resourceFactory.create("UserFollowResource",{user_id:a.id});b.call("create").then(function(){P.Invite.trackInvite("pinterest",!0)},function(){P.Invite.trackInvite("pinterest",!1)})},resetForNextInvite:function(){this.parent&&this.parent.show(),this.reset(),this.$(".inviteFriends").addClass(CLASS_HIDDEN),this.$(".inviteMoreFriends").removeClass(CLASS_HIDDEN)},showSuccess:function(){var a=this.getSelectedItem(),b=this.$(".inviteSent"),c=this.$(".followSent");"user"===a.type?(b.addClass(CLASS_HIDDEN),c.removeClass(CLASS_HIDDEN)):(b.removeClass(CLASS_HIDDEN),c.addClass(CLASS_HIDDEN)),P.modules.UserSelectBase.prototype.showSuccess.call(this)}}),goog.provide("P.modules.tutorials.ModalCategorySearchIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalCategorySearchIntro=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){var b=this._getHighlightedElementForModule("categoriesDropdownButton"),c=this._getHighlightedElementForModule("mainSearchTextbox"),d=b||c;d&&(this.setModalPosition("BOTTOM_LEFT",d,!0),d.addClass("categorySearchIntroHighlight")),a&&a()},_getHighlightedElementForModule:function(a){var b=this._getModuleChildById(P.app,a);return b?this._highlightModule(b,!0):null},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_CATEGORY_SEARCH_USER_ED}}),goog.provide("P.modules.tutorials.ModalExploreButton"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalExploreButton=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){this.module=this._getModuleChildById(P.app,"categoriesDropdownButton")||this._getModuleChildById(P.app,"headerExploreButton");var b;this.module&&(b=this._highlightModule(this.module,!0)),b&&this.setModalPosition("BOTTOM_LEFT",b,!0),a&&a()},onButtonClick:function(a){var b=a.target;"nextButton"===b.id&&("DropdownButton"===this.module.className?this.module.showDropdown():this.navigate("/explore/"))},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EXPLORE_BUTTON_USER_ED}}),goog.provide("P.modules.tutorials.ModalExploreCheckBack"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalExploreCheckBack=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){var b,c=this._getModuleChildById(P.app,"header");b="ModernHeader"!==c.className?"categoriesDropdownButton":"exploreCategoriesButton";var d=c.getChildById(b),e=this._highlightModule(d,!0);this.setModalPosition("BOTTOM_LEFT",e,!0),a&&a()},getPlacementId:function(){return P.Experiences.Placement.WEB_EXPLORE_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EXPLORE_PAGE_USER_ED}}),goog.provide("P.modules.tutorials.ModalExploreInterest"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalExploreInterest=P.modules.tutorials.ModalStepBase.extend({highlightChildState:1,onEnter:function(a){this.ensurePath("/explore/"),a&&a()},onShow:function(a){var b=this,c=this._getModuleChildById(P.app,"interestGrid"),d=this._getModuleChildrenByModuleName(c,"Interest");if(d=_.filter(d,function(a){return a.state===b.highlightChildState}),d.length){var e=d[0];1===this.highlightChildState&&d.length>=3&&(e=d[3]);var f=this._highlightModule(e,!0),g=$(window).width(),h="RIGHT_TOP";f.offset().left+f.width()>g/2&&(h="LEFT_TOP"),this.setModalPosition(h,f,!0),a&&a()}}}),goog.provide("P.modules.tutorials.ModalExplorePage"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalExplorePage=P.modules.tutorials.ModalStepBase.extend({onEnter:function(a){this.ensurePath("/explore/"),a&&a()},getPlacementId:function(){return P.Experiences.Placement.WEB_EXPLORE_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EXPLORE_PAGE_USER_ED}}),goog.provide("P.modules.tutorials.ModalFastFollowIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalFastFollowIntro=P.modules.tutorials.ModalStepBase.extend({onCreated:function(){P.modules.tutorials.ModalStepBase.prototype.onCreated.apply(this,arguments),this.listen(this,P.CONST.EVENT_NEXT,_.bindFn(this.onNextClicked,this))},onNextClicked:function(){var a=this._getMenu(),b=a.getDropdown().getContentModule();b.openFindBoards()},onShow:function(a){var b=this,c=this._getMenu();c.getDropdown().setSticky(!0),c.showDropdown(_.bindFn(function(){var d=c.getDropdown().getContentModule(),e=d.getFindBoardsElement(),f=this._highlightElement("highlightContainer",e,!0);f.addClass("fastFollowIntroHighlight"),f.on("click",function(){b.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}),this.setModalPosition("LEFT_TOP",f,!0),a&&a()},this))},_getMenu:function(){return this._getModuleChildById(P.app,"userMenu")},onExit:function(a){if(P.app){var b=this._getMenu();b.getDropdown().setSticky(!1),b.hideDropdown()}a&&a()},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FAST_FOLLOW_USER_ED}}),goog.provide("P.modules.tutorials.ModalFindFriendsIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalFindFriendsIntro=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){this.highlightFindFriendsInMenu(a)},onExit:function(a){if(P.app){var b=this._getMenu();b.getDropdown().setSticky(!1),b.hideDropdown()}a&&a()},highlightFindFriendsInMenu:function(a){var b=this,c=this._getMenu();c.getDropdown().setSticky(!0),c.showDropdown(_.bindFn(function(){var d=c.getDropdown().getContentModule(),e=d.getFindFriendsElement(),f=this._highlightElement("highlightContainer",e,!0);f.addClass("findFriendsIntroHighlightMenu"),f.on("click",function(){b.triggerEvent(P.CONST.EVENT_NEXT,null,!0)});var g="LEFT_TOP";this.setModalPosition(g,f,!0),a&&a()},this))},_getMenu:function(){return this._getModuleChildById(P.app,"userMenu")},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIND_FRIENDS_USER_ED}}),goog.provide("P.modules.tutorials.ModalFirstBoardIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalFirstBoardIntro=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){$("html, body").scrollTop(0);var b=!1,c=this._getModuleChildrenByModuleName(P.app,"UserProfileContent");if(c&&c[0]){var d=c[0].data,e=d.board_count+d.secret_board_count;b=e>0}var f,g;b?(f=this.$(".hasBoardsTitle"),g=this.$(".hasBoardsContent")):(f=this.$(".hasNoBoardsTitle"),g=this.$(".hasNoBoardsContent")),f.show(),g.show(),this.highlightBoard(),a&&a()},highlightBoard:function(){if(this.board=this.getTargetBoard(),this.board){var a=this._highlightModule(this.board,!0);a.on("click",_.bindFn(this.onBoardClicked,this)),a.addClass("firstBoardIntroHighlight");var b,c=$(window).height();b=a.offset().top+a.height()>c?"TOP_LEFT":"RIGHT_TOP",this.setModalPosition(b,a,!0)}},setCloneInteractions:function(a){this.disableCloneLinks(a)},getTargetBoard:function(){var a,b=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(b){var c=b.getGridItems();a=c.getChildModuleAtIndex(0,"BoardCreateRep")}return a},onBoardClicked:function(a){return a.preventDefault(),this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0),this.board.showModal(),!1},getPlacementId:function(){return P.Experiences.Placement.WEB_USER_PROFILE_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIRST_BOARD_USER_ED}}),goog.provide("P.modules.tutorials.ModalFirstPinIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalFirstPinIntro=P.modules.tutorials.ModalStepBase.extend({onCreated:function(){P.modules.tutorials.ModalStepBase.prototype.onCreated.apply(this,arguments),this.listen(P.Viewport,P.CONST.EVENT_BODY_COLUMN_CHANGE,_.bindFn(this.onBodyColumnChange,this))},onShow:function(a){this.highlightPin(),a&&a()},highlightPin:function(){if(this.pin=this.getTargetPin(),this.pin){var a=this._highlightModule(this.pin,!0);this.$repinButton=a.find(".repinSmall"),this.$repinButton.on("click",_.bindFn(this.onRepinClicked,this)),this.modal.$el.addClass("modalPinIntro"),this.setModalPosition("LEFT_TOP",this.$repinButton,!0),a.addClass("firstPinIntroHighlight")}},setCloneInteractions:function(a){this.disableCloneLinks(a)},getTargetPin:function(){var a=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(a){var b=a.getGridItems(),c=Math.ceil(P.Viewport.numColumns/2);return b.getChildModuleAtIndex(c,"Pin")}},onBodyColumnChange:function(){this.$repinButton.off(),this.$repinButton=null,this.cleanHighlightedElements(),this.highlightPin()},onRepinClicked:function(){this.triggerEvent(P.CONST.EVENT_PREVIOUS,null,!0);var a=this.pin.getChildById("pinItButton");a.showModal()},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FIRST_PIN_USER_ED}}),goog.provide("P.modules.tutorials.ModalHomeFeedPinIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase");var MODAL_HOME_FEED_LOGO_STEP_BACKGROUND_CLASS="pinterestLogoStepBackground";P.modules.tutorials.ModalHomeFeedPinIntro=P.modules.tutorials.ModalStepBase.extend({onEnter:function(a){this.ensurePath("/"),a&&a()},onShow:function(a){var b=this._getModuleChildById(P.app,"header"),c=b.getHomeElement(),d=this._highlightElement("homeButton",c,!0),e=$("<div>");e.addClass(MODAL_HOME_FEED_LOGO_STEP_BACKGROUND_CLASS),e.css({top:d.offset().top-60,left:d.offset().left}),$("body").append(e),a&&a()},onExit:function(a){$("."+MODAL_HOME_FEED_LOGO_STEP_BACKGROUND_CLASS).remove(),a&&a()}}),goog.provide("P.modules.tutorials.ModalPinIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase");var SAMPLE_PIN_CLASS="samplePinTutorialStep";P.modules.tutorials.ModalPinIntro=P.modules.tutorials.ModalStepBase.extend({onEnter:function(a){this.ensurePath("/"),$("body").append('<div class="'+SAMPLE_PIN_CLASS+'">&nbsp;</div>'),a&&a()},onShow:function(a){var b=$("."+SAMPLE_PIN_CLASS);this.setModalPosition("RIGHT_TOP",b,!0),a&&a()},onExit:function(a){$("."+SAMPLE_PIN_CLASS).remove(),a&&a()}}),goog.provide("P.modules.tutorials.ModalPlacePinsAddBase"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalPlacePinsAddBase=P.modules.tutorials.ModalStepBase.extend({onShow:function(){this.highlightAddButton()},highlightAddButton:function(){if(this.button=this.getTargetModule(),this.button){var a=this._highlightModule(this.button,!0);this.setModalPosition("RIGHT_TOP",a,!0)}},getTargetModule:function(){var a=this._getModuleChildrenByModuleName(P.app,"BoardPage")[0];if(a){var b=this._getModuleChildrenByModuleName(a,"ShowModalButton");if(!_.isEmpty(b)){var c=_.find(b,function(a){return a.$el.hasClass("addAPlace")});return c}}}}),goog.provide("P.modules.tutorials.ModalPlacePinsAddEmpty"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalPlacePinsAddBase"),P.modules.tutorials.ModalPlacePinsAddEmpty=P.modules.tutorials.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED},onNextButtonClicked:function(){this.button.$el.click()}}),goog.provide("P.modules.tutorials.ModalPlacePinsAddFilled"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalPlacePinsAddBase"),P.modules.tutorials.ModalPlacePinsAddFilled=P.modules.tutorials.ModalPlacePinsAddBase.extend({getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.tutorials.ModalPlacePinsEdit"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalPlacePinsEdit=P.modules.tutorials.ModalStepBase.extend({onShow:function(){$("html, body").scrollTop(0),this.highlightEditButton()},highlightEditButton:function(){var a=this.getTargetModule();if(a){var b=this._highlightModule(a,!0);this.setModalPosition("RIGHT_CENTER",b,!0)}},getTargetModule:function(){var a=this._getModuleChildrenByModuleName(P.app,"PlaceBoardInfoBar")[0];if(a){var b=this._getModuleChildById(a,"editButton");if(b)return b}},getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.tutorials.ModalPlacePinsIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalPlacePinsIntro=P.modules.tutorials.ModalStepBase.extend({onShow:function(){this.pageName=this.getPageName(),this.highlightEditButton()},highlightEditButton:function(){var a=this.getTargetModule();if(a){var b=this._highlightModule(a,!0);if("BoardPage"===this.pageName)this.setModalPosition("BOTTOM_CENTER",b,!0);else if("UserProfilePage"===this.pageName){var c,d=$(window).height();c=b.offset().top+b.height()>d?"TOP_CENTER":"RIGHT_CENTER",this.setModalPosition(c,b,!0)}}},getTargetModule:function(){var a;if("BoardPage"===this.pageName){if(a=this._getModuleChildrenByModuleName(P.app,"BoardInfoBar")[0],!a)return;var b=a.getChildrenByModuleName("ShowModalButton"),c=_.find(b,function(a){return a.$el.hasClass("boardEditButton")});return c}return"UserProfilePage"===this.pageName?this._getModuleChildrenByModuleName(P.app,"Board")[0]:void 0},onPreviousButtonClicked:function(){this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),P.navigate("/places/examples/")},getPageName:function(){var a=this._getModuleChildrenByModuleName(P.app,"BoardPage");return _.isEmpty(a)&&(a=this._getModuleChildrenByModuleName(P.app,"UserProfilePage")),_.isEmpty(a)||1!==a.length?void 0:a[0].className},getPlacementId:function(){return"BoardPage"===this.pageName?P.Experiences.Placement.WEB_BOARD_TAKEOVER:"UserProfilePage"===this.pageName?P.Experiences.Placement.WEB_USER_PROFILE_TAKEOVER:void 0},getExperienceId:function(){return P.Experiences.Experience.WEB_PLACE_PINS_TOOLTIP}}),goog.provide("P.modules.tutorials.ModalPlacePinsShow"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalPlacePinsShow=P.modules.tutorials.ModalStepBase.extend({onShow:function(){this.highlightAddPlace()},highlightAddPlace:function(){var a=this.getTargetPin(),b=this._getModuleChildById(a,"addToMap");if(b||(b=this._getModuleChildById(a,"seeOnMap")),b){var c=b.$el,d=c.offset().top,e=c.height(),f=P.Viewport.height,g=$(".headerBackground").height(),h=d-f/2-g/2+e/2;this.$("."+b.id).show(),$(window).scrollTop(h);var i=this._highlightModule(b,!0);this.setModalPosition("RIGHT_CENTER",i,!0,!0)}},getTargetPin:function(){var a=this._getModuleChildrenByModuleName(P.app,"Grid")[0];if(a){var b=a.getGridItems();return b.getChildModuleAtIndex(0,"Pin")}},getPlacementId:function(){return P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.tutorials.ModalQAIntroBaseStep"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalQAIntroBaseStep=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){this.isContextualExperience=!0;var b=this.getHighlightedElement();b&&(this.adjustHighlightedElement(b),this.modal.options.caret_style="lightGray",this.setModalPosition("TOP_LEFT",b,!0)),a&&a()},getHighlightedElement:P.NOOP,adjustHighlightedElement:P.NOOP}),goog.provide("P.modules.tutorials.ModalQuestionIntroOne"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalQAIntroBaseStep"),P.modules.tutorials.ModalQuestionIntroOne=P.modules.tutorials.ModalQAIntroBaseStep.extend({getHighlightedElement:function(){var a=this._getModuleChildrenByModuleName(P.app,"Questions");return a&&0!==a.length?this._highlightModule(a[0],!0):null},adjustHighlightedElement:function(a){var b=a.width(),c=a.height();a.css({width:b+20,height:c+20}).addClass("modalQuestionIntroHighlighted")}}),goog.provide("P.modules.tutorials.ModalQuestionIntroTwo"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalQAIntroBaseStep"),P.modules.tutorials.ModalQuestionIntroTwo=P.modules.tutorials.ModalQAIntroBaseStep.extend({_onBeforeShow:function(){var a=this._getModuleChildrenByModuleName(P.app,"Question"),b=a[0].getQuestionUserName(),c=this.$(".questionIntroTitle").html(),d=P.string.format(c,{name:b});this.$(".questionIntroTitle").html(d)},onShow:function(a){this._onBeforeShow(),P.modules.tutorials.ModalQAIntroBaseStep.prototype.onShow.call(this,a)},getHighlightedElement:function(){var a=this._getModuleChildrenByModuleName(P.app,"Question");return a&&0!==a.length?this._highlightModule(a[0],!0):null}}),goog.provide("P.modules.tutorials.ModalSeeProfileIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalSeeProfileIntro=P.modules.tutorials.ModalStepBase.extend({onShow:function(a){var b=this,c=this._getModuleChildrenByModuleName(P.app,"UserMenu")[0];c.setSticky(!0),c.showDropdown(_.bindFn(function(){var d=c.getDropdown().getChildByModuleName("UserDropdown").getMyBoardsElement(),e=this._highlightElement("highlightContainer",d,!0);e.addClass("seeProfileIntroHighlight"),e.on("click",function(){b.triggerEvent(P.CONST.EVENT_NEXT,null,!0)}),this.setModalPosition("LEFT_TOP",e,!0),a&&a()},this))},onExit:function(a){if(P.app){var b=this._getModuleChildrenByModuleName(P.app,"UserMenu")[0];b.setSticky(!1),b.hideDropdown()}a&&a()},getPlacementId:function(){return P.Experiences.Placement.WEB_HOME_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_YOUR_BOARDS_USER_ED}}),goog.provide("P.modules.tutorials.ModalVisualObjectSearchIntro"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),P.modules.tutorials.ModalVisualObjectSearchIntro=P.modules.tutorials.ModalStepBase.extend({getExperienceId:function(){return P.Experiences.Experience.WEB_VISUAL_OBJECT_SEARCH_CLOSEUP_USER_ED},getPlacementId:function(){return P.Experiences.Placement.WEB_PIN_CLOSEUP},onShow:function(a){this.isContextualExperience=!0;var b=this._getHighlightedClickTarget();b&&(b.css({"margin-left":"auto","margin-top":"auto"}),this.setModalPosition("BOTTOM_CENTER",b,!0,!1)),a&&a(),this.setExperienceViewed()},_getHighlightedClickTarget:function(){var a=this._getModuleChildrenByModuleName(P.app,"PaddedPin");return a.length?this._highlightElement("highlightedVisualObject",a[0].getFirstVisualObject(),!0):null}}),goog.provide("P.modules.tutorials.NewUserFindFriends"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase"),P.modules.tutorials.NewUserFindFriends=P.modules.tutorials.NewUserStepBase.extend({onContentReady:function(){P.modules.tutorials.NewUserStepBase.prototype.onContentReady.call(this),this.listen(this.getChildById("fbTab"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.listen(this.getChildById("twTab"),P.CONST.EVENT_BUTTON_CLICK,this.onButtonTabClick),this.childListen(P.CONST.EVENT_USER_CLICK,this.onFriendClick),this.content=null,this.selectedButton=null,this.twitterConnected=_.isString(P.currentUser.get("twitter_url")),this.facebookConnected=_.isString(P.currentUser.get("facebook_url"))
},onFriendClick:function(a){var b=a.data||{};if(b.user_id){var c=P.resourceFactory.create("UserFollowResource",{user_id:b.user_id});c.call(b.is_following?"create":"delete")}},_notifyProgressBar:function(a){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:a,total:1})},onButtonTabClick:function(a){this.$(".emptyContactGrid").addClass("hidden");var b=a.target,c=null,d=null;switch(b.id){case"fbTab":c=P.SocialConnect.FACEBOOK,this.facebookConnected&&(d="UserFacebookFriendsResource",this._notifyProgressBar("facebook")),this.getChildById("fbTab").setSelectedStyle(!0),this.getChildById("twTab").setSelectedStyle(!1);break;case"twTab":c=P.SocialConnect.TWITTER,this.twitterConnected&&(d="UserTwitterFriendsResource",this._notifyProgressBar("twitter")),this.getChildById("fbTab").setSelectedStyle(!1),this.getChildById("twTab").setSelectedStyle(!0)}if(c){var e=new P.modules.FindFriendsContent({options:{tab:c,username:P.currentUser.get("username"),item_options:{view_type:"userCheckableSelectView"},auto_connect:!1}}),f=this;if(d){var g={username:P.currentUser.get("username")};e.resource=P.resourceFactory.create(d,g)}e.render(function(){f.content&&f.content.remove(),f.appendChild(e),f.content=e,f.listen(e,P.CONST.EVENT_SOCIAL_NETWORK_CONNECTION,function(a){switch(a.data.network){case P.SocialConnect.FACEBOOK:this._notifyProgressBar("facebook"),this.facebookConnected=!0;break;case P.SocialConnect.TWITTER:this._notifyProgressBar("twitter"),this.twitterConnected=!0}})})}}}),goog.provide("P.modules.tutorials.NewUserInterestPicker"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase"),goog.require("P.tutorialManager"),P.modules.tutorials.NewUserInterestPicker=P.modules.tutorials.NewUserStepBase.extend({onAddedToDom:function(){this.childListen(P.CONST.EVENT_ITEM_CLICK,this.onInterestClick)},onInterestClick:function(a){var b=a.data||{},c=b.url_name;_.contains(this.selectedInterests,c)?this.selectedInterests=_.without(this.selectedInterests,c):this.selectedInterests.push(c),this._notifyProgressBar()},_notifyProgressBar:function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_MINI_NEXT,{type:"interest",total:this.selectedInterests.length})},initializeStep:function(){this.selectedInterests=[]},onExit:function(a){var b=this.selectedInterests.join(",");b&&this.signalFollowedInterests(b),a&&a()},signalFollowedInterests:function(a){var b=P.resourceFactory.create("OrientationContextResource",{interests:a});b.callCreate()}}),goog.provide("P.modules.tutorials.NewUserInterestSearch"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase");var SELECTOR_TOOLTIP_CLOSER_LOOK=".tooltipCloserLook",NEW_USER_INTEREST_SEARCH_CLASS_VISIBLE="visible",EXIT_TOUR_TIME=15e3,FORCE_EXIT_TIME=48e4,MIN_SEARCHES=1,SEARCH_ITEM_OPTIONS={show_pinner:!0,show_board:!0,lite:!0,show_via:!1,show_pinned_from:!1};P.modules.tutorials.NewUserInterestSearch=P.modules.tutorials.NewUserStepBase.extend({onAddedToDom:function(){this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate)},onButtonClick:function(a){var b=a.target.id;"previous"===b&&this.triggerInterest()},initializeStep:function(){this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this.numSearches=0,this.endTourTooltip=null;var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onChildNavigate:function(a){var b=P.router.get().resolve(a.data.url);"FeedPage"===b.module?(this.triggerCategory(b.options.feed),a.data.handled=!0):"SearchPage"===b.module?(this.triggerPinSearch(b.options.query),a.data.handled=!0):"Closeup"===b.module&&this._closeTooltip(),a.data.handled&&a.stopPropagation()},onEnter:function(a){var b=this,c={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.loadModule(c,function(a){b.showInModal(a,{mask_type:"dark",can_dismiss:!1}),b.listen(a,P.CONST.EVENT_CONFIRM,function(){this.nuxProgress.triggerEvent(P.CONST.EVENT_NEXT)}),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN),P.trackRegisterAction("autobahn_force_exit")})},FORCE_EXIT_TIME),this.autoEnableExit=window.setTimeout(function(){b._enableExitTour()},EXIT_TOUR_TIME),a&&a()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.trackRegisterAction("autobahn_repinned")},onContentReady:function(){P.modules.tutorials.NewUserStepBase.prototype.onContentReady.call(this),this.grid=this.getChildById("grid"),this.$previousButton=this.$(".previous"),this.endTourButton=this.nuxProgress.getNextButton(),this.endTourButton.disable();var a=this.extraData?this.extraData.showAutobahnV3Tooltip:!1;a===!0&&this.showEndTourTip()},showEndTourTip:function(){if(this.endTourButton){var a={name:"Dropdown",options:{anchor:this.endTourButton.$el,class_name:"endTourTooltip",position_point:"BOTTOM_RIGHT",sticky:!0,text:P._("Try a pin search below. <br>(The more specific, the better!)"),title:P._("Psst! Before you leave...")}},b=this;P.loadModule(a,function(a){b.endTourTooltip=a,a.render(function(){b.endTourButton.appendChild(a),a.positionModule(),a.fadeIn()})})}},hideEndTourTip:function(){this.endTourTooltip&&this.endTourTooltip.fadeOut()},showPrevious:function(){this.togglePrevious(!0),this._toggleTooltip(!0),this._handleSearchCount()},hidePrevious:function(){this.togglePrevious(!1),this._toggleTooltip(!1)},togglePrevious:function(a){this.$previousButton.toggleClass("visible",a)},_handleSearchCount:function(){this.numSearches=1,this.numSearches===MIN_SEARCHES&&(P.trackRegisterAction("autobahn_user_search"),this._enableExitTour())},triggerCategory:function(a){this.grid.options.layout="variable_height",this.grid.options.item_options=SEARCH_ITEM_OPTIONS,this.grid.resource=P.resourceFactory.create("CategoryFeedResource",{feed:a}),this.grid.empty(),this.grid.render(_.bindFn(this.showPrevious,this))},triggerInterest:function(){this.grid.options.layout="fixed_height",this.grid.resource=P.resourceFactory.create("AllCategoriesResource",{field_set_key:"grid_item"}),this.grid.render(_.bindFn(this.hidePrevious,this))},triggerPinSearch:function(a){return""===$.trim(a)?this.triggerInterest():(this.grid.resource=P.resourceFactory.create("SearchResource",{query:a,scope:"pins"}),this.grid.options.layout="variable_height",this.grid.options.item_options=SEARCH_ITEM_OPTIONS,this.grid.empty(),void this.grid.render(_.bindFn(this.showPrevious,this)))},_enableExitTour:function(){this.endTourButton.enable(),this.hideEndTourTip()},onExit:function(a){clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),a&&a()},_toggleTooltip:function(a){var b=this.$(SELECTOR_TOOLTIP_CLOSER_LOOK);b&&b.toggleClass(NEW_USER_INTEREST_SEARCH_CLASS_VISIBLE,a)},_closeTooltip:function(){var a=this.$(SELECTOR_TOOLTIP_CLOSER_LOOK);a&&a.remove()}}),goog.provide("P.modules.tutorials.NewUserPin"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase");var FACEBOOK_SCRIPT_ID="fb_pixel",FACEBOOK_PIXEL_CONFIGURATION={pixel_id:"6011522978142",value:"0.00",currency:"USD"};P.modules.tutorials.NewUserPin=P.modules.tutorials.NewUserStepBase.extend({onContentReady:function(){window.fb_param=FACEBOOK_PIXEL_CONFIGURATION,P.script.load([],"//connect.facebook.net/en_US/fp.js",FACEBOOK_SCRIPT_ID),P.modules.tutorials.NewUserStepBase.prototype.onContentReady.call(this)}}),goog.provide("P.modules.tutorials.NewUserPinCreate"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase"),P.modules.tutorials.NewUserPinCreate=P.modules.tutorials.NewUserStepBase.extend({onContentReady:function(){P.modules.tutorials.NewUserStepBase.prototype.onContentReady.call(this),this.nextStepButton=this.nuxProgress.getNextButton(),this.nextStepButton.disable()}}),goog.provide("P.modules.tutorials.NewUserPinSearch"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase");var MIN_BOTTOM_GUTTER=-220,MIN_REQUESTED_ITEMS=3,NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK=".tooltipCloserLook",NEW_USER_CLASS_VISIBLE="visible",INTERVAL_TIME=5e3,NEW_USER_EXIT_TOUR_TIME=15e3,NEW_USER_FORCE_EXIT_TIME=48e4,TEMPLATE_SUGGESTIONS="<% _.each(suggestions, function(suggestion) { %><li><%= suggestion %></li><% }) %>";P.modules.tutorials.NewUserPinSearch=P.modules.tutorials.NewUserStepBase.extend({events:{"click .searchSuggestions li":"_onSuggestionClick","click .searchInterestField":"stopInterval","submit .searchInterest":"_onSubmit"},initializeStep:function(){this.currentQuestion=0,this._requestedItems=0,this._startCountingRequestedItems=!1,this.childListen(P.CONST.EVENT_NAVIGATE,P.NuxUtils.preventNavigationIfNecessary),this._onScrollHandle=this.listen($(window),"scroll",_.debounce(_.bindFn(this._onScroll,this),50)),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this._onRequestItemSuccess);var a={};a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this._onRepinned,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onContentReady:function(){this.$searchTitle=this.$(".searchTitle"),this.$searchSuggestions=this.$(".searchSuggestions ul"),this.$searchField=this.$(".searchInterestField"),this.endTourButton=this.getChildById("nextButton"),this.interestGrid=this.getChildById("interestGrid"),this.interval=P.setInterval(_.bindFn(this._nextQuestion,this),INTERVAL_TIME),this.$searchField.placeholder(),this.endTourButton.setText(this.extraData.nextButtonText),this.endTourButton.disable(),this.siteWideNags=P.app.getChildByModuleName("Nags"),this.header=P.app.getChildById("header")},onEnter:function(a){var b=this,c={name:"ConfirmDialog",options:{template:"new_user_ready"}};this.forceExit=window.setTimeout(function(){P.loadModule(c,function(a){b.showInModal(a,{mask_type:"dark",can_dismiss:!1}),b.listen(a,P.CONST.EVENT_CONFIRM,function(){b._endMandatoryFlow()}),P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN),P.trackRegisterAction("autobahn_force_exit")})},NEW_USER_FORCE_EXIT_TIME),this.autoEnableExit=window.setTimeout(function(){b._enableExitTour()},NEW_USER_EXIT_TOUR_TIME),a&&a()},_onRepinned:function(){this._enableExitTour(),this.pubsubUnsubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_PIN_CREATED),P.trackRegisterAction("autobahn_repinned")},setInterest:function(a,b){a=$.trim(a),b?(this.$searchField.val(""),this.$searchField.attr("placeholder",a)):(this.$searchField.val(a),this._onRequestItemSuccess(),P.trackRegisterAction("autobahn_user_search")),this.$searchField.placeholder();var c=this.$searchField.val(),d=this.$searchSuggestions.children("li");_.each(d,function(b){var d=$(b),e=d.text().toLowerCase()===a.toLowerCase(),f=d.text().toLowerCase()===c.toLowerCase();d.toggleClass("highlight",f||e)}),this.interestGrid.resource.options.interest=a,this.renderGrid()},renderGrid:_.debounce(function(){this.interestGrid.render()},250),stopInterval:function(){clearInterval(this.interval)},onRemovedFromDom:function(){this._closeTooltip(),this.stopInterval()},_closeTooltip:function(){var a=this.$(NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK);a&&(a.remove(),this.removeListener(this._onScrollHandle))},_nextQuestion:function(){this.currentQuestion++;var a=this.extraData.search_suggestions.length;this.currentQuestion===a&&(this.currentQuestion=0),this._refreshQuestion()},_previousQuestion:function(){this.currentQuestion--;var a=this.extraData.search_suggestions.length;this.currentQuestion<0&&(this.currentQuestion=a-1),this._refreshQuestion()},_refreshQuestion:function(){var a=this.extraData.search_suggestions,b=a[this.currentQuestion];if(b){var c=b.suggestions[0],d=_.template(TEMPLATE_SUGGESTIONS,b);this.$searchTitle.html(b.title),this.$searchSuggestions.html(d),this.setInterest(c,!0)}},_search:function(){this.setInterest(this.$searchField.val(),!1)},_onButtonClick:function(a){this.stopInterval();var b=a.target.id;"next"===b?this._nextQuestion():"prev"===b?this._previousQuestion():"search"===b?this._search():("close"===b||"nextButton"===b)&&this._endMandatoryFlow()},_endMandatoryFlow:function(){if(clearTimeout(this.forceExit),clearTimeout(this.autoEnableExit),P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)){var a=this;P.ExperienceManager.instance().completePlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN,function(){a.triggerEvent(P.CONST.EVENT_NEXT,null,!0),a._endMandatoryFlowRender()})}else this.triggerEvent(P.CONST.EVENT_NEXT,null,!0),this._endMandatoryFlowRender()},_endMandatoryFlowRender:function(){this.header&&this.header.render(),this.siteWideNags&&this.siteWideNags.render()},_onRequestItemSuccess:function(){this._requestedItems===MIN_REQUESTED_ITEMS&&(this._enableExitTour(),P.trackRegisterAction("autobahn_search_done")),this._requestedItems++},_enableExitTour:function(){this.endTourButton.enable()},_onScroll:function(){this.stopInterval();var a=this.$(".newUserStepHeader"),b=this.$(NEW_USER_SELECTOR_TOOLTIP_CLOSER_LOOK),c=a.offset().top+a.height();if(b){var d=c+MIN_BOTTOM_GUTTER;b.toggleClass(NEW_USER_CLASS_VISIBLE,$(window).scrollTop()>d)}},_onSubmit:function(a){a.preventDefault(),this._search()},_onSuggestionClick:function(a){this.stopInterval(),this.setInterest($(a.target).text(),!1)}}),goog.provide("P.modules.tutorials.NewUserPinSource"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase"),P.modules.tutorials.NewUserPinSource=P.modules.tutorials.NewUserStepBase.extend({}),goog.provide("P.modules.tutorials.NewUserPinUsage"),goog.require("P.Module"),goog.require("P.modules.tutorials.NewUserStepBase"),P.modules.tutorials.NewUserPinUsage=P.modules.tutorials.NewUserStepBase.extend({}),goog.provide("P.modules.AuxiliarySiteHeaderButtonDropdown"),goog.require("P.Module"),goog.require("P.modules.DropdownButton"),P.modules.AuxiliarySiteHeaderButtonDropdown=P.modules.DropdownButton.extend({onContentReady:function(){P.modules.DropdownButton.prototype.onContentReady.apply(this,arguments);var a=this.$el.width();$(".headerDropdown").width(a)}}),goog.provide("P.modules.BoardEditBase"),goog.require("P.Module"),goog.require("P.modules.BoardCollaboratorInvitesBase"),goog.require("P.modules.BoardInvites"),P.modules.BoardEditBase=P.modules.BoardCollaboratorInvitesBase.extend({onCreated:function(){P.modules.BoardCollaboratorInvitesBase.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick)},setupForm:function(){this.$form=this.$("form");var a={},b=this.extraData;if(this._isOwner()){var c=b.errorMessages.name.required;a={name:[P.Validator.Required({message:c}),P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_TITLE})],description:[P.Validator.Length({max:P.CONST.MAX_CHARS_FOR_BOARD_PIN_DESCRIPTION})]}}this.form=new P.Form(this.$form,a),this.listen(this.form,P.CONST.EVENT_SUBMIT_VALIDATED,this.onSubmitValidated)},onContentReady:function(){this.setupForm()},onButtonClick:function(a){var b=a.target;if(b){var c=this._getGACategory();"submitButton"===b.id?P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_SUBMIT):"cancelButton"===b.id&&P.trackGAEvent(c,P.CONST.GA_ACTION_CLICK_CANCEL)}},onSubmitValidated:function(a){a.errors[0]||this.saveBoard()},getBoardId:function(){return this.data&&this.data.id},_getGACategory:function(){return this.getBoardId()?"board_edit":"board_create"},isMakePublic:function(a){return this.data&&"secret"===this.data.privacy&&"public"===a},getFieldValues:function(){var a=this.$("form"),b={},c=a.find("[name=name]");c.length&&(b.name=c.val());var d=this.getChildById("boardCategory");d&&(b.category=d.getValue());var e=a.find("[name=description]");e.length&&(b.description=e.val());var f=this.getChildById("secretCheckbox");f&&(b.privacy=f.isChecked()?"secret":"public");var g=this.getChildById("emailCheckbox");g&&(b.collab_board_email=g.isChecked());var h=this.getChildById("placeLayoutCheckbox");return h&&(b.layout=h.isChecked()?"places":"default"),b},_isOwner:function(){return this.extraData&&this.extraData.isOwner},saveBoard:function(){var a=this,b=this.getChildById("submitButton");b.showLoading();var c=this.getFieldValues(),d=this.getBoardId(),e=_.clone(c);d&&(e.board_id=d);var f;if(this._isOwner()){f=P.resourceFactory.create("BoardResource",e);var g={success:_.bindFn(this.onSaveSuccess,this),error:_.bindFn(this.onSaveError,this),complete:function(){b.hideLoading()}};d?f.callUpdate(g):f.callCreate(g)}else f=P.resourceFactory.create("BoardSettingsResource",e),f.callUpdate({complete:function(){b.hideLoading(),a.destroy()}})},onSaveError:function(a){P.trackGAEvent(this._getGACategory(),P.CONST.GA_ACTION_ERROR);var b=this.$(".formFooter"),c=this.$(".inlineError");c.length?c.empty():c=$("<p></p>").addClass("inlineError"),c.text(a.message),c.insertBefore(b)},_isNewBoard:function(){var a=this.getBoardId();return!a},onSaveSuccess:function(a){var b,c,d,e=this.getChildById("boardInvites");e&&(b=e.getSelectedInvitees("pinner"),c=e.getSelectedInvitees("email"),d=e.getSelectedInvitees("facebook"));var f=this.getBoardId(),g=this._isNewBoard();if(P.trackGAEvent(this._getGACategory(),P.CONST.GA_ACTION_SUCCESS),a){var h=a.resource_response;if(h&&!h.error&&h.data){var i=h.data;f?(P.pubsub.publish(f,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,i),this.isMakePublic(i.privacy)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_UPDATED,P.CONST.PUBSUB_MESSAGE_BOARD_SET_PUBLIC)):(P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,i),this.triggerEvent(P.CONST.EVENT_BOARD_CREATED,i,!0)),g&&(b&&this.inviteUsers(i.id,b),c&&this.inviteEmail(i.id,c),d&&d.length>0&&this.inviteFacebook(i.id,d)),!g&&this.isInModal()?this.destroy():this.navigate(i.url)}}},displayFacebookDialog:function(a,b,c){P.FacebookDialog.open({type:"send",path:b,to:a,callback:c})},inviteUsers:function(a,b){var c={board_id:a,invited_user_ids:b};if(b&&b.length>0){var d=P.resourceFactory.create("BoardInviteResource",c);d.callCreate()}},inviteEmail:function(a,b){var c={board_id:a,emails:b};if(b&&b.length>0){var d=P.resourceFactory.create("BoardEmailInviteResource",c);d.callCreate()}},inviteFacebook:function(a,b){var c=this,d=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:a});d.callGet().then(function(d){var e=d.resource_response.data;c._inviteFacebookRecursive(a,b,e.invite_code,e.url)})},_inviteFacebookRecursive:function(a,b,c,d){if(b.length>0){var e=b.pop(),f=this;f.displayFacebookDialog(e,d,function(e){if(f._inviteFacebookRecursive(a,b,c,d),e&&e.success){var g=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:a,invite_code:c});g.callUpdate()}})}}}),goog.provide("P.modules.Conversation"),goog.require("P.Module"),goog.require("P.modules.Dropdown"),goog.require("P.modules.ConversationHead"),goog.require("P.modules.ConversationPopup"),P.modules.Conversation=P.Module.extend({onCreated:function(){this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_CONVERSATION_HEAD_READY,this.onConversationHeadReady),this._needsRendered=!0;var a={};a[P.CONST.PUBSUB_TOPIC_OBJECT_SENT]=this.onObjectSent,this.pubsubSubscribe(this.getConversationId(),a)},onObjectSent:function(){this.fetchNewMessages(1)},onContentReady:function(){this._attachPopup()},onConversationHeadReady:function(a){var b=this,c=a.target;_.contains(b.children,c)&&(this._headClickListener||(this._headClickListener=this.listen(c,P.CONST.EVENT_CONVERSATION_HEAD_CLICKED,this.onConversationHeadClick)),c.getContent().droppable({activeClass:"ui-state-highlight",tolerance:"pointer",over:function(a,b){$(b.helper).transition({scale:.24},230,"ease").transition({scale:.25,duration:20}),$(this).transition({scale:1.3,duration:150}).transition({scale:1.2,duration:100})},out:function(a,b){$(b.helper).transition({scale:1,duration:250}),$(this).transition({scale:1,duration:250})},drop:function(){var a=b.getConversationPopup(),c=P.getConversationsManager().getDraggedObject();a.sendMessage(null,c),P.getConversationsManager().openConversation(b)}}))},onConversationHeadClick:function(){if(this._popup)if(this._popup.isShowing()){if(this.getConversationHeadBadgeCount())return void this.getConversationPopup().scrollToLatest();P.getConversationsManager().closeConversation(this)}else P.getConversationsManager().openConversation(this);else this._attachPopup()},onDropdownShow:function(){var a=this,b=this.getConversationPopup();this.focusInput();var c=this._popup.getContent();if(c.droppable({activeClass:"ui-state-highlight",tolerance:"pointer",activate:function(){P.getConversationsManager().getDraggedObject()&&b.showDropTarget()},deactivate:function(){b.hideDropTarget()},over:function(a,d){P.getConversationsManager().getDraggedObject()&&(b.setDropTargetText(P._("Drop here to send!")),d.helper.transition({scale:.5,duration:130}).transition({scale:.53,duration:50}),c.addClass("ui-state-hover"))},out:function(a,d){b.setDropTargetText(P._("Drag here to send!")),c.removeClass("ui-state-hover"),d.helper.animate({scale:1},150)},drop:function(){if(P.getConversationsManager().getDraggedObject()){var b=a.getConversationPopup(),c=P.getConversationsManager().getDraggedObject();b.sendMessage(null,c)}}}),this._shouldScrollToBottom){var d=this.getConversationPopup();d&&d.scrollToLatest()}this._messagesNeedRendered&&this.renderMessages(),this._shouldScrollToBottom=!1},_attachPopup:function(){var a={module:this.getPopupModuleLoadOptions(),anchor:this.getContent(),preserve_dropdown_on_body_mousedown:!0,persist_through_navigate:!0,fixed:!0,caret_style:"lightGray lightGrayConversations",position_point:"RIGHT_BOTTOM",class_name:"aboveModal activeConversationDropdown",prefetch:!0};this._popup=new P.modules.Dropdown({options:a,id:"popup"}),this.addChild(this._popup),this._shouldScrollToBottom=!0,this.listen(this._popup,P.CONST.EVENT_DROPDOWN_SHOW,this.onDropdownShow),this.childListen(P.CONST.EVENT_CONVERSATION_DECREMENT_BADGE,this.onDecrementBadge)},onDecrementBadge:function(){var a=this._getConversationHead(),b=this.getConversationHeadBadgeCount(),c=Math.max(b-1,0);a.setBadgeCount(c)},getPopupModuleLoadOptions:function(){return{name:"ConversationPopup",options:this.options,data:this.data}},focusInput:function(){var a=this.getConversationPopup();a&&a.focus()},fetchNewMessages:function(a){var b=this.getConversationPopup();b.fetchNewMessages(a)},renderMessages:function(){var a=this.getConversationPopup();a.renderMessages()},getConversationPopup:function(){return this._popup.getContentModule()},focus:function(){this.focusInput()},onDestroyed:function(){this.closePopup()},showPopup:function(){var a=this.getConversationHeadBadgeCount();a&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT_DECREASE,a),this.setConversationHeadBadgeCount(0),this._popup.show(),this.focusInput()},adjustPopup:function(){this._popup.reposition()},setConversationHeadBadgeCount:function(a){var b=this._getConversationHead();b.setBadgeCount(a)},getConversationHeadBadgeCount:function(){var a=this._getConversationHead();return a.getBadgeCount()},closePopup:function(){this._popup.hide()},setMessagesNeedRendered:function(a){this._messagesNeedRendered=a},setBadgeCount:function(a){var b=this._getConversationHead();b.setBadgeCount(a)},popupIsVisible:function(){return this._popup.isVisible()},_getConversationHead:function(){return this.getChildById("conversationHead")},onButtonClick:function(a){var b=a.target;b.isCancelButton()&&(this.closePopup(),P.getConversationsManager().scaleConversationDownAndRemove(this.getConversationId()))},getConversationId:function(){return this.options.id},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/Conversation/Conversation.nunjucks")}),goog.provide("P.modules.ConversationsListDropdown"),goog.require("P.Module"),goog.require("P.modules.CreateConversationGroup");var CONVERSATION_LIST_ID="conversationList";P.modules.ConversationsListDropdown=P.Module.extend({mixins:[P.Mixins.PreventScroll],onCreated:function(){this.onConversationsScroll=_.bindFn(this.onConversationsScroll,this),this.onConversationsScroll=_.throttle(this.onConversationsScroll,200)},onContentReady:function(){this.startPreventingScroll(),this._scrollListener=this.listen(this.$(".convosContent"),"scroll",this.onConversationsScroll)},onChildRemoved:function(a){"CreateConversationGroup"===a.className&&(this._showingCreateConversationModule=!1)},onConversationsScroll:function(a){var b=$(a.target).scrollTop(),c=this._getList(),d=c.getHeight();d-b<=400&&c.fetchMore()},startPreventingScroll:function(){var a=this._getList();a&&this.startPreventScroll(this.$(".convosContent"),a.getContent())},_getList:function(){return this.getChildById(CONVERSATION_LIST_ID)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/ConversationsListDropdown/ConversationsListDropdown.nunjucks")}),goog.provide("P.modules.InterestFollowButton"),goog.require("P.Module"),goog.require("P.modules.ui.FollowButton"),P.modules.InterestFollowButton=P.modules.ui.FollowButton.extend({getResourceId:function(){return this.options.interest},getFollowResource:function(){return P.resourceFactory.create("InterestFollowResource",{interest_list:P.CONST.INTEREST_LIST_FAVORITED,interest:this.getResourceId()})},onContentReady:function(){this.showMemo()},onClick:function(){if(P.currentUser.isAuthenticated()){var a=this.options.followed?this.options.unfollow_ga_category:this.options.follow_ga_category;a&&P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),this.toggleFollow()}else P.UserRegistration.showSignupModal(null,{redirect_to_signup:!0,tagline:P.string.format(P._("Want to follow {{ interest_name }}? Just sign up!"),{interest_name:this.options.interest_display_name}),auto_follow_interest:this.getResourceId()})}}),goog.provide("P.modules.UserBoardsBase"),goog.require("P.Module"),goog.require("P.modules.Board");var USER_BOARDS_BASE_SECRET_BOARD_TYPE=P.CONST.BOARD_PRIVACY_SECRET,USER_BOARDS_BASE_MODULE_ID_PUBLIC_BOARDS_GRID="publicBoardsGrid",USER_BOARDS_BASE_MODULE_ID_SECRET_BOARDS_GRID="secretBoardsGrid";P.modules.UserBoardsBase=P.Module.extend({onContentReady:function(){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_CREATED]=this.onBoardCreated,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,this.extraData.isOwnProfile&&(a[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,a)},onBoardCreated:function(a,b,c){var d=c,e=d.id,f=d.privacy,g=f===USER_BOARDS_BASE_SECRET_BOARD_TYPE?USER_BOARDS_BASE_MODULE_ID_SECRET_BOARDS_GRID:USER_BOARDS_BASE_MODULE_ID_PUBLIC_BOARDS_GRID,h=this.getChildById(g),i=new P.modules.Board({options:{show_board_context:!1},resource:{name:"BoardResource",options:{board_id:e}}});h.items.appendChild(i),i.render()},onBoardDeleted:function(){},onBoardUpdated:function(a,b,c){c===P.CONST.PUBSUB_MESSAGE_BOARD_SET_PUBLIC&&this.render()},onBoardRemovedSelf:function(){this.render()}}),goog.provide("P.modules.ui.InterestsTypeaheadField"),goog.require("P.Module"),goog.require("P.modules.ui.TypeaheadField"),P.modules.ui.InterestsTypeaheadField=P.modules.ui.TypeaheadField.extend({onContentReady:function(){P.modules.ui.TypeaheadField.prototype.onContentReady.apply(this,arguments),this.createInterestButton=this.getChildById("createInterestButton"),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onCreateInterestClick)},onChildItemSelected:function(a){this._clearTypeahead(),this._followInterest(P.CONST.INTEREST_LIST_FAVORITED,a.data.item.get("key"))},onFieldInput:function(){var a=this.getValue();if(a.length>0){this.createInterestButton.show();var b=P.string.format(P._('Create "{{ interest_name }}"'),{interest_name:a});this.createInterestButton.setText(b)}else this._clearTypeahead();P.modules.ui.TypeaheadField.prototype.onFieldInput.call(this)},onCreateInterestClick:function(){var a=this.getValue();a.length>0&&(this._clearTypeahead(),this._followInterest(P.CONST.INTEREST_LIST_USER_ADDED,a))},_clearTypeahead:function(){this.reset(),this.createInterestButton.setText(""),this.createInterestButton.hide()},_followInterest:function(a,b){var c=this,d=P.resourceFactory.create("InterestFollowResource",{interest_list:a,interest:b});d.callCreate().then(function(a){c.triggerEvent(P.CONST.EVENT_INTEREST_FOLLOW,a,!0)})}}),goog.provide("P.modules.AddPinToMap"),goog.require("P.Module"),goog.require("P.modules.GeoFeatureList"),goog.require("P.modules.Map");var SUBMIT_BUTTON_ID="submitButton",CLASS_ADD_PIN_TO_MAP_LOADING="loading",CLASS_EMPTY_STATE="isEmpty",ID_BACK_BUTTON="backButton",ID_CLOSE_BUTTON="closeButton",CLASS_HAS_NO_RESULTS_HIDE_EMPTY_STATE="hasNoResults",PIN_BUTTON_ID="pinIt";P.modules.AddPinToMap=P.Module.extend({events:{"keydown input":"onSearchFieldKeydown","click .exampleQuery":"onExampleQueryClick"},onExampleQueryClick:function(a){var b=$(a.target),c=b.text();this.typeaheadField.setValue(c),this.typeaheadField.search()},onSearchFieldKeydown:function(){this.typeaheadField.setResourceOptionForTypeahead("near",null),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!0),this._ignoreHints=!1},onCreated:function(){this.onUploadSuccess=_.bindFn(this.onUploadSuccess,this),this._place=null,this.typeaheadItems=null,this.childListen(P.CONST.EVENT_ITEM_HIGHLIGHTED,this.onTypeaheadItemHighlighted),this.childListen(P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.listen(this,P.CONST.EVENT_EXTERNAL_CLICK,this.onExternalClick),this.childListen(P.CONST.EVENT_ITEM_SELECTED,this.onTypeaheadItemSelected),this.childListen(P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.childListen(P.CONST.EVENT_UPLOAD_SUCCESS,this.onUploadSuccess),this.childListen(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,this.onTypeaheadSearchStart),this.childListen(P.CONST.EVENT_TYPEAHEAD_HINT,this.onTypeaheadHint),this.childListen(P.CONST.EVENT_TYPEAHEAD_RESULTS_RETURNED,this.onTypeaheadResultsReturned),this.childListen(P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.childListen(P.CONST.EVENT_PINIT_BUTTON_CLICKED,this.onPinItButtonClicked),this.childListen(P.CONST.EVENT_UPDATE_GEO_FEATURE_LIST,this.onUpdateGeo)},onExternalClick:function(a){a.stopPropagation()},getTerm:function(){var a=this.typeaheadField.getValue();return a},search:function(){var a=this.getTerm();a.length&&this.typeahead.search()},onTypeaheadHint:function(a){if(!this._ignoreHints){var b=a.data||[];this._loadFeatures(b),this.features.length>1?this._addGeoFeatureList():this._removeGeoFeatureList(),this._panMapAsNeeded(),this._toggleRegionEmptyResult()}},_toggleRegionEmptyResult:function(){var a,b=this.$(".noResults");a=this.features.length?P.string.format(P._("Sorry, we couldn't find {{ what }} in {{ where }}."),{where:this.$(".featureName").text(),what:this.interpretation.what}):P._("Sorry, we couldn't find that"),b.text(a)},_loadFeatures:function(a){var b=_.map(a,function(a){var b={},c=a.feature;return b.text=c.name,b.icon_class_name="flag"+c.cc,b.class_name="geoFeature",b.cc=c.cc,b.center=c.center,b});if(this.features=b,a.length){var c=a[0];this.interpretation={what:c.what,where:c.where,center:b[0].center}}},_removeGeoFeatureList:function(){this.$el.removeClass("hasGeoFeatures"),this._geoFeatureList&&(this._geoFeatureList.hide(),this._geo=null,this._toggleRegionEmptyResult())},_addGeoFeatureList:function(){if(this.$el.addClass("hasGeoFeatures"),this._geoFeatureList)this._geoFeatureList.updateFeatures(this.features),this._geoFeatureList.show();else{var a=this,b=this.typeaheadField,c=b.$el,d=new P.modules.GeoFeatureList({options:{features:this.features}});this._geoFeatureList=d,d.render(function(){a.insertChild(d,c)})}this._panMapAsNeeded()},_panMapAsNeeded:function(){if(this.interpretation){var a=this.interpretation.center,b=new L.LatLng(a.latitude,a.longitude);
this._triggerCenter(b)}},onTypeaheadSearchStart:function(){this.showLoading()},hideTypeaheadResults:function(){this.typeahead.emptyResults()},showLoading:function(){this.$el.toggleClass(CLASS_ADD_PIN_TO_MAP_LOADING,!0)},hideLoading:function(){this.$el.toggleClass(CLASS_ADD_PIN_TO_MAP_LOADING,!1)},_setLoading:function(a){this.$el.toggleClass(CLASS_ADD_PIN_TO_MAP_LOADING,a)},onTypeaheadResultsReturned:function(a){var b=a.data.items;this._setPlaceholderMarkersOnMap(b),this.hideEmptyState(),this.hideNoResults(),this.hideLoading()},showEmptyState:function(){this.hideNoResults(),this._setEmptyStateVisible(!0)},hideEmptyState:function(){this._setEmptyStateVisible(!1)},_setEmptyStateVisible:function(a){this.$el.toggleClass(CLASS_EMPTY_STATE,a)},showNoResults:function(){this._setNoResultsVisible(!0)},hideNoResults:function(){this._setNoResultsVisible(!1)},_setNoResultsVisible:function(a){this.$el.toggleClass(CLASS_HAS_NO_RESULTS_HIDE_EMPTY_STATE,a)},onTypeaheadNoResultsReturned:function(){this.$(".ui-Typeahead").show(),this.clearPlaceholderMarkersFromMap(),this.hideLoading(),this.hideTypeaheadResults(),this._toggleRegionEmptyResult();var a=this.getTerm();$.trim(a.length)>1?this.showNoResults():this.showEmptyState()},_triggerCenter:function(a){this.triggerEvent(P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,a)},getPlaceSelector:function(){return this.getChildByModuleName("PlaceSelector")},onContentReady:function(){var a=this.options.board_id,b=this.getPlaceSelector(),c=b.getTypeaheadField();this.typeaheadField=c,this.typeahead=c.typeahead;var d={};d[P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED]=this.onPlaceholderMarkerOpen,this.pubsubSubscribe(a,d)},onUpdateGeo:function(a){var b=a.data;this._geo=b,this._updateGeo(b),this._panMapAsNeeded();var c=this._geo.center,d=new L.LatLng(c.latitude,c.longitude);this._triggerCenter(d)},_updateGeo:function(a){var b=a.text,c=this.interpretation.what;this.typeaheadField.setResourceOptionForTypeahead("near",b),this.typeaheadField.setResourceOptionForTypeahead("should_geocode",!1),this.typeaheadField.search(c),this._ignoreHints=!0},focus:function(){this.typeaheadField.focus()},onPlaceholderMarkerOpen:function(a,b,c){var d=c.place_id;d&&(this.typeahead.highlightItemWithAttributeAndValue("id",d),this.typeahead.focusHighlighted())},onUploadSuccess:function(a){a.stopPropagation();var b=a.data.image_url;this._setActiveImage(b)},onButtonClick:function(a){var b=a.target,c=b.id;if(c===ID_BACK_BUTTON){var d=this.getChildById("addPlace");d&&d.remove(),this._panMapAsNeeded(),this._setPlaceholderMarkersOnMap(this.typeaheadItems),this.setBackButton(!1),a.stopPropagation()}else c===ID_CLOSE_BUTTON&&this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},reset:function(){var a=this.typeaheadField;a.reset(),this.hideTypeaheadResults(),this._removeAddPlace()},onPinItButtonClicked:function(a){var b=a.data;this._setActiveImage(b),this.createPin()},_setActiveImage:function(a){this._activeImageUrl=a},_getActiveImage:function(){return this._activeImageUrl},createPin:function(){var a=this,b=this._place,c=b.get("id"),d=this.$("textarea").val(),e=this.options.board_id,f=this._getActiveImage(),g={board_id:e,place:c,description:d,image_url:f},h=P.resourceFactory.create("PinResource",g);h.callCreate({success:function(){a._place.set("placeholder",!1),a._setActiveImage(null),P.pubsub.publish(e,P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD,a._place.attributes),a.reset()}})},addPermanentMarkerToMap:function(a){var b=a.attributes;this.triggerEvent(P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,b)},_isNewPin:function(){return!this.options.pin_id},_getSubmitButton:function(){var a,b=this.options.pin_id;return a=this.getChildById(b?SUBMIT_BUTTON_ID:PIN_BUTTON_ID)},setBackButton:function(a){var b=this.getChildById("closeButton");a?(b.options.text=P._("Back"),b.id=ID_BACK_BUTTON,b.options.cancelButton=!1):(b.options.text=P._("Close"),b.id=ID_CLOSE_BUTTON,b.options.cancelButton=!0),b.render()},_replaceContentWithPinForm:function(a){var b=this,c=this.options.board_id,d={id:"addPlace",name:"AddAPlace",options:{place:a.attributes,board_id:c}};P.loadModule(d,function(c){b.showLoading(),c.render(function(){b.setBackButton(!0),b.hideLoading();var d=b.$(".typeaheadWrapper");b.insertChild(c,d),c.setPlace(a)})})},_removeAddPlace:function(){var a=this.getChildById("addPlace");a&&a.remove()},_getMarkerOptions:function(a){var b=P.MarkerOptionsFactory.fromPlainObject(a.attributes);return b},onRemovedFromDom:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null)},_setPlaceholderMarkersOnMap:function(a){var b=this;this.typeaheadItems=a;var c=_.map(a,function(a){return a.get("template")?void 0:b._getMarkerOptions(a)});c=c;var d={markerOptionsList:c};this.triggerEvent(P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,d)},highlightPlaceholderMarkerOnMap:function(a){var b=a.get("resultIndex"),c={index:b};this.triggerEvent(P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,c)},clearPlaceholderMarkersFromMap:function(){this.triggerEvent(P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,null),this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null)},hideChildDropdowns:function(){this._geoFeatureList&&this._geoFeatureList.hideDropdown()},onTypeaheadItemSelected:function(a){a.stopPropagation();var b=a.data.item;if(b&&!b.get(P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE)){var c=b.get("search_id"),d=b.get("id"),e=this;if(c){var f={search_id:c,place:d},g=P.resourceFactory.create("PlacePingbackResource",f);g.call("update",{error:P.NOOP,success:P.NOOP,complete:P.NOOP})}if(this._isNewPin()){this._place=b;var h=b.get("latitude"),i=b.get("longitude"),j=L.latLng(h,i),k=b.get("resultIndex"),l={latLng:j,index:k};return this.triggerEvent(P.CONST.EVENT_PLACE_SELECTED,l),this._replaceContentWithPinForm(b),void window.setTimeout(function(){e.highlightPlaceholderMarkerOnMap(b)},150)}var m=a.target;m.showLoading(!0);var n=this.options.pin_id,o=P.resourceFactory.create("PinResource",{id:n,place:d});o.callUpdate({error:P.NOOP}).then(function(a){var c=a.resource_response;m.hideLoading(),e.addPermanentMarkerToMap(b),P.pubsub.publish(n,P.CONST.PUBSUB_TOPIC_PIN_UPDATED,c.data)})}},onTypeaheadItemHighlighted:function(a){var b=a.data.item;!b||b.get(P.CONST.TYPEAHEAD_ATTRIBUTE_EMPTY_STATE)?this.triggerEvent(P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,null):(this.highlightPlaceholderMarkerOnMap(b),a.stopPropagation())}}),goog.provide("P.modules.App"),goog.require("P.HistoryManager"),goog.require("P.interfaces.HistoryManagerProvider"),goog.require("P.modules.AppBase"),goog.require("P.interfaces.IModalManager"),goog.require("P.modules.Grid"),goog.require("P.modules.Header"),goog.require("P.modules.Modal");var CLASS_SHOWING_PLACE_BOARD="showingPlaceBoard",PROMPT_VIEWS_COOKIE="prompt_views",PROMPT_SEEN_COOKIE="prompt_seen",PROMPT_EXCLUDE_MODULES=["LoginPage","HomePage","BusinessAccountCreate"];P.modules.App=P.modules.AppBase.extend({events:{},onCreated:function(){P.modules.AppBase.prototype.onCreated.call(this),P.experiments.instance.inExperimentGroup("conversations","employees")&&P.getConversationsManager().setup(),this.modalManager=null},onAddedToDom:function(){P.modules.AppBase.prototype.onAddedToDom.apply(this,arguments),P.DeepLink.setup(P.CONTEXT.ios_deep_link,"pinterest://"),this.childListen(P.CONST.EVENT_MODAL,this.onChildModal),this.childListen(P.CONST.EVENT_CLOSE,this.onChildClose),this.childListen(P.CONST.EVENT_CATEGORIES_BAR_SHOWN,this.onCategoriesBarShown),this.childListen(P.CONST.EVENT_CATEGORIES_BAR_HIDDEN,this.onCategoriesBarHidden),this.modalManager||(this.modalManager=P.getModalManager())},onCategoriesBarShown:function(){this.$(".appContent").addClass("categoriesBarOnTop")},onCategoriesBarHidden:function(){this.$(".appContent").removeClass("categoriesBarOnTop")},_startTutorials:function(){P.TutorialManager.instance().resumeTutorial()},isTutorialActive:function(){return P.TutorialManager.instance().isTutorialActive()},_getGAPageviewOptions:function(){return{streaming:Pc.pageStreaming,scriptLoadLocation:Pc.scriptLoadLocation}},_adjustScrollToTopPositionIfNeeded:function(){var a=this._getCurrentMainModule();if(a)return"BoardPage"===a.className&&a.isPlaceBoard()?void this.$el.addClass(CLASS_SHOWING_PLACE_BOARD):void this.$el.removeClass(CLASS_SHOWING_PLACE_BOARD)},_scrollMainModuleIfNeeded:function(){var a=this._getCurrentMainModule();a&&a.initScroll()},onContentReady:function(){if(P.modules.AppBase.prototype.onContentReady.apply(this,arguments),P.requestPushNotifications(),P.experiments.instance.inExperimentGroup("conversations","employees")){var a=P.getConversationsManager();a.setContainer(this.getChildById("activeConversations")),a.loadCachedConversations(),a.listenForConversations();var b=P.getQueryStringParams();b.conversation&&a.addConversationById(b.conversation)}},_getScrollToTopModule:function(){var a=this.getChildById("scrollToTop");return a},updateScrollWatchers:function(a){var b=this._getScrollToTopModule();b&&b.setScroller(a.getScrollableElement())},maybeShowSignupPrompt:function(a){if(!a||P.currentUser.isAuthenticated())return!1;if(Cookie.get(PROMPT_SEEN_COOKIE))return!1;var b=_.contains(PROMPT_EXCLUDE_MODULES,a.module),c=_.contains(PROMPT_EXCLUDE_MODULES,this._getCurrentMainModule().className);if(b||c)return!1;var d=parseInt(Cookie.get(PROMPT_VIEWS_COOKIE),10)||0;return d>2&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("board_signup",["no_scroll_small_2","scroll_small_2"])&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_clickthrough_prompted_signup",["can_dismiss_no_skip_3","cannot_dismiss_3"])&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_closeup_prompted_signup",["can_dismiss_no_skip_3","cannot_dismiss_3"])?(Cookie.set(PROMPT_SEEN_COOKIE,"1"),P.UserRegistration.showSignupModal(null,{redirect_to_signup:!0}),!0):!1},onChildNavigate:function(a){var b=a.data.url;if(!P.currentUser.isAuthenticated()){if(!Cookie.get(PROMPT_SEEN_COOKIE)){var c=parseInt(Cookie.get(PROMPT_VIEWS_COOKIE),10)||0;Cookie.set(PROMPT_VIEWS_COOKIE,String(c+1))}if(this.maybeShowSignupPrompt(P.router.get().resolve(b)))return a.stopPropagation(),void(this.midNavigate=!1)}P.modules.AppBase.prototype.onChildNavigate.call(this,a)},onChildModal:function(a){this.log.debug("Got modal event from child",a.target,"for module:",a.data.module),a.stopPropagation(),this.modalManager.showInModal(a.data.module,a.data.showModalOptions||{},a.target)},onChildClose:function(){this.historyManager.closeCurrentModule()},removeAllModals:function(){this.isTutorialActive()||this.modalManager.removeAllModals(!0)},debugNumGridItems:function(){for(var a,b=this,c=[],d=[this];d.length>0;)a=d.pop(),"GridItems"===a.className&&c.push(a),d=d.concat(a.children);return _.each(c,function(a,c){for(var d=a.parent,e=a.className+" has "+a.children.length+" children";d;)e=d.className+"->"+e,d=d.parent;b.log.debug(c+1+": "+e)}),0===c.length&&this.log.debug("There are no grids in the page."),":)"},updateNavigationBar:function(){var a=P.app.getChildByModuleName("Nags"),b=P.app.getChildById("header");b&&b.render().then(function(){b.show()}),a&&a.render()},getHistoryManager:function(){return this.historyManager}}),P.Errors.wrap(P.modules.App.prototype,["initialize","onAddedToDom","onChildNavigate","onChildModal","onContentReady","onRoute","onRouteNotFound"]),goog.provide("P.modules.BoardCreate"),goog.require("P.Module"),goog.require("P.modules.BoardEditBase"),goog.require("P.modules.BoardInvites"),P.modules.BoardCreate=P.modules.BoardEditBase.extend({_clearInviteForm:function(){var a=this.getChildById("boardInviteForm");a.clearTypeahead()},onChildInviteUser:function(a){var b=this.getChildById("boardInvites"),c=a.data.userId,d=a.data.type,e=a.data.attributes;b.addInvitee(d===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER?{type:"facebook",identifier:c,attributes:e}:{type:"pinner",identifier:c}),this._clearInviteForm()},onChildInviteEmail:function(a){var b=this.getChildById("boardInvites"),c=a.data.email;b.addInvitee({type:"email",identifier:c}),this._clearInviteForm()}}),goog.provide("P.modules.BoardPage"),goog.require("P.modules.BoardPageBase"),goog.require("P.Module"),goog.require("P.modules.Map"),goog.require("P.modules.AddPinToMap"),goog.require("P.number");var CLASS_ATTRIBUTION_MOVED="moved",CLASS_FADE="fade",BOARD_PAGE_PINS_TAB="pins",TRAVEL_CATEGORY="travel";P.modules.BoardPage=P.modules.BoardPageBase.extend({onCreated:function(){this._pinCount=0,this._onPrependedToMapBoard=_.bindFn(this._onPrependedToMapBoard,this),this.map=null},addTutorials:function(){if(this.options.tab===BOARD_PAGE_PINS_TAB&&this.extraData.canEdit){var a,b=this.data,c=P.ExperienceManager.instance();b.layout===P.CONST.BOARD_LAYOUT_PLACES?a=_.isEmpty(this.getPins())?P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER:P.Experiences.Placement.WEB_FILLED_PLACES_BOARD_TAKEOVER:b.category!==TRAVEL_CATEGORY&&(a=P.Experiences.Placement.WEB_BOARD_TAKEOVER);var d=c.getPlacedExperience(a);if(d){var e=P.ExperienceManager.Tutorials[d.experience_id];e&&(P.TutorialManager.instance().startTutorial(e),c.viewPlacedExperience(a,d.experience_id))}}},getLoggingObjectIdStr:function(){return this.data.id},onScrollToTopHidden:function(){this.restoreAttributionOriginalPosition()},onScrollToTopVisible:function(){this.preventAttributionObstruction()},restoreAttributionOriginalPosition:function(){this._toggleAttributionMoved(!1)},_toggleAttributionMoved:function(a){this.$(".attribution").toggleClass(CLASS_ATTRIBUTION_MOVED,a)},preventAttributionObstruction:function(){this._toggleAttributionMoved(!0)},addPermanentMarkerFromTypeahead:function(a){a=a.data,this.map.clearPlaceholderMarkers(),a.highlighted=!0,a.animated=!0,a.placeholder=!1,a=this._generateMapMarkerData(a),this.map.addPermanentMarkerFromTypeahead(a),this.hideMapModal()},onSetPlaceholderMarkers:function(a){var b=this,c=a.data,d=c.markerOptionsList;d=_.compact(d),_.each(d,function(a){a.placeholder=!0,a.highlighted=!1,a.animated=!1});var e=_.map(d,function(a){return b._generateMapMarkerData(a)});this.map.setPlaceholderMarkers(e,!1)},onHighlightPlaceholderMarker:function(a){var b=a.data.index;this.map.clearPlaceholderHighlights(),this.map.highlightPlaceholderMarker(b)},onClearHighlightedPlaceholderMarkerHighlight:function(){this.map.clearPlaceholderHighlights()},onClearPlaceholderMarkers:function(){this.map.clearPlaceholderMarkers()},_generateMapMarkerData:function(a){var b=a.pin||this.getPinToAddToMap(),c=[a.latitude,a.longitude],d=a.id,e={pin:b,coordinates:c,id:d},f=_.extend(e,a);return f},onRemovedFromDom:function(){this.data&&this.data.layout===P.CONST.BOARD_LAYOUT_PLACES&&(this.hideMapModal(),this.map.clearMarkers())},_getPinByPinId:function(a){for(var b,c=this.getPins(),d=0,e=c.length;d<e;++d)if(b=c[d],b.getId()===a)return b;return null},onMapPopupOpened:function(a){var b=a.data,c=this._getPinByPinId(b);c.scrollIntoView(),this.map.highlightMarkerForPinId(b)},onContentReady:function(){if(this.data.id){var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,a[P.CONST.PUBSUB_TOPIC_BOARD_UPDATED]=this.onBoardUpdated,a[P.CONST.PUBSUB_TOPIC_BOARD_DELETED]=this.onBoardDeleted,a[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,a[P.CONST.PUBSUB_TOPIC_PIN_CREATED]=this.onPinAdded,a[P.CONST.PUBSUB_TOPIC_PREPEND_ITEM_MAP_BOARD]=this.onPrependNewPinMapBoard,a[P.CONST.PUBSUB_TOPIC_PIN_FLAGGED]=this.onPinFlagged,this.pubsubSubscribe(this.data.id,a)}if(this.childListen(P.CONST.EVENT_PIN_UPDATED,this.onChildPinUpdated),this.childListen(P.CONST.EVENT_RESET_SHOW_PIN_ON_MAP_BUTTON,this.resetShowPinOnMapButtonStates),P.currentUser.isAuthenticated()||this.childListen(P.CONST.EVENT_CONTENT_CHANGED,this.onContentReadyAndContentChanged),this.map=this.getChildById("map"),this.map){var b={};b[P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_HIDDEN]=this.onScrollToTopHidden,b[P.CONST.PUBSUB_TOPIC_SCROLL_TO_TOP_VISIBLE]=this.onScrollToTopVisible,this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_SITE,b),this.attachHoverListeners(),this.childListen(P.CONST.EVENT_PIN_PLACE_CLICK,this.onPinPlaceClick),this.childListen(P.CONST.EVENT_MAP_POPUP_OPENED,this.onMapPopupOpened),this.childListen(P.CONST.EVENT_PIN_MOUSE_IN,this.onPinMouseIn),this.childListen(P.CONST.EVENT_PIN_MOUSE_OUT,this.onPinMouseOut),this.childListen(P.CONST.EVENT_ITEMS_REQUEST_SUCCESS,this.onChildItemsAddedToGrid),this.childListen(P.CONST.EVENT_BOARD_CACHE_PIN_ID_TO_ADD_TO_MAP,this.onPinAddToMapCachePinId),this.childListen(P.CONST.EVENT_MODAL,this.onPlaceBoardModal)}P.modules.BoardPageBase.prototype.onContentReady.call(this),this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this._sticky=new P.Sticky(this.$(".addPinToMapButton"),{$boundTo:this.$el,$scrollable:this.getScrollableElement(),headerHeight:$(".headerBackground").height()}),this.addTutorials(),this.numPinsFlagged=0,this.showingPageTwoSneakPeek=!1,P.currentUser.isAuthenticated()||this.onContentReadyAndContentChanged()},onContentReadyAndContentChanged:function(){if(!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_closeup_prompted_signup",["control_3","cannot_dismiss_3","can_dismiss_no_skip_3"])&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_clickthrough_prompted_signup",["control_3","cannot_dismiss_3","can_dismiss_no_skip_3"])){if(P.experiments.instance.inExperimentGroupActiveOrTriggerable("board_signup","no_scroll_small_2"))this.adjustPageHeightForSignupBanner();else if(P.experiments.instance.inExperimentGroupActiveOrTriggerable("board_signup","scroll_small_2")){var a=this.data,b=this.isPlaceBoard()?100:25;a.pin_count<=b?this.adjustPageHeightForSignupBanner():this.childListen(P.CONST.EVENT_ITEMS_END,this.adjustPageHeightForSignupBanner)}this.listen(P.Viewport,P.CONST.EVENT_RESIZE,this.onResize)}},onPlaceBoardModal:function(a){var b=a.data.module;"AddPinToMap"===b.className&&(this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_SHOW_START,this.onAddPinToMapBeginShowing),this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_SHOW_END,this.onAddPinToMapEndShowing),this.listen(b,P.CONST.EVENT_MODAL_ANIMATE_HIDE_START,this.onAddPinToMapBeginHiding),this.listen(b,P.CONST.EVENT_TYPEAHEAD_NO_RESULTS_RETURNED,this.onTypeaheadNoResultsReturned),this.listen(b,P.CONST.EVENT_CENTER_MAP_GEO_FEATURE,this.onCenterMapGeoFeature),this.listen(b,P.CONST.EVENT_BUTTON_CLICK,this.onButtonClick),this.listen(b,P.CONST.EVENT_ADD_PERMANENT_MARKER_TO_MAP_FROM_TYPEAHEAD,this.addPermanentMarkerFromTypeahead),this.listen(b,P.CONST.EVENT_PLACE_SELECTED,this.onPlaceSelected),this.listen(b,P.CONST.EVENT_SET_PLACEHOLDER_MARKERS,this.onSetPlaceholderMarkers),this.listen(b,P.CONST.EVENT_HIGHLIGHT_PLACEHOLDER_MARKER,this.onHighlightPlaceholderMarker),this.listen(b,P.CONST.EVENT_CLEAR_PLACEHOLDER_MARKER_HIGHLIGHT,this.onClearHighlightedPlaceholderMarkerHighlight),this.listen(b,P.CONST.EVENT_REMOVE_PLACEHOLDER_MARKER_TO_MAP_FROM_TYPEAHEAD,this.onClearPlaceholderMarkers),this.listen(b,P.CONST.EVENT_TYPEAHEAD_SEARCH_WORLD,this.onSearchGlobally))},onCenterMapGeoFeature:function(a){var b=a.data,c=this.map.getCityBoundsFromCenter(b);this.map.fitBounds(c)},onPinFlagged:function(){this.numPinsFlagged+=1},getNumPinsFlagged:function(){return this.numPinsFlagged},onSearchGlobally:function(){this._searchingGlobally=!0,this.map.fitWorld()},onCitySelected:function(a){var b=a.data;this._city=b;var c,d;b.bounds?d=b.bounds:c=b.latLng,d||(d=this.getCityBoundsFromCenter(c)),this.map.fitBounds(d)},makeLatLngBoundsFromLatLngAndPadding:function(a,b){var c=L.latLng(a.lat-b,a.lng-b),d=L.latLng(a.lat+b,a.lng+b);return L.latLngBounds(c,d)},getCityBoundsFromCenter:function(a){var b=.05;return this.makeLatLngBoundsFromLatLngAndPadding(a,b)},onTypeaheadNoResultsReturned:function(){this.map&&this.map.clearPlaceholderMarkers()},onPlaceSelected:function(a){var b=a.data.index;this.map.showOnlyPlaceholderMarkerAtIndex(b),this._place=a.data},onPlaceholderMarkerOpened:function(a){var b=a.data.place_id,c=a.data.index,d=this.data.id;P.pubsub.publish(d,P.CONST.PUBSUB_TOPIC_PLACEHOLDER_MARKER_OPENED,{place_id:b}),this.map.highlightPlaceholderMarker(c)},onButtonClick:function(a){var b=a.target;"wrongPlace"===b.id?this._place=null:"addToMap"===b.id&&this.disablePinsAndButton()},disablePinsAndButton:function(){this._setPinsAndButtonEnabled(!1)},enablePinsAndButton:function(){this._setPinsAndButtonEnabled(!0)},_setPinsAndButtonEnabled:function(a){var b,c=this.$(".locationBoardPageContentWrapper, .locationBoardContentWrapperBackground, .addAPlace"),d=this.map.getAttributionElement(),e=P.app._getScrollToTopModule();e&&(b=e.$el),c=c.add(d),e&&(b.length&&(c=c.add(b)),a?c.removeClass(CLASS_FADE):c.addClass(CLASS_FADE))},setMapPaddingTopLeft:function(){var a,b=this._getAddToMapButton();b||(a=this.getGrid());var c=a||b;if(c){var d=c.getOffset(),e=c.getPosition(),f=c.getWidth()+d.left+e.left,g=100,h=L.point(f,g);this.map.setPaddingTopLeft(h)}},hideMapModal:function(){P.getModalManager().removeTopModal()},_onPrependedToMapBoard:function(){var a=this.getPins()[0],b=this._markerToPrepend;b.pin=a,this.addPermanentMarkerFromTypeahead({data:b})},onPrependNewPinMapBoard:function(a,b,c){var d=this,e=this.getGrid();this._markerToPrepend=c,this.hideMapModal(),e.prependNewItems(1,d._onPrependedToMapBoard)},onPinMouseOut:function(a){var b=a.data;this.map.unHighlightMarkerForPinId(b)},onPinMouseIn:function(a){var b=a.data;this.map.highlightMarkerForPinId(b)},onPinPlaceClick:function(a){var b=a.data;this.map.highlightMarkerForPinId(b),this.map.openPopupForPin(b)},onAddPinToMapBeginShowing:function(){this.disablePinsAndButton(),this.map.toggleTranslucentMarkers(!0),this.detatchHoverListeners(),this.map.closeAllMarkerPopups(),this.attachHoverListeners()},onAddPinToMapEndShowing:function(a){var b=a.target;b.focus(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_NEXT)},onAddPinToMapBeginHiding:function(a){var b=a.target;this.enablePinsAndButton(),this.setPinToAddToMap(null),this.ensureModalChildDropdownsHidden(b),this.map.clearPlaceholderMarkers(),this.detatchHoverListeners(),this.map.toggleTranslucentMarkers(!1),this.attachHoverListeners()},ensureModalChildDropdownsHidden:function(a){a.hideChildDropdowns()},onPinAddToMapCachePinId:function(a){var b=a&&a.data;this.setPinToAddToMap(b)},getPinToAddToMap:function(){return this._pinToAddToMap},setPinToAddToMap:function(a){this._pinToAddToMap=a},_getPinsWithCoordinates:function(){var a=[];if(this.map){var b=this.getPins();_.each(b,function(b){var c=b.getCoordinates();c&&a.push(b)})}return a},detatchHoverListeners:function(){this.map&&this._toggleHoverListeners(!1)},_toggleHoverListeners:function(a){var b=this._getPinsWithCoordinates();_.each(b,function(b){var c=b.getCoordinates();if(c){var d=a?P.CONST.ADD_HOVER_LISTENER_FOR_MAP_MARKER:P.CONST.REMOVE_HOVER_LISTENER_FOR_MAP_MARKER;b.trigger(d)}})},attachHoverListeners:function(){this.map&&this._toggleHoverListeners(!0)},isPlaceBoard:function(){var a=this.data;return a?a.layout===P.CONST.BOARD_LAYOUT_PLACES:!1},onRendered:function(){var a="places"===this.data.layout;a&&this.attachHoverListeners(),P.Module.prototype.onRendered()},resetShowPinOnMapButtonStates:function(){var a=this.getPins();_.each(a,function(a){a.resetShowOnMapButton()})},onChildItemsAddedToGrid:function(){this.map&&(this.attachHoverListeners(),this.updatePinsOnMap())},updatePinsOnMap:function(){var a=this._pinCount,b=this.getPins();if(!b)return void(this._pinCount=0);var c=b.length,d=c-a-1;d&&(b=b.slice(a),this.map.addMarkersToMap(b,!0),this._pinCount=c)},onBoardUpdated:function(a,b,c){c.url!==this.data.url&&this.inDom?(this.data.url=c.url,this.navigate(c.url)):this.headerDataChanged(c)&&this.renderHeader(),c.layout!==this.data.layout&&(this.data.layout=c.layout,this.navigate(c.url,this,!0))},onPinAdded:function(){var a=this.getGrid();a.prependNewItems(1)},onBannedUser:function(){this.renderHeader();var a=this.getGrid();a.render()},headerDataChanged:function(a){var b=_.pick(this.data,"privacy","description"),c=_.pick(a,"privacy","description");return!_.isEqual(b,c)},onBoardDeleted:function(){this.inDom&&this.navigateToUserPage()},navigateToUserPage:function(){var a=this.extraData&&this.extraData.currentUsername,b="/",c=a?b+a+"/":b;this.navigate(c)},getHeader:function(){return this.getChildById("boardHeader")},renderHeader:function(){var a=this.getHeader();a.render()},showEditModal:function(){var a=this.getHeader();return a.showEditModal()},onChildPinUpdated:function(a){var b=a.data,c=b.board.id,d=b.place,e=a.target,f=b.id;if(c!==this.data.id&&(e.destroy(),this._removePinFromMap(e)),d||this._removePinFromMap(e),this.map){var g=this.map.getMarkerForPin(f);if(g&&d){var h=g.getLatLng(),i=h.lat,j=h.lng,k=d.latitude,l=d.longitude;if(l!==j||k!==i){this.map.removeMarkerForPinId(f);var m={data:d};m.data.pin=e,this.addPermanentMarkerFromTypeahead(m)}}}},onBoardRemovedSelf:function(){this.data.privacy===P.CONST.BOARD_PRIVACY_SECRET&&this.inDom?this.navigateToUserPage():this.renderHeader()},adjustPageHeightForSignupBanner:function(){if(this.options.tab===BOARD_PAGE_PINS_TAB&&this.getChildById("grid").getGridItems()&&this.getChildById("grid").getGridItems().isReady()){this.$(".GridFooter").hide(),this.showingPageTwoSneakPeek||(this.$el.height("100%"),this.$el.height(this.$el.height()+this.$(".UnauthBanner").outerHeight()));var a=this.isPlaceBoard()?100:25;if(P.experiments.instance.inExperimentGroupsActiveOrTriggerable("board_signup",["no_scroll_small_2"])&&this.data.pin_count>a&&!this.showingPageTwoSneakPeek){var b=this.$el.height();this.showingPageTwoSneakPeek=!0,this.getChildById("grid").requestMoreItems(),this.$el.height(b),this.$el.css("overflow-y","hidden")}}},onResize:function(){this.options.tab===BOARD_PAGE_PINS_TAB&&(this.showingPageTwoSneakPeek?this.render():(this.$el.height("100%"),this.$el.height(this.$el.height()+this.$(".UnauthBanner").outerHeight())))}}),goog.provide("P.modules.BusinessGetStarted"),goog.require("P.Module"),goog.require("P.modules.BoardCreate"),P.modules.BusinessGetStarted=P.Module.extend({events:{"click .partnerCreateBoard":"createBoard"},createBoard:function(){return P.trackGAEvent("board_create",P.CONST.GA_ACTION_OPEN_MODAL),this.showBoardCreateModal(),!1},showBoardCreateModal:function(){var a=new P.modules.BoardCreate({options:{}});this.showInModal(a)}}),goog.provide("P.modules.Closeup"),goog.require("P.Module"),goog.require("P.modules.CloseupBottom"),goog.require("P.modules.CloseupContent"),goog.require("P.modules.CloseupSidebar"),goog.require("P.modules.Pin"),goog.require("P.modules.PinActionBar");var MODULE_ID_ACTION_BAR="actions",MODULE_ID_CONTENT="content",MODULE_ID_SIDEBAR="sidebar",MODULE_ID_BOTTOM="bottom",SELECTOR_CLOSEUP_ACTION_BAR=".closeupActionBarContainer",FIXED_IMAGE_WIDTH=736,ACTIONBAR_HEIGHT=57,DEFAULT_PADDING=40,PIN_MARGIN=14,CLOSEUP_CONTENT_WIDTH=1e3,CLOSE_BUTTON_VISIBLE_CLASS="visible",IN_CLICKTHROUGH_SIGNUP_EXP=P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_clickthrough_prompted_signup",["control_3","can_dismiss_no_skip_3","cannot_dismiss_3"])&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_closeup_prompted_signup",["control_3","can_dismiss_no_skip_3","cannot_dismiss_3"])&&!P.experiments.instance.inExperimentGroupsActiveOrTriggerable("board_signup",["control_2","no_scroll_small_2","scroll_small_2"]);P.modules.Closeup=P.Module.extend({events:{click:"_onClick","click button.close":"onCloseButtonClick"},onVisualSearchObjectSelected:function(a){var b=this.getChildById(MODULE_ID_SIDEBAR);if(b){var c=this.resource.options.id,d=a.data;b.updateVisuallySimilar({pinId:c,objId:d})}return!1},getOwnedScrollables:function(){return this.options.can_close?this.$el:$()},onCreated:function(){this.closeDiv=$('<button class="Button borderless close"><em></em>&nbsp;</button>')},onKeyup:function(a){var b=P.getModalManager();this.options.can_close&&!b.hasModals()&&a.keyCode===P.keyCode.ESCAPE&&this._close()},_close:function(){this.triggerEvent(P.CONST.EVENT_CLOSE,this,!0)},_unsticky:function(){this._actionBar&&this._actionBar.unsticky()},_updateSticky:function(){if(this.parent&&this.inDom&&this._actionBar){var a=this.$(".PaddedPin"),b=this.getScrollableElement(),c=0;this.options.can_close||(c=$(".headerBackground").height()),this._actionBar.updateSticky({$boundTo:a,$scrollable:b,headerHeight:c})}},resetCloseButton:function(){this.$close.removeClass(CLOSE_BUTTON_VISIBLE_CLASS)},onAddedToDom:function(){var a=this;if(this.hasError)return this.detachElement(),void this.destroy();this._positionActionBar(),this.options.can_close&&$("body").on("keyup.closeup",function(b){a.onKeyup(b)}),this.childListen(P.CONST.EVENT_NAVIGATE,this.onChildNavigate),this.childListen(P.CONST.EVENT_VISUAL_SEARCH_OBJECT_SELECTED,this.onVisualSearchObjectSelected),this.childListen(P.CONST.EVENT_TOAST_RENDER,this._onChildToastRender);var b=P.scrollbarWidth();this.$close||(this.$close=this.$(".close")),this.$close.css("right",b+PIN_MARGIN+"px").addClass(CLOSE_BUTTON_VISIBLE_CLASS)},_positionActionBar:function(){this._actionBar&&this.inDom&&this.contentReady&&this._updateSticky()},onContentReady:function(){this._actionBar=this.getChildById(MODULE_ID_ACTION_BAR),this.options.show_repin?(this.showRepinModal(),delete this.options.show_repin):this.options.show_edit&&(this.extraData.canEdit&&this.showEditModal(),delete this.options.show_edit),this._positionActionBar(),this.extraData&&this.extraData.showContextualReg&&(P.trackRegisterAction("send_pin_landing"),P.UserRegistration.showSignupModal(this.resource,{sent_pin:!0,sender:this.options.sender,redirect_to_signup:!0}));var a=this.getChildById(MODULE_ID_CONTENT);a&&a.addTutorials(),IN_CLICKTHROUGH_SIGNUP_EXP&&P.trackRegisterAction("view_pin_closeup")},onChildRemoved:function(a){"CloseupContent"===a.className&&(this.options.can_close?this._close():(this.destroy(),this.navigate("/")))},_removeTransitionImage:function(){this.transitionPinImage&&(this.transitionPinImage.remove(),this.transitionPinImage=null)},onRemovedFromDom:function(){this._actionBar&&this._actionBar.removeDropdowns(),this._unsticky(),this.options.can_close&&$("body").off("keyup.closeup"),this._removeListeners()},_shouldRenderAsLite:function(){var a=P.ExperienceManager.instance().getPlacedExperience(P.Experiences.Placement.WEB_PIN_CLOSEUP);return a&&(a.experience_id===P.Experiences.Experience.WEB_PIN_CLOSEUP_LITE||a.experience_id===P.Experiences.Experience.WEB_PIN_CLOSEUP_AUTOBAHN)},render:function(){if(!this.options.can_close)try{return P.Module.prototype.render.apply(this,arguments)}catch(a){throw console.error(a),a}this.$el.empty().addClass("canClose");var b=this._shouldRenderAsLite();b&&this.$el.addClass("lite"),this.$el.append(this.closeDiv),this.$el.append('<div class="closeupActionBarContainer" data-component-type="'+P.ContextLogging.ComponentType.MODAL_PIN+'"></div><div class="closeupContainer"></div><div class="closeupBottom"></div>');var c=!!this.transitionPinImage;c&&this.$el.append(this.transitionPinImage);var d=this,e=P.resourceFactory.clone(this.resource),f=this.resource.options.id,g=P.resourceFactory.clone(this.resource);g.options.field_set_key="detailed";var h=new P.modules.CloseupContent({id:MODULE_ID_CONTENT,resource:g,options:{highlight_question_id:this.options.question_id,highlight_answer_id:this.options.answer_id,show_comments:this.options.show_comments,show_reply_answer_id:this.options.show_reply_answer_id}}),i=d.$(SELECTOR_CLOSEUP_ACTION_BAR),j=new P.modules.PinActionBar({id:MODULE_ID_ACTION_BAR,options:{pin_id:f},resource:e});j.errorStrategy=P.CONST.ErrorStrategy.BUBBLE,j.render(),this._actionBar=j,this.insertChild(j,i);var k=this.$(".closeupContainer"),l=P.resourceFactory.clone(this.resource);l.options.field_set_key="closeup_sidebar";var m=new P.modules.CloseupSidebar({id:MODULE_ID_SIDEBAR,resource:l});m.render(function(){d.insertChild(m,k)});var n=h.render().then(function(){if(d.insertChild(h,k),c){var a=h.getPin(),e=a.getPinMedia(),f=e.attr("src");
e.load(_.bindFn(d._removeTransitionImage,d)),e.error(_.bindFn(d._removeTransitionImage,d)),e.attr("src",f),e[0]&&e[0].complete&&d._removeTransitionImage()}d.contentReady=!0,d.onContentReady();var g=new P.modules.CloseupBottom({id:MODULE_ID_BOTTOM,options:{pin_id:d.resource.options.id}});if(!b){var i=d.$(".closeupBottom");g.render(function(){d.insertChild(g,i)})}});return c?Promise.resolve(void 0):n},handleError:function(a){a.api_error_code===P.CONST.API_ERROR_PIN_NOT_FOUND&&(this.hasError=!0),P.Module.prototype.handleError.call(this,a)},setCloseupBottomMinHeight:function(){var a=this.$(".closeupContainer").height(),b=this.getScrollableElement().scrollTop(),c=this.getChildById(MODULE_ID_BOTTOM);if(c){var d=P.Viewport.height,e=b+d-a;c.setMinHeight(e)}},removeCloseupBottomMinHeight:function(){var a=this.getChildById(MODULE_ID_BOTTOM);a&&a.setMinHeight(null)},showRepinModal:function(){this._actionBar&&P.currentUser.isAuthenticated()&&this._actionBar.showRepinModal()},showEditModal:function(){var a=this.getChildById(MODULE_ID_CONTENT);return a.showEditModal()},setAsMainModule:function(a,b,c){var d=this,e=this.getChildById(MODULE_ID_CONTENT),f=this.getChildById(MODULE_ID_SIDEBAR),g=this.getChildById(MODULE_ID_BOTTOM),h=b.options.id;if(!e||!f||!g)return P.Module.prototype.setAsMainModule.apply(this,arguments);if(this._removeTransitionImage(),a.can_close?0===this.closeDiv.parent().length&&(this.$el.prepend(this.closeDiv),this.$el.addClass("canClose")):this.closeDiv.parent().length>0&&(this.closeDiv.remove(),this.$el.removeClass("canClose")),this.options.can_close=a.can_close,this.hasSameOptions(a,b)&&this.contentReady&&!this._forceRefreshRequested(c))return Promise.resolve(void 0);this.setOptions(a),this.setResource(b),c.evt&&c.evt.currentTarget&&"Closeup"===c.evt.currentTarget.className||e.empty();var i={name:b.name,options:_.extend({},b.options)},j=P.resourceFactory.clone(this.resource),k=new P.modules.PinActionBar({id:MODULE_ID_ACTION_BAR,options:{pin_id:h},resource:j});return i.options.field_set_key="detailed",e.setResource(i),this.setCloseupBottomMinHeight(),k.render(),e.render().then(function(){var a=d.$(SELECTOR_CLOSEUP_ACTION_BAR);d.insertChild(k,a),d._actionBar&&d._actionBar.destroy(),d._actionBar=k,d._positionActionBar(),g.setOptions({pin_id:h}),g.render(function(){d.removeCloseupBottomMinHeight()}),f.updateDomain(e.data.domain),f.updateRelatedRecipes(e.data.rich_recipe_top_ingredients),IN_CLICKTHROUGH_SIGNUP_EXP&&P.trackRegisterAction("view_pin_closeup"),d.signupShownOnce=!1})},onChildNavigate:function(a){if(!P.isOffsiteUrl(a.data.url)||this.signupShownOnce||P.experiments.instance.inExperimentGroupsActiveOrTriggerable("pin_closeup_prompted_signup",["control_3","can_dismiss_no_skip_3","cannot_dismiss_3"])||P.experiments.instance.inExperimentGroupsActiveOrTriggerable("board_signup",["control_2","no_scroll_small_2","scroll_small_2"])||P.showSignupPromptForExperiment("pin_clickthrough_prompted_signup","click_pin_source",P._("Sign up to see where this Pin came from and discover more great ideas"))&&(this.signupShownOnce=!0,a.stopPropagation()),P.NuxUtils.preventNavigationIfNecessary(a),this.log.debug("Closeup got navigate event from child",a.target,"for url:",a.data.url),!P.isOffsiteUrl(a.data.url)){var b=this.getChildById(MODULE_ID_SIDEBAR);return b===a.currentTarget&&"Pin"===a.target.className&&(a.data.handled=!0,"boardPinsGrid"===a.target.options.view_type&&b.updateVisuallySimilar(null)),!1}},onCloseButtonClick:function(){return this._close(),this.resetCloseButton(),!1},_onClick:function(a){if(this.options.can_close){var b=a.target;(b&&(b===this.$el[0]||b===this.$(".closeupContainer")[0])||b===this.$(".closeupBottom")[0])&&(a.stopPropagation(),this._close())}},performTransition:function(a){var b=a.evt&&a.evt.target||null,c=a.evt&&a.evt.currentTarget||null;return b&&"Pin"===b.className&&"summary"===b._getViewType()&&"Closeup"!==c.className&&(this.transitionPinImage=this._getTransitionPinImage(b)),this.render()},_getTransitionPinImage:function(a){var b=a.getPinMedia();if(!b)return null;var c=b.clone(),d=a.getSourceUrl()||a.getImageUrl(P.CONST.IMAGE_SIZE_ORIG),e=$("<a class='transitionImage' href='"+d+"'></a>").append(c);c[0].onload=null;var f,g=a.getDetailedImageDimensions(),h=g.height,i=g.width;if(i<FIXED_IMAGE_WIDTH){var j=Math.round((FIXED_IMAGE_WIDTH-i)/2);f=j<DEFAULT_PADDING?j+ACTIONBAR_HEIGHT:DEFAULT_PADDING+ACTIONBAR_HEIGHT}else f=ACTIONBAR_HEIGHT;var k=2*PIN_MARGIN,l=(P.Viewport.width-CLOSEUP_CONTENT_WIDTH+PIN_MARGIN)/2,m=(FIXED_IMAGE_WIDTH-i)/2,n={height:h,padding:f+"px "+m+"px "+(f-ACTIONBAR_HEIGHT)+"px",left:l,top:k};return a.isVideo()&&a.data.attribution&&(n.padding=ACTIONBAR_HEIGHT+"px 0px 0px"),e.css(n),c.css({height:h,width:i}),e},getPin:function(){return this.getChildById(MODULE_ID_CONTENT).getPin()},getLoggingObjectIdStr:function(){return this.resource.options.id},_onChildToastRender:function(a){var b=a.target;this.$el.append(b.getContent())},getQuestions:function(){var a=this.getChildById(MODULE_ID_CONTENT);return a?a.getQuestions():null},initScroll:function(){this.options.question_id&&this.getQuestions()&&this.getQuestions().scrollToQuestions()}}),goog.provide("P.modules.SendBase"),goog.require("P.Module"),goog.require("P.modules.UserSelectBase"),P.modules.SendBase=P.modules.UserSelectBase.extend({_EMAIL_RESOURCE_NAME:"",_GA_TOPIC_EMAIL:"send_base_email",_GA_TOPIC_SEND_FACEBOOK:"send_base_facebook",_GPLUS_SHARE_LABEL:"",_OBJECT_ID_NAME:"",_SEND_RESOURCE_NAME:"",_SEND_FACEBOOK_RESOURCE_NAME:"",_logThirdPartySend:function(){},onChildItemSelected:function(a){a.stopPropagation();var b=a.data.item.attributes;return b.type===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER?(this._sendViaFacebook(b),this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),void this._logThirdPartySend("facebook")):b.type===P.CONST.TYPEAHEAD_TYPE_GPLUS_NON_PINNER?(this.triggerEvent(P.CONST.EVENT_DROPDOWN_HIDE,null,!0),void this._logThirdPartySend("gplus")):void P.modules.UserSelectBase.prototype.onChildItemSelected.call(this,a)},onContentReady:function(){P.resourceFactory.create("TrackFunnelActionResource",{action:"sendpin_open"}).call("create",{error:P.NOOP}),P.modules.UserSelectBase.prototype.onContentReady.call(this),P.fb.ensureInit(P.NOOP)},onSendAction:function(){var a=this.getSelectedItem();"user"===a.type?this._sendViaUser(a):this.isEmailType(a.type)?this._sendViaEmail(a):P.showError(P.string.common.defaultErrorMessage)},onTypeaheadRenderDone:function(a){this.enableGplusShareButton(a.data,P.absolutify(this.options.object_url,"http",P.CONST.CANONICAL_MAIN_DOMAIN),this._GPLUS_SHARE_LABEL)},_sendViaEmail:function(a){var b=this,c=a.email||a.email_address,d=a.full_name||a.first_name,e={email:c,recipient_name:d||c};e[this._OBJECT_ID_NAME]=this.options.object_id;var f=this.getMessageValue();f&&(e.message=f);var g=P.resourceFactory.create(b._EMAIL_RESOURCE_NAME,e);g.call("create").then(function(){P.trackGAEvent(b._GA_TOPIC_EMAIL,P.CONST.GA_ACTION_SUCCESS)},function(){P.trackGAEvent(b._GA_TOPIC_EMAIL,P.CONST.GA_ACTION_ERROR)}),this.reset()},_sendViaUser:function(a){if(a){var b={user_id:a.id};b[this._OBJECT_ID_NAME]=this.options.object_id;var c=this.getMessageValue();c&&(b.message=c);var d=this;P.resourceFactory.create(this._SEND_RESOURCE_NAME,b).call("create",{error:P.NOOP}).then(function(){d.clearSelectedItem()},function(a){P.showError(a.message)}),this.clearSelectedItem()}},_sendViaFacebook:function(a){var b=this;P.fb.ensureLoggedIn(function(){b._sendToFacebook(a)})},_sendToFacebook:function(a){var b=this,c={};c[this._OBJECT_ID_NAME]=this.options.object_id,c.send_type="facebook_no_user",P.resourceFactory.create(this._SEND_FACEBOOK_RESOURCE_NAME,c).call("create",{error:P.NOOP}).then(function(d){var e,f=d.resource_response.data;e=_.isString(e)?f:f.share_url,P.FacebookDialog.open({type:"send",picture:b.options.object_image_url,path:e,to:a.id,callback:function(a){if(a&&a.success){P.trackGAEvent(b._GA_TOPIC_SEND_FACEBOOK,P.CONST.GA_ACTION_SUCCESS);var d=P.resourceFactory.create("ConversationObjectSentResource",c);d.callCreate()}}}),P.trackGAEvent(b._GA_TOPIC_SEND_FACEBOOK,P.CONST.GA_ACTION_OPEN_MODAL)}).fin(function(){P.trackGAEvent(b._GA_TOPIC_SEND_FACEBOOK,P.CONST.GA_ACTION_ERROR)}),this.reset()}}),goog.provide("P.modules.SendBoard"),goog.require("P.modules.SendBase"),P.modules.SendBoard=P.modules.SendBase.extend({_EMAIL_RESOURCE_NAME:"EmailBoardResource",_GA_TOPIC_EMAIL:"board_email",_GA_TOPIC_SEND_FACEBOOK:"board_send_facebook",_GPLUS_SHARE_LABEL:"FOLLOW",_OBJECT_ID_NAME:"board",_SEND_FACEBOOK_RESOURCE_NAME:"SendBoardFacebookResource",_SEND_RESOURCE_NAME:"ShareBoardResource"}),goog.provide("P.modules.SendBoard2"),goog.require("P.Module"),goog.require("P.modules.SendObject2Base"),P.modules.SendBoard2=P.modules.SendObject2Base.extend({_OBJECT_ID_NAME:"board",moduleRenderer:new P.ModuleRendererLocal("app/desktop/modules/SendBoard2/SendBoard2.nunjucks")}),goog.provide("P.modules.SendPin"),goog.require("P.modules.SendBase"),P.modules.SendPin=P.modules.SendBase.extend({_EMAIL_RESOURCE_NAME:"EmailPinResource",_GA_TOPIC_EMAIL:"pin_email",_GA_TOPIC_SEND_FACEBOOK:"pin_send_facebook",_GPLUS_SHARE_LABEL:"PIN_IT",_OBJECT_ID_NAME:"pin",_SEND_FACEBOOK_RESOURCE_NAME:"SendPinFacebookResource",_SEND_RESOURCE_NAME:"SharePinResource",_logThirdPartySend:function(a,b){var c={userid:P.currentUser.id,send_method:b,recipient_email:null,recipient_name:a.name,recipient_id:null,pin:this.options.object_id,message:null,time:jQuery.now()},d={topic:"send_pin",content:c},e=P.resourceFactory.create("EventLoggingResource",d);e.callCreate({error:P.NOOP})}}),goog.provide("P.modules.SendPinner"),goog.require("P.modules.SendBase"),P.modules.SendPinner=P.modules.SendBase.extend({_EMAIL_RESOURCE_NAME:"EmailUserResource",_GA_TOPIC_EMAIL:"user_email",_GA_TOPIC_SEND_FACEBOOK:"user_send_facebook",_GPLUS_SHARE_LABEL:"FOLLOW",_OBJECT_ID_NAME:"shared_user",_SEND_FACEBOOK_RESOURCE_NAME:"SendUserFacebookResource",_SEND_RESOURCE_NAME:"ShareUserResource"}),goog.provide("P.modules.UserBoards"),goog.require("P.modules.Board"),goog.require("P.modules.BoardCreateRep"),goog.require("P.modules.UserBoardsBase");var SECRET_BOARD_TYPE=P.CONST.BOARD_PRIVACY_SECRET,MODULE_ID_PUBLIC_BOARDS_GRID="publicBoardsGrid",MODULE_ID_SECRET_BOARDS_GRID="secretBoardsGrid";P.modules.UserBoards=P.modules.UserBoardsBase.extend({onContentReady:function(){P.modules.UserBoardsBase.prototype.onContentReady.call(this),this.extraData.isOwnProfile&&(this.initializeBoardsSortManager(MODULE_ID_PUBLIC_BOARDS_GRID),this.initializeBoardsSortManager(MODULE_ID_SECRET_BOARDS_GRID),this.setupMessageHandlers())},addCreateBoardRep:function(a,b,c){if(!c.items.getChildById(a)){var d=new P.modules.BoardCreateRep({id:a,options:{secret:b===SECRET_BOARD_TYPE}});d.render(function(){c.items.appendChild(d)})}},initializeBoardsSortManager:function(a){var b=this.getChildById(a),c=this,d=function(a){var c=a.find(".Board"),d=b.items.getChildByElement(c);d.disable()},e=function(a){var c=a.find(".Board"),d=b.items.getChildByElement(c);d.enable()},f={cancel:".BoardCreateRep",start:function(a,b){d(b.item)},stop:function(a,b){P.setTimeout(function(){e(b.item)},5)},over:function(a,b){var c=30,d=$(window).scrollTop(),e=b.offset.top-d,f=b.item.height(),g=e<0,h=e>P.Viewport.height-f;h&&(c*=-1),(g||h)&&$(window).scrollTop(d-c)},update:function(b,d){c.onBoardsSortUpdate(b,d,a)}};b.setDragState(b.DRAGGING_DISABLED),b.items.initializeSortManager(f,"Board",function(a){return a.data&&a.data.id})},onBoardsSortUpdate:function(a,b,c){var d=this.getChildById(c);this.saveBoardOrder(d.items.getSortOrder())},saveBoardOrder:function(a){var b="BoardsReorderResource",c={board_ids:a},d=P.resourceFactory.create(b,c),e="user_boards_reorder";d.callUpdate({success:function(){P.trackGAEvent(e,P.CONST.GA_ACTION_SUCCESS)},error:function(){P.trackGAEvent(e,P.CONST.GA_ACTION_ERROR)}})},setupMessageHandlers:function(){var a=[this.getChildById(MODULE_ID_PUBLIC_BOARDS_GRID),this.getChildById(MODULE_ID_SECRET_BOARDS_GRID)],b={};b[P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN]=_.bindFn(this.handleConversationOpen,this,a),b[P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED]=_.bindFn(this.handleConversationClosed,this,a),this.pubsubSubscribe(P.CONST.PUBSUB_CHANNEL_MESSAGES,b)},handleConversationOpen:function(a){_.each(a,function(a){a.setDragState(a.DRAGGING_ENABLED)})},handleConversationClosed:function(a){_.each(a,function(a){a.setDragState(a.DRAGGING_DISABLED)})}}),goog.provide("P.modules.tutorials.ModalAnswerIntroOne"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalQAIntroBaseStep"),P.modules.tutorials.ModalAnswerIntroOne=P.modules.tutorials.ModalQAIntroBaseStep.extend({getHighlightedElement:function(){var a=this._getModuleChildrenByModuleName(P.app,"Question");return a&&0!==a.length?this._highlightModule(a[0],!0):null}}),goog.provide("P.modules.tutorials.ModalAnswerIntroTwo"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalQAIntroBaseStep"),P.modules.tutorials.ModalAnswerIntroTwo=P.modules.tutorials.ModalQAIntroBaseStep.extend({getHighlightedElement:function(){var a=this._getModuleChildrenByModuleName(P.app,"QuestionCreate");return a&&0!==a.length?this._highlightModule(a[0],!0):null}}),goog.provide("P.modules.tutorials.ModalPlacePinsSearch"),goog.require("P.Module"),goog.require("P.modules.tutorials.ModalStepBase"),goog.require("P.modules.AddPinToMap"),P.modules.tutorials.ModalPlacePinsSearch=P.modules.tutorials.ModalStepBase.extend({onShow:function(){this.highlightAddPinToMap()},highlightAddPinToMap:function(){var a=this.getTargetModule();if(a){var b=this._highlightModule(a,!0);this.setModalPosition("RIGHT_TOP",b,!0);var c=this._getModal();c&&this._setModalVisible(c,!1)}},_setModalVisible:function(a,b){var c=a.getMask();c=c.add(a.getModalScroller()),b?c.css("visibility","visible"):c.css("visibility","hidden")},_getModal:function(){var a=P.getModalManager(),b=a.getTopModal();return b?b:null},getTargetModule:function(){var a=this._getModal();if(!a)return null;var b=a.getModule();return b?b:null},onPreviousButtonClicked:function(){P.modules.tutorials.ModalStepBase.prototype.onPreviousButtonClicked.call(this),this.clickCloseButton()},clickCloseButton:function(){var a=this.getTargetModule(),b=a.getChildById("closeButton");b.$el.click();var c=this._getModal();c&&this._setModalVisible(c,!0)},getPlacementId:function(){return P.Experiences.Placement.WEB_EMPTY_PLACES_BOARD_TAKEOVER},getExperienceId:function(){return P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED}}),goog.provide("P.modules.BoardEditActionBase"),goog.require("P.Module"),goog.require("P.modules.BoardEditBase"),goog.require("P.modules.BoardInvites"),P.modules.BoardEditActionBase=P.modules.BoardEditBase.extend({onCreated:function(){P.modules.BoardEditBase.prototype.onCreated.call(this),this.childListen(P.CONST.EVENT_CHANGE,this.onChildChange)},onContentReady:function(){P.modules.BoardEditBase.prototype.onContentReady.call(this);var a={};a[P.CONST.PUBSUB_TOPIC_BOARD_BANNED_COLLABORATOR]=this.onBannedUser,a[P.CONST.PUBSUB_TOPIC_BOARD_REMOVED_COLLABORATOR_SELF]=this.onBoardRemovedSelf,this.pubsubSubscribe(this.data.id,a)},onSubmitValidated:function(){var a=this;if(!this._showSecretBoardStatusChangeConfirmation)return void a.saveBoard();var b={name:"ConfirmDialog",options:{template:"make_public"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.saveBoard)})},onChildChange:function(a){if("secretCheckbox"===a.target.id){var b=!a.target.isChecked();this._showSecretBoardStatusChangeConfirmation=b?!0:!1}},onChildInviteUser:function(a){var b=this.getChildById("boardInviteForm");b.showLoading();var c,d,e=this,f=a.data.userId,g=a.data.pending,h=a.data.type,i=this.getBoardId(),j=this.getChildById(g?"boardPendingInvites":"boardInvites");"user"===h?(c={board_id:i,invited_user_id:f},d=P.resourceFactory.create("BoardInviteResource",c),d.callCreate({error:P.NOOP}).then(function(){P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_SUCCESS),j.addInvitee({type:"pinner",identifier:f}),b.clearTypeahead()},function(a){P.showError(a.message),P.trackGAEvent("collaborator_invite_user",P.CONST.GA_ACTION_ERROR)}).fin(function(){b.hideLoading()})):h===P.CONST.TYPEAHEAD_TYPE_FB_NON_PINNER&&(d=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:this.getBoardId()}),d.callGet({error:P.NOOP}).then(function(a){var c=a.resource_response.data;b.hideLoading(),e.displayFacebookDialog([f],c.url,function(a){a&&a.success&&(d=P.resourceFactory.create("BoardFacebookInviteResource",{board_id:e.getBoardId(),invite_code:c.invite_code}),d.callUpdate())})},function(a){b.hideLoading(),P.showError(a.message)}))},onChildInviteEmail:function(a){var b=this,c=this.getChildById("boardInviteForm");c.showLoading();var d=a.data.email,e={board_id:this.getBoardId(),emails:[d]},f=P.resourceFactory.create("BoardEmailInviteResource",e);f.callCreate({success:function(){P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_SUCCESS);var a=P.string.format(P.string.common.successInviteSentToEmail,{email:d});c.clearTypeahead();var e=$("<div class='alert'>"+a+"</div>");b.insertAfterModule(e,c),e.fadeIn(function(){e.delay(5e3).fadeOut(function(){e.remove()})})},error:function(a){P.showError(a.message),P.trackGAEvent("collaborator_invite_email",P.CONST.GA_ACTION_ERROR)},complete:function(){c.hideLoading()}})},deleteBoard:function(){var a=this,b=this.getBoardId(),c=this.getFieldValues(),d=c.privacy,e=P.resourceFactory.create("BoardResource",{board_id:b}),f=function(a){P.showError(a.message),P.trackGAEvent("board_delete",P.CONST.GA_ACTION_ERROR)},g=function(c){if(P.trackGAEvent("board_delete",P.CONST.GA_ACTION_SUCCESS),c){var e=c.resource_response;if(e&&!e.error)return void a.handleDelete(b,d)}f(c)};this.showLoading(),e.callDelete({success:g,error:f,complete:function(){a.hideLoading()}})},handleDelete:function(){},redirectAfterDelete:function(){var a=this.data.owner?"/"+this.data.owner.username+"/":"/";window.location.href!==a&&this.navigate(a)},onBoardRemovedSelf:function(){this.destroy()},onBannedUser:function(){var a=this.getChildById("boardInvites");a.render();var b=this.getChildById("boardPendingInvites");b&&b.render()}}),goog.provide("P.modules.BoardPicker"),goog.require("P.modules.ui.Picker"),goog.require("P.modules.BoardCreate"),P.modules.BoardPicker=P.modules.ui.Picker.extend({create:function(a){return this._create(a)},_create:function(a){if(a){var b=this,c=P.resourceFactory.create("BoardResource",{name:a});return c.callCreate().then(function(a){var c=a.resource_response.data,d=c.id;return b.triggerEvent(P.CONST.EVENT_BOARD_SELECTED,null,!0),b.triggerEvent("boardCreated",d,!0),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_CREATED,d),c})}return new Promise(function(b){var c=new P.modules.BoardCreate;c.setOptions({name:a}),this.listen(c,P.CONST.EVENT_DESTROYED,function(){b(null)}),this.listen(c,P.CONST.EVENT_BOARD_CREATED,function(a){b(a.data)}),this.showInModal(c)})},hasBoards:function(){return this.extraData.hasBoards},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/BoardPicker/BoardPicker.nunjucks")}),goog.provide("P.modules.BoardPickerDropdownButton"),goog.require("P.modules.DropdownButton"),goog.require("P.modules.BoardPicker"),P.modules.BoardPickerDropdownButton=P.modules.DropdownButton.extend({onCreated:function(){P.modules.DropdownButton.prototype.onCreated.call(this),this._selectedBoard=null,this.childListen(P.CONST.EVENT_CHANGE,_.bindFn(this._onChildChange,this))},onContentReady:function(){this.extraData&&(this._selectedBoard=this.extraData.selectedBoard),P.modules.DropdownButton.prototype.onContentReady.call(this)},getContentModuleLoadOptions:function(){var a={name:"BoardPicker",options:{view_type:"compact",in_popover:!0},resource:{name:this.resource.name,options:this.resource.options}};return this.options.selected_board_id&&(a.options.selected_board_id=this.options.selected_board_id),a},getSelectedBoard:function(){return this._selectedBoard},_onChildChange:function(a){a.stopPropagation(),this._selectedBoard=a.data,this.options.selected_board_id=this._selectedBoard.id;var b=this._getLabelModule();b.data=this._selectedBoard,b.renderExistingData(),this.hideDropdown(),this.triggerEvent(P.CONST.EVENT_CHANGE,a.data,!0)},moduleRenderer:new P.ModuleRendererLocal("app/common/modules/BoardPickerDropdownButton/BoardPickerDropdownButton.nunjucks")}),goog.provide("P.modules.BoardEdit"),goog.require("P.Module"),goog.require("P.modules.BoardEditActionBase"),P.modules.BoardEdit=P.modules.BoardEditActionBase.extend({handleDelete:function(a,b){this.isInModal()?(P.pubsub.publish(a,P.CONST.PUBSUB_TOPIC_BOARD_DELETED),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_BOARD_DELETED,{privacy:b}),this.destroy()):this.redirectAfterDelete()},onButtonClick:function(a){P.modules.BoardEditBase.prototype.onButtonClick.call(this,a);var b=a.target;"deleteBoardButton"===b.id&&this.onDeleteClick()},onDeleteClick:function(){P.trackGAEvent("board_delete",P.CONST.GA_ACTION_OPEN_MODAL),this.showConfirmation()},onDeleteConfirm:function(){P.trackGAEvent("board_delete",P.CONST.GA_ACTION_CLICK_SUBMIT),this.deleteBoard()},showConfirmation:function(){var a=this,b={name:"ConfirmDialog",options:{template:"delete_board"}};P.loadModule(b,function(b){a.showInModal(b),a.listen(b,P.CONST.EVENT_CONFIRM,a.onDeleteConfirm)})}}),goog.provide("P.modules.PinCreateSuccessBoardEdit"),goog.require("P.Module"),goog.require("P.modules.BoardEditActionBase"),P.modules.PinCreateSuccessBoardEdit=P.modules.BoardEditActionBase.extend({onContentReady:function(){P.modules.BoardEditActionBase.prototype.onContentReady.call(this);var a=this.getChildById("doneButton");a&&this.listen(a,P.CONST.EVENT_BUTTON_CLICK,this.onDone)},onDone:function(){this.showLoading();var a={board_id:this.data&&this.data.id},b=this.getChildById("placeLayoutCheckbox");b&&(a.layout=b.isChecked()?"places":"default");var c=this,d=P.resourceFactory.create("BoardResource",a),e=this.options.pinCreateInfo,f=function(){e&&P.loadModule(e,function(a){c.showInModal(a),c.hideLoading(),c.destroy()})};d.callUpdate({error:P.NOOP}).fin(f)}}),function(){goog.provide("P.main"),goog.require("P.adTracking"),goog.require("P.logger"),goog.require("P.modules"),goog.require("P.start"),goog.require("P.string");var a=P.Logger.getLogger("Main"),b=function(a,c){_.each(a,function(a,d){a.prototype?a.prototype.className=c+d:"object"===typeof a&&b(a,c+d+".")})};P.start.ready(function(a){b(P.modules,""),P.CONST.CANONICAL_MAIN_DOMAIN=a.canonicalMainDomain,P.string.initializeCommonStrings();var c=a.tree,d=P.ModuleTree.fromPlainObject(c);P.moduleFactory.create(d).then(function(a){P.app=a}),P.AdTracking.trackConversions(),a.canDebug&&$(document).on("keypress",function(a){var b=P.getWindowManager();b&&"|"===String.fromCharCode(a.which)&&b.open("/_/_/debug/","debug",800,800)}),P.start.finishStart()}),$(document).ready(function(){var b=$("#jsInit");b.length||a.error("jsInit block at bottom of page failed to load"),FastClick.attach(document.body)})}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/AnswerLikeButton/AnswerLikeButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",h+=d.suppressValue((f=7,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["QALikeButton"])),a.autoesc),a.getTemplate("app/common/modules/QALikeButton/QALikeButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/BoardIcons/BoardIcons.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("board",i),c.parent||(b.setVariable("board",i),b.addExport("board")),h+="\n";var j;j=d.memberLookup(i,"is_collaborative",a.autoesc),c.set("is_collaborative",j),c.parent||(b.setVariable("is_collaborative",j),b.addExport("is_collaborative")),h+="\n";var k;k="places"==d.memberLookup(i,"layout",a.autoesc),c.set("is_place",k),c.parent||(b.setVariable("is_place",k),b.addExport("is_place")),h+="\n";var l;l="secret"==d.memberLookup(i,"privacy",a.autoesc),c.set("is_secret",l),c.parent||(b.setVariable("is_secret",l),b.addExport("is_secret")),h+="\n\n",k&&(h+='\n    <span class="placeIcon"></span>\n'),h+="\n",l&&(h+='\n    <span class="secretIcon"></span>\n'),h+="\n",j&&(h+='\n    <span class="collaborativeIcon"></span>\n'),h+="\n",e(null,h)}catch(m){e(d.handleError(m,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/BoardLabel/BoardLabel.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/image.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("image_tag"))return void e(new Error("cannot import 'image_tag'"));var k=j.image_tag;b.setVariable("image_tag",k),h+="\n\n";var l;l=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),"normal"),c.set("view_type",l),c.parent||(b.setVariable("view_type",l),b.addExport("view_type")),h+="\n",h+=d.suppressValue((f=9,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[l])),a.autoesc),h+="\n\n";var m;m=d.contextOrFrameLookup(b,c,"data"),c.set("board",m),c.parent||(b.setVariable("board",m),b.addExport("board")),h+="\n\n";var n;f=13,g=32,n=d.callWrap(d.memberLookup(m,"get",a.autoesc),'board["get"]',["image_cover_url"]),c.set("image_cover_url",n),c.parent||(b.setVariable("image_cover_url",n),b.addExport("image_cover_url")),h+="\n",h+=d.suppressValue((f=14,g=10,d.callWrap(k,"image_tag",[d.makeKeywordArgs({src:n,class_name:"boardImg"})])),a.autoesc),h+='\n\n<span class="nameAndIcons">\n    ',h+=d.suppressValue((f=19,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardIcons",d.makeKeywordArgs({id:"boardIcons",data:m})])),a.autoesc),h+="\n    ",h+=d.suppressValue(d.memberLookup(m,"name",a.autoesc),a.autoesc),h+="\n</span>\n",e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/BoardPicker/BoardPicker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),"normal"),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"in_popover",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=12,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["inPopover"])),a.autoesc),h+="\n"),h+="\n\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"boards_shortlist",a.autoesc),c.set("boards_shortlist",j),c.parent||(b.setVariable("boards_shortlist",j),b.addExport("boards_shortlist")),h+="\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"all_boards",a.autoesc),c.set("all_boards",k),c.parent||(b.setVariable("all_boards",k),b.addExport("all_boards")),h+="\n\n";var l;if(l=[],c.set("base_data",l),c.parent||(b.setVariable("base_data",l),b.addExport("base_data")),h+="\n\n",a.getFilter("length").call(b,j)>0){if(h+="\n    ","compact"==i){h+="\n        ";var m;m=d.contextOrFrameLookup(b,c,"none"),c.set("shortlist_section_name",m),c.parent||(b.setVariable("shortlist_section_name",m),b.addExport("shortlist_section_name")),h+="\n    "}else h+="\n        ",f=24,g=39,m=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Recently Picked"]),c.set("shortlist_section_name",m),c.parent||(b.setVariable("shortlist_section_name",m),b.addExport("shortlist_section_name")),h+="\n    ";h+="\n    ";var n;n={name:m,items:j},c.set("section",n),c.parent||(b.setVariable("section",n),b.addExport("section")),h+="\n    ",h+="\n    ";var o;f=31,g=38,o=d.callWrap(d.memberLookup(l,"append",a.autoesc),'base_data["append"]',[n]),c.set("throw_away",o),c.parent||(b.setVariable("throw_away",o),b.addExport("throw_away")),h+="\n"}if(h+="\n\n",a.getFilter("length").call(b,k)>0){if(h+="\n    ",h+=d.suppressValue((f=35,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{hasBoards:!0}])),a.autoesc),h+="\n\n    ","compact"==i){h+="\n        ";var p;p=d.contextOrFrameLookup(b,c,"none"),c.set("all_boards_section_name",p),c.parent||(b.setVariable("all_boards_section_name",p),b.addExport("all_boards_section_name")),h+="\n    "}else h+="\n        ",f=40,g=40,p=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["All Boards"]),c.set("all_boards_section_name",p),c.parent||(b.setVariable("all_boards_section_name",p),b.addExport("all_boards_section_name")),h+="\n    ";h+="\n    ",n={name:p,items:k},c.set("section",n),c.parent||(b.setVariable("section",n),b.addExport("section")),h+="\n\n    ",h+="\n    ",f=48,g=38,o=d.callWrap(d.memberLookup(l,"append",a.autoesc),'base_data["append"]',[n]),c.set("throw_away",o),c.parent||(b.setVariable("throw_away",o),b.addExport("throw_away")),h+="\n    ";var q;q=a.getFilter("length").call(b,l)-1,c.set("all_boards_section_index",q),c.parent||(b.setVariable("all_boards_section_index",q),b.addExport("all_boards_section_index")),h+="\n"}else h+="\n    ",h+=d.suppressValue((f=51,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{hasBoards:!1}])),a.autoesc),h+="\n";h+="\n\n\n";var r;r={input_placeholder_text:(f=56,g=31,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Type a board name"])),item_module:{name:"BoardLabel",options:{view_type:i}}},c.set("base_options",r),c.parent||(b.setVariable("base_options",r),b.addExport("base_options")),h+="\n\n",h+="\n";var s;if(f=67,g=36,s=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["selected_board_id"]),c.set("selected_board_id",s),c.parent||(b.setVariable("selected_board_id",s),b.addExport("selected_board_id")),h+="\n",s){h+="\n    ",c=c.push();var t=k;if(t)for(var u=0;u<t.length;u++){var v=t[u];if(c.set("board",v),c.set("loop.index0",u),h+="\n        ",f=70,g=21,d.callWrap(d.memberLookup(v,"get",a.autoesc),'board["get"]',["id"])==s){h+="\n            ",h+="\n            ";var w;f=72,g=49,w=d.callWrap(d.memberLookup(r,"update",a.autoesc),'base_options["update"]',[{selected_section_index:q,selected_item_index:d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"index0",a.autoesc)}]),c.set("throw_away",w),c.parent||(b.setVariable("throw_away",w),b.addExport("throw_away")),h+="\n        "}h+="\n    "}c=c.pop(),h+="\n"}h+="\n\n";var x;x=0==a.getFilter("length").call(b,k),c.set("empty",x),c.parent||(b.setVariable("empty",x),b.addExport("empty")),h+="\n",x&&(h+="\n    ",h+="\n    ",f=83,g=41,o=d.callWrap(d.memberLookup(r,"update",a.autoesc),'base_options["update"]',[{create_suggestions:[(f=85,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Places to Visit"])),(f=86,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Stuff to Buy"])),(f=87,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Projects to Try"])),(f=88,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Things to Wear"])),(f=89,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Recipes to Cook"])),(f=90,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Ideas for the House"]))]}]),c.set("throw_away",o),c.parent||(b.setVariable("throw_away",o),b.addExport("throw_away")),h+="\n"),h+="\n\n";var y;y=l,c.set("data",y),c.parent||(b.setVariable("data",y),b.addExport("data")),h+="\n",h+=d.suppressValue((f=96,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[r])),a.autoesc),h+=d.suppressValue((f=96,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.Picker"])),a.autoesc),a.getTemplate("app/common/modules/ui/Picker/Picker.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);
h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(z){e(d.handleError(z,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/BoardPickerDropdownButton/BoardPickerDropdownButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"boards_shortlist",a.autoesc),c.set("boards_shortlist",i),c.parent||(b.setVariable("boards_shortlist",i),b.addExport("boards_shortlist")),h+="\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"all_boards",a.autoesc),c.set("all_boards",j),c.parent||(b.setVariable("all_boards",j),b.addExport("all_boards")),h+="\n\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"selected_board_id",a.autoesc),c.set("selected_board_id",k),c.parent||(b.setVariable("selected_board_id",k),b.addExport("selected_board_id")),h+="\n\n";var l;l={arrow:"down",dropdown_options:{class_name:"aboveModal strongBorder boardPicker",hide_caret:!0},label_module:{name:"BoardLabel",options:{view_type:"compact"},data:{name:(f=22,g=26,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Select a board"]))}}},c.set("base_options",l),c.parent||(b.setVariable("base_options",l),b.addExport("base_options")),h+="\n\n",c=c.push();var m=j;if(m)for(var n=0;n<m.length;n++){var o=m[n];if(c.set("board",o),h+="\n    ",d.memberLookup(o,"id",a.autoesc)==k){h+="\n        ";var p;f=28,g=58,p=d.callWrap(d.memberLookup(d.memberLookup(l,"label_module",a.autoesc),"update",a.autoesc),'base_options["label_modu"]["update"]',[{data:o}]),c.set("throw_away",p),c.parent||(b.setVariable("throw_away",p),b.addExport("throw_away")),h+="\n        ",h+=d.suppressValue((f=31,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{selectedBoard:o}])),a.autoesc),h+="\n    "}h+="\n"}c=c.pop(),h+="\n\n",h+=d.suppressValue((f=37,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[l])),a.autoesc),h+=d.suppressValue((f=37,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["DropdownButton"])),a.autoesc),a.getTemplate("app/common/modules/DropdownButton/DropdownButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(q){e(d.handleError(q,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Button/Button.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+="\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"class_name",a.autoesc),""),c.set("class_name",i),c.parent||(b.setVariable("class_name",i),b.addExport("class_name"));var j;j=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"element_type",a.autoesc),"button"),c.set("element_type",j),c.parent||(b.setVariable("element_type",j),b.addExport("element_type")),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"ellipsis",a.autoesc)||"button"!=j||(h+=d.suppressValue((f=36,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",["button"])),a.autoesc)),"a"==d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"element_type",a.autoesc)&&d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"url",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=40,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({href:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"url",a.autoesc)})])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"cancelButton",a.autoesc)&&(h+=d.suppressValue((f=44,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["cancelButton"])),a.autoesc)),"div"!=j&&"button"!=j&&(h+=d.suppressValue((f=48,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",[j])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc)&&(h+=d.suppressValue((f=52,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({disabled:"disabled"})])),a.autoesc),h+="\n    ",h+=d.suppressValue((f=53,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["disabled"])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"borderless",a.autoesc)?h+=d.suppressValue((f=57,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["borderless"])),a.autoesc):"inContextDropdownButton"!=i&&(h+="\n    ",h+=d.suppressValue((f=59,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["btn"])),a.autoesc),a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"rounded",a.autoesc),!0)&&(h+=d.suppressValue((f=61,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["rounded"])),a.autoesc))),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"size",a.autoesc)&&(h+=d.suppressValue((f=66,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"size",a.autoesc)])),a.autoesc));var k;k=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"color",a.autoesc),"default"),c.set("color",k),c.parent||(b.setVariable("color",k),b.addExport("color")),"default"!=k&&(h+=d.suppressValue((f=71,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[k])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"primary_on_hover",a.autoesc)&&(h+=d.suppressValue((f=75,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["primaryOnHover"])),a.autoesc)),(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc)||0==d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc))&&(h+=d.suppressValue((f=79,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-element-type":d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc)}])),a.autoesc)),h+=d.suppressValue((f=82,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n",h+=d.suppressValue((f=83,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({type:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"type",a.autoesc),"button")})])),a.autoesc),h+="\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"has_icon",a.autoesc),c.set("has_icon",l),c.parent||(b.setVariable("has_icon",l),b.addExport("has_icon")),h+="\n";var m;m=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"icon_on_right",a.autoesc),c.set("icon_on_right",m),c.parent||(b.setVariable("icon_on_right",m),b.addExport("icon_on_right")),h+="\n\n","down"==d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"arrow",a.autoesc)&&(h+="<span class='downArrow'></span>"),l&&!m&&(h+="<em></em>\n");var n;if(n=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"label_module",a.autoesc),c.set("label_module",n),c.parent||(b.setVariable("label_module",n),b.addExport("label_module")),n){var o;o={},c.set("label_module_with_id",o),c.parent||(b.setVariable("label_module_with_id",o),b.addExport("label_module_with_id")),h+="\n    ",h+="\n    ";var p;f=100,g=49,p=d.callWrap(d.memberLookup(o,"update",a.autoesc),'label_module_with_id["update"]',[n]),c.set("throw_away",p),c.parent||(b.setVariable("throw_away",p),b.addExport("throw_away")),h+="\n    ",h+="\n    ",f=102,g=49,p=d.callWrap(d.memberLookup(o,"update",a.autoesc),'label_module_with_id["update"]',[{id:"label"}]),c.set("throw_away",p),c.parent||(b.setVariable("throw_away",p),b.addExport("throw_away")),h+="\n    ",h+=d.suppressValue((f=103,g=16,d.callWrap(d.contextOrFrameLookup(b,c,"ProxyModule"),"ProxyModule",[o])),a.autoesc)}else if(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"text",a.autoesc)){var q;q=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"text",a.autoesc),c.set("text",q),c.parent||(b.setVariable("text",q),b.addExport("text"));var r;r=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_text",a.autoesc),!0),c.set("show_text",r),c.parent||(b.setVariable("show_text",r),b.addExport("show_text")),r?(h+='<span class="buttonText">',h+=d.suppressValue(q,a.autoesc),h+="</span>\n        ",h+=d.suppressValue((f=109,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasText"])),a.autoesc)):(h+='<span class="accessibilityText">',h+=d.suppressValue(q,a.autoesc),h+="</span>")}else h+="\n    &nbsp;";h+="\n",l&&m&&(h+="\n    <em></em>"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"supports_badge",a.autoesc)&&(h+="<span class='buttonBadge'></span>"),e(null,h)}catch(s){e(d.handleError(s,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Conversation/Conversation.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("conversation",i),c.parent||(b.setVariable("conversation",i),b.addExport("conversation")),h+="\n";var j;j=d.memberLookup(i,"users",a.autoesc),c.set("users",j),c.parent||(b.setVariable("users",j),b.addExport("users")),h+="\n";var k;k=d.memberLookup(i,"emails",a.autoesc),c.set("emails",k),c.parent||(b.setVariable("emails",k),b.addExport("emails")),h+="\n\n",h+=d.suppressValue((f=13,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationHead",d.makeKeywordArgs({id:"conversationHead",options:{can_close:!0,users:j,emails:k}})])),a.autoesc),h+="\n",e(null,h)}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationHead/ConversationHead.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"users",a.autoesc)||[],c.set("users",i),c.parent||(b.setVariable("users",i),b.addExport("users")),h+="\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"emails",a.autoesc)||[],c.set("emails",j),c.parent||(b.setVariable("emails",j),b.addExport("emails")),h+="\n";var k;k=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"size",a.autoesc),"normal"),c.set("size",k),c.parent||(b.setVariable("size",k),b.addExport("size")),h+="\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"can_close",a.autoesc),c.set("can_close",l),c.parent||(b.setVariable("can_close",l),b.addExport("can_close")),h+="\n";var m;m=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"should_link",a.autoesc),c.set("should_link",m),c.parent||(b.setVariable("should_link",m),b.addExport("should_link")),h+="\n\n",h+=d.suppressValue((f=26,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[k])),a.autoesc),h+="\n\n";var n=d.makeMacro(["user"],[],function(e,f){c=c.push(),f=f||{},c.set("user",e);var g="";if(g+="\n    ",d.memberLookup(e,"image_large_url",a.autoesc)){g+="\n        ",m&&d.memberLookup(e,"username",a.autoesc)&&(g+='\n            <a href="/',g+=d.suppressValue(d.memberLookup(e,"username",a.autoesc),a.autoesc),g+='/">\n        '),g+="\n        ";var h;h=d.memberLookup(e,"image_large_url",a.autoesc),c.set("image",h),c.parent||(b.setVariable("image",h),b.addExport("image")),g+='\n        <img class="head" src="',g+=d.suppressValue(h,a.autoesc),g+='">\n        ',m&&d.memberLookup(e,"username",a.autoesc)&&(g+="\n            </a>\n        "),g+="\n    "}else g+="\n        ",g+='\n        <div class="head">\n            ',g+=d.suppressValue(a.getFilter("upper").call(b,a.getFilter("first").call(b,e)),a.autoesc),g+="\n        </div>\n    ";return g+="\n",c=c.pop(),new d.SafeString(g)});b.addExport("image_view"),b.setVariable("image_view",n),h+='\n\n<div class="contentContainer">\n    ',l&&(h+="\n        ",h+=d.suppressValue((f=48,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"closeButton",options:{text:"X",show_text:!1,cancelButton:!0,has_icon:!0,borderless:!0,class_name:"conversationHeadClose"}})])),a.autoesc),h+="\n    "),h+='\n    <div class="headWrapper">\n        ';var o;o=a.getFilter("length").call(b,i),c.set("user_count",o),c.parent||(b.setVariable("user_count",o),b.addExport("user_count")),h+="\n        ";var p;if(p=o+a.getFilter("length").call(b,j),c.set("total_count",p),c.parent||(b.setVariable("total_count",p),b.addExport("total_count")),h+="\n\n        ",1==p){h+="\n            ";var q;q=d.memberLookup(i,0,a.autoesc)||d.memberLookup(j,0,a.autoesc),c.set("user",q),c.parent||(b.setVariable("user",q),b.addExport("user")),h+="\n            ",h+=d.suppressValue((f=66,g=23,d.callWrap(n,"image_view",[q])),a.autoesc),h+="\n        "}else{if(h+="\n            ",2==p){if(h+="\n                ",0==o){h+="\n                    ";var r;r=d.memberLookup(j,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ";var s;s=d.memberLookup(j,1,a.autoesc),c.set("right_user",s),c.parent||(b.setVariable("right_user",s),b.addExport("right_user")),h+="\n                "}else 1==o?(h+="\n                    ",r=d.memberLookup(i,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ",s=d.memberLookup(j,0,a.autoesc),c.set("right_user",s),c.parent||(b.setVariable("right_user",s),b.addExport("right_user")),h+="\n                "):(h+="\n                    ",r=d.memberLookup(i,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ",s=d.memberLookup(i,1,a.autoesc),c.set("right_user",s),c.parent||(b.setVariable("right_user",s),b.addExport("right_user")),h+="\n                ");h+='\n                <div class="imagesWrapper">\n                    <div class="leftWrapper halfWrapper">\n                        ',h+=d.suppressValue((f=81,g=35,d.callWrap(n,"image_view",[r])),a.autoesc),h+=' \n                    </div>\n                    <div class="rightWrapper halfWrapper isWholeHalf">\n                        ',h+=d.suppressValue((f=84,g=35,d.callWrap(n,"image_view",[s])),a.autoesc),h+=" \n                    </div>\n                </div>\n            "}else{if(h+="\n                ",0==o){h+="\n                    ",r=d.memberLookup(j,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ";var t;t=d.memberLookup(j,1,a.autoesc),c.set("right_top_user",t),c.parent||(b.setVariable("right_top_user",t),b.addExport("right_top_user")),h+="\n                    ";var u;u=d.memberLookup(j,2,a.autoesc),c.set("right_bottom_user",u),c.parent||(b.setVariable("right_bottom_user",u),b.addExport("right_bottom_user")),h+="\n                "}else 1==o?(h+="\n                    ",r=d.memberLookup(i,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ",t=d.memberLookup(j,0,a.autoesc),c.set("right_top_user",t),c.parent||(b.setVariable("right_top_user",t),b.addExport("right_top_user")),h+="\n                    ",u=d.memberLookup(j,1,a.autoesc),c.set("right_bottom_user",u),c.parent||(b.setVariable("right_bottom_user",u),b.addExport("right_bottom_user")),h+="\n                "):2==o?(h+="\n                    ",r=d.memberLookup(i,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ",t=d.memberLookup(i,1,a.autoesc),c.set("right_top_user",t),c.parent||(b.setVariable("right_top_user",t),b.addExport("right_top_user")),h+="\n                    ",u=d.memberLookup(j,0,a.autoesc),c.set("right_bottom_user",u),c.parent||(b.setVariable("right_bottom_user",u),b.addExport("right_bottom_user")),h+="\n                "):(h+="\n                    ",r=d.memberLookup(i,0,a.autoesc),c.set("left_user",r),c.parent||(b.setVariable("left_user",r),b.addExport("left_user")),h+="\n                    ",t=d.memberLookup(i,1,a.autoesc),c.set("right_top_user",t),c.parent||(b.setVariable("right_top_user",t),b.addExport("right_top_user")),h+="\n                    ",u=d.memberLookup(i,2,a.autoesc),c.set("right_bottom_user",u),c.parent||(b.setVariable("right_bottom_user",u),b.addExport("right_bottom_user")),h+="\n                ");h+='\n                <div class="imagesWrapper">\n                    <div class="leftWrapper halfWrapper">\n                        ',h+=d.suppressValue((f=107,g=35,d.callWrap(n,"image_view",[r])),a.autoesc),h+=' \n                    </div>\n                    <div class="rightWrapper halfWrapper smallImage top">\n                        ',h+=d.suppressValue((f=110,g=35,d.callWrap(n,"image_view",[t])),a.autoesc),h+=' \n                    </div>\n                    <div class="rightWrapper halfWrapper smallImage bottom">\n                        ',h+=d.suppressValue((f=113,g=35,d.callWrap(n,"image_view",[u])),a.autoesc),h+=" \n                    </div>\n                </div>\n            "}h+="\n        "}h+='\n        <div class="noDrag"></div>\n    </div>\n    ';var v;v=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"badge_count",a.autoesc),c.set("badge_count",v),c.parent||(b.setVariable("badge_count",v),b.addExport("badge_count")),h+="\n    ";var w;w="count badge",c.set("base_class",w),c.parent||(b.setVariable("base_class",w),b.addExport("base_class")),h+="\n    ",v||(h+="\n        ",w+=" hidden",c.set("base_class",w),c.parent||(b.setVariable("base_class",w),b.addExport("base_class")),h+="\n    "),h+="\n    ",h+=d.suppressValue((f=125,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"badgeButton",options:{class_name:w,text:v,borderless:!0,has_icon:!1}})])),a.autoesc),h+="\n\n    ";var x;x=d.memberLookup(i,0,a.autoesc)&&d.memberLookup(d.memberLookup(i,0,a.autoesc),"first_name",a.autoesc)||d.memberLookup(j,0,a.autoesc),c.set("first_user_name",x),c.parent||(b.setVariable("first_user_name",x),b.addExport("first_user_name")),h+="\n    ",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_name",a.autoesc)&&x&&(h+='  \n        <div class="name">\n            <p class="nameText">',h+=d.suppressValue(x,a.autoesc),h+="\n        </div>\n    "),h+="\n</div>",e(null,h)}catch(y){e(d.handleError(y,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationListItem/ConversationListItem.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("conversation",i),c.parent||(b.setVariable("conversation",i),b.addExport("conversation")),h+="\n";var j;f=21,g=29,j=d.callWrap(d.memberLookup(i,"get",a.autoesc),'conversation["get"]',["users"])||d.contextOrFrameLookup(b,c,"data"),c.set("users",j),c.parent||(b.setVariable("users",j),b.addExport("users")),h+="\n";var k;f=22,g=30,k=d.callWrap(d.memberLookup(i,"get",a.autoesc),'conversation["get"]',["emails"])||[],c.set("emails",k),c.parent||(b.setVariable("emails",k),b.addExport("emails")),h+="\n";var l;l=[],c.set("other_users",l),c.parent||(b.setVariable("other_users",l),b.addExport("other_users")),h+="\n\n",c=c.push();var m=j;if(m)for(var n=0;n<m.length;n++){var o=m[n];if(c.set("user",o),h+="\n    ",f=26,g=16,d.callWrap(d.memberLookup(o,"get",a.autoesc),'user["get"]',["id"])!=(f=26,g=42,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["id"]))){h+="\n        ",h+="\n        ";var p;f=28,g=45,p=d.callWrap(d.memberLookup(l,"append",a.autoesc),'other_users["append"]',[o]),c.set("other_users",p),c.parent||(b.setVariable("other_users",p),b.addExport("other_users")),h+="\n    "}h+="\n"}c=c.pop(),h+="\n\n";var q;q=a.getFilter("length").call(b,l)+a.getFilter("length").call(b,k),c.set("total_count",q),c.parent||(b.setVariable("total_count",q),b.addExport("total_count")),h+="\n";var r;r=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_is_pinner",a.autoesc),c.set("show_is_pinner",r),c.parent||(b.setVariable("show_is_pinner",r),b.addExport("show_is_pinner")),h+="\n";var s;s=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_selected_state",a.autoesc),c.set("show_selected_state",s),c.parent||(b.setVariable("show_selected_state",s),b.addExport("show_selected_state")),h+="\n";var t;t=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"conversation_head_size",a.autoesc),"small"),c.set("conversation_head_size",t),c.parent||(b.setVariable("conversation_head_size",t),b.addExport("conversation_head_size")),h+="\n\n";var u;if(u=d.memberLookup(i,"unread",a.autoesc),c.set("unread",u),c.parent||(b.setVariable("unread",u),b.addExport("unread")),h+="\n",u&&d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"differentiate_unread_state",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=39,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["unread"])),a.autoesc),h+="\n"),h+='\n\n<div class="left">\n    ',h+=d.suppressValue((f=43,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationHead",d.makeKeywordArgs({id:"conversationHead",options:{can_close:!1,size:t,users:l,emails:k}})])),a.autoesc),h+='\n</div>\n\n<div class="right">\n    ',q>1){h+="\n        ";var v;v=[],c.set("names",v),c.parent||(b.setVariable("names",v),b.addExport("names")),h+="\n        ",c=c.push();var w=l;if(w)for(var x=0;x<w.length;x++){var y=w[x];c.set("user",y),h+="\n            ";var z;f=58,g=37,z=d.callWrap(d.memberLookup(y,"get",a.autoesc),'user["get"]',["first_name"]),c.set("full_name",z),c.parent||(b.setVariable("full_name",z),b.addExport("full_name")),h+="\n            ";var A;f=59,g=37,A=d.callWrap(d.memberLookup(v,"append",a.autoesc),'names["append"]',[z]),c.set("names",A),c.parent||(b.setVariable("names",A),b.addExport("names")),h+="\n        "}c=c.pop(),h+="\n        ",c=c.push();var B=k;if(B)for(var C=0;C<B.length;C++){var D=B[C];c.set("email",D),h+="\n            ";var E;f=62,g=37,E=d.callWrap(d.memberLookup(v,"append",a.autoesc),'names["append"]',[D]),c.set("names",E),c.parent||(b.setVariable("names",E),b.addExport("names")),h+="\n        "}c=c.pop(),h+="\n        ";var F;F=a.getFilter("join").call(b,v,", "),c.set("display_title",F),c.parent||(b.setVariable("display_title",F),b.addExport("display_title")),h+="\n    "}else h+="\n        ",1==a.getFilter("length").call(b,l)?(h+="\n            ",f=67,g=51,F=d.callWrap(d.memberLookup(d.memberLookup(l,0,a.autoesc),"get",a.autoesc),'other_users["0"]["get"]',["full_name"]),c.set("display_title",F),c.parent||(b.setVariable("display_title",F),b.addExport("display_title")),h+="\n        "):(h+="\n            ",F=d.memberLookup(k,0,a.autoesc),c.set("display_title",F),c.parent||(b.setVariable("display_title",F),b.addExport("display_title")),h+="\n        "),h+="\n    ";h+="\n    ";var G;f=72,g=40,G=d.callWrap(d.memberLookup(i,"get",a.autoesc),'conversation["get"]',["last_message"])||{},c.set("last_message",G),c.parent||(b.setVariable("last_message",G),b.addExport("last_message")),h+="\n    ";var H;f=73,g=47,H=d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["sender"])||{},c.set("last_message_sender",H),c.parent||(b.setVariable("last_message_sender",H),b.addExport("last_message_sender")),h+="\n    ";var I;f=74,g=68,I=d.callWrap(d.memberLookup(H,"get",a.autoesc),'last_message_sender["get"]',["id"])==(f=74,g=94,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["id"])),c.set("last_message_sent_by_current_user",I),c.parent||(b.setVariable("last_message_sent_by_current_user",I),b.addExport("last_message_sent_by_current_user")),h+="\n    ";var J;if(J=!1,c.set("last_message_sent_object",J),c.parent||(b.setVariable("last_message_sent_object",J),b.addExport("last_message_sent_object")),h+="\n    ",f=76,g=24,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["text"])){if(h+="\n        ",I){h+="\n            ";var K;K=a.getFilter("safe").call(b,a.getFilter("emojify").call(b,(f=78,g=49,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["text"])))),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n        "}else h+="\n            ",K=a.getFilter("safe").call(b,a.getFilter("named_format").call(b,(f=80,g=34,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["{{first_name}}: {{text}}"])),{first_name:(f=81,g=53,d.callWrap(d.memberLookup(H,"get",a.autoesc),'last_message_sender["get"]',["first_name"])),text:a.getFilter("safe").call(b,a.getFilter("emojify").call(b,(f=82,g=40,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["text"]))))})),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n        ";h+="\n    "}else h+="\n        ",J=!0,c.set("last_message_sent_object",J),c.parent||(b.setVariable("last_message_sent_object",J),b.addExport("last_message_sent_object")),h+="\n        ",f=86,g=28,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["user"])?(h+="\n            ",I?(h+="\n                ",f=88,g=38,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["You sent a Pinner."]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "):(h+="\n                ",K=a.getFilter("named_format").call(b,(f=90,g=38,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["{{first_name}} sent you a Pinner."])),{first_name:(f=91,g=57,d.callWrap(d.memberLookup(H,"get",a.autoesc),'last_message_sender["get"]',["first_name"]))}),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "),h+="\n        "):(f=93,g=30,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["board"])?(h+="\n            ",I?(h+="\n                ",f=95,g=38,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["You sent a board."]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "):(h+="\n                ",K=a.getFilter("named_format").call(b,(f=97,g=38,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["{{first_name}} sent you a board."])),{first_name:(f=98,g=57,d.callWrap(d.memberLookup(H,"get",a.autoesc),'last_message_sender["get"]',["first_name"]))}),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "),h+="\n        "):(f=100,g=30,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["pin"])&&(h+="\n            ",I?(h+="\n                ",f=102,g=38,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["You sent a Pin."]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "):(h+="\n                ",K=a.getFilter("named_format").call(b,(f=104,g=38,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["{{first_name}} sent you a Pin."])),{first_name:(f=105,g=57,d.callWrap(d.memberLookup(H,"get",a.autoesc),'last_message_sender["get"]',["first_name"]))}),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n            "),h+="\n        "))),h+="\n    ";if(h+="\n\n    ",r&&(h+="\n        ",J=!1,c.set("last_message_sent_object",J),c.parent||(b.setVariable("last_message_sent_object",J),b.addExport("last_message_sent_object")),h+=" ",h+="\n        ",q>1?(h+="\n            ",f=113,g=34,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Group of Pinners"]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n        "):1==q&&1==a.getFilter("length").call(b,k)?(h+="\n            ",f=115,g=34,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Email Friend"]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n        "):(h+="\n            ",f=117,g=34,K=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Fellow Pinner"]),c.set("subtitle_text",K),c.parent||(b.setVariable("subtitle_text",K),b.addExport("subtitle_text")),h+="\n        "),h+="\n    "),h+="\n\n    ",s?(h+="\n        ",h+=d.suppressValue((f=122,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasSelectedStateAvailable"])),a.autoesc),h+="\n    "):(h+="\n        ",h+=d.suppressValue((f=124,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["noSelectedStateAvailable"])),a.autoesc),h+="\n    "),h+="\n    ",s&&(h+='\n        <div class="titleSubtitleWrapper">\n    '),h+="\n    ",f=129,g=19,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["hideable"])&&(h+="\n        ",h+=d.suppressValue((f=130,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hideable"])),a.autoesc),h+="\n        ",h+=d.suppressValue((f=131,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"hideConversation",options:{text:(f=134,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["&times;"])),has_icon:!1,show_text:!0,class_name:"hideableButton",borderless:!0}})])),a.autoesc),h+="\n    "),h+='\n        <h4 class="title">',h+=d.suppressValue(F,a.autoesc),h+='</h4>\n        <p class="subtitle',J&&(h+=" sentObject"),h+='">',h+=d.suppressValue(K,a.autoesc),h+="</p>\n    ",f=144,g=19,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["include_timestamp"])){h+="\n        ",h+=d.suppressValue((f=145,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasTimestamp"])),a.autoesc),h+="\n        ";var L;L=a.getFilter("humanize_timesince").call(b,(f=146,g=54,d.callWrap(d.memberLookup(G,"get",a.autoesc),'last_message["get"]',["created_at"]))),c.set("last_message_timestamp",L),c.parent||(b.setVariable("last_message_timestamp",L),b.addExport("last_message_timestamp")),h+='\n        <p class="timeStamp">\n            ',h+=d.suppressValue(L,a.autoesc),h+="\n        </p>\n    "}h+="\n    ",s&&(h+="\n        </div>\n    "),h+="\n\n    ",s&&(h+='\n        <div class="selectedState">\n            <em class="icon"></em>\n        </div>\n    '),h+="\n</div>",e(null,h)}catch(M){e(d.handleError(M,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationMessage/ConversationMessage.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("message",i),c.parent||(b.setVariable("message",i),b.addExport("message")),h+="\n";var j;j=d.memberLookup(i,"text",a.autoesc),c.set("message_text",j),c.parent||(b.setVariable("message_text",j),b.addExport("message_text")),h+="\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"text",a.autoesc)&&(h+="\n    ",j=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"text",a.autoesc),c.set("message_text",j),c.parent||(b.setVariable("message_text",j),b.addExport("message_text")),h+="\n"),h+="\n";var k;k=d.memberLookup(i,"sender",a.autoesc),c.set("sender",k),c.parent||(b.setVariable("sender",k),b.addExport("sender")),h+="\n";var l;l=d.memberLookup(i,"pin",a.autoesc),c.set("pin",l),c.parent||(b.setVariable("pin",l),b.addExport("pin")),h+="\n",l||(h+="\n    ",l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"pin",a.autoesc),c.set("pin",l),c.parent||(b.setVariable("pin",l),b.addExport("pin")),h+="\n"),h+="\n";var m;m=d.memberLookup(i,"board",a.autoesc),c.set("board",m),c.parent||(b.setVariable("board",m),b.addExport("board")),h+="\n",m||(h+="\n    ",m=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"board",a.autoesc),c.set("board",m),c.parent||(b.setVariable("board",m),b.addExport("board")),h+="\n"),h+="\n";var n;n=d.memberLookup(i,"user",a.autoesc),c.set("user",n),c.parent||(b.setVariable("user",n),b.addExport("user")),h+="\n",n||(h+="\n    ",n=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"user",a.autoesc),c.set("user",n),c.parent||(b.setVariable("user",n),b.addExport("user")),h+="\n"),h+="\n\n",d.memberLookup(k,"id",a.autoesc)==d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"id",a.autoesc)||d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_own_message",a.autoesc)?(h+="\n    ",h+=d.suppressValue((f=36,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["isOwnMessage"])),a.autoesc),h+="\n"):(h+="\n    ",h+=d.suppressValue((f=38,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["notOwnMessage"])),a.autoesc),h+="\n"),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_group",a.autoesc)&&d.memberLookup(d.memberLookup(i,"sender",a.autoesc),"id",a.autoesc)!=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"id",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=42,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasConversationHead"])),a.autoesc),h+="\n    ",h+=d.suppressValue((f=43,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationHead",d.makeKeywordArgs({options:{users:[(f=45,g=33,d.callWrap(d.memberLookup(i,"get",a.autoesc),'message["get"]',["sender"]))],size:"small",should_link:!0,link:!0,actionable:!1}})])),a.autoesc),h+="\n"),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"hide_object",a.autoesc)||(h+="\n    ",l?(h+="\n        ",h+=d.suppressValue((f=56,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasPin"])),a.autoesc),h+="\n\n        ",a.getFilter("trim").call(b,d.memberLookup(l,"description",a.autoesc))||(h+="\n            ",h+=d.suppressValue((f=59,g=21,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasNoDescription"])),a.autoesc),h+="\n        "),h+="\n\n        ",h+=d.suppressValue((f=62,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Pin",d.makeKeywordArgs({data:l,resource:(f=64,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["PinResource",d.makeKeywordArgs({options:{id:d.memberLookup(l,"id",a.autoesc),field_set_key:"grid_item"}})])),options:{show_comments:!1,hide_pin_credits:!0,show_pinner:!0,no_fade:!0,squish_giraffe_pins:!0,show_board:!0,hide_edit_button:!0,show_social_counts:!1,show_send_button:!1},error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"REMOVE",a.autoesc)})])),a.autoesc),h+="\n    "):m?(h+="\n        ",h+=d.suppressValue((f=82,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasBoard"])),a.autoesc),h+="\n        ",h+=d.suppressValue((f=83,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Board",d.makeKeywordArgs({data:m,resource:(f=85,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["BoardResource",d.makeKeywordArgs({options:{board_id:d.memberLookup(m,"id",a.autoesc),field_set_key:"grid_item"}})])),options:{show_user_icon:!0},error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"REMOVE",a.autoesc)})])),a.autoesc),h+="\n    "):n&&(h+="\n        ",h+=d.suppressValue((f=95,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasUser"])),a.autoesc),h+="\n        ",h+=d.suppressValue((f=96,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["User",d.makeKeywordArgs({data:n,resource:(f=98,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["UserResource",d.makeKeywordArgs({options:{username:d.memberLookup(n,"username",a.autoesc),field_set_key:"grid_item"}})])),options:{},error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"REMOVE",a.autoesc)})])),a.autoesc),h+="\n    "),h+="\n"),h+='\n\n<em class="messageCaret"></em>\n',j&&!d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"hide_text",a.autoesc)&&(h+="\n    <p>",h+=d.suppressValue(a.getFilter("safe").call(b,a.getFilter("emojify").call(b,a.getFilter("urlize").call(b,j))),a.autoesc),h+="</p>\n"),h+="\n",e(null,h)
}catch(o){e(d.handleError(o,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationMessages/ConversationMessages.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("conversation_messages",i),c.parent||(b.setVariable("conversation_messages",i),b.addExport("conversation_messages")),h+="\n",i||(h+="\n    ",h+=d.suppressValue((f=13,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["empty"])),a.autoesc),h+='\n    <div class="emptyState">\n        <p>',h+=d.suppressValue((f=15,g=12,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Type your message or drag a Pin!"])),a.autoesc),h+="</p>\n    </div>\n"),h+="\n",h+="\n";var j;j={},c.set("previous_message_time",j),c.parent||(b.setVariable("previous_message_time",j),b.addExport("previous_message_time")),h+="\n",c=c.push();var k=i;if(k)for(var l=0;l<k.length;l++){var m=k[l];c.set("message",m),c.set("loop.index0",l),h+="\n    ";var n;f=24,g=35,n=d.callWrap(d.memberLookup(m,"get",a.autoesc),'message["get"]',["created_at"]),c.set("message_time",n),c.parent||(b.setVariable("message_time",n),b.addExport("message_time")),h+="\n    ";var o;if(o=a.getFilter("should_include_timestamp").call(b,n,d.makeKeywordArgs({chunk_time:3600,previous_message_time:(f=26,g=77,d.callWrap(d.memberLookup(j,"get",a.autoesc),'previous_message_time["get"]',["time"]))})),c.set("should_show_timestamp",o),c.parent||(b.setVariable("should_show_timestamp",o),b.addExport("should_show_timestamp")),h+="\n    ",o){h+="\n        ";var p;if(p=a.getFilter("humanize_timesince").call(b,n),c.set("humanized_time",p),c.parent||(b.setVariable("humanized_time",p),b.addExport("humanized_time")),h+="\n        ",p!=d.contextOrFrameLookup(b,c,"previous_humanized_time")){h+='\n            <p class="timeSeparator',0==d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"index0",a.autoesc)&&(h+=" firstItem"),h+='">\n                ',h+=d.suppressValue(p,a.autoesc),h+="\n            </p>\n            ";var q;q=p,c.set("previous_humanized_time",q),c.parent||(b.setVariable("previous_humanized_time",q),b.addExport("previous_humanized_time")),h+="\n        "}h+="\n    "}h+="\n    ";var r;f=36,g=50,r=d.callWrap(d.memberLookup(j,"update",a.autoesc),'previous_message_time["update"]',[{time:n}]),c.set("throw_away",r),c.parent||(b.setVariable("throw_away",r),b.addExport("throw_away")),h+='\n    <li class="messageWrapper">\n        ',f=38,g=23,(d.callWrap(d.memberLookup(m,"get",a.autoesc),'message["get"]',["pin"])||(f=38,g=45,d.callWrap(d.memberLookup(m,"get",a.autoesc),'message["get"]',["board"]))||(f=38,g=69,d.callWrap(d.memberLookup(m,"get",a.autoesc),'message["get"]',["user"])))&&(h+="\n            ",h+=d.suppressValue((f=39,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationMessage",d.makeKeywordArgs({options:{hide_text:!0,is_group:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_group",a.autoesc)},data:m,resource:d.contextOrFrameLookup(b,c,"resource")})])),a.autoesc),h+="\n        "),h+="\n        ",f=48,g=23,d.callWrap(d.memberLookup(m,"get",a.autoesc),'message["get"]',["text"])&&(h+="\n            ",h+=d.suppressValue((f=49,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationMessage",d.makeKeywordArgs({options:{hide_object:!0,is_group:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_group",a.autoesc)},data:m,resource:d.contextOrFrameLookup(b,c,"resource")})])),a.autoesc),h+="\n        "),h+="\n    </li>\n"}c=c.pop(),h+="\n",e(null,h)}catch(s){e(d.handleError(s,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationPopup/ConversationPopup.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("conversation",i),c.parent||(b.setVariable("conversation",i),b.addExport("conversation")),h+="\n";var j;f=13,g=29,j=d.callWrap(d.memberLookup(i,"get",a.autoesc),'conversation["get"]',["users"]),c.set("users",j),c.parent||(b.setVariable("users",j),b.addExport("users")),h+="\n";var k;k=a.getFilter("length").call(b,j),c.set("user_count",k),c.parent||(b.setVariable("user_count",k),b.addExport("user_count")),h+="\n";var l;f=15,g=30,l=d.callWrap(d.memberLookup(i,"get",a.autoesc),'conversation["get"]',["emails"])||[],c.set("emails",l),c.parent||(b.setVariable("emails",l),b.addExport("emails")),h+="\n";var m;m=a.getFilter("length").call(b,l),c.set("emails_count",m),c.parent||(b.setVariable("emails_count",m),b.addExport("emails_count")),h+="\n";var n;if(n=k+m,c.set("total_count",n),c.parent||(b.setVariable("total_count",n),b.addExport("total_count")),h+='\n\n<div class="convosHeader">\n    <div class="left">\n        <h1 class="convosTitle">\n            ',n>1){h+="\n                ",c=c.push();var o=j;if(o)for(var p=0;p<o.length;p++){var q=o[p];c.set("user",q),c.set("loop.last",p===o.length-1),h+='\n                    <a href="/',h+=d.suppressValue((f=24,g=39,d.callWrap(d.memberLookup(q,"get",a.autoesc),'user["get"]',["username"])),a.autoesc),h+='/">',h+=d.suppressValue((f=24,g=64,d.callWrap(d.memberLookup(q,"get",a.autoesc),'user["get"]',["first_name"])),a.autoesc),h+="</a>",(!d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"last",a.autoesc)||a.getFilter("length").call(b,l)>0)&&(h+=","),h+="\n                "}c=c.pop(),h+="\n                ",c=c.push();var r=l;if(r)for(var s=0;s<r.length;s++){var t=r[s];c.set("email",t),c.set("loop.first",0===s),h+="\n                    ",d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"first",a.autoesc)||(h+=", "),h+=d.suppressValue(t,a.autoesc),h+="\n                "}c=c.pop(),h+="\n            "}else{if(h+="\n                ",k){h+="\n                    ";var u;u=d.memberLookup(j,0,a.autoesc),c.set("user",u),c.parent||(b.setVariable("user",u),b.addExport("user")),h+='\n                    <a href="/',h+=d.suppressValue((f=32,g=39,d.callWrap(d.memberLookup(u,"get",a.autoesc),'user["get"]',["username"])),a.autoesc),h+='/">',h+=d.suppressValue((f=32,g=64,d.callWrap(d.memberLookup(u,"get",a.autoesc),'user["get"]',["full_name"])),a.autoesc),h+="</a>\n                "}else h+="\n                    ",h+=d.suppressValue(d.memberLookup(l,0,a.autoesc),a.autoesc),h+="\n                ";h+="\n            "}h+='\n        </h1>\n    </div>\n\n    <div class="right">\n        ',h+=d.suppressValue((f=41,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"addPersonButton",options:{text:(f=44,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add Person"])),cancelButton:!1,show_text:!1,borderless:!0,has_icon:!0,class_name:"addPersonToActiveChat hidden"}})])),a.autoesc),h+="\n        \n        ",h+=d.suppressValue((f=53,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ShowModalButton",d.makeKeywordArgs({id:"reportButton",options:{class_name:"reportMsgButton",has_icon:!0,show_text:!1,borderless:!0,text:(f=60,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Report Message"])),submodule:{name:"FlagConversation",options:{class_name:"blockInput",object_flagged:"conversation",show_confirmation_on_change:!0,users:j,conversation:i}}}})])),a.autoesc),h+="\n\n        ",h+=d.suppressValue((f=74,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"closeChatButton",options:{text:(f=77,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Close"])),cancelButton:!0,show_text:!1,borderless:!0,has_icon:!0,class_name:"conversationClose"}})])),a.autoesc),h+='\n    </div>\n</div>\n\n<div class="messagesContainer">\n    <div class="dropTarget">\n        <p>',h+=d.suppressValue((f=90,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Drag here to send"])),a.autoesc),h+='</p>\n    </div>\n\n    <ul class="conversationMessagesList">\n        <div class="spinner"></div>\n        ',h+='\n        <div class="messagesContent">\n            ',h+=d.suppressValue((f=99,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationMessages",d.makeKeywordArgs({id:"messages",options:{is_group:n>1,emails:l},async:!0,resource:(f=106,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["ConversationMessagesResource",d.makeKeywordArgs({options:{conversation_id:(f=108,g=54,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["id"])),page_size:(f=109,g=48,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["page_size",12]))}})]))})])),a.autoesc),h+="\n\n            ",m>0&&(h+='\n                <p class="emailSentText">\n                    ',h+=d.suppressValue((f=116,g=22,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Message sent!"])),a.autoesc),h+="<br>\n                    ",h+=d.suppressValue((f=117,g=22,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["To message you back, your friend will need to sign up for Pinterest"])),a.autoesc),h+="\n                </p>\n            "),h+='\n        </div>\n    </ul>\n</div>\n\n<div class="inputWrapper">\n    ',h+="\n    ";var v;v=32,c.set("max_input_height",v),c.parent||(b.setVariable("max_input_height",v),b.addExport("max_input_height")),h+="\n\n    ",h+=d.suppressValue((f=128,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"textField",options:{autofocus:!0,autogrow:!0,prevent_default_on_enter:!0,maxheight:v}})])),a.autoesc),h+=" \n</div>\n",e(null,h)}catch(w){e(d.handleError(w,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationsList/ConversationsList.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=[],c.set("list_items",i),c.parent||(b.setVariable("list_items",i),b.addExport("list_items")),h+="\n";var j;if(f=15,g=36,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["list_item_options",{}]),c.set("list_item_options",j),c.parent||(b.setVariable("list_item_options",j),b.addExport("list_item_options")),h+="\n\n",a.getFilter("length").call(b,d.contextOrFrameLookup(b,c,"data"))){h+="\n    ",c=c.push();var k=d.contextOrFrameLookup(b,c,"data");if(k)for(var l=0;l<k.length;l++){var m=k[l];c.set("item",m),h+="\n        ";var n;n={module:{name:"ConversationListItem",options:j,data:m}},c.set("list_item",n),c.parent||(b.setVariable("list_item",n),b.addExport("list_item")),h+="\n        ";var o;o=a.getFilter("length").call(b,d.memberLookup(m,"users",a.autoesc)||[]),c.set("users_count",o),c.parent||(b.setVariable("users_count",o),b.addExport("users_count")),h+="\n        ";var p;if(p=a.getFilter("length").call(b,d.memberLookup(m,"emails",a.autoesc)||[]),c.set("emails_count",p),c.parent||(b.setVariable("emails_count",p),b.addExport("emails_count")),h+="\n        ",f=37,g=28,!(d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["exclude_groups"])&&o+p>2)){h+="\n            ";var q;f=38,g=47,q=d.callWrap(d.memberLookup(i,"append",a.autoesc),'list_items["append"]',[n]),c.set("list_items",q),c.parent||(b.setVariable("list_items",q),b.addExport("list_items")),h+="\n        "}h+="\n    "}c=c.pop(),h+="\n\n    ",h+=d.suppressValue((f=42,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["List",d.makeKeywordArgs({id:"list",options:{items:i}})])),a.autoesc),h+="\n"}else h+="\n    ",h+=d.suppressValue((f=18,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["isEmptyState"])),a.autoesc),h+="\n    ",h+=d.suppressValue((f=19,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["EmptyConversations",d.makeKeywordArgs({resource:(f=20,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["UserFriendSuggestionsResource",d.makeKeywordArgs({options:{min_public_pins:10}})]))})])),a.autoesc),h+="\n";h+="\n",e(null,h)}catch(r){e(d.handleError(r,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ConversationsListDropdown/ConversationsListDropdown.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=9,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["withinSegmentedController"])),a.autoesc),h+='\n\n<div class="convosContent">\n    ',h+=d.suppressValue((f=12,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationsList",d.makeKeywordArgs({id:"conversationList",options:{list_item_options:{conversation_head_size:"medium",open_conversation_on_click:!0,hideable:!0,differentiate_unread_state:!0,include_timestamp:!0}},data:d.contextOrFrameLookup(b,c,"data"),resource:d.contextOrFrameLookup(b,c,"resource")})])),a.autoesc),h+="\n</div>\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Counter/Counter.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=11,g=35,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["max"])-(f=11,g=56,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["count",0])),c.set("count_to_display",i),c.parent||(b.setVariable("count_to_display",i),b.addExport("count_to_display")),h+="\n\n",h+=d.suppressValue((f=13,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",["span"])),a.autoesc),h+="\n",i<0&&(h+="\n    ",h+=d.suppressValue((f=15,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["error"])),a.autoesc),h+="\n"),h+="\n",h+=d.suppressValue(i,a.autoesc),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/CreateConversationGroup/CreateConversationGroup.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='\n\n<div class="conversationGroupHeader">\n    <p class="title">',h+=d.suppressValue((f=10,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["New message"])),a.autoesc),h+='</p>\n</div>\n\n<div class="conversationGroupTokenizedWrapper">\n\n    ',h+=d.suppressValue((f=15,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"textField",options:{autofocus:!1,autogrow:!0,placeholder:(f=20,g=28,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add a message"])),prevent_default_on_enter:!0}})])),a.autoesc),h+='\n\n    <div class="tokenized">\n        <div class="placeholder">',h+=d.suppressValue((f=26,g=35,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["To:"])),a.autoesc),h+="</div>\n        ",h+=d.suppressValue((f=27,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TypeaheadField",d.makeKeywordArgs({id:"searchField",options:{class_name:"createConversationGroup",enable_recent_queries:!1,name:"q",count:10,template:"user_circle_avatar",prefetch_on_focus:!0,placeholder:"",bypass_maxheight:!0,populate_on_result_highlight:!1,preserve_typeahead:!0,prevent_default_on_enter:!0,set_input_value_on_selection:!1,use_tab_index:!1,search_delay:0,show_caret:!1,should_geocode:!1,spinner:{enable:!1},tags:"pinners_and_email_contacts",minimum_term_character_length:1,type:"tokenized"}})])),a.autoesc),h+="\n    </div>\n\n    ",h+=d.suppressValue((f=56,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationsList",d.makeKeywordArgs({id:"convosList",options:{exclude_groups:!0,no_rerender:!0,list_item_options:{show_is_pinner:!0,show_selected_state:!0}},resource:(f=66,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["ConversationsResource",{}]))})])),a.autoesc),h+='\n</div>\n\n<div class="formFooter">\n    <div class="formFooterButtons">\n        ',h+=d.suppressValue((f=73,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"cancelButton",options:{text:(f=76,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Cancel"])),cancelButton:!0}})])),a.autoesc),h+="\n\n        ",h+=d.suppressValue((f=81,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"sendToGroupButton",options:{text:(f=84,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Send"])),disabled:!0,color:"primary"}})])),a.autoesc),h+="\n    </div>\n</div>\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Dropdown/Dropdown.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=25,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["PositionModule"])),a.autoesc),h+="\n\n",h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/DropdownButton/DropdownButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=14,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/LikeButton/LikeButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=10,g=18,i=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Like"]),c.set("like_text",i),c.parent||(b.setVariable("like_text",i),b.addExport("like_text")),h+="\n";var j;f=11,g=20,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Unlike"]),c.set("unlike_text",j),c.parent||(b.setVariable("unlike_text",j),b.addExport("unlike_text")),h+="\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"liked",a.autoesc)?j:i,c.set("button_text",k),c.parent||(b.setVariable("button_text",k),b.addExport("button_text")),h+="\n\n",h+=d.suppressValue((f=14,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),h+="\n",h+=d.suppressValue((f=15,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[d.makeKeywordArgs({text:k,has_icon:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"has_icon",a.autoesc)})])),a.autoesc),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"liked",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=18,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["unlike"])),a.autoesc),h+="\n"),h+="\n\n",h+=d.suppressValue((f=21,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-text-like":i,"data-text-unlike":j}])),a.autoesc),h+="\n\n",h+=d.suppressValue((f=26,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/List/List.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=11,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",["ul"])),a.autoesc),h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data")||(f=13,g=32,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["items",[]])),c.set("items",i),c.parent||(b.setVariable("items",i),b.addExport("items")),h+="\n";var j;f=14,g=39,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["list_item_class_name",""]),c.set("list_item_class_name",j),c.parent||(b.setVariable("list_item_class_name",j),b.addExport("list_item_class_name")),h+="\n\n",c=c.push();var k=i;if(k)for(var l=0;l<k.length;l++){var m=k[l];c.set("item",m),c.set("loop.index0",l),h+="\n    ";var n;n=d.memberLookup(m,"type",a.autoesc),c.set("type",n),c.parent||(b.setVariable("type",n),b.addExport("type")),h+="\n\n    <li data-index='",h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"index0",a.autoesc),a.autoesc),h+="' class=\"",h+=d.suppressValue(j,a.autoesc),h+='">\n        ';var o;if(o=a.getFilter("dict_copy").call(b,(f=20,g=39,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["item_options",{}]))),c.set("item_options",o),c.parent||(b.setVariable("item_options",o),b.addExport("item_options")),h+="\n\n        ","comment"==n)h+="\n            ",h+=d.suppressValue((f=23,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["PinComment",d.makeKeywordArgs({data:m,options:o})])),a.autoesc),h+="\n        ";else if("user"==n)h+="\n            ",h+=d.suppressValue((f=26,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["User",d.makeKeywordArgs({data:m,resource:(f=28,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["UserResource",d.makeKeywordArgs({options:{user_id:(f=30,g=43,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"])),field_set_key:"follow_suggestion"}})])),options:o})])),a.autoesc),h+="\n        ";else if("board"==n)h+="\n            ",h+=d.suppressValue((f=35,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Board",d.makeKeywordArgs({data:m,resource:(f=37,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["BoardResource",d.makeKeywordArgs({options:{board_id:(f=39,g=44,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"]))}})])),options:o})])),a.autoesc),h+="\n        ";else if("question"==n)h+="\n            ",f=43,g=32,d.callWrap(d.memberLookup(o,"get",a.autoesc),'item_options["get"]',["is_domain_question"])?(h+="\n                ",h+=d.suppressValue((f=44,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["DomainQuestion",d.makeKeywordArgs({data:m,resource:(f=46,g=44,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["QuestionResource",d.makeKeywordArgs({options:{question_id:(f=48,g=51,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"])),field_set_key:"list_item"}})])),options:o})])),a.autoesc),h+="\n            "):(h+="\n                ",h+=d.suppressValue((f=53,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Question",d.makeKeywordArgs({data:m,resource:(f=55,g=44,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["QuestionResource",d.makeKeywordArgs({options:{question_id:(f=57,g=51,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"])),field_set_key:"list_item"}})])),options:o})])),a.autoesc),h+="\n            "),h+="\n        ";else if("answer"==n)h+="\n            ",h+=d.suppressValue((f=63,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Answer",d.makeKeywordArgs({data:m,resource:(f=65,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["AnswerResource",d.makeKeywordArgs({options:{answer_id:(f=67,g=45,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"])),field_set_key:"list_item"}})])),options:o})])),a.autoesc),h+="\n        ";else if("reply"==n)h+="\n            ",h+=d.suppressValue((f=72,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Reply",d.makeKeywordArgs({data:m,resource:(f=74,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["ReplyResource",d.makeKeywordArgs({options:{reply_id:(f=76,g=44,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id"])),field_set_key:"list_item"}})])),options:o})])),a.autoesc),h+="\n        ";else{if(h+="\n            ",f=81,g=24,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["module"]))h+="\n                ",h+=d.suppressValue((f=82,g=28,d.callWrap(d.contextOrFrameLookup(b,c,"ProxyModule"),"ProxyModule",[(f=82,g=37,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["module"]))])),a.autoesc),h+="\n            ";else if(f=83,g=26,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["network"]))h+="\n                ",h+=d.suppressValue((f=84,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["UserContact",d.makeKeywordArgs({options:{contact_info:m}})])),a.autoesc),h+="\n            ";else if("email"==(f=89,g=26,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id_type"]))){h+="\n                ";var p;f=90,g=39,p=d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["checked"])||(f=90,g=70,d.callWrap(d.memberLookup(o,"get",a.autoesc),'item_options["get"]',["checkedAll"])),c.set("checked",p),c.parent||(b.setVariable("checked",p),b.addExport("checked")),h+="\n                ";var q;f=91,g=48,q=d.callWrap(d.memberLookup(o,"update",a.autoesc),'item_options["update"]',[{checked:p,email_contact:m}]),c.set("dummy",q),c.parent||(b.setVariable("dummy",q),b.addExport("dummy")),h+="\n                ",h+=d.suppressValue((f=92,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["EmailContact",d.makeKeywordArgs({options:o})])),a.autoesc),h+="\n            "}else if("uid"==(f=95,g=27,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["id_type"]))||"facebook_non_pinner"==(f=95,g=60,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["type"])))h+="\n                ",f=96,g=48,q=d.callWrap(d.memberLookup(o,"update",a.autoesc),'item_options["update"]',[{facebook_contact:m}]),c.set("dummy",q),c.parent||(b.setVariable("dummy",q),b.addExport("dummy")),h+="\n                ",h+=d.suppressValue((f=97,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["FacebookContact",d.makeKeywordArgs({options:o})])),a.autoesc),h+="\n            ";else{if(h+="\n                ",f=101,g=28,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["text"])){h+="\n                    ",f=102,g=32,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["url"])&&(h+='\n                        <a class="',f=103,g=46,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["external"])&&(h+="external "),h+=d.suppressValue((f=103,g=84,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["class_name"])),a.autoesc),h+='"\n                            ',f=104,g=40,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["external"])&&(h+='target="_blank" '),h+='href="',h+=d.suppressValue(d.memberLookup(m,"url",a.autoesc),a.autoesc),h+='"\n                            ',f=105,g=40,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["ga_category"])&&(h+='data-ga="',h+=d.suppressValue(d.memberLookup(m,"ga_category",a.autoesc),a.autoesc),h+='"'),h+="\n                            ",f=106,g=40,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["force_refresh"])&&(h+='data-force-refresh="1"'),h+="\n                            ",f=107,g=40,(d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["log_element_type"])||0==(f=107,g=72,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["log_element_type"])))&&(h+='\n                                data-element-type="',h+=d.suppressValue((f=108,g=60,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["log_element_type"])),a.autoesc),h+='"\n                            '),h+=">\n                    "),h+="\n                        ",f=111,g=36,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["icon_class_name"])&&(h+='\n                            <span class="',h+=d.suppressValue(d.memberLookup(m,"icon_class_name",a.autoesc),a.autoesc),h+='"></span>\n                        '),h+="\n                        ";var r;f=114,g=50,r=d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["class_name"]),c.set("class_name",r),c.parent||(b.setVariable("class_name",r),b.addExport("class_name")),h+="\n                        ",r&&(h+='<span class="',h+=d.suppressValue(r,a.autoesc),h+='">\n                        '),h+="\n                        ",h+=d.suppressValue(d.memberLookup(m,"text",a.autoesc),a.autoesc),h+="\n                        ",r&&(h+="\n                            </span>\n                        "),h+="\n                    ",f=122,g=32,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["url"])&&(h+="\n                        </a>\n                    "),h+="\n                "}else h+="\n                    <hr ",f=126,g=36,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["class_name"])&&(h+='class="',h+=d.suppressValue((f=126,g=67,d.callWrap(d.memberLookup(m,"get",a.autoesc),'item["get"]',["class_name"])),a.autoesc),h+='"'),h+=">\n                ";h+="\n\n            "}h+="\n        "}h+="\n    </li>\n"}c=c.pop(),h+="\n",e(null,h)}catch(s){e(d.handleError(s,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Map/addToMapToast.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"image")||"",c.set("image",i),c.parent||(b.setVariable("image",i),b.addExport("image")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"name")||"",c.set("name",j),c.parent||(b.setVariable("name",j),b.addExport("name")),h+='\n\n<div class="addToMapToast">\n    ',i&&(h+="\n        <div class=\"imageWrapper\">\n            <img class='popupToastPinImage' src='",h+=d.suppressValue(i,a.autoesc),h+="'>\n        </div>\n    "),h+="\n    <h3 class='toastPlaceName'>",h+=d.suppressValue(j,a.autoesc),h+='</h3>\n    <p class="toastAddedToMap">',h+=d.suppressValue((f=10,g=33,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Added to your map!"])),a.autoesc),h+="</p>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Map/marker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"pinImage")||"",c.set("pinImage",i),c.parent||(b.setVariable("pinImage",i),b.addExport("pinImage")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"markerWrapperClassName")||"",c.set("markerWrapperClassName",j),c.parent||(b.setVariable("markerWrapperClassName",j),b.addExport("markerWrapperClassName")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"markerClassName")||"",c.set("markerClassName",k),c.parent||(b.setVariable("markerClassName",k),b.addExport("markerClassName")),h+='\n\n<div class="',h+=d.suppressValue(j,a.autoesc),h+='">\n    <div class="',h+=d.suppressValue(k,a.autoesc),h+='">\n        <div class="imageContainer">\n            ',i&&""!=i&&(h+='\n                <img src="',h+=d.suppressValue(i,a.autoesc),h+='" alt="">\n            '),h+="\n        </div>\n    </div>\n</div>\n",e(null,h)}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Map/markerCluster.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"markerClusterPinImage")||"",c.set("markerClusterPinImage",i),c.parent||(b.setVariable("markerClusterPinImage",i),b.addExport("markerClusterPinImage")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"clusterChildCount")||"",c.set("clusterChildCount",j),c.parent||(b.setVariable("clusterChildCount",j),b.addExport("clusterChildCount")),h+='\n\n<div class="markerCluster">\n    <div class="imageContainerClustered">\n        <img src="',h+=d.suppressValue(i,a.autoesc),h+='" alt="">\n    </div>\n    <em class="clusterChildCount">\n        ',h+=d.suppressValue(j,a.autoesc),h+="\n    </em>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Map/markerPopup.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";
try{var i;i=d.memberLookup(d.contextOrFrameLookup(b,c,"place"),"region",a.autoesc),c.set("region",i),c.parent||(b.setVariable("region",i),b.addExport("region")),h+="\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"place"),"category",a.autoesc),c.set("category",j),c.parent||(b.setVariable("category",j),b.addExport("category")),h+="\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"place"),"locality",a.autoesc),c.set("locality",k),c.parent||(b.setVariable("locality",k),b.addExport("locality")),h+="\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"place"),"street",a.autoesc),c.set("street",l),c.parent||(b.setVariable("street",l),b.addExport("street")),h+="\n";var m;m=d.memberLookup(d.contextOrFrameLookup(b,c,"place"),"phone",a.autoesc),c.set("phone",m),c.parent||(b.setVariable("phone",m),b.addExport("phone")),h+="\n";var n;n=d.contextOrFrameLookup(b,c,"place")||{},c.set("place",n),c.parent||(b.setVariable("place",n),b.addExport("place")),h+="\n";var o;o=d.memberLookup(n,"url",a.autoesc)||d.memberLookup(n,"source_url",a.autoesc),c.set("url",o),c.parent||(b.setVariable("url",o),b.addExport("url")),h+="\n";var p;p=d.contextOrFrameLookup(b,c,"name")||"",c.set("name",p),c.parent||(b.setVariable("name",p),b.addExport("name")),h+="\n\n";var q;q=!l&&(k||i),c.set("show_just_locality",q),c.parent||(b.setVariable("show_just_locality",q),b.addExport("show_just_locality")),h+='\n\n<div class="popupContentWrapper" itemscope itemtype="http://schema.org/Place">\n    <h3 class="placeName" itemprop="name">\n        ',h+=d.suppressValue(p,a.autoesc),h+="\n    </h3>\n    ",(j||q)&&(h+='\n        <p class="categoryLocation">\n            ',j&&(h+="\n                <strong>",h+=d.suppressValue(j,a.autoesc),h+="</strong>\n            "),h+="\n            ",q&&(h+='\n                <span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n                    ',j&&(h+=d.suppressValue((f=22,g=35,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["in"])),a.autoesc)),h+="\n                    ",k&&(h+='<span itemprop="addressLocality">',h+=d.suppressValue(k,a.autoesc),h+="</span>"),i&&(k&&(h+=", "),h+='<span itemprop="addressRegion">',h+=d.suppressValue(i,a.autoesc),h+="</span>"),h+="\n                </span>\n            "),h+="\n        </p>\n    "),h+="\n    ",l&&(h+='\n        <h4 class="heading">',h+=d.suppressValue((f=35,g=30,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Address"])),a.autoesc),h+='</h4>\n        <p class="address" itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n            ',l&&(h+='<span itemprop="streetAddress">',h+=d.suppressValue(l,a.autoesc),h+="</span><br>"),h+='\n                <span itemprop="addressLocality">',h+=d.suppressValue(k,a.autoesc),h+="</span>",i&&(h+=', <span itemprop="addressRegion">',h+=d.suppressValue(i,a.autoesc),h+="</span>"),h+="\n        </p>\n    "),h+="\n    ",m&&(h+='\n        <h4 class="heading">',h+=d.suppressValue((f=47,g=30,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Contact Information"])),a.autoesc),h+='</h4>\n        <p class="address" itemprop="telephone">\n            ',h+=d.suppressValue(m,a.autoesc),h+="\n        </p>\n    "),h+="\n\n    ",o&&(h+='\n        <div class="sourceLinkWrapper">\n            <a href="',h+=d.suppressValue(o,a.autoesc),h+='" target="_blank" class="Button btn rounded sourceLink" rel="nofollow">',h+=d.suppressValue((f=55,g=99,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Learn More"])),a.autoesc),h+="</a>\n        </div>\n    "),h+="\n</div>\n",e(null,h)}catch(r){e(d.handleError(r,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/NavigateButton/NavigateButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"force_refresh",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=8,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-force-refresh":1}])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"nofollow",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=11,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({rel:"nofollow"})])),a.autoesc)),h+="\n\n",h+=d.suppressValue((f=14,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/PinLikeButton/PinLikeButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",h+=d.suppressValue((f=7,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["LikeButton"])),a.autoesc),h+="\n\n",h+=d.suppressValue((f=9,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-element-type":d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"PIN_LIKE_BUTTON",a.autoesc)}])),a.autoesc),h+="\n\n",h+=d.suppressValue((f=13,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["LikeButton"])),a.autoesc),a.getTemplate("app/common/modules/LikeButton/LikeButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/QALikeButton/QALikeButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",h+=d.suppressValue((f=7,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[{borderless:!0,has_icon:!0,show_text:!1}])),a.autoesc),h+=d.suppressValue((f=7,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["LikeButton"])),a.autoesc),a.getTemplate("app/common/modules/LikeButton/LikeButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/QuestionLikeButton/QuestionLikeButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",h+=d.suppressValue((f=7,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["QALikeButton"])),a.autoesc),a.getTemplate("app/common/modules/QALikeButton/QALikeButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ShowModalButton/ShowModalButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+=d.suppressValue((f=0,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/Token/Token.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/TokenizedInput/TokenizedInput.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"input_options",a.autoesc),d.contextOrFrameLookup(b,c,"none")),c.set("input_options",i),c.parent||(b.setVariable("input_options",i),b.addExport("input_options")),h+="\n";var j;f=15,g=28,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type"]),c.set("view_type",j),c.parent||(b.setVariable("view_type",j),b.addExport("view_type")),h+="\n";var k;f=16,g=34,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_remove_all"]),c.set("show_remove_all",k),c.parent||(b.setVariable("show_remove_all",k),b.addExport("show_remove_all")),h+="\n",j&&(h+="\n    ",h+=d.suppressValue((f=18,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[j])),a.autoesc),h+="\n"),h+='\n\n<ul class="tokensWrapper">\n    <li class="tokenizedItem inputToken">\n        ',h+=d.suppressValue((f=23,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Input",d.makeKeywordArgs({id:"input",options:i})])),a.autoesc),h+="\n    </li>\n</ul>\n\n",k&&(h+='\n    <a class="removeAll"><em></em></a>\n'),h+="\n",e(null,h)}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Checkbox/Checkbox.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"id",a.autoesc),c.set("id",i),c.parent||(b.setVariable("id",i),b.addExport("id")),h+="\n";var j;j=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc),""),c.set("name",j),c.parent||(b.setVariable("name",j),b.addExport("name"));var k;k=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"value",a.autoesc),""),c.set("value",k),c.parent||(b.setVariable("value",k),b.addExport("value"));var l;l=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"checked",a.autoesc),!1),c.set("checked",l),c.parent||(b.setVariable("checked",l),b.addExport("checked"));var m;m=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc),!1),c.set("disabled",m),c.parent||(b.setVariable("disabled",m),b.addExport("disabled"));var n;n=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),""),c.set("view_type",n),c.parent||(b.setVariable("view_type",n),b.addExport("view_type"));var o;if(o=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"class_name",a.autoesc),c.set("class_name",o),c.parent||(b.setVariable("class_name",o),b.addExport("class_name")),o&&(h+="\n    ",h+=d.suppressValue((f=25,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[o])),a.autoesc),h+="\n"),h+="\n\n",("fancyToggle"==n||"fancyCheckbox"==n)&&(h+="\n    ",n&&(h+="\n        ",h+=d.suppressValue((f=30,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[n])),a.autoesc),h+="\n    "),h+="\n\n    ",l&&(h+=d.suppressValue((f=34,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["on"])),a.autoesc),h+="\n    "),m&&(h+=d.suppressValue((f=38,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["disabled"])),a.autoesc),h+="\n    ")),h+="\n\n","fancyToggle"==n){var p;p=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"on_text",a.autoesc),(f=43,g=44,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Yes"]))),c.set("on_text",p),c.parent||(b.setVariable("on_text",p),b.addExport("on_text"));var q;q=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"off_text",a.autoesc),(f=44,g=46,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["No"]))),c.set("off_text",q),c.parent||(b.setVariable("off_text",q),b.addExport("off_text")),h+='<div class="slider"></div>\n    <p class="onText status">',h+=d.suppressValue(p,a.autoesc),h+='</p>\n    <p class="offText status">',h+=d.suppressValue(q,a.autoesc),h+="</p>\n    ",h+=d.suppressValue((f=49,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{checked:l,disabled:m,name:j,value:k}})])),a.autoesc),h+="\n"}else"fancyCheckbox"==n?(h+='\n    <span class="visibleCheck"></span\n    >',h+=d.suppressValue((f=56,g=12,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{checked:l,disabled:m,name:j,value:k,id:i}})])),a.autoesc),h+="\n"):(h+=d.suppressValue((f=63,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",["input"])),a.autoesc),h+="\n    ",h+=d.suppressValue((f=64,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({type:"checkbox"})])),a.autoesc),h+="\n    ",i&&(h+=d.suppressValue((f=66,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({id:i})])),a.autoesc),h+="\n    "),j&&(h+=d.suppressValue((f=69,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({name:j})])),a.autoesc),h+="\n    "),k&&(h+=d.suppressValue((f=72,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({value:k})])),a.autoesc),h+="\n    "),l&&(h+=d.suppressValue((f=75,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({checked:"checked"})])),a.autoesc),h+="\n    "),m&&(h+=d.suppressValue((f=78,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[d.makeKeywordArgs({disabled:"disabled"})])),a.autoesc),h+="\n    "));e(null,h)}catch(r){e(d.handleError(r,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Field/Field.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",b.getBlock("content")(a,b,c,d,function(a,b){return a?void e(a):(h+=b,h+="\n",void e(null,h))})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ";var i;if(f=10,g=38,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["currency_symbol"]),c.set("currency_symbol",i),c.parent||(b.setVariable("currency_symbol",i),b.addExport("currency_symbol")),h+="\n    ",i){h+="\n        ",h+="\n        ";var j;f=13,g=40,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"update",a.autoesc),'options["update"]',[{class_name:"withCurrencySymbol"}]),c.set("throw_away",j),c.parent||(b.setVariable("throw_away",j),b.addExport("throw_away")),h+="\n    "}h+="\n    ";var k;f=15,g=30,k=d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Input",d.makeKeywordArgs({id:"input",options:d.contextOrFrameLookup(b,c,"options")})]),c.set("input_module",k),c.parent||(b.setVariable("input_module",k),b.addExport("input_module")),h+="\n\n    ",i?(h+="\n        ",h+=d.suppressValue((f=20,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["withCurrencySymbol"])),a.autoesc),h+='\n        <span class="currencySymbol">\n            ',h+=d.suppressValue(i,a.autoesc),h+='\n        </span>\n\n        <span class="inputWrapper">\n            ',h+=d.suppressValue(k,a.autoesc),h+="\n        </span>\n    "):(h+="\n        ",h+=d.suppressValue(k,a.autoesc),h+="\n    "),h+="\n",e(null,h)}catch(l){e(d.handleError(l,f,g))}}return{b_content:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Input/Input.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=16,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"tag_name"),"tag_name",[a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"element_type",a.autoesc),"input")])),a.autoesc),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"type",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=19,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{type:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"type",a.autoesc)}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"id",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=22,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{id:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"id",a.autoesc)}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=25,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{name:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc)}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=28,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{disabled:""}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"class_name",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=31,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"class_name",a.autoesc)])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autofocus",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=34,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{autofocus:""}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"placeholder",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=37,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{placeholder:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"placeholder",a.autoesc)}])),a.autoesc),h+="\n"),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"value",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=40,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{value:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"value",a.autoesc)}])),a.autoesc)),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autocomplete",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=43,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{autocomplete:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autocomplete",a.autoesc)}])),a.autoesc)),(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc)||0==d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc))&&(h+=d.suppressValue((f=46,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-element-type":d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"log_element_type",a.autoesc)}])),a.autoesc)),e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/InterestsTypeaheadField/InterestsTypeaheadField.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=2,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.TypeaheadField"])),a.autoesc),a.getTemplate("app/common/modules/ui/TypeaheadField/TypeaheadField.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n\n",h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ",h+=d.suppressValue((f=5,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"createInterestButton",options:{class_name:"createInterest",color:"primary",text:(f=10,g=21,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",['Create "New Interest"']))}})])),a.autoesc),h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{b_buttons:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Label/Label.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"name",a.autoesc),a.autoesc),h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/MetricPoint/MetricPoint.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=13,g=23,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["date"]),c.set("date",i),c.parent||(b.setVariable("date",i),b.addExport("date")),h+="\n";var j;f=14,g=32,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["metric_values"]),c.set("metric_values",j),c.parent||(b.setVariable("metric_values",j),b.addExport("metric_values")),h+='\n\n<table>\n    <tr class="dateContainer">\n        <td class="date" colspan="2">',h+=d.suppressValue(i,a.autoesc),h+="</td>\n    </tr>\n    ",c=c.push();var k=j;if(k)for(var l=0;l<k.length;l++){var m=k[l];c.set("metric_value",m),h+='\n        <tr class="valueContainer">\n            <td class="value" style="',h+=d.suppressValue("color:"+(f=22,g=65,d.callWrap(d.memberLookup(m,"get",a.autoesc),'metric_value["get"]',["value_color"])),a.autoesc),h+='">\n                ',h+=d.suppressValue((f=23,g=33,d.callWrap(d.memberLookup(m,"get",a.autoesc),'metric_value["get"]',["value"])),a.autoesc),h+='\n            </td>\n            <td class="metric">',h+=d.suppressValue((f=25,g=48,d.callWrap(d.memberLookup(m,"get",a.autoesc),'metric_value["get"]',["metric"])),a.autoesc),h+="</td>\n        </tr>\n    "}c=c.pop(),h+="\n</table>\n",e(null,h)}catch(n){e(d.handleError(n,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Picker/Picker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=13,g=28,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type","normal"]),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n",h+=d.suppressValue((f=14,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n\n";var j;f=16,g=37,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["create_suggestions"]),c.set("create_suggestions",j),c.parent||(b.setVariable("create_suggestions",j),b.addExport("create_suggestions")),h+="\n\n";var k;f=18,g=31,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["allow_create",!0]),c.set("allow_create",k),c.parent||(b.setVariable("allow_create",k),b.addExport("allow_create")),h+="\n\n";var l;if(f=20,g=35,l=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_top_section",!0]),c.set("show_top_section",l),c.parent||(b.setVariable("show_top_section",l),b.addExport("show_top_section")),h+="\n",l){h+="\n    ";var m;f=22,g=45,m=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["input_placeholder_text",(f=22,g=73,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Type a name"]))]),c.set("input_placeholder_text",m),c.parent||(b.setVariable("input_placeholder_text",m),b.addExport("input_placeholder_text")),h+='\n    <div class="top">\n        ',k&&(h+="\n            ",h+=d.suppressValue((f=25,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"createButton",options:{class_name:"createButton",text:(f=29,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create"]))}})])),a.autoesc),h+="\n        "),h+='\n        <div class="nameWrapper',k||(h+=" withoutCreate"),h+='">\n            ',h+="\n            ",h+=d.suppressValue((f=38,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Input",d.makeKeywordArgs({id:"name",options:{name:"name",class_name:"name",placeholder:m,autocomplete:"off"}})])),a.autoesc),h+="\n        </div>\n    </div>\n"}h+="\n\n",h+="\n\n";var n;n=[],c.set("select_list_data",n),c.parent||(b.setVariable("select_list_data",n),b.addExport("select_list_data")),h+="\n",c=c.push();var o=d.contextOrFrameLookup(b,c,"data");if(o)for(var p=0;p<o.length;p++){var q=o[p];c.set("section",q),h+="\n    ",h+="\n    ";var r;f=56,g=45,r=d.callWrap(d.memberLookup(n,"append",a.autoesc),'select_list_data["append"]',[q]),c.set("throw_away",r),c.parent||(b.setVariable("throw_away",r),b.addExport("throw_away")),h+="\n"}if(c=c.pop(),h+="\n\n",j){h+="\n    ";var s;s=[],c.set("create_items",s),c.parent||(b.setVariable("create_items",s),b.addExport("create_items")),h+="\n    ",c=c.push();var t=j;if(t)for(var u=0;u<t.length;u++){var v=t[u];c.set("create_suggestion",v),h+="\n        ",h+="\n        ";var w;f=63,g=45,w=d.callWrap(d.memberLookup(s,"append",a.autoesc),'create_items["append"]',[{type:"module",name:"ui.PickerItemCreate",data:{name:v,is_create_suggestion:!0}}]),c.set("throw_away",w),c.parent||(b.setVariable("throw_away",w),b.addExport("throw_away")),h+="\n    "}c=c.pop(),h+="\n\n    ";var x;x={name:(f=74,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Feeling stuck? Try one of these:"])),items:s},c.set("create_suggestion_section",x),c.parent||(b.setVariable("create_suggestion_section",x),b.addExport("create_suggestion_section")),h+="\n    ",h+="\n    ";var y;f=78,g=45,y=d.callWrap(d.memberLookup(n,"append",a.autoesc),'select_list_data["append"]',[x]),c.set("throw_away",y),c.parent||(b.setVariable("throw_away",y),b.addExport("throw_away")),h+="\n"}h+="\n\n";var z;z={view_type:i,selected_section_index:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"selected_section_index",a.autoesc),selected_item_index:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"selected_item_index",a.autoesc)},c.set("select_list_options",z),c.parent||(b.setVariable("select_list_options",z),b.addExport("select_list_options")),h+="\n\n";var A;f=87,g=30,A=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["item_module"]),c.set("item_module",A),c.parent||(b.setVariable("item_module",A),b.addExport("item_module")),h+="\n",A&&(h+="\n    ",h+="\n    ",f=90,g=48,y=d.callWrap(d.memberLookup(z,"update",a.autoesc),'select_list_options["update"]',[{item_module:A}]),c.set("throw_away",y),c.parent||(b.setVariable("throw_away",y),b.addExport("throw_away")),h+="\n"),h+="\n\n",h+=d.suppressValue((f=93,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.SelectList",d.makeKeywordArgs({id:"list",options:z,data:n})])),a.autoesc),h+="\n\n",e(null,h)}catch(B){e(d.handleError(B,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/PickerItemCreate/PickerItemCreate.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=7,g=28,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type","normal"]),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n",h+=d.suppressValue((f=8,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+='\n\n<span class="icon"></span>\n\n';var j;f=12,g=36,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["create_item_label",(f=12,g=59,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create"]))]),c.set("create_item_label",j),c.parent||(b.setVariable("create_item_label",j),b.addExport("create_item_label")),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"is_create",a.autoesc)&&!d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"name",a.autoesc)?(h+='\n    <span class="createLabel">',h+=d.suppressValue(j,a.autoesc),h+=':</span>\n    <span class="createName"></span>\n'):(h+="\n    ",h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"name",a.autoesc),a.autoesc),h+="\n"),h+="\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/SelectButton/SelectButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=15,g=29,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name","inContextDropdownButton"]),c.set("class_name",i),c.parent||(b.setVariable("class_name",i),b.addExport("class_name")),h+="\n\n",h+=d.suppressValue((f=17,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["DropdownButton",d.makeKeywordArgs({id:"button",options:{text:(f=20,g=27,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["text"])),class_name:i,has_icon:!0,icon_on_right:!0,module:{name:"ui.RadioGroup",options:{name:(f=27,g=35,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["name"])),items:(f=28,g=36,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["items",[]]))}},dropdown_options:(f=31,g=39,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["dropdown_options",{}]))}})])),a.autoesc),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/SelectList/SelectList.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=15,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{tabindex:"0"}])),a.autoesc),h+="\n\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),"normal"),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n",h+=d.suppressValue((f=18,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n\n";var j;f=20,g=41,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["selected_section_index"]),c.set("selected_section_index",j),c.parent||(b.setVariable("selected_section_index",j),b.addExport("selected_section_index")),h+="\n";var k;f=21,g=38,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["selected_item_index"]),c.set("selected_item_index",k),c.parent||(b.setVariable("selected_item_index",k),b.addExport("selected_item_index")),h+="\n\n",h+="\n";var l;f=24,g=30,l=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["item_module",{name:"ui.Label"}]),c.set("item_module",l),c.parent||(b.setVariable("item_module",l),b.addExport("item_module")),h+="\n";var m;f=25,g=41,m=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["section_heading_module",{name:"ui.Label"}]),c.set("section_heading_module",m),c.parent||(b.setVariable("section_heading_module",m),b.addExport("section_heading_module")),h+="\n\n";var n;n=d.contextOrFrameLookup(b,c,"data"),c.set("sections",n),c.parent||(b.setVariable("sections",n),b.addExport("sections")),h+='\n\n<div class="items">\n    <ul>\n        ',c=c.push();var o=n;if(o)for(var p=0;p<o.length;p++){var q=o[p];c.set("section",q),c.set("loop.index0",p),h+="\n            ";var r;r=d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"index0",a.autoesc),c.set("section_index",r),c.parent||(b.setVariable("section_index",r),b.addExport("section_index")),h+="\n            ",d.memberLookup(q,"name",a.autoesc)&&(h+='\n                <li class="sectionHeading">\n                    ',h+=d.suppressValue((f=35,g=27,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",[d.memberLookup(m,"name",a.autoesc),d.makeKeywordArgs({options:d.memberLookup(m,"options",a.autoesc),data:q})])),a.autoesc),h+="\n                </li>\n            "),h+="\n            ",c=c.push();var s=d.memberLookup(q,"items",a.autoesc);if(s)for(var t=0;t<s.length;t++){var u=s[t];c.set("item",u),c.set("loop.index0",t),h+="\n                ";var v;v=d.memberLookup(d.contextOrFrameLookup(b,c,"loop"),"index0",a.autoesc),c.set("item_index",v),c.parent||(b.setVariable("item_index",v),b.addExport("item_index")),h+="\n                ";var w;w=r==j&&v==k,c.set("is_selected",w),c.parent||(b.setVariable("is_selected",w),b.addExport("is_selected")),h+='\n                <li class="item ',w&&(h+="selected"),h+='">\n                    ',"module"==d.memberLookup(u,"type",a.autoesc)?(h+="\n                        ",h+=d.suppressValue((f=46,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"ProxyModule"),"ProxyModule",[u])),a.autoesc),h+="\n                    "):(h+="\n                        ",h+=d.suppressValue((f=48,g=31,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",[d.memberLookup(l,"name",a.autoesc),d.makeKeywordArgs({options:d.memberLookup(l,"options",a.autoesc),data:u})])),a.autoesc),h+="\n                    "),h+="\n                </li>\n            "
}c=c.pop(),h+="\n        "}c=c.pop(),h+="\n    </ul>\n</div>\n",e(null,h)}catch(x){e(d.handleError(x,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/TableLookalikePicker/TableLookalikePicker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=14,g=29,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]),c.set("class_name",i),c.parent||(b.setVariable("class_name",i),b.addExport("class_name")),h+="\n";var j;f=15,g=35,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_top_section",!0]),c.set("show_top_section",j),c.parent||(b.setVariable("show_top_section",j),b.addExport("show_top_section")),h+="\n";var k;f=16,g=41,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["input_placeholder_text",(f=16,g=69,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Search"]))]),c.set("input_placeholder_text",k),c.parent||(b.setVariable("input_placeholder_text",k),b.addExport("input_placeholder_text")),h+="\n";var l;f=17,g=31,l=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["allow_create",!1]),c.set("allow_create",l),c.parent||(b.setVariable("allow_create",l),b.addExport("allow_create")),h+="\n";var m;f=18,g=26,m=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["columns"]),c.set("columns",m),c.parent||(b.setVariable("columns",m),b.addExport("columns")),h+="\n";var n;f=19,g=29,n=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["filter_key"]),c.set("filter_key",n),c.parent||(b.setVariable("filter_key",n),b.addExport("filter_key")),h+="\n\n",i&&(h+="\n    ",h+=d.suppressValue((f=22,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n"),h+="\n\n";var o;o={show_top_section:j,input_placeholder_text:k,allow_create:l,item_module:{name:"ui.TableLookalikePickerRow",options:{columns:m}}},c.set("base_options",o),c.parent||(b.setVariable("base_options",o),b.addExport("base_options")),h+="\n\n";var p;p={name:d.contextOrFrameLookup(b,c,"none"),items:d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"rows",a.autoesc)},c.set("section",p),c.parent||(b.setVariable("section",p),b.addExport("section")),h+="\n\n",h+="\n";var q;q=[p],c.set("data",q),c.parent||(b.setVariable("data",q),b.addExport("data")),h+="\n\n",h+=d.suppressValue((f=45,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[o])),a.autoesc),h+=d.suppressValue((f=45,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.Picker"])),a.autoesc),a.getTemplate("app/common/modules/ui/Picker/Picker.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(r){e(d.handleError(r,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/TableLookalikePickerRow/TableLookalikePickerRow.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=8,g=26,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["columns"]),c.set("columns",i),c.parent||(b.setVariable("columns",i),b.addExport("columns")),h+="\n\n",c=c.push();var j=i;if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("column",l),h+="\n    ";var m;f=11,g=32,m=d.callWrap(d.memberLookup(l,"get",a.autoesc),'column["get"]',["key"]),c.set("column_key",m),c.parent||(b.setVariable("column_key",m),b.addExport("column_key")),h+="\n    ";var n;f=12,g=39,n=d.callWrap(d.memberLookup(l,"get",a.autoesc),'column["get"]',["class_name"]),c.set("column_class_name",n),c.parent||(b.setVariable("column_class_name",n),b.addExport("column_class_name")),h+='\n    <div class="cell',n&&(h+=" ",h+=d.suppressValue(n,a.autoesc)),h+='">\n        <span>\n            ',f=15,g=26,d.callWrap(d.memberLookup(l,"get",a.autoesc),'column["get"]',["static_value"])?(h+="\n                ",h+=d.suppressValue((f=16,g=27,d.callWrap(d.memberLookup(l,"get",a.autoesc),'column["get"]',["static_value"])),a.autoesc),h+="\n            "):(h+="\n                ",h+=d.suppressValue((f=18,g=25,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',[m])),a.autoesc),h+="\n            "),h+="\n        </span>\n    </div>\n"}c=c.pop(),h+="\n",e(null,h)}catch(o){e(d.handleError(o,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/TextField/TextField.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=13,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.Field"])),a.autoesc),a.getTemplate("app/common/modules/ui/Field/Field.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n\n",h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ";var i=d.makeMacro(["disabled","autogrow"],[],function(e,f,g){c=c.push(),g=g||{},c.set("disabled",e),c.set("autogrow",f);var h="";return d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc)&&(h+="disabled "),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autogrow",a.autoesc)&&(h+="autogrow"),h+="\n    ",c=c.pop(),new d.SafeString(h)});b.addExport("classnames"),b.setVariable("classnames",i),h+="\n    <textarea",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"id",a.autoesc)&&(h+=' id="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"id",a.autoesc),a.autoesc),h+='"'),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc)&&(h+=' name="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc),a.autoesc),h+='"'),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autofocus",a.autoesc)&&(h+=' autofocus="autofocus"'),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"rows",a.autoesc)&&(h+=' rows="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"rows",a.autoesc),a.autoesc),h+='"'),h+='\n        class="content ',h+=d.suppressValue((f=24,g=33,d.callWrap(i,"classnames",[d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc),d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"autogrow",a.autoesc)])),a.autoesc),h+='"\n        placeholder="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"placeholder",a.autoesc),a.autoesc),h+='"\n    >',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"value",a.autoesc),a.autoesc),h+="</textarea>\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{b_content:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/Typeahead.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",f=10,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type"])&&(h+="\n    ",h+=d.suppressValue((f=11,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[(f=11,g=25,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type"]))])),a.autoesc),h+="\n"),h+="\n\n",f=14,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"])&&(h+="\n    ",h+=d.suppressValue((f=15,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[(f=15,g=25,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]))])),a.autoesc),h+="\n"),h+="\n\n";var i;i="expanded"==(f=18,g=37,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type"])),c.set("show_new_typeahead",i),c.parent||(b.setVariable("show_new_typeahead",i),b.addExport("show_new_typeahead")),h+="\n",i?(h+="\n    ",h+=d.suppressValue((f=20,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"cancelButton",options:{cancelButton:!0,text:(f=24,g=21,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["&times;"])),show_text:!0,borderless:!0}})])),a.autoesc),h+='\n\n    <div class="recentQueriesHeader">\n        <span class="title">',h+=d.suppressValue((f=31,g=30,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Recent Searches"])),a.autoesc),h+='</span>\n        <hr>\n    </div>\n\n    <ul class="results" data-component-type="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"ComponentType"),"TYPEAHEAD_SUGGESTIONS",a.autoesc),a.autoesc),h+='">\n        <ul class="leftColumn"></ul>\n        <ul class="midColumn"></ul>\n        <ul class="rightColumn"></ul>\n    </ul>\n'):(h+='\n    <ul class="results" data-component-type="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"ComponentType"),"TYPEAHEAD_SUGGESTIONS",a.autoesc),a.autoesc),h+='"></ul>\n'),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/add_pin_to_map.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i="typeaheadResultEmphasized",c.set("emphasized_classname",i),c.parent||(b.setVariable("emphasized_classname",i),b.addExport("emphasized_classname")),h+="\n";var j;j="typeaheadResultMetaData",c.set("meta_classname",j),c.parent||(b.setVariable("meta_classname",j),b.addExport("meta_classname")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",k),c.parent||(b.setVariable("label",k),b.addExport("label")),h+='\n\n<a>\n    <div class="addToMap">\n        <p class="Button btn rounded addToMap">\n            ',h+=d.suppressValue((f=7,g=14,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Map it"])),a.autoesc),h+='\n        </p>\n    </div>\n    <h4 class="',h+=d.suppressValue(i,a.autoesc),h+='">\n        ',h+=d.suppressValue(k,a.autoesc),h+="\n    </h4>\n\n    ",h+="\n    ",a.getTemplate("app/desktop/modules/AddPinToMap/pinFormMetadata.nunjucks",function(a,d){return a?void e(a):void d.render(b.getVariables(),c.push(),function(a,b){return a?void e(a):(h+=b,h+="\n</a>\n",void e(null,h))})})}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/default_item.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"title")||"",c.set("title",i),c.parent||(b.setVariable("title",i),b.addExport("title")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"class_name")||"",c.set("class_name",j),c.parent||(b.setVariable("class_name",j),b.addExport("class_name")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"emptyState")||!1,c.set("emptyState",k),c.parent||(b.setVariable("emptyState",k),b.addExport("emptyState")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"image")||"",c.set("image",l),c.parent||(b.setVariable("image",l),b.addExport("image")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"resultIndex")||"",c.set("resultIndex",m),c.parent||(b.setVariable("resultIndex",m),b.addExport("resultIndex")),h+="\n";var n;n=d.contextOrFrameLookup(b,c,"tag")||"",c.set("tag",n),c.parent||(b.setVariable("tag",n),b.addExport("tag")),h+="\n";var o;o=d.contextOrFrameLookup(b,c,"query")||"",c.set("query",o),c.parent||(b.setVariable("query",o),b.addExport("query")),h+="\n";var p;p=d.contextOrFrameLookup(b,c,"type")||"",c.set("type",p),c.parent||(b.setVariable("type",p),b.addExport("type")),h+="\n";var q;q=d.contextOrFrameLookup(b,c,"enteredQuery")||"",c.set("enteredQuery",q),c.parent||(b.setVariable("enteredQuery",q),b.addExport("enteredQuery")),h+="\n";var r;r=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",r),c.parent||(b.setVariable("label",r),b.addExport("label")),h+="\n\n<a ",j&&(h+='class="',h+=d.suppressValue(j,a.autoesc),h+='"'),h+=">\n    ",l&&(h+='\n        <span class="typeaheadImg">\n            <img src="',h+=d.suppressValue(l,a.autoesc),h+='">\n        </span>\n    '),h+="\n    ","recent_queries"==n&&(h+='\n        <span data-query="',h+=d.suppressValue(o,a.autoesc),h+='" class="remove">',h+=d.suppressValue((f=18,g=52,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Remove"])),a.autoesc),h+="</span>\n    "),h+="\n\n    ";var s;s="pins",c.set("search_mode",s),c.parent||(b.setVariable("search_mode",s),b.addExport("search_mode")),h+="\n    ";var t;t=p,c.set("autocomplete_type",t),c.parent||(b.setVariable("autocomplete_type",t),b.addExport("autocomplete_type")),h+="\n    ","pin_search"==p?(h+="\n        ",t="query",c.set("autocomplete_type",t),c.parent||(b.setVariable("autocomplete_type",t),b.addExport("autocomplete_type")),h+="\n    "):"board_search"==p?(h+="\n        ",s="boards",c.set("search_mode",s),c.parent||(b.setVariable("search_mode",s),b.addExport("search_mode")),h+="\n        ",t="query",c.set("autocomplete_type",t),c.parent||(b.setVariable("autocomplete_type",t),b.addExport("autocomplete_type")),h+="\n    "):"people_search"==p&&(h+="\n        ",s="users",c.set("search_mode",s),c.parent||(b.setVariable("search_mode",s),b.addExport("search_mode")),h+="\n        ",t="query",c.set("autocomplete_type",t),c.parent||(b.setVariable("autocomplete_type",t),b.addExport("autocomplete_type")),h+="\n    "),h+="\n    ",a.getFilter("contains").call(b,["pin_search","board_search","people_search"],p)&&(h+='\n        <span class="typeaheadSearchIcon"><em></em></span>\n        <span class="typeaheadScope">',h+=d.suppressValue(i,a.autoesc),h+="</span>\n    "),h+="\n    ";var u;u=d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"AUTOCOMPLETE_SUGGESTION",a.autoesc),c.set("element_type",u),c.parent||(b.setVariable("element_type",u),b.addExport("element_type")),h+="\n    ","recent_query"==p&&(h+="\n        ",u=d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"RECENT_SEARCH_SUGGESTION",a.autoesc),c.set("element_type",u),c.parent||(b.setVariable("element_type",u),b.addExport("element_type")),h+="\n    "),h+='\n    <span class="typeaheadName"\n        data-element-type="',h+=d.suppressValue(u,a.autoesc),h+="\"\n        data-aux='",h+=d.suppressValue(a.getFilter("to_json").call(b,{result_index:m,entered_query:q,selected_query:r,autocomplete_type:t,search_mode:s}),a.autoesc),h+="'>\n        ",h+=d.suppressValue(r,a.autoesc),h+="\n    </span>\n</a>\n",a.getFilter("contains").call(b,["pin_search","board_search","people_search"],p)&&!k&&(h+="\n    <hr />\n"),h+="\n",e(null,h)}catch(v){e(d.handleError(v,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/hint_no_city.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="hintWrapper">\n    <p class="hint">\n        <span class="highlighted">',h+=d.suppressValue((f=2,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Hint!"])),a.autoesc),h+="</span>\n        ",h+=d.suppressValue((f=3,g=10,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Type a place or place and area "])),a.autoesc),h+='\n    </p>\n\n    <p class="example">\n        ',h+=d.suppressValue((f=7,g=10,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["e.g. Taj Mahal or Harrods near London"])),a.autoesc),h+="\n    </p>\n</div>\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/hint_specific_city.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"locality")||"",c.set("locality",i),c.parent||(b.setVariable("locality",i),b.addExport("locality")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"place")||"",c.set("place",j),c.parent||(b.setVariable("place",j),b.addExport("place")),h+='\n\n<div class="hintWrapper">\n    <p class="hint">\n        <span class="highlighted">',h+=d.suppressValue((f=5,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Hint!"])),a.autoesc),h+="</span>\n        Wrong ",h+=d.suppressValue(i,a.autoesc),h+='?\n    </p>\n\n    <p class="example">\n        Help us out by being more specific. We\'re searching in ',h+=d.suppressValue(j,a.autoesc),h+="\n    </p>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/interest.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"class_name")||"",c.set("class_name",i),c.parent||(b.setVariable("class_name",i),b.addExport("class_name")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"image")||"",c.set("image",j),c.parent||(b.setVariable("image",j),b.addExport("image")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"resultIndex")||"",c.set("resultIndex",k),c.parent||(b.setVariable("resultIndex",k),b.addExport("resultIndex")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",l),c.parent||(b.setVariable("label",l),b.addExport("label")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"enteredQuery")||"",c.set("enteredQuery",m),c.parent||(b.setVariable("enteredQuery",m),b.addExport("enteredQuery")),h+="\n";var n;n=d.contextOrFrameLookup(b,c,"follower_count")||"",c.set("follower_count",n),c.parent||(b.setVariable("follower_count",n),b.addExport("follower_count")),h+="\n\n<a ",i&&(h+='class="',h+=d.suppressValue(i,a.autoesc),h+='"'),h+=">\n    ",j&&(h+='\n        <span class="typeaheadImg">\n            <img src="',h+=d.suppressValue(j,a.autoesc),h+='">\n        </span>\n    '),h+='\n\n    <span class="typeaheadSummary">\n        <div class="typeaheadName"\n             data-element-type="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"INTEREST_SUGGESTION",a.autoesc),a.autoesc),h+='"\n             data-aux=\'{\n                "result_index": ',h+=d.suppressValue(k,a.autoesc),h+=',\n                "entered_query": "',h+=d.suppressValue(m,a.autoesc),h+='",\n                "selected_query": "',h+=d.suppressValue(l,a.autoesc),h+="\"\n            }'>\n            ",h+=d.suppressValue(l,a.autoesc),h+='\n        </div>\n        <div class="typeaheadStats">\n            <span class="numPinnersIcon"></span>\n            <span class="numPinnersStat">\n                ',h+="\n                ";var o=d.makeMacro([],[],function(e){c=c.push(),e=e||{};var h,i="";return h={follower_count:n},c.set("__dict",h),c.parent||b.setVariable("__dict",h),i+=d.suppressValue((f=28,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"_interpolate"),"_interpolate",[(f=28,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["{{ follower_count }} Pinners"])),h])),a.autoesc),c=c.pop(),new d.SafeString(i)});b.setVariable("_doTranslation",o),h+=d.suppressValue((f=28,g=17,d.callWrap(o,"_doTranslation",[])),a.autoesc),h+='\n            </span>\n        </div>\n    </span>\n    <span class="plusIcon"></span>\n</a>\n',e(null,h)}catch(p){e(d.handleError(p,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/place.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"category")||"",c.set("category",i),c.parent||(b.setVariable("category",i),b.addExport("category")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"locality")||"",c.set("locality",j),c.parent||(b.setVariable("locality",j),b.addExport("locality")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"class_name")||"",c.set("class_name",k),c.parent||(b.setVariable("class_name",k),b.addExport("class_name")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"image")||"",c.set("image",l),c.parent||(b.setVariable("image",l),b.addExport("image")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"hideLocalityAndRegion")||!1,c.set("hideLocalityAndRegion",m),c.parent||(b.setVariable("hideLocalityAndRegion",m),b.addExport("hideLocalityAndRegion")),h+="\n";var n;n=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",n),c.parent||(b.setVariable("label",n),b.addExport("label")),h+="\n";var o;o=d.contextOrFrameLookup(b,c,"sublabel")||"",c.set("sublabel",o),c.parent||(b.setVariable("sublabel",o),b.addExport("sublabel")),h+="\n";var p;p=d.contextOrFrameLookup(b,c,"street")||"",c.set("street",p),c.parent||(b.setVariable("street",p),b.addExport("street")),h+="\n";var q;q=d.contextOrFrameLookup(b,c,"region")||"",c.set("region",q),c.parent||(b.setVariable("region",q),b.addExport("region")),h+="\n\n",a.getTemplate("templates/macros/image.nunjucks",function(c,f){return c?void e(c):void f.getExported(function(c,f){if(c)return void e(c);if(!f.hasOwnProperty("image_tag"))return void e(new Error("cannot import 'image_tag'"));var g=f.image_tag;b.setVariable("image_tag",g),h+='\n\n<a class="',k&&(h+=d.suppressValue(k,a.autoesc),h+=" "),l&&(h+="hasChildImage "),h+='">\n    <div class="content',l&&(h+=" hasImage "),h+='">\n        <h4 class="typeaheadResultEmphasized">\n            <span class="emphasized">',h+=d.suppressValue(n,a.autoesc),h+="</span>\n            ",i&&(h+='\n                <span class="category"> <span class="bullet">&bull;</span> ',h+=d.suppressValue(i,a.autoesc),h+="</span>\n            "),h+='\n        </h4>\n\n        <p class="typeaheadResultMetaData">\n            <span class="typeaheadPlace">\n                ',o&&(h+="\n                    ",h+=d.suppressValue(o,a.autoesc),h+="\n                "),h+="\n                ",p&&(h+="\n                    ",h+=d.suppressValue(p,a.autoesc),h+="\n                "),h+="\n                ",m||(h+="\n                    ",p&&j&&(h+="&bull;"),h+="\n                    ",h+=d.suppressValue(j,a.autoesc),j&&q&&(h+=", "),h+="\n                    ",q&&(h+="\n                        ",h+=d.suppressValue(q,a.autoesc),h+="\n                    "),h+="\n                "),h+="\n            </span>\n        </p>\n    </div>\n</a>\n",e(null,h)})})}catch(r){e(d.handleError(r,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/send_pin.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"id")||"",c.set("id",i),c.parent||(b.setVariable("id",i),b.addExport("id")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"is_pinner")||!1,c.set("is_pinner",j),c.parent||(b.setVariable("is_pinner",j),b.addExport("is_pinner")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"type")||"",c.set("type",k),c.parent||(b.setVariable("type",k),b.addExport("type")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"email")||"",c.set("email",l),c.parent||(b.setVariable("email",l),b.addExport("email")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",m),c.parent||(b.setVariable("label",m),b.addExport("label")),h+="\n";var n;n=d.contextOrFrameLookup(b,c,"send_pin_image")||!1,c.set("send_pin_image",n),c.parent||(b.setVariable("send_pin_image",n),b.addExport("send_pin_image")),h+="\n\n";var o;o="",c.set("element_type",o),c.parent||(b.setVariable("element_type",o),b.addExport("element_type")),h+="\n",j?(h+="\n    ",h+="\n    ",o=204,c.set("element_type",o),c.parent||(b.setVariable("element_type",o),b.addExport("element_type")),h+="\n"):"facebook_non_pinner"==k?(h+="\n    ",h+="\n    ",o=202,c.set("element_type",o),c.parent||(b.setVariable("element_type",o),b.addExport("element_type")),h+="\n"):"gplus_non_pinner"==k&&(h+="\n    ",h+="\n    ",o=203,c.set("element_type",o),c.parent||(b.setVariable("element_type",o),b.addExport("element_type")),h+="\n"),h+="\n\n<a ",i&&(h+='class="',h+=d.suppressValue(i,a.autoesc),h+='"'),h+=" ",o&&(h+='data-element-type="',h+=d.suppressValue(o,a.autoesc),h+='"'),h+=">\n    ",n&&(h+='\n        <span class="typeaheadImg">\n            <img src="',h+=d.suppressValue(n,a.autoesc),h+='" alt="">\n        </span>\n    '),h+='\n    <p class="typeaheadName">',h+=d.suppressValue(m,a.autoesc),h+='</p>\n    <div class="titleWrapper">\n        <i class="titleIcon ',j&&(h+="isPinner "),"facebook_non_pinner"==k&&(h+="isFacebook "),"gplus_non_pinner"==k&&(h+="isGplus "),h+='"></i>\n        <p class="title">\n            ',j?(h+="\n                ",h+=d.suppressValue((f=30,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Fellow Pinner"])),a.autoesc),h+="\n            "):l?(h+="\n                ",h+=d.suppressValue(l,a.autoesc),h+="\n            "):"facebook_non_pinner"==k?(h+="\n                ",h+=d.suppressValue((f=34,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Facebook"])),a.autoesc),h+="\n            "):"gplus_non_pinner"==k?(h+="\n                ",h+=d.suppressValue((f=36,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Google"])),a.autoesc),h+="\n            "):(h+="\n                ",h+=d.suppressValue((f=38,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Enter an email address"])),a.autoesc),h+="\n            "),h+="\n        </p>\n    </div>\n</a>\n",e(null,h)}catch(p){e(d.handleError(p,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/send_to_email.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"email")||"",c.set("email",i),c.parent||(b.setVariable("email",i),b.addExport("email")),h+='\n\n<div class="sendToEmail">\n    <a>\n        <div class="left">\n            <div class="icon">',h+=d.suppressValue(a.getFilter("upper").call(b,a.getFilter("first").call(b,i)),a.autoesc),h+='</div>\n        </div>\n        <div class="right">\n            <h4 class="title">',h+=d.suppressValue(i,a.autoesc),h+='</h4>\n            <p class="subtitle">',h+=d.suppressValue((f=9,g=34,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Click to send"])),a.autoesc),h+="</p>\n        </div>\n    </a>\n</div>\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/social_connect.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;if(i=d.contextOrFrameLookup(b,c,"network")||"",c.set("network",i),c.parent||(b.setVariable("network",i),b.addExport("network")),h+="\n\n","facebook"==i){h+="\n    ";var j;f=3,g=22,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Find friends from Facebook"]),c.set("titleText",j),c.parent||(b.setVariable("titleText",j),b.addExport("titleText")),h+="\n"}else"twitter"==i?(h+="\n    ",f=5,g=22,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Find friends from Twitter"]),c.set("titleText",j),c.parent||(b.setVariable("titleText",j),b.addExport("titleText")),h+="\n"):"gplus"==i?(h+="\n    ",f=7,g=22,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Find friends from Google+"]),c.set("titleText",j),c.parent||(b.setVariable("titleText",j),b.addExport("titleText")),h+="\n"):"yahoo"==i&&(h+="\n    ",f=9,g=22,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Find friends from Yahoo"]),c.set("titleText",j),c.parent||(b.setVariable("titleText",j),b.addExport("titleText")),h+="\n");h+='\n\n<div class="socialConnect">\n    <a>\n        <div class="left">\n            <div class="icon socialConnect-',h+=d.suppressValue(i,a.autoesc),h+='">\n                <em></em>\n            </div>\n        </div>\n        <div class="right">\n            <h4 class="title">',h+=d.suppressValue(j,a.autoesc),h+="</h4>\n        </div>\n    </a>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/Typeahead/user_circle_avatar.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"send_pin_image")||"",c.set("send_pin_image",i),c.parent||(b.setVariable("send_pin_image",i),b.addExport("send_pin_image")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"is_pinner")||!1,c.set("is_pinner",j),c.parent||(b.setVariable("is_pinner",j),b.addExport("is_pinner")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"type")||"",c.set("type",k),c.parent||(b.setVariable("type",k),b.addExport("type")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"email")||"",c.set("email",l),c.parent||(b.setVariable("email",l),b.addExport("email")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"label")||"",c.set("label",m),c.parent||(b.setVariable("label",m),b.addExport("label")),h+='\n\n<a>\n    <div class="left">\n        <img src="',h+=d.suppressValue(i,a.autoesc),h+='"/>\n    </div>\n    <div class="right">\n        <h4 class="title">',h+=d.suppressValue(m,a.autoesc),h+='</h4>\n        <p class="subtitle">\n            ',j?(h+="\n                ",h+=d.suppressValue((f=14,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Fellow Pinner"])),a.autoesc),h+="\n            "):l?(h+="\n                ",h+=d.suppressValue(l,a.autoesc),h+="\n            "):"facebook_non_pinner"==k?(h+="\n                ",h+=d.suppressValue((f=18,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Facebook"])),a.autoesc),h+="\n            "):"gplus_non_pinner"==k&&(h+="\n                ",h+=d.suppressValue((f=20,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Google"])),a.autoesc),h+="\n            "),h+="\n        </p>\n    </div>\n</a>\n",e(null,h)}catch(n){e(d.handleError(n,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/common/modules/ui/TypeaheadField/TypeaheadField.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=41,g=23,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["type","text"]),c.set("type",i),c.parent||(b.setVariable("type",i),b.addExport("type")),h+="\n";var j;f=42,g=23,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["name",""]),c.set("name",j),c.parent||(b.setVariable("name",j),b.addExport("name")),h+="\n";var k;f=43,g=24,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["value",""]),c.set("value",k),c.parent||(b.setVariable("value",k),b.addExport("value")),h+="\n";var l;f=44,g=28,l=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["autofocus"]),c.set("autofocus",l),c.parent||(b.setVariable("autofocus",l),b.addExport("autofocus")),h+="\n";var m;f=45,g=28,m=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type",""]),c.set("view_type",m),c.parent||(b.setVariable("view_type",m),b.addExport("view_type")),h+="\n";var n;f=46,g=30,n=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["placeholder",""]),c.set("placeholder",n),c.parent||(b.setVariable("placeholder",n),b.addExport("placeholder")),h+="\n";var o;f=47,g=27,o=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["disabled",!1]),c.set("disabled",o),c.parent||(b.setVariable("disabled",o),b.addExport("disabled")),h+="\n";var p;if(f=48,g=31,p=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["autocomplete","off"]),c.set("autocomplete",p),c.parent||(b.setVariable("autocomplete",p),b.addExport("autocomplete")),h+="\n\n",f=50,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"])&&(h+="\n    ",h+=d.suppressValue((f=51,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[(f=51,g=25,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]))])),a.autoesc),h+="\n"),h+="\n\n",h+=d.suppressValue((f=54,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[m])),a.autoesc),h+="\n\n","tokenized"==i){h+="\n    ";
var q;q="field",c.set("class_name",q),c.parent||(b.setVariable("class_name",q),b.addExport("class_name")),h+="\n    ";var r;f=58,g=40,r=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["handled_by_parent",!0]),c.set("handled_by_parent",r),c.parent||(b.setVariable("handled_by_parent",r),b.addExport("handled_by_parent")),h+="\n    ";var s;f=59,g=38,s=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_remove_all"]),c.set("show_remove_all",s),c.parent||(b.setVariable("show_remove_all",s),b.addExport("show_remove_all")),h+="\n    ";var t;f=60,g=43,t=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["hide_tokens_on_focus"]),c.set("hide_tokens_on_focus",t),c.parent||(b.setVariable("hide_tokens_on_focus",t),b.addExport("hide_tokens_on_focus")),h+="\n    ";var u;f=61,g=45,u=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["input_log_element_type"]),c.set("input_log_element_type",u),c.parent||(b.setVariable("input_log_element_type",u),b.addExport("input_log_element_type")),h+="\n    ",o&&(h+="\n        ",q+=" disabled",c.set("class_name",q),c.parent||(b.setVariable("class_name",q),b.addExport("class_name")),h+="\n    "),h+='\n    <div class="tokenizedInputWrapper">\n        ',h+=d.suppressValue((f=66,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["TokenizedInput",d.makeKeywordArgs({id:"tokenizedInput",options:{handled_by_parent:r,view_type:m,token_text_strategy:"prioritized",show_remove_all:s,hide_tokens_on_focus:t,input_options:{name:j,class_name:q,value:k,disabled:o,placeholder:n,autofocus:l,autocomplete:p,log_element_type:u}}})])),a.autoesc),h+="\n    </div>\n"}else"textarea"==i?(h+="\n    ",h+=d.suppressValue((f=88,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"textfield",options:{placeholder:n,value:k}})])),a.autoesc),h+="\n"):(h+="\n    ",q="field",c.set("class_name",q),c.parent||(b.setVariable("class_name",q),b.addExport("class_name")),h+="\n    ",o&&(h+="\n        ",q+=" disabled",c.set("class_name",q),c.parent||(b.setVariable("class_name",q),b.addExport("class_name")),h+="\n    "),h+="\n    ",f=97,g=45,u=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["input_log_element_type"]),c.set("input_log_element_type",u),c.parent||(b.setVariable("input_log_element_type",u),b.addExport("input_log_element_type")),h+="\n    ",h+=d.suppressValue((f=98,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Input",d.makeKeywordArgs({id:"input",options:{name:j,class_name:q,value:k,disabled:o,placeholder:n,autofocus:l,autocomplete:p,log_element_type:u}})])),a.autoesc),h+="\n");h+="\n\n",f=113,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_caret"])&&(h+='\n    <span class="typeaheadCaret"></span>\n'),h+="\n\n",b.getBlock("buttons")(a,b,c,d,function(i,j){if(i)return void e(i);h+=j,h+="\n\n",h+="\n\n";var k;k="guided expanded"==m,c.set("show_new_typeahead_dropdown",k),c.parent||(b.setVariable("show_new_typeahead_dropdown",k),b.addExport("show_new_typeahead_dropdown")),h+="\n\n",k||(h+="\n",h+=d.suppressValue((f=126,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Typeahead",d.makeKeywordArgs({id:"typeahead",options:{count:(f=129,g=28,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["count"])),class_name:(f=130,g=33,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"])),enable_recent_queries:(f=131,g=44,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["enable_recent_queries"])),view_type:m,should_geocode:(f=133,g=37,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["should_geocode"])),use_tab_index:(f=134,g=36,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["use_tab_index"])),bypass_maxheight:(f=135,g=39,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["bypass_maxheight"])),exclude_non_followers:(f=136,g=44,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["exclude_non_followers"])),tags:(f=137,g=27,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["tags"])),minimum_term_character_length:(f=138,g=52,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["minimum_term_character_length"])),num_places:(f=139,g=33,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["num_places"])),bypass_lru_cache:(f=140,g=39,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["bypass_lru_cache"])),resource_name:(f=141,g=36,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["resource_name"])),template:(f=142,g=31,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["template"]))}})])),a.autoesc),h+="\n"),h+="\n",e(null,h)})}catch(v){e(d.handleError(v,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{b_buttons:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/AddInterestButton/AddInterestButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=8,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/AddPinToMap/pinFormMetadata.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"category")||"",c.set("category",i),c.parent||(b.setVariable("category",i),b.addExport("category")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"hideLocalityAndRegion")||!1,c.set("hideLocalityAndRegion",j),c.parent||(b.setVariable("hideLocalityAndRegion",j),b.addExport("hideLocalityAndRegion")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"region")||"",c.set("region",k),c.parent||(b.setVariable("region",k),b.addExport("region")),h+="\n";var l;l=d.contextOrFrameLookup(b,c,"street")||"",c.set("street",l),c.parent||(b.setVariable("street",l),b.addExport("street")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"locality")||"",c.set("locality",m),c.parent||(b.setVariable("locality",m),b.addExport("locality")),h+='\n\n<p class="typeaheadResultMetaData">\n    ',i&&(h+='\n        <strong class="typeaheadPlaceType">\n            ',h+=d.suppressValue(i,a.autoesc),h+="\n        </strong>\n        ",(l||m||k)&&(h+="\n            &bull;\n        "),h+="\n    "),h+='\n    <span class="typeaheadPlaceDistrict">\n        ',l&&(h+="\n            ",h+=d.suppressValue(l,a.autoesc),h+=" \n        "),h+="\n        ",j||(h+="\n                ",h+=d.suppressValue(m,a.autoesc),m&&k&&(h+=", "),h+="\n            ",k&&(h+="\n                ",h+=d.suppressValue(k,a.autoesc),h+="\n            "),h+="\n        "),h+="\n    </span>\n</p>\n",e(null,h)}catch(n){e(d.handleError(n,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/AddPinToMap/uploadedImage.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i;i=d.contextOrFrameLookup(b,c,"image_url")||"",c.set("image_url",i),c.parent||(b.setVariable("image_url",i),b.addExport("image_url")),h+='\n\n<div class="imageWrapper selected">\n    <img class="uploadedImage" src="',h+=d.suppressValue(i,a.autoesc),h+='">\n    <div class="hoverSelectedStateIconWrapper">\n    <em class="icon"></em>\n    </div>\n</div>\n',e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/BoardPicker2/BoardPicker2.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/image.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("image_tag"))return void e(new Error("cannot import 'image_tag'"));var k=j.image_tag;b.setVariable("image_tag",k),h+="\n\n";var l;f=10,g=43,l=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["has_social_share_options",!0]),c.set("has_social_share_options",l),c.parent||(b.setVariable("has_social_share_options",l),b.addExport("has_social_share_options")),h+="\n";var m;f=11,g=34,m=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["pinned_to_board",{}]),c.set("pinned_to_board",m),c.parent||(b.setVariable("pinned_to_board",m),b.addExport("pinned_to_board")),h+="\n";var n;f=12,g=34,n=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["autofocus_board",!0]),c.set("autofocus_board",n),c.parent||(b.setVariable("autofocus_board",n),b.addExport("autofocus_board")),h+="\n\n",l||(h+="\n    ",h+=d.suppressValue((f=15,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["noSocialShareOptions"])),a.autoesc),h+="\n"),h+="\n\n";var o=d.makeMacro(["board"],[],function(e,h){c=c.push(),h=h||{},c.set("board",e);var i="";i+="\n    <li>\n        ";var j;f=20,g=33,j=d.callWrap(d.memberLookup(e,"get",a.autoesc),'board["get"]',["id"]),c.set("board_id",j),c.parent||(b.setVariable("board_id",j),b.addExport("board_id")),i+="\n        ";var l;f=21,g=31,l=d.callWrap(d.memberLookup(e,"get",a.autoesc),'board["get"]',["recommendation_reason"]),c.set("reason",l),c.parent||(b.setVariable("reason",l),b.addExport("reason")),i+="\n        ";var m;m=l,c.set("subtext",m),c.parent||(b.setVariable("subtext",m),b.addExport("subtext")),i+="\n        ";var n;n="boardListItem",c.set("board_list_item_class",n),c.parent||(b.setVariable("board_list_item_class",n),b.addExport("board_list_item_class")),i+="\n        ",j||(i+="\n            ",n+=" createBoard hidden",c.set("board_list_item_class",n),c.parent||(b.setVariable("board_list_item_class",n),b.addExport("board_list_item_class")),i+="\n            ",f=26,g=28,m=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create a new board"]),c.set("subtext",m),c.parent||(b.setVariable("subtext",m),b.addExport("subtext")),i+="\n        "),i+='\n        <div class="',i+=d.suppressValue(n,a.autoesc),i+='" data-id="',i+=d.suppressValue(j,a.autoesc),i+='">\n            ',j?(i+='\n                <div class="boardImgContainer">\n                    ',i+=d.suppressValue((f=33,g=30,d.callWrap(k,"image_tag",[d.makeKeywordArgs({src:(f=34,g=37,d.callWrap(d.memberLookup(e,"get",a.autoesc),'board["get"]',["image_cover_url"])),class_name:"boardImg"})])),a.autoesc),i+="\n                </div>\n            "):i+='\n                <span class="createBoardIcon"></span>\n            ',i+="\n            ";var o;return o="boardNameWrapper",c.set("board_name_wrapper_class",o),c.parent||(b.setVariable("board_name_wrapper_class",o),b.addExport("board_name_wrapper_class")),i+="\n            ",m&&(i+="\n                ",o+=" withSubtext",c.set("board_name_wrapper_class",o),c.parent||(b.setVariable("board_name_wrapper_class",o),b.addExport("board_name_wrapper_class")),i+="\n            "),i+='\n            <span class="',i+=d.suppressValue(o,a.autoesc),i+='">\n                <span class="boardName">\n                    ',i+=d.suppressValue((f=44,g=30,d.callWrap(d.memberLookup(e,"get",a.autoesc),'board["get"]',["name"])),a.autoesc),i+="\n                </span>\n                ",m&&(i+='\n                    <span class="boardSubtext">',i+=d.suppressValue(m,a.autoesc),i+="</span>\n                "),i+="\n            </span>\n            ",j&&(i+="\n                ",i+=d.suppressValue((f=51,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardIcons",d.makeKeywordArgs({data:e})])),a.autoesc),i+="\n            "),i+='\n\n            <div class="buttonWrapper">\n                ',i+=d.suppressValue((f=55,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({options:{class_name:"repinSmall pinIt",type:"submit",show_text:!1,text:(f=60,g=33,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pin it"])),has_icon:!0,color:"primary"}})])),a.autoesc),i+="\n            </div>\n        </div>\n    </li>\n",c=c.pop(),new d.SafeString(i)});b.addExport("board_list_item"),b.setVariable("board_list_item",o),h+="\n\n";var p;f=68,g=32,p=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["boards_shortlist",[]]),c.set("boards_shortlist",p),c.parent||(b.setVariable("boards_shortlist",p),b.addExport("boards_shortlist")),h+="\n",h+="\n";var q;f=70,g=26,q=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["all_boards",[]]),c.set("all_boards",q),c.parent||(b.setVariable("all_boards",q),b.addExport("all_boards")),h+="\n",m&&(h+="\n    ",h+=d.suppressValue((f=72,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["PinDupWarning",d.makeKeywordArgs({data:{pinned_to_board:m}})])),a.autoesc),h+="\n"),h+='\n<div class="boardPickerTypeaheadSelector">\n    <span class="enterInstructions hidden">\n        ',h+=d.suppressValue((f=77,g=10,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Hit 'Enter' to pin"])),a.autoesc),h+="\n    </span>\n    ";var r;if(f=79,g=24,r=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Type a board name"]),c.set("placeholder",r),c.parent||(b.setVariable("placeholder",r),b.addExport("placeholder")),h+='\n    <input type="text"\n        name="boardName"\n        class="boardSelectorInput"\n        placeholder="',h+=d.suppressValue(r,a.autoesc),h+='"\n        ',h+='\n        autocomplete="off"\n        ',n&&(h+='\n            autofocus="autofocus"\n        '),h+="/>\n</div>\n",h+='\n<div class="boardPickerListItems',m&&(h+=" hasPinDupWarning"),h+='" tabindex="0">\n    ',a.getFilter("length").call(b,p)>0){h+='\n        <ul class="boardsShortlist">\n            ',c=c.push();var s=p;if(s)for(var t=0;t<s.length;t++){var u=s[t];c.set("board",u),h+="\n                ",h+=d.suppressValue((f=97,g=32,d.callWrap(o,"board_list_item",[u])),a.autoesc),h+="\n            "}c=c.pop(),h+="\n        </ul>\n        ",a.getFilter("length").call(b,q)>0&&(h+='\n            <div class="allBoardsHeader">',h+=d.suppressValue((f=101,g=43,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["All boards"])),a.autoesc),h+="</div>\n        "),h+="\n    "}h+='\n\n    <ul class="allBoardsList">\n        ',c=c.push();var v=q;if(v)for(var w=0;w<v.length;w++){var x=v[w];c.set("board",x),h+="\n            ",h+=d.suppressValue((f=107,g=28,d.callWrap(o,"board_list_item",[x])),a.autoesc),h+="\n        "}c=c.pop(),h+="\n\n        ",h+=d.suppressValue((f=110,g=24,d.callWrap(o,"board_list_item",[{}])),a.autoesc),h+="\n\n    </ul>\n</div>\n",e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/BoardPickerOld/BoardPickerOld.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/boardpicker.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("icon_wrapper"))return void e(new Error("cannot import 'icon_wrapper'"));var k=j.icon_wrapper;b.setVariable("icon_wrapper",k),h+="\n\n",h+="\n";var l;l="places",c.set("LAYOUT_PLACES",l),c.parent||(b.setVariable("LAYOUT_PLACES",l),b.addExport("LAYOUT_PLACES")),h+="\n";var m;m=d.contextOrFrameLookup(b,c,"data"),c.set("boards",m),c.parent||(b.setVariable("boards",m),b.addExport("boards")),h+="\n";var n;n=0==a.getFilter("length").call(b,m),c.set("no_boards",n),c.parent||(b.setVariable("no_boards",n),b.addExport("no_boards")),h+="\n\n",h+=d.suppressValue((f=17,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"size",a.autoesc),"")])),a.autoesc),h+="\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"disabled",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=19,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["disabled"])),a.autoesc),h+="\n"),h+="\n\n";var o=d.makeMacro(["board"],[],function(e,h){c=c.push(),h=h||{},c.set("board",e);var i="";i+="\n    ";var j;j=a.getFilter("default").call(b,d.memberLookup(e,"privacy",a.autoesc),"public"),c.set("privacy",j),c.parent||(b.setVariable("privacy",j),b.addExport("privacy")),i+="\n    ";var m;m="secret"==j,c.set("is_secret",m),c.parent||(b.setVariable("is_secret",m),b.addExport("is_secret")),i+="\n    ";var n;n=d.memberLookup(e,"layout",a.autoesc)==l,c.set("is_place",n),c.parent||(b.setVariable("is_place",n),b.addExport("is_place")),i+="\n    ";var o;o=d.memberLookup(e,"is_collaborative",a.autoesc),c.set("is_collaborative",o),c.parent||(b.setVariable("is_collaborative",o),b.addExport("is_collaborative")),i+="\n\n    ",i+="\n    ",i+="\n    ";var p;return p="",c.set("is_collaborative_string",p),c.parent||(b.setVariable("is_collaborative_string",p),b.addExport("is_collaborative_string")),i+="\n    ",o&&(i+="\n        ",p="1",c.set("is_collaborative_string",p),c.parent||(b.setVariable("is_collaborative_string",p),b.addExport("is_collaborative_string")),i+="\n    "),i+='\n\n    <div class="currentBoard"\n        data-id="',i+=d.suppressValue(d.memberLookup(e,"id",a.autoesc),a.autoesc),i+='"\n        data-privacy="',i+=d.suppressValue(j,a.autoesc),i+='"\n        data-collaborative="',i+=d.suppressValue(p,a.autoesc),i+='">\n            ',i+=d.suppressValue((f=40,g=25,d.callWrap(k,"icon_wrapper",[m,o,n,!0])),a.autoesc),i+='\n        <span class="currentBoardName">',i+=d.suppressValue(d.memberLookup(e,"name",a.autoesc),a.autoesc),i+="</span>\n    </div>\n",c=c.pop(),new d.SafeString(i)});b.addExport("current_board"),b.setVariable("current_board",o),h+="\n\n",b.getBlock("board_picker")(a,b,c,d,function(a,b){return a?void e(a):(h+=b,h+="\n",void e(null,h))})})})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{if(h+="\n    ",h+=d.suppressValue((f=46,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{num_boards:a.getFilter("length").call(b,d.contextOrFrameLookup(b,c,"boards"))}])),a.autoesc),h+="\n    ",d.contextOrFrameLookup(b,c,"no_boards")){h+="\n        ",h+=d.suppressValue((f=48,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["no_boards"])),a.autoesc),h+="\n        ",h+=d.suppressValue((f=49,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{no_boards:d.contextOrFrameLookup(b,c,"no_boards")}])),a.autoesc),h+="\n        ";var i;i=[(f=51,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Places to Visit"])),(f=52,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Stuff to Buy"])),(f=53,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Projects to Try"])),(f=54,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Things to Wear"])),(f=55,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Recipes to Cook"])),(f=56,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Ideas for the House"]))],c.set("board_name_suggestions",i),c.parent||(b.setVariable("board_name_suggestions",i),b.addExport("board_name_suggestions")),h+="\n    "}else h+="\n        ",i=[],c.set("board_name_suggestions",i),c.parent||(b.setVariable("board_name_suggestions",i),b.addExport("board_name_suggestions")),h+="\n    ";h+='\n\n    <div class="boardPickerInnerWrapper">\n        <div class="createBoard">\n            ',h+=d.suppressValue((f=63,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"createBoard",options:{class_name:"createBoardButton",text:(f=67,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create"]))}})])),a.autoesc),h+="\n            ";var j;f=70,g=37,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create New Board"]),c.set("placeholder_text",j),c.parent||(b.setVariable("placeholder_text",j),b.addExport("placeholder_text")),h+="\n            ",d.contextOrFrameLookup(b,c,"no_boards")&&(h+="\n                ",f=72,g=41,j=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create a Board"]),c.set("placeholder_text",j),c.parent||(b.setVariable("placeholder_text",j),b.addExport("placeholder_text")),h+="\n            "),h+='\n            <div class="createBoardNameContainer">\n                <input type="text" name="name" class="createBoardName" placeholder="',h+=d.suppressValue(j,a.autoesc),h+='">\n            </div>\n        </div>\n            <div class="boardPickerInner">\n            <ul>\n                ',d.contextOrFrameLookup(b,c,"no_boards")&&(h+='\n                    <li class="boardPickerHeader">\n                        <h2>\n                            ',h+=d.suppressValue((f=83,g=30,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Feeling stuck? Try one of these:"])),a.autoesc),h+="\n                        </h2>\n                    </li>\n                "),h+="\n\n                ",c=c.push();var k=i;if(k)for(var l=0;l<k.length;l++){var m=k[l];c.set("board",m),h+='\n                    <li class="boardPickerItem" data-suggestion="',h+=d.suppressValue(m,a.autoesc),h+='">\n                        ',h+=d.suppressValue(m,a.autoesc),h+="\n                    </li>\n                "}c=c.pop(),h+="\n\n                ",c=c.push();var n=d.contextOrFrameLookup(b,c,"boards");if(n)for(var o=0;o<n.length;o++){var p=n[o];c.set("board",p),h+="\n                    ";var q;q=d.memberLookup(p,"privacy",a.autoesc),c.set("privacy",q),c.parent||(b.setVariable("privacy",q),b.addExport("privacy")),h+="\n                    ";var r;r=d.memberLookup(p,"is_collaborative",a.autoesc),c.set("is_collaborative",r),c.parent||(b.setVariable("is_collaborative",r),b.addExport("is_collaborative")),h+="\n                    ";var s;s=d.memberLookup(p,"layout",a.autoesc)==d.contextOrFrameLookup(b,c,"LAYOUT_PLACES"),c.set("is_place",s),c.parent||(b.setVariable("is_place",s),b.addExport("is_place")),h+="\n                    ";var t;t="",c.set("is_collaborative_string",t),c.parent||(b.setVariable("is_collaborative_string",t),b.addExport("is_collaborative_string")),h+="\n                    ",r&&(h+="\n                        ",t="1",c.set("is_collaborative_string",t),c.parent||(b.setVariable("is_collaborative_string",t),b.addExport("is_collaborative_string")),h+="\n                    "),h+="\n                    ";var u;u="secret"==q,c.set("is_secret",u),c.parent||(b.setVariable("is_secret",u),b.addExport("is_secret")),h+='\n                    <li class="boardPickerItem"\n                        data-id="',h+=d.suppressValue(d.memberLookup(p,"id",a.autoesc),a.autoesc),h+='"\n                        data-place="',h+=d.suppressValue(s,a.autoesc),h+='"\n                        data-privacy="',h+=d.suppressValue(q,a.autoesc),h+='"\n                        data-collaborative="',h+=d.suppressValue(t,a.autoesc),h+='">\n                            ',h+=d.suppressValue((f=108,g=41,d.callWrap(d.contextOrFrameLookup(b,c,"icon_wrapper"),"icon_wrapper",[u,r,s,!1])),a.autoesc),h+="\n                            ",h+=d.suppressValue(d.memberLookup(p,"name",a.autoesc),a.autoesc),h+="\n                    </li>\n                "}if(c=c.pop(),h+="\n            </ul>\n        </div>\n    </div>\n\n    ",d.contextOrFrameLookup(b,c,"no_boards"))h+='\n        <div class="tooltipAnchor"></div>\n        <div class="boardPickerOuter primary createYourFirstBoard">\n            ',h+=d.suppressValue((f=122,g=14,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create your first board","Button text that invites the user to create one board"])),a.autoesc),h+="\n        </div>\n    ";else{h+='\n        <div class="boardPickerOuter">\n            ';var v;if(v=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"default_board_id",a.autoesc),c.set("default_board_id",v),c.parent||(b.setVariable("default_board_id",v),b.addExport("default_board_id")),h+="\n            ",v){h+="\n                ",c=c.push();var w=d.contextOrFrameLookup(b,c,"boards");if(w)for(var x=0;x<w.length;x++){var y=w[x];c.set("board",y),h+="\n                    ",v==d.memberLookup(y,"id",a.autoesc)&&(h+="\n                        ",h+=d.suppressValue((f=130,g=38,d.callWrap(d.contextOrFrameLookup(b,c,"current_board"),"current_board",[y])),a.autoesc),h+="\n                    "),h+="\n                "}c=c.pop(),h+="\n            "}else{h+="\n                ";var z;z=a.getFilter("first").call(b,d.contextOrFrameLookup(b,c,"boards")),c.set("board",z),c.parent||(b.setVariable("board",z),b.addExport("board")),h+="\n                ",h+=d.suppressValue((f=135,g=30,d.callWrap(d.contextOrFrameLookup(b,c,"current_board"),"current_board",[z])),a.autoesc),h+="\n            "}h+="\n        </div>\n    "}h+="\n",e(null,h)}catch(A){e(d.handleError(A,f,g))}}return{b_board_picker:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/EmptyConversations/EmptyConversations.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='\n\n<div class="icon"></div>\n\n<p class="intro">\n    ';var i=d.makeMacro([],[],function(e){c=c.push(),e=e||{};var h,i="";return h={},c.set("__dict",h),c.parent||b.setVariable("__dict",h),i+=d.suppressValue((f=8,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"_interpolate"),"_interpolate",[(f=8,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["<strong>Send messages</strong> to your friends! Plan projects, swap ideas and share your best discoveries."])),h])),a.autoesc),c=c.pop(),new d.SafeString(i)});if(b.setVariable("_doTranslation",i),h+=d.suppressValue((f=8,g=5,d.callWrap(i,"_doTranslation",[])),a.autoesc),h+="\n</p>\n\n",3==a.getFilter("length").call(b,d.contextOrFrameLookup(b,c,"data"))){h+='\n    <div class="headsContainer">\n        ',c=c.push();var j=d.contextOrFrameLookup(b,c,"data");if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("user",l),h+="\n            ",h+=d.suppressValue((f=17,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationHead",d.makeKeywordArgs({options:{show_name:!0,users:[l]}})])),a.autoesc),h+="\n        "}c=c.pop(),h+="\n    </div>\n"}h+="\n",e(null,h)}catch(m){e(d.handleError(m,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/FacebookShareButton/FacebookShareButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n\n",h+=d.suppressValue((f=11,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[{text:(f=12,g=23,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["text",(f=12,g=33,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Facebook"]))])),has_icon:!0,class_name:(f=14,g=29,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name","facebook"]))}])),a.autoesc),h+=d.suppressValue((f=11,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["Button"])),a.autoesc),a.getTemplate("app/common/modules/Button/Button.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/GeoFeatureList/GeoFeatureList.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/geo_feature.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("geo_feature"))return void e(new Error("cannot import 'geo_feature'"));var k=j.geo_feature;b.setVariable("geo_feature",k),h+="\n\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"features",a.autoesc),c.set("features",l),c.parent||(b.setVariable("features",l),b.addExport("features")),h+="\n\n";var m;m=d.memberLookup(l,0,a.autoesc),c.set("first_feature",m),c.parent||(b.setVariable("first_feature",m),b.addExport("first_feature")),h+="\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"active_feature",a.autoesc)&&(h+="\n    ",m=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"active_feature",a.autoesc),c.set("first_feature",m),c.parent||(b.setVariable("first_feature",m),b.addExport("first_feature")),h+="\n"),h+='\n<div class="labelWrapper">\n    <p class="label">',h+=d.suppressValue((f=18,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Places near:"])),a.autoesc),h+='</p>\n    <div class="dropdownTarget">\n        ',h+=d.suppressValue((f=20,g=20,d.callWrap(k,"geo_feature",[m])),a.autoesc),h+='\n\n        <div class="dropdownIcon"></div>\n    </div>\n</div>\n',e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/IncrementingNavigateButton/IncrementingNavigateButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"actionCount",a.autoesc),0),c.set("actionCount",i),c.parent||(b.setVariable("actionCount",i),b.addExport("actionCount")),h+="\n",i||(h+="\n    ",h+=d.suppressValue((f=13,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hidden"])),a.autoesc),h+="\n"),h+="\n\n",h+=d.suppressValue((f=16,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{actionCount:i}])),a.autoesc),h+="\n\n",h+=d.suppressValue((f=19,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["NavigateButton"])),a.autoesc),a.getTemplate("app/common/modules/NavigateButton/NavigateButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinActionBar/PinActionBar.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("pin",i),c.parent||(b.setVariable("pin",i),b.addExport("pin")),h+="\n";var j;j=d.memberLookup(i,"id",a.autoesc),c.set("pin_id",j),c.parent||(b.setVariable("pin_id",j),b.addExport("pin_id")),h+="\n";var k;k=d.memberLookup(i,"link",a.autoesc),c.set("link",k),c.parent||(b.setVariable("link",k),b.addExport("link")),h+="\n";var l;l=a.getFilter("default").call(b,d.memberLookup(i,"images",a.autoesc),{}),c.set("images",l),c.parent||(b.setVariable("images",l),b.addExport("images")),h+="\n";var m;m=a.getFilter("default").call(b,d.memberLookup(l,"236x",a.autoesc),{}),c.set("grid_pin_image",m),c.parent||(b.setVariable("grid_pin_image",m),b.addExport("grid_pin_image")),h+="\n";var n;n=!1,c.set("has_fullsize_image",n),c.parent||(b.setVariable("has_fullsize_image",n),b.addExport("has_fullsize_image")),h+="\n";var o;o=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),c.set("view_type",o),c.parent||(b.setVariable("view_type",o),b.addExport("view_type")),h+="\n\n",f=17,g=44,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["web_guided_search",["new_header_with_guided_search","new_header_with_old_search","new_header_with_user_dropdown","employee","guided_search_with_old_typeahead","guided_search_without_categories_bar","guided_search_rollout"]])&&(h+="\n    ",h+=d.suppressValue((f=20,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["guided"])),a.autoesc),h+="\n"),h+="\n\n";
var p;f=23,g=64,p=d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiences",a.autoesc),"is_placed_experience",a.autoesc),'context["experience"]["is_placed_"]',["WEB_PIN_CLOSEUP","WEB_PIN_CLOSEUP_LITE"]),c.set("first_pin_create",p),c.parent||(b.setVariable("first_pin_create",p),b.addExport("first_pin_create")),h+="\n";var q;f=24,g=67,q=d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiences",a.autoesc),"is_placed_experience",a.autoesc),'context["experience"]["is_placed_"]',["WEB_PIN_CLOSEUP","WEB_PIN_CLOSEUP_AUTOBAHN"]),c.set("autobahn_pin_create",q),c.parent||(b.setVariable("autobahn_pin_create",q),b.addExport("autobahn_pin_create")),h+="\n";var r;f=25,g=70,r=d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiences",a.autoesc),"is_placed_experience",a.autoesc),'context["experience"]["is_placed_"]',["WEB_PIN_SUCCESS","WEB_FIRST_PIN_SUCCESS"]),c.set("show_first_pin_success",r),c.parent||(b.setVariable("show_first_pin_success",r),b.addExport("show_first_pin_success")),h+="\n";var s;s=!1,c.set("show_pin_tip",s),c.parent||(b.setVariable("show_pin_tip",s),b.addExport("show_pin_tip")),h+="\n";var t;t=p||q,c.set("pin_lite",t),c.parent||(b.setVariable("pin_lite",t),b.addExport("pin_lite")),h+="\n";var u;f=28,g=33,u=d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["canonical_pin"]),c.set("canonical_pin_data",u),c.parent||(b.setVariable("canonical_pin_data",u),b.addExport("canonical_pin_data")),h+="\n";var v;f=29,g=25,v=d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["access",[]]),c.set("pin_access",v),c.parent||(b.setVariable("pin_access",v),b.addExport("pin_access")),h+="\n\n";var w;w=!1,c.set("can_edit",w),c.parent||(b.setVariable("can_edit",w),b.addExport("can_edit")),h+="\n",(a.getFilter("contains").call(b,v,"write")||a.getFilter("contains").call(b,v,"delete"))&&(h+="\n    ",w=!0,c.set("can_edit",w),c.parent||(b.setVariable("can_edit",w),b.addExport("can_edit")),h+="\n"),h+="\n\n",t&&(h+="\n    ",(r||p)&&(h+="\n        ",s=!0,c.set("show_pin_tip",s),c.parent||(b.setVariable("show_pin_tip",s),b.addExport("show_pin_tip")),h+="\n    "),h+="\n    ",h+=d.suppressValue((f=40,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{lite:!0,showPinTip:s}])),a.autoesc),h+="\n    ",h+=d.suppressValue((f=41,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["lite"])),a.autoesc),h+="\n"),h+="\n\n",k||(h+="\n    ",d.memberLookup(i,"images",a.autoesc)&&d.memberLookup(d.memberLookup(i,"images",a.autoesc),"orig",a.autoesc)&&(h+="\n        ",k=d.memberLookup(d.memberLookup(d.memberLookup(i,"images",a.autoesc),"orig",a.autoesc),"url",a.autoesc),c.set("link",k),c.parent||(b.setVariable("link",k),b.addExport("link")),h+="\n    "),h+="\n    ",k&&(h+="\n        ",n=!0,c.set("has_fullsize_image",n),c.parent||(b.setVariable("has_fullsize_image",n),b.addExport("has_fullsize_image")),h+="\n    "),h+="\n"),h+="\n";var x;x=d.memberLookup(i,"repin_count",a.autoesc),c.set("repin_count",x),c.parent||(b.setVariable("repin_count",x),b.addExport("repin_count")),h+="\n";var y;y=d.memberLookup(i,"like_count",a.autoesc),c.set("like_count",y),c.parent||(b.setVariable("like_count",y),b.addExport("like_count")),h+="\n\n";var z;if(f=55,g=62,z=d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["denzel_new_repin_flow2",["enabled","repin_only"]]),c.set("new_repin_flow",z),c.parent||(b.setVariable("new_repin_flow",z),b.addExport("new_repin_flow")),h+="\n",z){h+="\n    ";var A;A="PinCreate2",c.set("submodule_name",A),c.parent||(b.setVariable("submodule_name",A),b.addExport("submodule_name")),h+="\n    ";var B;B="repin2",c.set("submodule_field_set_key",B),c.parent||(b.setVariable("submodule_field_set_key",B),b.addExport("submodule_field_set_key")),h+="\n    ";var C;C=!0,c.set("transparent_modal",C),c.parent||(b.setVariable("transparent_modal",C),b.addExport("transparent_modal")),h+="\n    ";var D;D={container_class:"pinCreate2Modal"},c.set("extra_options",D),c.parent||(b.setVariable("extra_options",D),b.addExport("extra_options")),h+="\n"}else h+="\n    ",A="PinCreate",c.set("submodule_name",A),c.parent||(b.setVariable("submodule_name",A),b.addExport("submodule_name")),h+="\n    ",B="repin",c.set("submodule_field_set_key",B),c.parent||(b.setVariable("submodule_field_set_key",B),b.addExport("submodule_field_set_key")),h+="\n    ",C=!1,c.set("transparent_modal",C),c.parent||(b.setVariable("transparent_modal",C),b.addExport("transparent_modal")),h+="\n    ",D={},c.set("extra_options",D),c.parent||(b.setVariable("extra_options",D),b.addExport("extra_options")),h+="\n";h+='\n\n<div class="repinLike">\n    ';var E;E=" pinActionBarButton",c.set("pin_action_bar_button_classname",E),c.parent||(b.setVariable("pin_action_bar_button_classname",E),b.addExport("pin_action_bar_button_classname")),h+="\n    ";var F;F="medium",c.set("action_bar_button_size",F),c.parent||(b.setVariable("action_bar_button_size",F),b.addExport("action_bar_button_size")),h+="\n    ";var G;G="repinLikeNavigateButton ",c.set("baseIncrementButtonClass",G),c.parent||(b.setVariable("baseIncrementButtonClass",G),b.addExport("baseIncrementButtonClass")),h+="\n    ";var H;H=G,c.set("repinIncrementButtonClass",H),c.parent||(b.setVariable("repinIncrementButtonClass",H),b.addExport("repinIncrementButtonClass")),h+="\n    ";var I;I=G,c.set("likeIncrementButtonClass",I),c.parent||(b.setVariable("likeIncrementButtonClass",I),b.addExport("likeIncrementButtonClass")),h+="\n\n    ";var J;J="repin",c.set("repin_class_name",J),c.parent||(b.setVariable("repin_class_name",J),b.addExport("repin_class_name")),h+="\n    ",!x||u||t||(h+="\n        ",J+=" leftRounded",c.set("repin_class_name",J),c.parent||(b.setVariable("repin_class_name",J),b.addExport("repin_class_name")),h+="\n    "),h+="\n\n    ";var K;K="primary",c.set("repin_color",K),c.parent||(b.setVariable("repin_color",K),b.addExport("repin_color")),h+="\n    ";var L;L=!0,c.set("repin_primary_on_hover",L),c.parent||(b.setVariable("repin_primary_on_hover",L),b.addExport("repin_primary_on_hover")),h+="\n    ";var M;M=!1,c.set("repin_show_text",M),c.parent||(b.setVariable("repin_show_text",M),b.addExport("repin_show_text")),h+="\n    ";var N;if(f=84,g=23,N=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pin it"]),c.set("repin_text",N),c.parent||(b.setVariable("repin_text",N),b.addExport("repin_text")),h+="\n    ",d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc)&&"ja"==d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"locale",a.autoesc)&&(h+="\n        ",M=!0,c.set("repin_show_text",M),c.parent||(b.setVariable("repin_show_text",M),b.addExport("repin_show_text")),h+="\n    "),h+="\n\n    ",H+=J,c.set("repinIncrementButtonClass",H),c.parent||(b.setVariable("repinIncrementButtonClass",H),b.addExport("repinIncrementButtonClass")),h+="\n    ",h+="\n\n    ",h+=d.suppressValue((f=92,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ShowModalButton",d.makeKeywordArgs({id:"pinItButton",options:{ga_category:"repin_create_closeup",class_name:J+E,color:K,primary_on_hover:L,has_icon:!0,show_text:M,text:N,require_auth:!0,require_auth_params:{action:"pinit"},size:F,log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"PIN_REPIN_BUTTON",a.autoesc),extra_options:D,submodule:{name:A,resource:{name:"PinResource",options:{id:j,field_set_key:B}},options:{action:"repin",is_video:d.memberLookup(i,"is_video",a.autoesc),transparent_modal:C},error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"SHOW",a.autoesc)}}})])),a.autoesc),h+="\n\n    ",u||(h+="\n        ",h+=d.suppressValue((f=128,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["IncrementingNavigateButton",d.makeKeywordArgs({id:"repinsButton",options:{url:"/pin/"+j+"/repins/",color:K,actionCount:x,class_name:"repinLikeNavigateButton"+E,siblingButtonId:"pinItButton",size:"medium",text:x,log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"REPINS_BUTTON",a.autoesc)}})])),a.autoesc),h+="\n    "),h+="\n\n    ",y&&!u){h+="\n        ";var O;O="like leftRounded",c.set("like_class_name",O),c.parent||(b.setVariable("like_class_name",O),b.addExport("like_class_name")),h+="\n    "}else h+="\n        ",O="like",c.set("like_class_name",O),c.parent||(b.setVariable("like_class_name",O),b.addExport("like_class_name")),h+="\n    ";h+="\n    ",I+=O,c.set("likeIncrementButtonClass",I),c.parent||(b.setVariable("likeIncrementButtonClass",I),b.addExport("likeIncrementButtonClass")),h+="\n    ",h+="\n    ";var P;if(P=d.memberLookup(i,"liked_by_me",a.autoesc),c.set("liked",P),c.parent||(b.setVariable("liked",P),b.addExport("liked")),h+="\n    ",h+=d.suppressValue((f=152,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["PinLikeButton",d.makeKeywordArgs({id:"likeButton",options:{class_name:O+E,liked:P,size:F,has_icon:!P,pin_id:j}})])),a.autoesc),h+="\n\n    ",u||(h+="\n        ",h+=d.suppressValue((f=165,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["IncrementingNavigateButton",d.makeKeywordArgs({id:"likesButton",options:{siblingButtonId:"likeButton",actionCount:y,url:"/pin/"+j+"/likes/",class_name:I+E,text:y,size:"medium",log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"LIKES_BUTTON",a.autoesc)}})])),a.autoesc),h+="\n    "),h+="\n\n    ",k){h+="\n        ";var Q;Q="website",c.set("btn_class_name",Q),c.parent||(b.setVariable("btn_class_name",Q),b.addExport("btn_class_name")),h+="\n        ";var R;R=n?(f=182,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Image"])):(f=182,g=63,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Visit Site"])),c.set("btn_text",R),c.parent||(b.setVariable("btn_text",R),b.addExport("btn_text")),h+="\n        ";var S;if(S=k,c.set("btn_url",S),c.parent||(b.setVariable("btn_url",S),b.addExport("btn_url")),h+="\n\n        ",f=185,g=19,d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["rich_metadata"])&&(f=185,g=62,d.callWrap(d.memberLookup(d.memberLookup(i,"rich_metadata",a.autoesc),"get",a.autoesc),'pin["rich_metad"]["get"]',["products"]))&&!d.memberLookup(i,"is_promoted",a.autoesc)){h+="\n            ",h+="\n            ";var T;T=d.memberLookup(d.memberLookup(d.memberLookup(i,"rich_metadata",a.autoesc),"products",a.autoesc),0,a.autoesc),c.set("product_data",T),c.parent||(b.setVariable("product_data",T),b.addExport("product_data")),h+="\n            ","ebay.com"==(f=188,g=23,d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["domain"]))&&(f=188,g=68,d.callWrap(d.memberLookup(T,"get",a.autoesc),'product_data["get"]',["purchase_url"]))&&(h+="\n                ",h+="\n                ",f=190,g=36,d.callWrap(d.memberLookup(T,"get",a.autoesc),'product_data["get"]',["offer_summary"])&&(f=190,g=91,d.callWrap(d.memberLookup(d.memberLookup(T,"offer_summary",a.autoesc),"get",a.autoesc),'product_data["offer_summ"]["get"]',["in_stock",!0]))&&(h+="\n                    ",h+="\n                    ",f=192,g=64,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["denzel_buy_button_ebay",["buy_btn_product_link"]])?(h+="\n                        ",Q="primary buy",c.set("btn_class_name",Q),c.parent||(b.setVariable("btn_class_name",Q),b.addExport("btn_class_name")),h+="\n                        ",f=195,g=41,R=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Buy from Site"]),c.set("btn_text",R),c.parent||(b.setVariable("btn_text",R),b.addExport("btn_text")),h+="\n                        ",S=a.getFilter("urlparams").call(b,k,d.makeKeywordArgs({pincsp:"tt.gbuy_desc_page_click"})),c.set("btn_url",S),c.parent||(b.setVariable("btn_url",S),b.addExport("btn_url")),h+="\n                    "):(f=197,g=66,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["denzel_buy_button_ebay",["buy_btn_purchase_link"]])?(h+="\n                        ",Q="primary buy",c.set("btn_class_name",Q),c.parent||(b.setVariable("btn_class_name",Q),b.addExport("btn_class_name")),h+="\n                        ",f=200,g=41,R=d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Buy from Site"]),c.set("btn_text",R),c.parent||(b.setVariable("btn_text",R),b.addExport("btn_text")),h+="\n                        ",S=a.getFilter("urlparams").call(b,d.memberLookup(T,"purchase_url",a.autoesc),d.makeKeywordArgs({pincsp:"tt.gbuy_purchase_page_click"})),c.set("btn_url",S),c.parent||(b.setVariable("btn_url",S),b.addExport("btn_url")),h+="\n                    "):(f=202,g=66,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["denzel_buy_button_ebay",["control"]])&&(h+="\n                        ",Q="website",c.set("btn_class_name",Q),c.parent||(b.setVariable("btn_class_name",Q),b.addExport("btn_class_name")),h+="\n                        ",R=n?(f=205,g=41,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Image"])):(f=205,g=79,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Visit Site"])),c.set("btn_text",R),c.parent||(b.setVariable("btn_text",R),b.addExport("btn_text")),h+="\n                        ",S=a.getFilter("urlparams").call(b,k,d.makeKeywordArgs({pincsp:"tt.gwebsite_click"})),c.set("btn_url",S),c.parent||(b.setVariable("btn_url",S),b.addExport("btn_url")),h+="\n                    "))),h+="\n                "),h+="\n            "),h+="\n        "}h+="\n\n        ",h+=d.suppressValue((f=212,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["NavigateButton",d.makeKeywordArgs({id:"viewPinSource",options:{class_name:Q+E,element_type:"a",has_icon:!0,size:F,text:R,safe_link_pin_id:j,url:S,log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"WEBSITE_BUTTON",a.autoesc),nofollow:!0}})])),a.autoesc),h+="\n    "}if(h+='\n</div>\n\n<div class="shareGear">\n    ',w&&(h+="\n        ",h+=d.suppressValue((f=231,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ShowModalButton",d.makeKeywordArgs({id:"editButton",options:{object_id:j,text:(f=236,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Edit"])),ga_category:"pin_edit_closeup",class_name:"pinEditDark"+E,size:"medium",has_icon:!0,log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"PIN_EDIT_BUTTON",a.autoesc),submodule:{name:"PinEdit",resource:{name:"PinResource",options:{id:j,field_set_key:"edit"}},options:{next_url:"/pin/"+j+"/edit/"}}}})])),a.autoesc),h+="\n    "),h+="\n    ","secret"!=(f=258,g=15,d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["privacy"]))){if(h+="\n        ",d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc)&&(f=259,g=45,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["username"]))){h+="\n            ";var U;U=d.memberLookup(i,"description",a.autoesc),c.set("description",U),c.parent||(b.setVariable("description",U),b.addExport("description")),h+="\n            ";var V;if(V="/pin/"+j+"/",c.set("pin_url",V),c.parent||(b.setVariable("pin_url",V),b.addExport("pin_url")),h+="\n            ",f=262,g=55,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_group",a.autoesc),'context["experiment"]["in_experim"]',["conversations","employees"])){h+="\n                ";var W;W={name:"SendPin2",options:{object_id:j,object_image_url:d.memberLookup(m,"url",a.autoesc),object_description:U,object_url:V}},c.set("send_module",W),c.parent||(b.setVariable("send_module",W),b.addExport("send_module")),h+="\n            "}else h+="\n                ",W={name:"SendPin",options:{object_id:j,object_image_url:d.memberLookup(m,"url",a.autoesc),object_description:U,object_url:V},resource:{name:"RecentContactsResource",options:{field_set_key:"default"}}},c.set("send_module",W),c.parent||(b.setVariable("send_module",W),b.addExport("send_module")),h+="\n            ";h+="\n            ",h+=d.suppressValue((f=289,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["DropdownButton",d.makeKeywordArgs({data:d.contextOrFrameLookup(b,c,"data"),options:{size:F,class_name:"send"+E,has_icon:!0,text:(f=296,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Send"])),log_element_type:d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"PIN_SEND_BUTTON",a.autoesc),dropdown_options:{largeCaret:!0,manually_close:!0,fixed:!1,position_point:"BOTTOM_RIGHT",view_type:"closeupShare",display_while_loading:!0},module:W,check_write_banned:!0}})])),a.autoesc),h+="\n        "}h+="\n    "}h+="\n    ",V="/pin/"+j+"/",c.set("pin_url",V),c.parent||(b.setVariable("pin_url",V),b.addExport("pin_url")),h+="\n    ";var X;f=313,g=62,X=d.callWrap(d.memberLookup((f=313,g=46,d.callWrap(d.memberLookup((f=313,g=28,d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["images",{}])),"get",a.autoesc),'the return value of (pin["get"])["get"]',["236x",{}])),"get",a.autoesc),'the return value of (the return value of (pin["get"])["get"])["get"]',["url"]),c.set("pin_image",X),c.parent||(b.setVariable("pin_image",X),b.addExport("pin_image")),h+="\n    ";var Y;f=314,g=34,Y=d.callWrap(d.memberLookup(i,"get",a.autoesc),'pin["get"]',["description"]),c.set("pin_description",Y),c.parent||(b.setVariable("pin_description",Y),b.addExport("pin_description")),h+="\n\n    ",h+=d.suppressValue((f=316,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["FacebookShareButton",d.makeKeywordArgs({options:{object_id:j,text:(f=320,g=21,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Share"])),dialog_options:{object_type:"pin",object_id:j,description:d.memberLookup(i,"description",a.autoesc),path:V,picture:X},ga_category:"pin_share_facebook",class_name:"facebookShare"+E,size:"medium"}})])),a.autoesc),h+="\n</div>\n",e(null,h)}catch(Z){e(d.handleError(Z,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinCreate/PinCreate.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data"),c.set("pin",i),c.parent||(b.setVariable("pin",i),b.addExport("pin")),h+="\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"action",a.autoesc),c.set("action",j),c.parent||(b.setVariable("action",j),b.addExport("action")),h+="\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"description",a.autoesc),c.set("description",k),c.parent||(b.setVariable("description",k),b.addExport("description")),h+="\n\n","fluid"==d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=19,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["fluid","inModal"])),a.autoesc),h+="\n"),h+="\n\n";var l;if(l=!0,c.set("show_cancel_button",l),c.parent||(b.setVariable("show_cancel_button",l),b.addExport("show_cancel_button")),h+="\n","create"==j&&k){h+="\n    ",h+="\n    ";var m;m=500,c.set("MAX_DESCRIPTION_LENGTH",m),c.parent||(b.setVariable("MAX_DESCRIPTION_LENGTH",m),b.addExport("MAX_DESCRIPTION_LENGTH")),h+="\n    ";var n;n=m-3,c.set("TRUNCATE_AT",n),c.parent||(b.setVariable("TRUNCATE_AT",n),b.addExport("TRUNCATE_AT")),h+="\n    ",k=a.getFilter("truncate").call(b,k,n),c.set("description",k),c.parent||(b.setVariable("description",k),b.addExport("description")),h+="\n"}else"pin_create_ignition"==j&&(h+="\n    ",l=!1,c.set("show_cancel_button",l),c.parent||(b.setVariable("show_cancel_button",l),b.addExport("show_cancel_button")),h+="\n");h+="\n\n",h+="\n";var o;o=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_video",a.autoesc),c.set("is_video_option",o),c.parent||(b.setVariable("is_video_option",o),b.addExport("is_video_option")),h+="\n";var p;p=i&&d.memberLookup(i,"is_video",a.autoesc)||o&&"false"!=o,c.set("is_video",p),c.parent||(b.setVariable("is_video",p),b.addExport("is_video")),h+="\n\n",h+=d.suppressValue((f=39,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"include_data"),"include_data",["id"])),a.autoesc),h+="\n\n",h+=d.suppressValue((f=41,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["PinForm",d.makeKeywordArgs({data:i,id:"pinForm",options:{cancel_text:(f=45,g=24,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Close"])),description:a.getFilter("default").call(b,k,""),heading:(f=47,g=20,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pick a board"])),image_url:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"image_url",a.autoesc),""),default_board_id:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"default_board_id",a.autoesc),""),is_video:p,link:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"link",a.autoesc),""),show_uploader:!1,pin_it_script_button:!0,show_cancel_button:l},resource:d.contextOrFrameLookup(b,c,"resource"),error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"BUBBLE",a.autoesc)})])),a.autoesc),h+="\n",e(null,h)}catch(q){e(d.handleError(q,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinCreate2/PinCreate2.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/image.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("image_tag"))return void e(new Error("cannot import 'image_tag'"));var k=j.image_tag;b.setVariable("image_tag",k),h+="\n\n";var l;if(l=d.contextOrFrameLookup(b,c,"data")||{},c.set("pin",l),c.parent||(b.setVariable("pin",l),b.addExport("pin")),h+="\n\n",l){h+="\n    ";var m;m=!0,c.set("autofocus_board",m),c.parent||(b.setVariable("autofocus_board",m),b.addExport("autofocus_board")),h+="\n    ";var n;n=!1,c.set("autofocus_description",n),c.parent||(b.setVariable("autofocus_description",n),b.addExport("autofocus_description")),h+="\n"}else h+="\n    ",m=!1,c.set("autofocus_board",m),c.parent||(b.setVariable("autofocus_board",m),b.addExport("autofocus_board")),h+="\n    ",n=!0,c.set("autofocus_description",n),c.parent||(b.setVariable("autofocus_description",n),b.addExport("autofocus_description")),h+="\n";h+="\n\n";var o;f=25,g=26,o=d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["description"])||(f=26,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["description",""])),c.set("description",o),c.parent||(b.setVariable("description",o),b.addExport("description")),h+="\n";var p;f=27,g=19,p=d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["link"])||(f=28,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["link",""])),c.set("link",p),c.parent||(b.setVariable("link",p),b.addExport("link")),h+="\n";var q;f=29,g=34,q=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["is_video"]),c.set("is_video_option",q),c.parent||(b.setVariable("is_video_option",q),b.addExport("is_video_option")),h+="\n";var r;f=30,g=23,r=d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["is_video"])||q&&"false"!=q,c.set("is_video",r),c.parent||(b.setVariable("is_video",r),b.addExport("is_video")),h+="\n";var s;f=32,g=58,s=d.callWrap(d.memberLookup((f=32,g=42,d.callWrap(d.memberLookup((f=32,g=24,d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["images",{}])),"get",a.autoesc),'the return value of (pin["get"])["get"]',["236x",{}])),"get",a.autoesc),'the return value of (the return value of (pin["get"])["get"])["get"]',["url"])||(f=33,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["image_url"])),c.set("image_url",s),c.parent||(b.setVariable("image_url",s),b.addExport("image_url")),h+="\n";var t;f=34,g=30,t=d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["pinned_to_board",{}]),c.set("pinned_to_board",t),c.parent||(b.setVariable("pinned_to_board",t),b.addExport("pinned_to_board")),h+="\n\n",h+="\n";var u;f=37,g=35,u=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_suggestions",!1]),c.set("show_suggestions",u),c.parent||(b.setVariable("show_suggestions",u),b.addExport("show_suggestions")),h+="\n";var v;v=l?(f=38,g=37,d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["id"])):d.contextOrFrameLookup(b,c,"none"),c.set("pin_id_for_suggestions",v),c.parent||(b.setVariable("pin_id_for_suggestions",v),b.addExport("pin_id_for_suggestions")),h+="\n",u||(h+="\n    ",v=d.contextOrFrameLookup(b,c,"none"),c.set("pin_id_for_suggestions",v),c.parent||(b.setVariable("pin_id_for_suggestions",v),b.addExport("pin_id_for_suggestions")),h+="\n"),h+="\n\n",h+=d.suppressValue((f=43,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"include_data"),"include_data",["id"])),a.autoesc),h+="\n",h+=d.suppressValue((f=44,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{link:p,isVideo:r,imageUrl:s}])),a.autoesc),h+="\n\n","fluid"==(f=49,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type"]))&&(h+="\n    ",h+=d.suppressValue((f=50,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["fluid","inModal"])),a.autoesc),h+="\n"),h+="\n\n";var w;w=85,c.set("image_width",w),c.parent||(b.setVariable("image_width",w),b.addExport("image_width")),h+="\n";var x;x=85,c.set("image_height",x),c.parent||(b.setVariable("image_height",x),b.addExport("image_height")),h+="\n";var y;f=55,g=63,y=d.callWrap(d.memberLookup((f=55,g=47,d.callWrap(d.memberLookup((f=55,g=29,d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["images",{}])),"get",a.autoesc),'the return value of (pin["get"])["get"]',["236x",{}])),"get",a.autoesc),'the return value of (the return value of (pin["get"])["get"])["get"]',["width"]),c.set("original_width",y),c.parent||(b.setVariable("original_width",y),b.addExport("original_width")),h+="\n";var z;f=56,g=64,z=d.callWrap(d.memberLookup((f=56,g=48,d.callWrap(d.memberLookup((f=56,g=30,d.callWrap(d.memberLookup(l,"get",a.autoesc),'pin["get"]',["images",{}])),"get",a.autoesc),'the return value of (pin["get"])["get"]',["236x",{}])),"get",a.autoesc),'the return value of (the return value of (pin["get"])["get"])["get"]',["height"]),c.set("original_height",z),c.parent||(b.setVariable("original_height",z),b.addExport("original_height")),h+="\n",y&&z&&(h+="\n    ",y>z?(h+="\n        ",x=z*w/y,c.set("image_height",x),c.parent||(b.setVariable("image_height",x),b.addExport("image_height")),h+="\n    "):(h+="\n        ",w=y*x/z,c.set("image_width",w),c.parent||(b.setVariable("image_width",w),b.addExport("image_width")),h+="\n    "),h+="\n"),h+="\n\n";var A;A=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_url",a.autoesc)||d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_url",a.autoesc),c.set("has_social_share_options",A),c.parent||(b.setVariable("has_social_share_options",A),b.addExport("has_social_share_options")),h+="\n";var B;if(B=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_url",a.autoesc)&&d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_url",a.autoesc),c.set("has_both_social_share_options",B),c.parent||(b.setVariable("has_both_social_share_options",B),b.addExport("has_both_social_share_options")),h+='\n\n<form>\n    <h1 class="title">',h+=d.suppressValue((f=69,g=24,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pick a board"])),a.autoesc),h+='</h1>\n    <div class="pinPreview">\n        <div class="pinPreviewImg">\n            ',h+=d.suppressValue((f=72,g=22,d.callWrap(k,"image_tag",[d.makeKeywordArgs({src:s,height:x,width:w})])),a.autoesc),h+='\n        </div>\n        <div class="pinDescription',A&&(h+=" withSocialShareOptions"),h+='">\n            ',h+=d.suppressValue((f=75,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"pinDescriptionField",options:{id:"pinDescriptionField",name:"description",value:o,placeholder:(f=81,g=36,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add a short description to your pin"])),autofocus:n,mentions:!0}})])),a.autoesc),h+="\n        </div>\n        ",A){if(h+='\n            <div class="socialShareOptions',B&&(h+=" both"),h+='">\n                ',d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_url",a.autoesc)){h+="\n                    ";var C;C=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_publish_enabled",a.autoesc),c.set("twitter_publish_enabled",C),c.parent||(b.setVariable("twitter_publish_enabled",C),b.addExport("twitter_publish_enabled")),h+='\n                    <div class="twitterInputWrapper">\n                        <label class="twitterInput">\n                            ',h+=d.suppressValue((f=93,g=35,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{name:"share_twitter",class_name:"twitter",checked:C,view_type:"fancyCheckbox"}})])),a.autoesc),h+="\n                        </label>\n                    </div>\n                "}if(h+="\n                ",d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_url",a.autoesc)){h+="\n                    ";var D;D=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_publish_stream_enabled",a.autoesc),c.set("facebook_stream_enabled",D),c.parent||(b.setVariable("facebook_stream_enabled",D),b.addExport("facebook_stream_enabled")),h+='\n                    <div class="facebookInputWrapper">\n                        <label class="facebookInput">\n                            ',h+=d.suppressValue((f=106,g=35,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{name:"share_facebook",class_name:"facebook",checked:D,view_type:"fancyCheckbox"}})])),a.autoesc),h+="\n                        </label>\n                    </div>\n                "}h+="\n            </div>\n        "}h+="\n    </div>\n    ",h+=d.suppressValue((f=118,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardPicker2",d.makeKeywordArgs({id:"boardPicker2",resource:(f=120,g=34,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["BoardPickerBoardsResource",d.makeKeywordArgs({options:{filter:(f=122,g=43,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["board_filter","all"])),default_board_id:(f=123,g=53,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["default_board_id"])),field_set_key:"board_picker2",pin_id_for_suggestions:v}})])),options:{has_social_share_options:A,pinned_to_board:t,autofocus_board:m},error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"BUBBLE",a.autoesc)})])),a.autoesc),h+="\n</form>\n",e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinCreateSuccessBoardEdit/PinCreateSuccessBoardEdit.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n",h+=d.suppressValue((f=1,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["BoardEditBase"])),a.autoesc),h+="\n",h+=d.suppressValue((f=2,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"include_data"),"include_data",["id","board","owner","privacy"])),a.autoesc),h+="\n\n";
var i;i=d.contextOrFrameLookup(b,c,"invites_will_be_pending")||!1,c.set("invites_will_be_pending",i),c.parent||(b.setVariable("invites_will_be_pending",i),b.addExport("invites_will_be_pending")),h+="\n";var j;j=d.contextOrFrameLookup(b,c,"map_view_checked")||d.contextOrFrameLookup(b,c,"map_view_checked"),c.set("map_view_checked",j),c.parent||(b.setVariable("map_view_checked",j),b.addExport("map_view_checked")),h+="\n";var k;k=d.contextOrFrameLookup(b,c,"async")||!1,c.set("async",k),c.parent||(b.setVariable("async",k),b.addExport("async")),h+='\n\n<div class="standardForm">\n    <h1>';var l=d.makeMacro([],[],function(e){c=c.push(),e=e||{};var h,i="";return h={name:d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"name",a.autoesc)},c.set("__dict",h),c.parent||b.setVariable("__dict",h),i+=d.suppressValue((f=9,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"_interpolate"),"_interpolate",[(f=9,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["<span>You just made a new board:</span> {{ name }}"])),h])),a.autoesc),c=c.pop(),new d.SafeString(i)});b.setVariable("_doTranslation",l),h+=d.suppressValue((f=9,g=9,d.callWrap(l,"_doTranslation",[])),a.autoesc),h+='</h1>\n\n    <ul>\n        <li>\n            <h3><label for="place">',h+=d.suppressValue((f=13,g=37,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add a map?"])),a.autoesc),h+="</label></h3>\n            <div>\n                ",h+=d.suppressValue((f=15,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({id:"placeLayoutCheckbox",options:{name:"layout",checked:j,disabled:!1,view_type:"fancyToggle"}})])),a.autoesc),h+="\n            </div>\n        </li>\n        <li>\n            <h3>\n                <label>",h+=d.suppressValue((f=28,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Invite friends to Pin"])),a.autoesc),h+='</label>\n                <a href="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"settings"),"HELP_BOARD_INVITE_URL",a.autoesc),a.autoesc),h+='" class="learnMore learnAboutBoardInvites">\n                    ',h+=d.suppressValue((f=30,g=22,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Learn more"])),a.autoesc),h+="\n                </a>\n            </h3>\n            <div>\n                ",h+=d.suppressValue((f=34,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardInviteForm",d.makeKeywordArgs({id:"boardInviteForm",options:{board_id:d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"id",a.autoesc),email_supported:!0,fillWidth:!0,pending:i,field_options:{view_type:"userSelect",tags:"pinners_and_contacts",template:"userSelect"}}})])),a.autoesc),h+='\n                <div class="boardInvites">\n                    ',h+=d.suppressValue((f=49,g=27,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardInvites",d.makeKeywordArgs({id:"boardInvites",resource:(f=51,g=48,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["BoardInvitesResource",d.makeKeywordArgs({options:{board_id:d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"id",a.autoesc),sort:"viewer_first",field_set_key:"boardEdit",status_filters:"new,accepted",include_inactive:!0}})])),async:k})])),a.autoesc),h+='\n                </div>\n            </div>\n        </li>\n    </ul>\n\n    <div class="formFooter">\n        <div class="formFooterButtons">\n            ',h+=d.suppressValue((f=69,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"doneButton",options:{color:"primary",size:"small",cancelButton:!0,text:(f=75,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Done"]))}})])),a.autoesc),h+="\n        </div>\n    </div>\n</div>\n",e(null,h)}catch(m){e(d.handleError(m,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinDupWarning/PinDupWarning.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{a.getTemplate("templates/macros/link.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("link_markup"))return void e(new Error("cannot import 'link_markup'"));var k=j.link_markup;b.setVariable("link_markup",k),h+="\n\n";var l;if(l=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"pinned_to_board",a.autoesc),c.set("board",l),c.parent||(b.setVariable("board",l),b.addExport("board")),h+="\n",l){h+='\n    <div class="pinnedToBoardWarning">\n        <strong>',h+=d.suppressValue((f=5,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pssst!"])),a.autoesc),h+="</strong>\n        ";var m=d.makeMacro([],[],function(e){c=c.push(),e=e||{};var h,i="";return h={link:(f=6,g=31,d.callWrap(k,"link_markup",[d.memberLookup(l,"url",a.autoesc),d.memberLookup(l,"name",a.autoesc)]))},c.set("__dict",h),c.parent||b.setVariable("__dict",h),i+=d.suppressValue((f=6,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"_interpolate"),"_interpolate",[(f=6,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Looks like this is already on {{ link }}."])),h])),a.autoesc),c=c.pop(),new d.SafeString(i)});b.setVariable("_doTranslation",m),h+=d.suppressValue((f=6,g=9,d.callWrap(m,"_doTranslation",[])),a.autoesc),h+="\n    </div>\n"}h+="\n",e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PinForm/PinForm.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;if(i=d.contextOrFrameLookup(b,c,"data"),c.set("pin",i),c.parent||(b.setVariable("pin",i),b.addExport("pin")),h+="\n",h+=d.suppressValue((f=27,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-component-type":"MODAL_REPIN"}])),a.autoesc),h+="\n",i){h+="\n    ";var j;j=d.memberLookup(i,"id",a.autoesc),c.set("pin_id",j),c.parent||(b.setVariable("pin_id",j),b.addExport("pin_id")),h+="\n    ";var k;k=d.memberLookup(i,"description",a.autoesc),c.set("description",k),c.parent||(b.setVariable("description",k),b.addExport("description")),h+="\n    ",h+="\n    ";var l;l=d.memberLookup(i,"images",a.autoesc)&&d.memberLookup(d.memberLookup(i,"images",a.autoesc),"236x",a.autoesc)&&d.memberLookup(d.memberLookup(d.memberLookup(i,"images",a.autoesc),"236x",a.autoesc),"url",a.autoesc),c.set("image_url",l),c.parent||(b.setVariable("image_url",l),b.addExport("image_url")),h+="\n    ";var m;m=d.memberLookup(i,"is_video",a.autoesc),c.set("is_video",m),c.parent||(b.setVariable("is_video",m),b.addExport("is_video")),h+="\n    ";var n;n=d.memberLookup(i,"link",a.autoesc),c.set("link",n),c.parent||(b.setVariable("link",n),b.addExport("link")),h+="\n    ";var o;o=d.memberLookup(i,"place_summary",a.autoesc),c.set("place",o),c.parent||(b.setVariable("place",o),b.addExport("place")),h+="\n"}else h+="\n    ",j=d.contextOrFrameLookup(b,c,"none"),c.set("pin_id",j),c.parent||(b.setVariable("pin_id",j),b.addExport("pin_id")),h+="\n    ",k=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"description",a.autoesc),""),c.set("description",k),c.parent||(b.setVariable("description",k),b.addExport("description")),h+="\n    ",l=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"image_url",a.autoesc),""),c.set("image_url",l),c.parent||(b.setVariable("image_url",l),b.addExport("image_url")),h+="\n    ",m=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_video",a.autoesc),!1),c.set("is_video",m),c.parent||(b.setVariable("is_video",m),b.addExport("is_video")),h+="\n    ",n=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"link",a.autoesc),""),c.set("link",n),c.parent||(b.setVariable("link",n),b.addExport("link")),h+="\n    ",o={},c.set("place",o),c.parent||(b.setVariable("place",o),b.addExport("place")),h+="\n";h+="\n\n";var p;p=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_link",a.autoesc),c.set("show_link",p),c.parent||(b.setVariable("show_link",p),b.addExport("show_link")),h+="\n";var q;q=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_place",a.autoesc)&&i,c.set("show_place",q),c.parent||(b.setVariable("show_place",q),b.addExport("show_place")),h+="\n";var r;r=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"writable",a.autoesc),!0),c.set("writable",r),c.parent||(b.setVariable("writable",r),b.addExport("writable")),h+="\n";var s;if(s=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_place",a.autoesc)&&i&&r,c.set("can_delete_place",s),c.parent||(b.setVariable("can_delete_place",s),b.addExport("can_delete_place")),h+="\n",d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc)){h+="\n    ";var t;t=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_id",a.autoesc),c.set("facebook_id",t),c.parent||(b.setVariable("facebook_id",t),b.addExport("facebook_id")),h+="\n    ";var u;u=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_url",a.autoesc),c.set("facebook_url",u),c.parent||(b.setVariable("facebook_url",u),b.addExport("facebook_url")),h+="\n    ";var v;v=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_timeline_enabled",a.autoesc),c.set("facebook_timeline_enabled",v),c.parent||(b.setVariable("facebook_timeline_enabled",v),b.addExport("facebook_timeline_enabled")),h+="\n    ";var w;w=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"facebook_publish_stream_enabled",a.autoesc),c.set("facebook_stream_enabled",w),c.parent||(b.setVariable("facebook_stream_enabled",w),b.addExport("facebook_stream_enabled")),h+="\n    ";var x;x=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_url",a.autoesc),c.set("twitter_url",x),c.parent||(b.setVariable("twitter_url",x),b.addExport("twitter_url")),h+="\n    ";var y;y=d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"twitter_publish_enabled",a.autoesc),c.set("twitter_publish_enabled",y),c.parent||(b.setVariable("twitter_publish_enabled",y),b.addExport("twitter_publish_enabled")),h+="\n    ",h+=d.suppressValue((f=56,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{facebookId:t,facebookUrl:u,facebookTimelineEnabled:v,facebookStreamEnabled:w,twitterUrl:x,twitterPublishEnabled:y}])),a.autoesc),h+="\n"}if(h+='\n\n<form class="standardForm" method="post">\n    <h1 class="pinFormHeader">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"heading",a.autoesc),a.autoesc),h+="</h1>\n\n    ",h+=d.suppressValue((f=68,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["PinDupWarning",d.makeKeywordArgs({data:{pinned_to_board:d.memberLookup(i,"pinned_to_board",a.autoesc)},resource:(f=72,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["PinResource",d.makeKeywordArgs({options:{id:j,field_set_key:"faster_repin"}})]))})])),a.autoesc),h+="\n\n    ",h+=d.suppressValue((f=80,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.PinPreview",d.makeKeywordArgs({id:"pinPreview",options:{image_url:l,is_video:m}})])),a.autoesc),h+="\n\n    <ul>\n        ",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_pinner",a.autoesc)){h+="\n            <li>\n                <h3><label>",h+=d.suppressValue((f=91,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pinner"])),a.autoesc),h+="</label></h3>\n                <div>\n                    ";var z;z=d.memberLookup(i,"pinner",a.autoesc),c.set("pinner",z),c.parent||(b.setVariable("pinner",z),b.addExport("pinner")),h+="\n                    ";var A;A="/"+d.memberLookup(z,"username",a.autoesc)+"/",c.set("pinner_url",A),c.parent||(b.setVariable("pinner_url",A),b.addExport("pinner_url")),h+='\n                    <a href="',h+=d.suppressValue(A,a.autoesc),h+='">\n                        <img src="',h+=d.suppressValue(d.memberLookup(z,"image_small_url",a.autoesc),a.autoesc),h+='" />\n                    </a>\n                    <a href="',h+=d.suppressValue(A,a.autoesc),h+='">\n                        ',h+=d.suppressValue(d.memberLookup(z,"full_name",a.autoesc),a.autoesc),h+="\n                    </a>\n                </div>\n            </li>\n        "}h+='\n        <li class="boardWrapper">\n            <h3><label>',h+=d.suppressValue((f=105,g=25,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Board"])),a.autoesc),h+="</label></h3>\n            <div>\n                ";var B;if(B=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"default_board_id",a.autoesc),c.set("default_board_id",B),c.parent||(b.setVariable("default_board_id",B),b.addExport("default_board_id")),h+="\n                ",B){h+="\n                    ";var C;C="alphabetical",c.set("board_sort",C),c.parent||(b.setVariable("board_sort",C),b.addExport("board_sort")),h+="\n                "}else h+="\n                    ",C=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"board_sort",a.autoesc),"board_picker"),c.set("board_sort",C),c.parent||(b.setVariable("board_sort",C),b.addExport("board_sort")),h+="\n                ";if(h+="\n                ",p){h+="\n                    ";var D;D="large",c.set("size",D),c.parent||(b.setVariable("size",D),b.addExport("size")),h+="\n                "}else h+="\n                    ",D="medium",c.set("size",D),c.parent||(b.setVariable("size",D),b.addExport("size")),h+="\n                ";if(h+="\n                ",h+=d.suppressValue((f=118,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["BoardPickerOld",d.makeKeywordArgs({id:"boardPicker",options:{default_board_id:a.getFilter("default").call(b,B,""),size:D,disabled:!r},resource:(f=125,g=44,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["BoardsResource",d.makeKeywordArgs({options:{username:d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"username",a.autoesc),filter:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"board_filter",a.autoesc),"all"),field_set_key:"board_picker",sort:C,default_board_id:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"default_board_id",a.autoesc)}})])),error_strategy:d.memberLookup(d.contextOrFrameLookup(b,c,"ErrorStrategy"),"BUBBLE",a.autoesc)})])),a.autoesc),h+='\n            </div>\n        </li>\n        <li>\n            <h3><label for="pinFormDescription">',h+=d.suppressValue((f=139,g=50,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Description"])),a.autoesc),h+="</label></h3>\n            <div>\n                ",h+=d.suppressValue((f=141,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"pinDescriptionField",options:{id:"pinFormDescription",name:"description",value:k,disabled:!r,placeholder:(f=148,g=40,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["What's this Pin all about?"])),mentions:!0,pin_id:j}})])),a.autoesc),h+="\n            </div>\n        </li>\n        ",p&&(h+="\n            ",h+=d.suppressValue((f=155,g=21,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["showLink"])),a.autoesc),h+='\n            <li>\n                <h3><label for="pinFormLink">',h+=d.suppressValue((f=157,g=47,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Source"])),a.autoesc),h+='</label></h3>\n                <div>\n                    <input type="url"\n                        name="link"\n                        id="pinFormLink"\n                        value="',h+=d.suppressValue(d.memberLookup(i,"link",a.autoesc),a.autoesc),h+='"\n                        ',r||(h+='disabled class="disabled"'),h+=" />\n                </div>\n            </li>\n        "),h+="\n\n        ",s&&o){h+='\n            <li class="placeWrapper">\n                    <h3><label>',h+=d.suppressValue((f=170,g=33,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Place"])),a.autoesc),h+='</label></h3>\n                    <div>\n                        <input type="text"\n                            disabled\n                            class="disabled"\n                            value="',h+=d.suppressValue(a.getFilter("default").call(b,d.memberLookup(o,"name",a.autoesc),""),a.autoesc),h+='">\n                    </div>\n                    ';var E;E="removePlaceButton",c.set("place_class_name",E),c.parent||(b.setVariable("place_class_name",E),b.addExport("place_class_name")),h+="\n                    ",o||(h+="\n                        ",E+=" hidden",c.set("place_class_name",E),c.parent||(b.setVariable("place_class_name",E),b.addExport("place_class_name")),h+="\n                    "),h+="\n                    ",h+=d.suppressValue((f=181,g=27,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"removePlaceButton",options:{borderless:!0,class_name:E,text:(f=186,g=37,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Remove Place"]))}})])),a.autoesc),h+="\n            </li>\n        "}h+='\n    </ul>\n\n    <div class="formFooter">\n        ';var F;F=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_explicit_share",a.autoesc),!0),c.set("show_explicit_share",F),c.parent||(b.setVariable("show_explicit_share",F),b.addExport("show_explicit_share")),h+="\n        ",F&&(h+='\n            <div class="socialShareWrapper">\n                ',u&&!v&&(h+='\n                    <label class="facebookInput">\n                        ',h+=d.suppressValue((f=199,g=31,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{name:"share_facebook",checked:w,view_type:d.contextOrFrameLookup(b,c,"none")}})])),a.autoesc),h+="\n                        <span>",h+=d.suppressValue((f=203,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Post to Facebook"])),a.autoesc),h+="</span>\n                    </label>\n                "),h+="\n                ",x&&(h+='\n                    <label class="twitterInput">\n                        ',h+=d.suppressValue((f=208,g=31,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Checkbox",d.makeKeywordArgs({options:{name:"share_twitter",checked:y,view_type:d.contextOrFrameLookup(b,c,"none")}})])),a.autoesc),h+="\n                        <span>",h+=d.suppressValue((f=212,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Post to Twitter"])),a.autoesc),h+="</span>\n                    </label>\n                "),h+="\n            </div>\n        "),h+="\n        ",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_delete",a.autoesc)?(h+='\n            <div class="formFooterDelete">\n                ',h+=d.suppressValue((f=219,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"deleteButton",options:{class_name:"deleteButton",text:(f=223,g=33,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Delete Pin"])),ga_category:"pin_delete"}})])),a.autoesc),h+="\n            </div>\n        "):d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_uploader",a.autoesc)&&(h+="\n            ",h+=d.suppressValue((f=230,g=22,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.ImageUploader",d.makeKeywordArgs({id:"uploader",options:{placeholder:l,button_options:{text:(f=235,g=37,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Choose File"])),class_name:"leftRounded",size:"large",element_type:"div",rounded:!1}}})])),a.autoesc),h+="\n        "),h+='\n\n        <div class="formFooterButtons">\n            ';var G;G=!r,c.set("disabled",G),c.parent||(b.setVariable("disabled",G),b.addExport("disabled")),h+="\n            ";var H;H="submitButton",c.set("submit_button_id",H),c.parent||(b.setVariable("submit_button_id",H),b.addExport("submit_button_id")),h+="\n            ";var I;I="primary",c.set("button_color",I),c.parent||(b.setVariable("button_color",I),b.addExport("button_color")),h+="\n            ";var J;if(J="submit",c.set("button_type",J),c.parent||(b.setVariable("button_type",J),b.addExport("button_type")),h+="\n            ",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"pin_it_script_button",a.autoesc))h+="\n                ",K={class_name:"repinSmall pinIt",type:J,show_text:!1,text:(f=264,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Pin it"])),has_icon:!0,disabled:G,color:I},c.set("button_options",K),c.parent||(b.setVariable("button_options",K),b.addExport("button_options")),h+="\n            ";else{h+="\n                ";var K;K={class_name:"savePinButton",color:I,disabled:G,text:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"submit_text",a.autoesc),(f=256,g=57,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Save Changes"]))),type:J},c.set("button_options",K),c.parent||(b.setVariable("button_options",K),b.addExport("button_options")),h+="\n            "}h+="\n\n            ",h+=d.suppressValue((f=271,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:H,options:K})])),a.autoesc),h+="\n\n            ",a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"show_cancel_button",a.autoesc),!0)&&(h+="\n                ",h+=d.suppressValue((f=275,g=23,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"cancelButton",options:{cancelButton:!0,text:a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"cancel_text",a.autoesc),(f=279,g=61,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Cancel"])))}})])),a.autoesc),h+="\n            "),h+="\n        </div>\n    </div>\n\n    ",p||(h+='\n        <input type="hidden" name="link" id="pinFormLink" value="',h+=d.suppressValue(n,a.autoesc),h+='">\n    '),h+="\n</form>\n",e(null,h)}catch(L){e(d.handleError(L,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/PlaceSelector/PlaceSelector.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=14,g=24,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["place"])||{},c.set("place",i),c.parent||(b.setVariable("place",i),b.addExport("place")),h+="\n";var j;f=15,g=27,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["writable",!1]),c.set("writable",j),c.parent||(b.setVariable("writable",j),b.addExport("writable")),h+="\n\n",j&&(f=17,g=26,d.callWrap(d.memberLookup(i,"get",a.autoesc),'place["get"]',["access"])!=d.contextOrFrameLookup(b,c,"none"))&&(h+="\n    ",j=0!=(f=18,g=38,d.callWrap(d.memberLookup(d.memberLookup(i,"access",a.autoesc),"count",a.autoesc),'place["access"]["count"]',["write"])),c.set("writable",j),c.parent||(b.setVariable("writable",j),b.addExport("writable")),h+="\n"),h+="\n\n";var k;f=21,g=42,k=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_remove_place_button",!0]),c.set("show_remove_place_button",k),c.parent||(b.setVariable("show_remove_place_button",k),b.addExport("show_remove_place_button")),h+='\n\n<div class="placeFieldWrapper">\n    <em class="searchIcon"></em>\n    ',h+=d.suppressValue((f=25,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TypeaheadField",d.makeKeywordArgs({id:"placeField",options:{class_name:"addPlaceToPinFormField",disabled:!j,enable_recent_queries:!1,name:"q",template:"place",placeholder:(f=33,g=28,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Name and city?"])),populate_on_result_highlight:!1,preserve_typeahead:(f=35,g=45,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["preserve_typeahead"])),prevent_default_on_enter:!0,set_input_value_on_selection:(f=37,g=55,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["set_input_value_on_selection"])),use_tab_index:!1,search_delay:300,show_caret:(f=40,g=37,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_caret",!0])),should_geocode:!0,spinner:{enable:!1},tags:"places",num_places:(f=46,g=37,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["num_places",5])),minimum_term_character_length:1,preserve_dropdown_on_body_mousedown:!1,value:(f=49,g=30,d.callWrap(d.memberLookup(i,"get",a.autoesc),'place["get"]',["name"])),view_type:"addPlaceToPinForm"}})])),a.autoesc),h+="\n</div>\n\n";var l;l="removePlace",c.set("remove_place_class",l),c.parent||(b.setVariable("remove_place_class",l),b.addExport("remove_place_class")),h+="\n",j&&i||(h+="\n    ",h+=d.suppressValue((f=57,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hasPlaceTags"])),a.autoesc),h+="\n    ",l+=" hidden",c.set("remove_place_class",l),c.parent||(b.setVariable("remove_place_class",l),b.addExport("remove_place_class")),h+="\n"),h+="\n\n",h+=d.suppressValue((f=61,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"removePlaceButton",options:{type:"button",text:(f=65,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Remove Place"])),class_name:l,borderless:!0}})])),a.autoesc),h+="\n",e(null,h)}catch(m){e(d.handleError(m,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/SearchInputToken/SearchInputToken.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n\n\n";var i;f=8,g=23,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["term"]),c.set("term",i),c.parent||(b.setVariable("term",i),b.addExport("term")),h+='\n\n<div class="tokenContainer">\n    <span data-element-type="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"SEARCH_BOX_TEXT_INPUT",a.autoesc),a.autoesc),h+='">',h+=d.suppressValue(i,a.autoesc),h+='</span>\n    <span data-element-type="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"SEARCH_TOKEN",a.autoesc),a.autoesc),h+='" class="remove">&times;</span>\n</div>\n',e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/SendBoard2/SendBoard2.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=11,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["SendObject2Base"])),a.autoesc),a.getTemplate("app/desktop/modules/SendObject2Base/SendObject2Base.nunjucks",!0,function(i,j){if(i)return void e(i);for(var k in j.blocks)b.addBlock(k,j.blocks[k]);h+="\n\n","newBoardHeaderStyle"==(f=13,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]))&&(h+="\n    ",h+=d.suppressValue((f=14,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["newBoardHeaderStyle"])),a.autoesc),h+="\n"),h+="\n\n",h+="\n",j.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ",h+=d.suppressValue((f=18,g=6,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Send this Board"])),a.autoesc),h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{b_title:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/SendObject2Base/SendObject2Base.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=7,g=70,i=d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"experiments",a.autoesc),"in_experiment_groups",a.autoesc),'context["experiment"]["in_experim"]',["user_profile_redesign_intl",["enabled","employees"]]),c.set("in_redesign_experiment",i),c.parent||(b.setVariable("in_redesign_experiment",i),b.addExport("in_redesign_experiment")),h+="\n",i&&(h+="\n    ",h+=d.suppressValue((f=10,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["newBoardHeaderStyle"])),a.autoesc),h+="\n"),h+='\n\n<div class="sendObjectFilter">\n    <textarea class="message" placeholder="',h+=d.suppressValue((f=14,g=45,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add a message?"])),a.autoesc),h+='"></textarea>\n    ',h+=d.suppressValue((f=15,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TypeaheadField",d.makeKeywordArgs({id:"typeaheadField",options:{name:"name",tags:"pinners_and_contacts",autofocus:!0,search_delay:0,preserve_typeahead:!0,bypass_maxheight:!0,bypass_lru_cache:!0,template:"user_circle_avatar",prefetch_on_focus:!0,prevent_default_on_enter:!0,class_name:"searchBox",placeholder:(f=29,g=28,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Search"])),autocomplete:"off"}})])),a.autoesc),h+='\n\n    <div class="spinner"></div>\n    ',h+=d.suppressValue((f=35,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ConversationsList",d.makeKeywordArgs({id:"conversationsList",options:{list_item_options:{show_is_pinner:!0,open_conversation_on_click:!0}},resource:(f=43,g=32,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["ConversationsResource"]))})])),a.autoesc),h+="\n</div>\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/SendPin2/SendPin2.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=7,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["SendObject2Base"])),a.autoesc),a.getTemplate("app/desktop/modules/SendObject2Base/SendObject2Base.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n\n",h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ",h+=d.suppressValue((f=10,g=6,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Send this Pin"])),a.autoesc),h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{b_title:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/SendPinner2/SendPinner2.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=11,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["SendObject2Base"])),a.autoesc),a.getTemplate("app/desktop/modules/SendObject2Base/SendObject2Base.nunjucks",!0,function(i,j){if(i)return void e(i);for(var k in j.blocks)b.addBlock(k,j.blocks[k]);h+="\n\n","newBoardHeaderStyle"==(f=13,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]))&&(h+="\n    ",h+=d.suppressValue((f=14,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["newBoardHeaderStyle"])),a.autoesc),h+="\n"),h+="\n\n",h+="\n",j.rootRenderFunc(a,b,c,d,e)})}catch(i){e(d.handleError(i,f,g))}}function b(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n    ",h+=d.suppressValue((f=18,g=6,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Send this Pinner"])),a.autoesc),h+="\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{b_title:b,root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/UrlPreview/UrlPreview.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{if(h+="\n\n",f=2,g=12,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["imgsrc"])){h+="\n    ";var i;f=3,g=26,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["imgsrc"]),c.set("imgsrc",i),c.parent||(b.setVariable("imgsrc",i),b.addExport("imgsrc")),h+="\n"}else f=4,g=14,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["images"])&&(h+="\n    ",f=5,g=55,i=d.callWrap(d.memberLookup((f=5,g=40,d.callWrap(d.memberLookup((f=5,g=26,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["images"])),"get",a.autoesc),'the return value of (data["get"])["get"]',["136x136"])),"get",a.autoesc),'the return value of (the return value of (data["get"])["get"])["get"]',["url"]),c.set("imgsrc",i),c.parent||(b.setVariable("imgsrc",i),b.addExport("imgsrc")),h+="\n");
h+="\n";var j;f=7,g=20,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["url"]),c.set("link",j),c.parent||(b.setVariable("link",j),b.addExport("link")),h+='\n\n<div class="imageBox">\n    ',i&&(h+='\n        <a href="',h+=d.suppressValue(j,a.autoesc),h+='" rel="nofollow">\n            <img class="attachmentImage" src="',h+=d.suppressValue(i,a.autoesc),h+='" />\n            <div class="borderMask"></div>\n        </a>\n    '),h+='\n</div>\n<div class="detailBox',i&&(h+=" hasImage"),h+='">\n    <div class="attachmentTitle">\n        <a href="',h+=d.suppressValue(j,a.autoesc),h+='" rel="nofollow">\n            ',h+=d.suppressValue((f=20,g=20,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["title"])),a.autoesc),h+='\n        </a>\n    </div>\n    <div class="attachmentDesc">',h+=d.suppressValue((f=23,g=40,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["description"])),a.autoesc),h+='</div>\n    <div class="attachmentDomain">\n        <a class="sitename" href="',h+=d.suppressValue(j,a.autoesc),h+='" rel="nofollow">\n            ',h+=d.suppressValue((f=26,g=21,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["site_name"])),a.autoesc),h+="\n        </a>\n    </div>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/UserMenu/UserMenu.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",h+=d.suppressValue((f=7,g=5,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{"data-element-type":d.memberLookup(d.contextOrFrameLookup(b,c,"ElementType"),"PROFILE_BUTTON",a.autoesc)}])),a.autoesc),h+="\n\n";var i;f=9,g=28,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["view_type",""]),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n",i&&(h+="\n    ",h+=d.suppressValue((f=11,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n"),h+="\n\n";var j;j=d.contextOrFrameLookup(b,c,"data"),c.set("user",j),c.parent||(b.setVariable("user",j),b.addExport("user")),h+="\n",h+=d.suppressValue((f=15,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"extra_data"),"extra_data",[{userId:d.memberLookup(j,"id",a.autoesc)}])),a.autoesc),h+="\n\n",f=17,g=15,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["show_caret"])&&(h+='\n    <span class="caret"></span>\n'),h+='\n<div class="usernameLink">\n    <span class="profileImage" style="background-image:url(',h+=d.suppressValue(d.memberLookup(j,"image_small_url",a.autoesc),a.autoesc),h+=')"></span>\n    <span class="profileName">',h+=d.suppressValue(d.memberLookup(j,"first_name",a.autoesc),a.autoesc),h+="</span>\n</div>\n",e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/desktop/modules/ui/PinPreview/PinPreview.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n",a.getTemplate("templates/macros/image.nunjucks",function(i,j){return i?void e(i):void j.getExported(function(i,j){if(i)return void e(i);if(!j.hasOwnProperty("image_tag"))return void e(new Error("cannot import 'image_tag'"));var k=j.image_tag;b.setVariable("image_tag",k),h+="\n\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"image_url",a.autoesc),c.set("image_url",l),c.parent||(b.setVariable("image_url",l),b.addExport("image_url")),h+="\n\n",h+=d.suppressValue((f=11,g=10,d.callWrap(k,"image_tag",[d.makeKeywordArgs({src:l,class_name:"pinPreviewImg"})])),a.autoesc),h+="\n\n",h+="\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_video",a.autoesc)&&(h+="\n    <div class='videoIndicator'></div>\n"),h+="\n",e(null,h)})})}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/internal/modules/internal/LogLevel/LogLevel.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i=d.makeMacro(["log","levels"],[],function(b,e,f){c=c.push(),f=f||{},c.set("log",b),c.set("levels",e);var g="";g+="\n<li>\n    ",g+=d.suppressValue(d.memberLookup(b,"name",a.autoesc),a.autoesc),g+="\n    <select>\n        ",c=c.push();var h=e;if(h)for(var i=0;i<h.length;i++){var j=h[i];c.set("level",j),g+="\n             <option value=",g+=d.suppressValue(d.memberLookup(b,"name",a.autoesc)+"_"+d.memberLookup(j,1,a.autoesc),a.autoesc),g+="\n             ",d.memberLookup(b,"logLevel",a.autoesc)==d.memberLookup(j,1,a.autoesc)&&(g+="\n                 selected\n             "),g+="\n             >",g+=d.suppressValue(d.memberLookup(j,0,a.autoesc),a.autoesc),g+="</option>\n        "}return c=c.pop(),g+="\n    </select>\n</li>\n",c=c.pop(),new d.SafeString(g)});b.addExport("single_log"),b.setVariable("single_log",i),h+='\n\n<div class="header">\n    <h1>Choose the log level you want for each logger</h1>\n    <a href="#" class="refreshButton">Refresh list</a>&nbsp;\n    <a href="/_/_/debug/">Back to Debug</a>\n</div>\n<div class="changeAll">\n    Change all to\n    ',c=c.push();var j=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"levels",a.autoesc);if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("level",l),h+='\n         <a class="switch" data-val="',h+=d.suppressValue(d.memberLookup(l,1,a.autoesc),a.autoesc),h+='">',h+=d.suppressValue(d.memberLookup(l,0,a.autoesc),a.autoesc),h+="</a>&nbsp;\n    "}c=c.pop(),h+="\n</div>\n<div>\n    ",c=c.push();var m=d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"loggerColumns",a.autoesc);if(m)for(var n=0;n<m.length;n++){var o=m[n];c.set("loggerColumn",o),h+="\n        <ul>\n            ",c=c.push();var p=o;if(p)for(var q=0;q<p.length;q++){var r=p[q];c.set("logItem",r),h+="\n                ",h+=d.suppressValue((f=30,g=27,d.callWrap(i,"single_log",[d.makeKeywordArgs({log:r,levels:d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"levels",a.autoesc)})])),a.autoesc),h+="\n            "}c=c.pop(),h+="\n        </ul>\n    "}c=c.pop(),h+="\n</div>\n",e(null,h)}catch(s){e(d.handleError(s,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/mobile/modules/Header/Header.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i="a",c.set("header_button_element_type",i),c.parent||(b.setVariable("header_button_element_type",i),b.addExport("header_button_element_type")),h+="\n";var j;j="small",c.set("header_button_size",j),c.parent||(b.setVariable("header_button_size",j),b.addExport("header_button_size")),h+="\n";var k;k=!1,c.set("header_button_rounded",k),c.parent||(b.setVariable("header_button_rounded",k),b.addExport("header_button_rounded")),h+="\n";var l;l=!1,c.set("header_button_show_text",l),c.parent||(b.setVariable("header_button_show_text",l),b.addExport("header_button_show_text")),h+="\n";var m;m=!0,c.set("header_button_has_icon",m),c.parent||(b.setVariable("header_button_has_icon",m),b.addExport("header_button_has_icon")),h+="\n\n";var n;f=14,g=30,n=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["main_module",{}]),c.set("main_module",n),c.parent||(b.setVariable("main_module",n),b.addExport("main_module")),h+="\n\n";var o;f=16,g=39,o=d.callWrap(d.memberLookup(n,"get",a.autoesc),'main_module["get"]',["className",(f=16,g=68,d.callWrap(d.memberLookup(n,"get",a.autoesc),'main_module["get"]',["name",""]))]),c.set("main_module_name",o),c.parent||(b.setVariable("main_module_name",o),b.addExport("main_module_name")),h+="\n";var p;f=17,g=42,p=d.callWrap(d.memberLookup(n,"get",a.autoesc),'main_module["get"]',["options",{}]),c.set("main_module_options",p),c.parent||(b.setVariable("main_module_options",p),b.addExport("main_module_options")),h+="\n";var q;if(q="logo",c.set("header_highlight",q),c.parent||(b.setVariable("header_highlight",q),b.addExport("header_highlight")),h+="\n","PinBookmarklet"==o){h+="\n    ";var r;r=!0,c.set("logo_only",r),c.parent||(b.setVariable("logo_only",r),b.addExport("logo_only")),h+="\n    ",d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc)&&(h+="\n        ",h+=d.suppressValue((f=22,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["sticky"])),a.autoesc),h+="\n    "),h+="\n"}else h+="\n    ",r=!1,c.set("logo_only",r),c.parent||(b.setVariable("logo_only",r),b.addExport("logo_only")),h+="\n    ",h+="\n    ","ExplorePage"==o||"FeedPage"==o||"SearchPage"==o?(h+="\n        ",q="explore",c.set("header_highlight",q),c.parent||(b.setVariable("header_highlight",q),b.addExport("header_highlight")),h+="\n    "):("UserProfilePage"==o&&(f=33,g=24,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["username"])==(f=33,g=63,d.callWrap(d.memberLookup(p,"get",a.autoesc),'main_module_options["get"]',["username"])))||"JoinSplashPage"==o||"LoginPage"==o)&&(h+="\n        ",q="profile",c.set("header_highlight",q),c.parent||(b.setVariable("header_highlight",q),b.addExport("header_highlight")),h+="\n    "),h+="\n";if(h+="\n\n",!r){h+="\n    ";var s;s="explore",c.set("explore_button_class",s),c.parent||(b.setVariable("explore_button_class",s),b.addExport("explore_button_class")),h+="\n    ","explore"==q&&(h+="\n        ",s+=" highlight",c.set("explore_button_class",s),c.parent||(b.setVariable("explore_button_class",s),b.addExport("explore_button_class")),h+="\n    "),h+="\n    ",h+=d.suppressValue((f=45,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["NavigateButton",d.makeKeywordArgs({id:"explore",options:{class_name:s,size:j,element_type:i,has_icon:m,rounded:k,show_text:l,url:"/categories/"}})])),a.autoesc),h+="\n"}h+="\n\n";var t;if(t="logo",c.set("logo_class",t),c.parent||(b.setVariable("logo_class",t),b.addExport("logo_class")),h+="\n","logo"==q&&(h+="\n    ",t+=" highlight",c.set("logo_class",t),c.parent||(b.setVariable("logo_class",t),b.addExport("logo_class")),h+="\n"),h+='\n<a href="/" class="',h+=d.suppressValue(t,a.autoesc),h+='">\n    <h1>Pinterest</h1>\n</a>\n\n',!r){if(h+="\n    ",d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc)&&(f=67,g=41,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["username"]))){h+="\n        ";var u;u="/"+(f=68,g=41,d.callWrap(d.memberLookup(d.memberLookup(d.contextOrFrameLookup(b,c,"context"),"user",a.autoesc),"get",a.autoesc),'context["user"]["get"]',["username"]))+"/",c.set("url",u),c.parent||(b.setVariable("url",u),b.addExport("url")),h+="\n    "}else h+="\n        ",u="/join/",c.set("url",u),c.parent||(b.setVariable("url",u),b.addExport("url")),h+="\n    ";h+="\n\n    ";var v;v="userProfile",c.set("profile_button_class",v),c.parent||(b.setVariable("profile_button_class",v),b.addExport("profile_button_class")),h+="\n    ","profile"==q&&(h+="\n        ",v+=" highlight",c.set("profile_button_class",v),c.parent||(b.setVariable("profile_button_class",v),b.addExport("profile_button_class")),h+="\n    "),h+="\n    ",h+=d.suppressValue((f=77,g=11,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["NavigateButton",d.makeKeywordArgs({id:"userProfile",options:{class_name:v,size:j,element_type:i,has_icon:m,rounded:k,show_text:l,url:u}})])),a.autoesc),h+="\n"}e(null,h)}catch(w){e(d.handleError(w,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/BreadcrumbNavigation/BreadcrumbNavigation.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=8,g=30,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["breadcrumbs",[]]),c.set("breadcrumbs",i),c.parent||(b.setVariable("breadcrumbs",i),b.addExport("breadcrumbs")),h+="\n",c=c.push();var j=i;if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("breadcrumb",l),h+='\n    <a\n        class="crumb"\n        href="',h+=d.suppressValue(d.memberLookup(l,"link",a.autoesc),a.autoesc),h+='">\n        <em class="crumbDivider"></em>\n        <span class="crumbText">\n            ',h+=d.suppressValue(d.memberLookup(l,"title",a.autoesc),a.autoesc),h+="\n        </span>\n    </a>\n"}c=c.pop(),h+="\n\n",e(null,h)}catch(m){e(d.handleError(m,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/CampaignPicker/CampaignPicker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=a.getFilter("default").call(b,d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"view_type",a.autoesc),"normal"),c.set("view_type",i),c.parent||(b.setVariable("view_type",i),b.addExport("view_type")),h+="\n\n";var j;f=9,g=23,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["data"]),c.set("data",j),c.parent||(b.setVariable("data",j),b.addExport("data")),h+="\n\n";var k;k={create_item_label:(f=12,g=26,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create a new campaign"])),skip_append_created_item:!0,input_placeholder_text:(f=14,g=31,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Create a new campaign"]))},c.set("base_options",k),c.parent||(b.setVariable("base_options",k),b.addExport("base_options")),h+="\n\n",h+=d.suppressValue((f=17,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[k])),a.autoesc),h+=d.suppressValue((f=17,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.Picker"])),a.autoesc),a.getTemplate("app/common/modules/ui/Picker/Picker.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(l){e(d.handleError(l,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/CampaignPickerDropdownButton/CampaignPickerDropdownButton.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i={arrow:"down",dropdown_options:{class_name:"aboveModal strongBorder boardPicker",hide_caret:!0},label_module:{name:"ui.Label",options:{},data:{name:(f=15,g=26,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Choose a Campaign"]))}}},c.set("base_options",i),c.parent||(b.setVariable("base_options",i),b.addExport("base_options")),h+="\n\n",d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc)&&(h+="\n    ",h+=d.suppressValue((f=20,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"attr"),"attr",[{name:d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"name",a.autoesc)}])),a.autoesc),h+="\n"),h+="\n\n",h+=d.suppressValue((f=23,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[i])),a.autoesc),h+=d.suppressValue((f=23,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["DropdownButton"])),a.autoesc),a.getTemplate("app/common/modules/DropdownButton/DropdownButton.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/SearchKeywordsImport/SearchKeywordsImport.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='\n\n<form class="standardForm">\n    <h1>\n        <strong>',h+=d.suppressValue((f=4,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Import multiple keywords"])),a.autoesc),h+='</strong>\n    </h1>\n    <ul>\n        <li>\n            <div class="helperText">\n                ',h+=d.suppressValue((f=9,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Separated by "])),a.autoesc),h+='\n                <div class="separatorSelectButton">\n                    ',h+=d.suppressValue((f=11,g=27,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.SelectButton",d.makeKeywordArgs({id:"separatorSelect",options:{name:"separator",text:(f=15,g=37,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["commas"])),items:[{label:"commas",value:"comma",selected:!0},{label:"line breaks",value:"newline"}],dropdown_options:{class_name:"aboveModal"}}})])),a.autoesc),h+="\n                </div>\n            </div>\n            ",h+=d.suppressValue((f=26,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.TextField",d.makeKeywordArgs({id:"csvField"})])),a.autoesc),h+='\n        </li>\n    </ul>\n    <div class="formFooter">\n        <div class="formFooterButtons">\n            ',h+=d.suppressValue((f=31,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"cancelButton",options:{cancelButton:!0,text:(f=35,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Cancel"]))}})])),a.autoesc),h+="\n\n            ",h+=d.suppressValue((f=39,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["Button",d.makeKeywordArgs({id:"submitButton",options:{type:"submit",color:"primary",text:(f=44,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Add keywords"]))}})])),a.autoesc),h+="\n        </div>\n    </div>\n</form>\n",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/SearchKeywordsTargetingTable/SearchKeywordsTargetingTable.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;f=9,g=29,i=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["class_name"]),c.set("class_name",i),c.parent||(b.setVariable("class_name",i),b.addExport("class_name")),h+="\n";var j;f=10,g=41,j=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"get",a.autoesc),'options["get"]',["input_placeholder_text",(f=10,g=69,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Search for keywords"]))]),c.set("input_placeholder_text",j),c.parent||(b.setVariable("input_placeholder_text",j),b.addExport("input_placeholder_text")),h+="\n\n",i&&(h+="\n    ",h+=d.suppressValue((f=13,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",[i])),a.autoesc),h+="\n"),h+='\n\n<div class="top">\n    <div class="nameWrapper">\n        ',h+="\n        ",h+=d.suppressValue((f=22,g=15,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ui.Input",d.makeKeywordArgs({id:"name",options:{name:"name",class_name:"name",placeholder:j,autocomplete:"off"}})])),a.autoesc),h+='\n    </div>\n</div>\n\n<div class="noQuery">\n    <div class="import">\n        <div class="importText">\n            ',h+=d.suppressValue((f=37,g=14,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Would you like to import multiple keywords?"])),a.autoesc),h+='\n        </div>\n        <div class="importButtonWrapper">\n            ',h+=d.suppressValue((f=40,g=19,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["ShowModalButton",d.makeKeywordArgs({id:"csvButton",options:{text:(f=43,g=29,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Import"])),show_text:!0,submodule:{name:"SearchKeywordsImport"}}})])),a.autoesc),h+="\n        </div>\n    </div>\n</div>\n\n",h+=d.suppressValue((f=53,g=7,d.callWrap(d.contextOrFrameLookup(b,c,"module"),"module",["SearchKeywordsTargetingTableRows",d.makeKeywordArgs({id:"searchKeywordsTargetingTableRows",options:d.contextOrFrameLookup(b,c,"options"),resource:(f=56,g=28,d.callWrap(d.contextOrFrameLookup(b,c,"create_resource"),"create_resource",["SterlingSearchKeywordsTypeaheadResource",d.makeKeywordArgs({options:{term:"",tags:"pin_autocomplete",num_autocompletes:4}})]))})])),a.autoesc),e(null,h)}catch(k){e(d.handleError(k,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/SearchKeywordsTargetingTableRows/SearchKeywordsTargetingTableRows.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=[],c.set("rows",i),c.parent||(b.setVariable("rows",i),b.addExport("rows")),h+="\n",c=c.push();var j=(f=9,g=21,d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"data"),"get",a.autoesc),'data["get"]',["items",[]]));if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("item",l),h+="\n    ";var m;f=10,g=33,m=d.callWrap(d.memberLookup(i,"append",a.autoesc),'rows["append"]',[{key:(f=12,g=27,d.callWrap(d.memberLookup(l,"get",a.autoesc),'item["get"]',["raw_query"])),name:(f=13,g=28,d.callWrap(d.memberLookup(l,"get",a.autoesc),'item["get"]',["label"]))}]),c.set("throw_away",m),c.parent||(b.setVariable("throw_away",m),b.addExport("throw_away")),h+="\n"}c=c.pop(),h+="\n\n";var n;n={rows:i},c.set("data",n),c.parent||(b.setVariable("data",n),b.addExport("data")),h+="\n\n";var o;f=19,g=32,o=d.callWrap(d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"update",a.autoesc),'options["update"]',[{show_top_section:!1}]),c.set("throw_away",o),c.parent||(b.setVariable("throw_away",o),b.addExport("throw_away")),h+="\n\n",h+=d.suppressValue((f=21,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"describe"),"describe",[d.contextOrFrameLookup(b,c,"options")])),a.autoesc),h+=d.suppressValue((f=21,g=1,d.callWrap(d.contextOrFrameLookup(b,c,"base"),"base",["ui.TableLookalikePicker"])),a.autoesc),a.getTemplate("app/common/modules/ui/TableLookalikePicker/TableLookalikePicker.nunjucks",!0,function(f,g){if(f)return void e(f);for(var i in g.blocks)b.addBlock(i,g.blocks[i]);h+="\n",g.rootRenderFunc(a,b,c,d,e)})}catch(p){e(d.handleError(p,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/TargetingValueToken/TargetingValueToken.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"targeting_type",a.autoesc),c.set("targeting_type",i),c.parent||(b.setVariable("targeting_type",i),b.addExport("targeting_type")),h+="\n";var j;j=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"targeting_value",a.autoesc),c.set("targeting_value",j),c.parent||(b.setVariable("targeting_value",j),b.addExport("targeting_value")),h+="\n";var k;k=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_default",a.autoesc),c.set("is_default",k),c.parent||(b.setVariable("is_default",k),b.addExport("is_default")),h+="\n";var l;l=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"is_more",a.autoesc),c.set("is_more",l),c.parent||(b.setVariable("is_more",l),b.addExport("is_more")),h+="\n";var m;m=d.memberLookup(d.contextOrFrameLookup(b,c,"options"),"hidden",a.autoesc),c.set("hidden",m),c.parent||(b.setVariable("hidden",m),b.addExport("hidden")),h+="\n\n",h+=d.suppressValue((f=21,g=9,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["targeting-color-"+i])),a.autoesc),h+="\n",k?(h+="\n    ",h+=d.suppressValue((f=23,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["default"])),a.autoesc),h+="\n    ",m&&(h+="\n        ",h+=d.suppressValue((f=25,g=17,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["hidden"])),a.autoesc),h+="\n    "),h+="\n"):l?(h+="\n    ",h+=d.suppressValue((f=28,g=13,d.callWrap(d.contextOrFrameLookup(b,c,"addclass"),"addclass",["more"])),a.autoesc),h+="\n"):h+='\n    <em class="removeTargeting"></em>\n',h+="\n",h+=d.suppressValue(d.memberLookup(j,"name",a.autoesc),a.autoesc),h+="\n",e(null,h)}catch(n){e(d.handleError(n,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["app/sterling/modules/VisitedAdvertisers/VisitedAdvertisers.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n\n";var i;i=d.contextOrFrameLookup(b,c,"data")||[],c.set("advertisers",i),c.parent||(b.setVariable("advertisers",i),b.addExport("advertisers")),h+='\n\n<form class="standardForm">\n    <ul>\n        <li>\n            <h2>',h+=d.suppressValue((f=17,g=18,d.callWrap(d.contextOrFrameLookup(b,c,"_"),"_",["Recently Visited"])),a.autoesc),h+="</h2>\n        </li>\n        <li>\n            <ul>\n            ",c=c.push();var j=i;if(j)for(var k=0;k<j.length;k++){var l=j[k];c.set("advertiser",l),h+="\n                ";var m;m="/advertiser/"+d.memberLookup(l,"id",a.autoesc)+"/",c.set("url",m),c.parent||(b.setVariable("url",m),b.addExport("url")),h+="\n                ";var n;n=d.memberLookup(l,"name",a.autoesc),c.set("advertiser_name",n),c.parent||(b.setVariable("advertiser_name",n),b.addExport("advertiser_name")),h+='\n                <li>\n                    <a href="',h+=d.suppressValue(m,a.autoesc),h+='">',h+=d.suppressValue(n,a.autoesc),h+="</a>\n                </li>\n            "}c=c.pop(),h+="\n            </ul>\n        </li>\n    </ul>\n</form>\n",e(null,h)}catch(o){e(d.handleError(o,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["templates/macros/boardpicker.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i=d.makeMacro(["is_secret","is_collaborative","is_place","show_arrow"],[],function(a,b,e,f,g){c=c.push(),g=g||{},c.set("is_secret",a),c.set("is_collaborative",b),c.set("is_place",e),c.set("show_arrow",f);var h="";return h+='\n    <div class="iconWrapper">\n        <span class="placeIcon ',e||(h+="hidden"),h+='"></span>\n        <span class="secretIcon ',a||(h+="hidden"),h+='"></span>\n        <span class="collaborativeIcon ',b||(h+="hidden"),h+='"></span>\n        ',f&&(h+='\n            <span class="downArrow"></span>\n        '),h+="\n    </div>\n",c=c.pop(),new d.SafeString(h)});b.addExport("icon_wrapper"),b.setVariable("icon_wrapper",i),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["templates/macros/geo_feature.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{var i=d.makeMacro(["feature"],[],function(b,e){c=c.push(),e=e||{},c.set("feature",b);var f="";return f+='\n    <div class="flag',f+=d.suppressValue(d.memberLookup(b,"cc",a.autoesc),a.autoesc),f+=' flagIcon"></div>\n    <p class="featureName">',f+=d.suppressValue(d.memberLookup(b,"text",a.autoesc),a.autoesc),f+="</p>\n",c=c.pop(),new d.SafeString(f)});b.addExport("geo_feature"),b.setVariable("geo_feature",i),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["templates/macros/image.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n";var i=d.makeMacro([],["src","class_name","width","height","style","add_class_on_load","alt","item_prop"],function(e){c=c.push(),e=e||{},c.set("src",e.hasOwnProperty("src")?e.src:""),c.set("class_name",e.hasOwnProperty("class_name")?e.class_name:""),c.set("width",e.hasOwnProperty("width")?e.width:-1),c.set("height",e.hasOwnProperty("height")?e.height:-1),c.set("style",e.hasOwnProperty("style")?e.style:{}),c.set("add_class_on_load",e.hasOwnProperty("add_class_on_load")?e.add_class_on_load:!1),c.set("alt",e.hasOwnProperty("alt")?e.alt:""),c.set("item_prop",e.hasOwnProperty("item_prop")?e.item_prop:"");var f="";f+="\n    ",f+='\n    \n\n    <img src="',f+=d.suppressValue(d.contextOrFrameLookup(b,c,"src"),a.autoesc),f+='"',d.contextOrFrameLookup(b,c,"class_name")&&(f+='\n        class="',f+=d.suppressValue(d.contextOrFrameLookup(b,c,"class_name"),a.autoesc),f+='"\n    '),f+='style="',-1!=d.contextOrFrameLookup(b,c,"height")&&(f+="height:",f+=d.suppressValue(d.contextOrFrameLookup(b,c,"height"),a.autoesc),f+="px;"),-1!=d.contextOrFrameLookup(b,c,"width")&&(f+="width:",f+=d.suppressValue(d.contextOrFrameLookup(b,c,"width"),a.autoesc),f+="px;"),c=c.push();var g=a.getFilter("dictsort").call(b,d.contextOrFrameLookup(b,c,"style"));if(g){var h;if(d.isArray(g))for(h=0;h<g.length;h++){var i=g[h][0];c.set("name",g[h][0]);var j=g[h][1];c.set("value",g[h][1]),f+=d.suppressValue(i,a.autoesc),f+=":",f+=d.suppressValue(j,a.autoesc),f+=";"}else{h=-1;for(var k in g){h++;var l=g[k];c.set("name",k),c.set("value",l),f+=d.suppressValue(k,a.autoesc),f+=":",f+=d.suppressValue(l,a.autoesc),f+=";"}}}return c=c.pop(),f+='"',d.contextOrFrameLookup(b,c,"add_class_on_load")&&(f+='\n        onload="P.lazy.onImageLoad(this)"\n    '),d.contextOrFrameLookup(b,c,"alt")&&(f+='\n        alt="',f+=d.suppressValue(d.contextOrFrameLookup(b,c,"alt"),a.autoesc),f+='"\n    '),d.contextOrFrameLookup(b,c,"item_prop")&&(f+='\n        itemprop="',f+=d.suppressValue(d.contextOrFrameLookup(b,c,"item_prop"),a.autoesc),f+='"\n    '),f+=">\n",c=c.pop(),new d.SafeString(f)});b.addExport("image_tag"),b.setVariable("image_tag",i),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["templates/macros/link.nunjucks"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+="\n";var i=d.makeMacro(["url","text"],["no_follow","new_window","element_type"],function(e,f,g){c=c.push(),g=g||{},c.set("url",e),c.set("text",f),c.set("no_follow",g.hasOwnProperty("no_follow")?g.no_follow:!1),c.set("new_window",g.hasOwnProperty("new_window")?g.new_window:!1),c.set("element_type",g.hasOwnProperty("element_type")?g.element_type:!1);var h="";return h+='<a href="',h+=d.suppressValue(e,a.autoesc),h+='"\n\n        ',d.contextOrFrameLookup(b,c,"no_follow")&&(h+='rel="nofollow"'),h+="\n        ",d.contextOrFrameLookup(b,c,"new_window")&&(h+='target="_blank"'),h+="\n        ",d.contextOrFrameLookup(b,c,"element_type")&&(h+='data-element-type="',h+=d.suppressValue(d.contextOrFrameLookup(b,c,"element_type"),a.autoesc),h+='"'),h+="\n\n    >",h+=d.suppressValue(f,a.autoesc),h+="</a>",c=c.pop(),new d.SafeString(h)});b.addExport("link_markup"),b.setVariable("link_markup",i),h+="\n",e(null,h)}catch(j){e(d.handleError(j,f,g))}}return{root:a}}()}();